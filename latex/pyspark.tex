%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,11pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
\edef\sphinxdqmaybe{\ifdefined\DeclareUnicodeCharacterAsOptional\string"\fi}
  \DeclareUnicodeCharacter{\sphinxdqmaybe00A0}{\nobreakspace}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2500}{\sphinxunichar{2500}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2502}{\sphinxunichar{2502}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2514}{\sphinxunichar{2514}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe251C}{\sphinxunichar{251C}}
  \DeclareUnicodeCharacter{\sphinxdqmaybe2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}
\usepackage{times}
\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}

% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\figurename}{Fig.\@ }}
\makeatletter
\def\fnum@figure{\figurename\thefigure{}}
\makeatother
\addto\captionsenglish{\renewcommand{\tablename}{Table }}
\makeatletter
\def\fnum@table{\tablename\thetable{}}
\makeatother
\addto\captionsenglish{\renewcommand{\literalblockname}{Listing}}

\addto\captionsenglish{\renewcommand{\literalblockcontinuedname}{continued from previous page}}
\addto\captionsenglish{\renewcommand{\literalblockcontinuesname}{continues on next page}}
\addto\captionsenglish{\renewcommand{\sphinxnonalphabeticalgroupname}{Non-alphabetical}}
\addto\captionsenglish{\renewcommand{\sphinxsymbolsname}{Symbols}}
\addto\captionsenglish{\renewcommand{\sphinxnumbersname}{Numbers}}

\addto\extrasenglish{\def\pageautorefname{page}}

\setcounter{tocdepth}{1}

\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{dsfont}
\def\Z{\mathbb{Z}}
\def\R{\mathbb{R}}
\def\bX{\mathbf{X}}
\def\X{\mathbf{X}}
\def\By{\mathbf{y}}
\def\Bbeta{\boldsymbol{\beta}}
\def\bU{\mathbf{U}}
\def\bV{\mathbf{V}}
\def\V1{\mathds{1}}
\def\hU{\mathbf{\hat{U}}}
\def\hS{\mathbf{\hat{\Sigma}}}
\def\hV{\mathbf{\hat{V}}}
\def\E{\mathbf{E}}
\def\F{\mathbf{F}}
\def\x{\mathbf{x}}
\def\h{\mathbf{h}}
\def\v{\mathbf{v}}
\def\nv{\mathbf{v^{{f -}}}}
\def\nh{\mathbf{h^{{f -}}}}
\def\s{\mathbf{s}}
\def\b{\mathbf{b}}
\def\c{\mathbf{c}}
\def\W{\mathbf{W}}
\def\C{\mathbf{C}}
\def\P{\mathbf{P}}
\def\T{{\bf \mathcal T}}
\def\B{{\bf \mathcal B}}
\def\euler{\ e^{i\pi} + 1 = 0}


\title{Learning Apache Spark with Python}
\date{March 20, 2019}
\release{1.00}
\author{Wenqiang Feng}
\newcommand{\sphinxlogo}{\sphinxincludegraphics{logo.jpg}\par}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{logo}.jpg}
\end{figure}
\end{quote}

Welcome to my \sphinxstylestrong{Learning Apache Spark with Python} note!
In this note, you will learn a wide array of concepts about
\sphinxstylestrong{PySpark} in Data Mining, Text Mining, Machine Learning
and Deep Learning. The PDF version can be downloaded from \sphinxhref{pyspark.pdf}{HERE}.




\chapter{Preface}
\label{\detokenize{preface:preface}}\label{\detokenize{preface:id1}}\label{\detokenize{preface::doc}}

\section{About}
\label{\detokenize{preface:about}}

\subsection{About this note}
\label{\detokenize{preface:about-this-note}}
This is a shared repository for \sphinxhref{https://github.com/runawayhorse001/LearningApacheSpark}{Learning Apache Spark Notes}.
The PDF version can be downloaded from \sphinxhref{pyspark.pdf}{HERE}.
The first version was posted on Github in \sphinxhref{https://mingchen0919.github.io/learning-apache-spark/index.html}{ChenFeng} (\sphinxcite{reference:feng2017}).
This shared repository mainly contains the self-learning and
self-teaching notes from Wenqiang during his \sphinxhref{https://www.ima.umn.edu/2016-2017/SW1.23-3.10.17\#}{IMA Data Science
Fellowship}. The reader is referred to the repository \sphinxurl{https://github.com/runawayhorse001/LearningApacheSpark} for more
details about the \sphinxcode{\sphinxupquote{dataset}} and the \sphinxcode{\sphinxupquote{.ipynb}} files.

In this repository, I try to use the detailed demo code and
examples to show how to use each main functions. If you find
your work wasn’t cited in this note, please feel free to let
me know.

Although I am by no means an data mining programming and Big Data expert,
I decided that it would be useful for me to share what I learned
about PySpark programming in the form of easy tutorials with
detailed example. I hope those tutorials will be a valuable tool
for your studies.

The tutorials assume that the reader has a preliminary knowledge
of programing and Linux. And this document is generated automatically
by using \sphinxhref{http://sphinx.pocoo.org}{sphinx}.


\subsection{About the authors}
\label{\detokenize{preface:about-the-authors}}\begin{itemize}
\item {} 
\sphinxstylestrong{Wenqiang Feng}
\begin{itemize}
\item {} 
Data Scientist and PhD in Mathematics

\item {} 
University of Tennessee at Knoxville

\item {} 
Email: \sphinxhref{mailto:von198@gmail.com}{von198@gmail.com}

\end{itemize}

\item {} 
\sphinxstylestrong{Biography}

Wenqiang Feng is Data Scientist within DST’s Applied Analytics Group. Dr. Feng’s responsibilities include providing DST clients with access to cutting-edge skills and technologies, including Big Data analytic solutions, advanced analytic and data enhancement techniques and modeling.

Dr. Feng has deep analytic expertise in data mining, analytic systems, machine learning algorithms, business intelligence, and applying Big Data tools to strategically solve industry problems in a cross-functional business. Before joining DST, Dr. Feng was an IMA Data Science Fellow at The Institute for Mathematics and its Applications (IMA) at the University of Minnesota. While there, he helped startup companies make marketing decisions based on deep predictive analytics.

Dr. Feng graduated from University of Tennessee, Knoxville, with Ph.D. in Computational Mathematics and Master’s degree in Statistics. He also holds Master’s degree in Computational Mathematics from Missouri University of Science and Technology (MST) and Master’s degree in Applied Mathematics from the University of Science and Technology of China (USTC).

\item {} 
\sphinxstylestrong{Declaration}

The work of Wenqiang Feng was supported by the IMA, while working at IMA. However, any opinion, finding, and conclusions or recommendations expressed in this material are those of the author and do not necessarily reflect the views of the IMA, UTK and DST.

\end{itemize}


\section{Motivation for this tutorial}
\label{\detokenize{preface:motivation-for-this-tutorial}}
I was motivated by the \sphinxhref{https://www.ima.umn.edu/2016-2017/SW1.23-3.10.17\#}{IMA Data Science Fellowship}
project to learn PySpark. After that I was impressed and attracted by the
PySpark. And I foud that:
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
It is no exaggeration to say that Spark is the most powerful
Bigdata tool.

\item {} 
However, I still found that learning Spark was a difficult
process. I have to Google it and identify which one is true.
And it was hard to find detailed examples which I can easily
learned the full process in one file.

\item {} 
Good sources are expensive for a graduate student.

\end{enumerate}


\section{Copyright notice and license info}
\label{\detokenize{preface:copyright-notice-and-license-info}}
This \sphinxhref{pyspark.pdf}{Learning Apache Spark with Python} PDF file is supposed to be a free and living document, which is why its source is available online at \sphinxurl{https://runawayhorse001.github.io/LearningApacheSpark/pyspark.pdf}. But this document is licensed according to both \sphinxhref{https://github.com/runawayhorse001/LearningApacheSpark/blob/master/LICENSE}{MIT License} and  \sphinxhref{https://creativecommons.org/licenses/by-nc/2.0/legalcode}{Creative Commons Attribution-NonCommercial 2.0 Generic (CC BY-NC 2.0) License}.

\sphinxstylestrong{When you plan to use, copy, modify, merge, publish, distribute or sublicense, Please see the terms of those licenses for more details and give the corresponding credits to the author}.


\section{Acknowledgement}
\label{\detokenize{preface:acknowledgement}}
At here, I would like to thank Ming Chen, Jian Sun and Zhongbo Li at the
University of Tennessee at Knoxville for the valuable disscussion
and thank the generous anonymous authors for providing the detailed
solutions and source code on the internet. Without those help,
this repository would not have been possible to be made. Wenqiang
also would like to thank the \sphinxhref{https://www.ima.umn.edu/}{Institute for Mathematics and Its
Applications (IMA)} at \sphinxhref{https://twin-cities.umn.edu/}{University of Minnesota, Twin Cities}
for support during his IMA Data Scientist Fellow visit.

A special thank you goes to \sphinxhref{http://staffwww.dcs.shef.ac.uk/people/H.Lu/}{Dr. Haiping Lu}, Lecturer in Machine Learning
at Department of Computer Science, University of Sheffield, for recommending
and heavily using my tutorial in his teaching class and for the valuable
suggestions.


\section{Feedback and suggestions}
\label{\detokenize{preface:feedback-and-suggestions}}
Your comments and suggestions are highly appreciated. I am more
than happy to receive corrections, suggestions or feedbacks through
email (\sphinxhref{mailto:von198@gmail.com}{von198@gmail.com}) for improvements.


\chapter{Why Spark with Python ?}
\label{\detokenize{why:why-spark-with-python}}\label{\detokenize{why:why}}\label{\detokenize{why::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

\sphinxstylestrong{Sharpening the knife longer can make it easier to hack the firewood} \textendash{} old Chinese proverb
\end{sphinxadmonition}

I want to answer this question from the following two parts:


\section{Why Spark?}
\label{\detokenize{why:why-spark}}
I think the following four main reasons from \sphinxhref{http://spark.apache.org/}{Apache Spark™} official website are good enough
to convince you to use Spark.
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Speed

Run programs up to 100x faster than Hadoop MapReduce in memory, or 10x faster on disk.

Apache Spark has an advanced DAG execution engine that supports acyclic data flow and in-memory computing.

\end{enumerate}
\begin{quote}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{logistic-regression}.png}
\caption{Logistic regression in Hadoop and Spark}\label{\detokenize{why:id1}}\label{\detokenize{why:fig-lr}}\end{figure}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Ease of Use

Write applications quickly in Java, Scala, Python, R.

Spark offers over 80 high-level operators that make it easy to build parallel apps. And you can use it interactively from the Scala, Python and R shells.

\item {} 
Generality

Combine SQL, streaming, and complex analytics.

Spark powers a stack of libraries including SQL and DataFrames, MLlib for machine learning, GraphX, and Spark Streaming. You can combine these libraries seamlessly in the same application.

\end{enumerate}
\begin{quote}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.7]{{stack}.png}
\caption{The Spark stack}\label{\detokenize{why:id2}}\label{\detokenize{why:fig-stack}}\end{figure}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Runs Everywhere

Spark runs on Hadoop, Mesos, standalone, or in the cloud. It can access diverse data sources including HDFS, Cassandra, HBase, and S3.

\end{enumerate}
\begin{quote}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[scale=0.6]{{spark-runs-everywhere}.png}
\caption{The Spark platform}\label{\detokenize{why:id3}}\label{\detokenize{why:fig-runs}}\end{figure}
\end{quote}


\section{Why Spark with Python (PySpark)?}
\label{\detokenize{why:why-spark-with-python-pyspark}}
No matter you like it or not, Python has been one of the most popular programming languages.
\begin{quote}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{languages}.jpg}
\caption{KDnuggets Analytics/Data Science 2017 Software Poll from \sphinxhref{http://www.kdnuggets.com/2017/05/poll-analytics-data-science-machine-learning-software-leaders.html}{kdnuggets}.}\label{\detokenize{why:id4}}\label{\detokenize{why:fig-languages}}\end{figure}
\end{quote}


\chapter{Configure Running Platform}
\label{\detokenize{setup:configure-running-platform}}\label{\detokenize{setup:setup}}\label{\detokenize{setup::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

\sphinxstylestrong{Good tools are prerequisite to the successful execution
of a job.} \textendash{} old Chinese proverb
\end{sphinxadmonition}

A good programming platform can save you lots of troubles and time.
Herein I will only present how to install my favorite programming
platform and only show the easiest way which I know to set it up
on Linux system. If you want to install on the other operator
system, you can Google it. In this section, you may learn how to
set up Pyspark on the corresponding programming platform and package.

\index{Run on Databricks Community Cloud@\spxentry{Run on Databricks Community Cloud}}\ignorespaces 

\section{Run on Databricks Community Cloud}
\label{\detokenize{setup:run-on-databricks-community-cloud}}\label{\detokenize{setup:index-0}}
If you don’t have any experience with Linux or Unix operator
system, I would love to recommend you to use Spark on Databricks
Community Cloud. Since you do not need to setup the Spark and it’s
totally \sphinxstylestrong{free} for Community Edition. Please follow the steps
listed below.
\begin{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Sign up a account at: \sphinxurl{https://community.cloud.databricks.com/login.html}

\end{enumerate}
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{login}.png}
\end{figure}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Sign in with your account, then you can creat your cluster(machine), table(dataset)
and notebook(code).

\end{enumerate}
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{workspace}.png}
\end{figure}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Create your cluster where your code will run

\end{enumerate}
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{cluster}.png}
\end{figure}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Import your dataset

\end{enumerate}
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{table}.png}
\end{figure}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{dataset1}.png}
\end{figure}
\end{quote}

\begin{sphinxadmonition}{note}{Note:}
You need to save the path which appears at Uploaded to DBFS:
/FileStore/tables/05rmhuqv1489687378010/. Since we will use
this path to load the dataset.
\end{sphinxadmonition}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Creat your notebook

\end{enumerate}
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{notebook}.png}
\end{figure}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{codenotebook}.png}
\end{figure}
\end{quote}

After finishing the above 5 steps, you are ready to run your
Spark code on Databricks Community Cloud. I will run all the
following demos on Databricks Community Cloud. Hopefully, when
you run the demo code, you will get the following results:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{\PYGZus{}c0}\PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{180.8}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.4}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{\PYGZus{}c0}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{TV}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Radio}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Newspaper}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Sales}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

\index{Configure Spark on Mac and Ubuntu@\spxentry{Configure Spark on Mac and Ubuntu}}\ignorespaces 

\section{Configure Spark on Mac and Ubuntu}
\label{\detokenize{setup:configure-spark-on-mac-and-ubuntu}}\label{\detokenize{setup:set-up-ubuntu}}\label{\detokenize{setup:index-1}}

\subsection{Installing Prerequisites}
\label{\detokenize{setup:installing-prerequisites}}
I will strongly recommend you to install \sphinxhref{https://www.anaconda.com/download/}{Anaconda}, since it contains most
of the prerequisites and support multiple Operator Systems.
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
\sphinxstylestrong{Install Python}

\end{enumerate}

Go to Ubuntu Software Center and follow the following steps:
\begin{enumerate}
\def\theenumi{\alph{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Open Ubuntu Software Center

\item {} 
Search for python

\item {} 
And click Install

\end{enumerate}

Or Open your terminal and  using the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo apt\PYGZhy{}get install build\PYGZhy{}essential checkinstall
sudo apt\PYGZhy{}get install libreadline\PYGZhy{}gplv2\PYGZhy{}dev libncursesw5\PYGZhy{}dev libssl\PYGZhy{}dev
                 libsqlite3\PYGZhy{}dev tk\PYGZhy{}dev libgdbm\PYGZhy{}dev libc6\PYGZhy{}dev libbz2\PYGZhy{}dev
sudo apt\PYGZhy{}get install python
sudo easy\PYGZus{}install pip
sudo pip install ipython
\end{sphinxVerbatim}


\subsection{Install Java}
\label{\detokenize{setup:install-java}}
Java is used by many other softwares. So it is quite possible that you have already installed it. You can
by using the following command in Command Prompt:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
java \PYGZhy{}version
\end{sphinxVerbatim}

Otherwise, you can follow the steps in \sphinxhref{https://java.com/en/download/help/mac\_install.xml}{How do I install Java for my Mac?} to install java on Mac and use the following command in Command Prompt to install on Ubuntu:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo apt\PYGZhy{}add\PYGZhy{}repository ppa:webupd8team/java
sudo apt\PYGZhy{}get update
sudo apt\PYGZhy{}get install oracle\PYGZhy{}java8\PYGZhy{}installer
\end{sphinxVerbatim}


\subsection{Install Java SE Runtime Environment}
\label{\detokenize{setup:install-java-se-runtime-environment}}
I installed ORACLE \sphinxhref{http://www.oracle.com/technetwork/java/javase/downloads/index-jsp-138363.html}{Java JDK}.

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxstylestrong{Installing Java and Java SE Runtime Environment steps are very important, since Spark is a domain-specific language written in Java.}
\end{sphinxadmonition}

You can check if your Java is available and find it’s version by using the following
command in Command Prompt:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
java \PYGZhy{}version
\end{sphinxVerbatim}

If your Java is installed successfully, you will get the similar results as follows:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
java version \PYG{l+s+s2}{\PYGZdq{}1.8.0\PYGZus{}131\PYGZdq{}}
Java\PYG{o}{(}TM\PYG{o}{)} SE Runtime Environment \PYG{o}{(}build \PYG{l+m}{1}.8.0\PYGZus{}131\PYGZhy{}b11\PYG{o}{)}
Java HotSpot\PYG{o}{(}TM\PYG{o}{)} \PYG{l+m}{64}\PYGZhy{}Bit Server VM \PYG{o}{(}build \PYG{l+m}{25}.131\PYGZhy{}b11, mixed mode\PYG{o}{)}
\end{sphinxVerbatim}


\subsection{Install Apache Spark}
\label{\detokenize{setup:install-apache-spark}}
Actually, the Pre-build version doesn’t need installation. You can use it when you unpack it.
\begin{quote}
\begin{enumerate}
\def\theenumi{\alph{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Download: You can get the Pre-built Apache Spark™ from \sphinxhref{http://spark.apache.org/downloads.html}{Download Apache Spark™}.

\item {} 
Unpack: Unpack the Apache Spark™ to the path where you want to install the Spark.

\item {} 
Test: Test the Prerequisites: change the direction \sphinxcode{\sphinxupquote{spark-\#.\#.\#-bin-hadoop\#.\#/bin}} and run

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
./pyspark
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Python \PYG{l+m}{2}.7.13 \PYG{p}{\textbar{}}Anaconda \PYG{l+m}{4}.4.0 \PYG{o}{(}x86\PYGZus{}64\PYG{o}{)}\PYG{p}{\textbar{}} \PYG{o}{(}default, Dec \PYG{l+m}{20} \PYG{l+m}{2016}, \PYG{l+m}{23}:05:08\PYG{o}{)}
\PYG{o}{[}GCC \PYG{l+m}{4}.2.1 Compatible Apple LLVM \PYG{l+m}{6}.0 \PYG{o}{(}clang\PYGZhy{}600.0.57\PYG{o}{)}\PYG{o}{]} on darwin
Type \PYG{l+s+s2}{\PYGZdq{}help\PYGZdq{}}, \PYG{l+s+s2}{\PYGZdq{}copyright\PYGZdq{}}, \PYG{l+s+s2}{\PYGZdq{}credits\PYGZdq{}} or \PYG{l+s+s2}{\PYGZdq{}license\PYGZdq{}} \PYG{k}{for} more information.
Anaconda is brought to you by Continuum Analytics.
Please check out: http://continuum.io/thanks and https://anaconda.org
Using Spark\PYG{l+s+s1}{\PYGZsq{}s default log4j profile: org/apache/spark/log4j\PYGZhy{}defaults.properties}
\PYG{l+s+s1}{Setting default log level to \PYGZdq{}WARN\PYGZdq{}.}
\PYG{l+s+s1}{To adjust logging level use sc.setLogLevel(newLevel). For SparkR,}
\PYG{l+s+s1}{use setLogLevel(newLevel).}
\PYG{l+s+s1}{17/08/30 13:30:12 WARN NativeCodeLoader: Unable to load native\PYGZhy{}hadoop}
\PYG{l+s+s1}{library for your platform... using builtin\PYGZhy{}java classes where applicable}
\PYG{l+s+s1}{17/08/30 13:30:17 WARN ObjectStore: Failed to get database global\PYGZus{}temp,}
\PYG{l+s+s1}{returning NoSuchObjectException}
\PYG{l+s+s1}{Welcome to}
\PYG{l+s+s1}{       \PYGZus{}\PYGZus{}\PYGZus{}\PYGZus{}              \PYGZus{}\PYGZus{}}
\PYG{l+s+s1}{      / \PYGZus{}\PYGZus{}/\PYGZus{}\PYGZus{}  \PYGZus{}\PYGZus{}\PYGZus{} \PYGZus{}\PYGZus{}\PYGZus{}\PYGZus{}\PYGZus{}/ /\PYGZus{}\PYGZus{}}
\PYG{l+s+s1}{     \PYGZus{}\PYGZbs{} \PYGZbs{}/ \PYGZus{} \PYGZbs{}/ \PYGZus{} {}`/ \PYGZus{}\PYGZus{}/  \PYGZsq{}}\PYGZus{}/
    /\PYGZus{}\PYGZus{} / .\PYGZus{}\PYGZus{}/\PYG{l+s+se}{\PYGZbs{}\PYGZus{}},\PYGZus{}/\PYGZus{}/ /\PYGZus{}/\PYG{l+s+se}{\PYGZbs{}\PYGZus{}}\PYG{l+s+se}{\PYGZbs{} }  version \PYG{l+m}{2}.1.1
       /\PYGZus{}/

Using Python version \PYG{l+m}{2}.7.13 \PYG{o}{(}default, Dec \PYG{l+m}{20} \PYG{l+m}{2016} \PYG{l+m}{23}:05:08\PYG{o}{)}
SparkSession available as \PYG{l+s+s1}{\PYGZsq{}spark\PYGZsq{}}.
\end{sphinxVerbatim}
\end{quote}


\subsection{Configure the Spark}
\label{\detokenize{setup:configure-the-spark}}\begin{quote}
\begin{enumerate}
\def\theenumi{\alph{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
\sphinxstylestrong{Mac Operator System:} open your \sphinxcode{\sphinxupquote{bash\_profile}} in Terminal

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
vim \PYGZti{}/.bash\PYGZus{}profile
\end{sphinxVerbatim}

And add the following lines to your \sphinxcode{\sphinxupquote{bash\_profile}} (remember to change the path)

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} add for spark}
\PYG{n+nb}{export} \PYG{n+nv}{SPARK\PYGZus{}HOME}\PYG{o}{=}your\PYGZus{}spark\PYGZus{}installation\PYGZus{}path
\PYG{n+nb}{export} \PYG{n+nv}{PATH}\PYG{o}{=}\PYG{n+nv}{\PYGZdl{}PATH}:\PYG{n+nv}{\PYGZdl{}SPARK\PYGZus{}HOME}/bin:\PYG{n+nv}{\PYGZdl{}SPARK\PYGZus{}HOME}/sbin
\PYG{n+nb}{export} \PYG{n+nv}{PATH}\PYG{o}{=}\PYG{n+nv}{\PYGZdl{}PATH}:\PYG{n+nv}{\PYGZdl{}SPARK\PYGZus{}HOME}/bin
\PYG{n+nb}{export} \PYG{n+nv}{PYSPARK\PYGZus{}DRIVE\PYGZus{}PYTHON}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}jupyter\PYGZdq{}}
\PYG{n+nb}{export} \PYG{n+nv}{PYSPARK\PYGZus{}DRIVE\PYGZus{}PYTHON\PYGZus{}OPTS}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}notebook\PYGZdq{}}
\end{sphinxVerbatim}

At last, remember to source your \sphinxcode{\sphinxupquote{bash\_profile}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nb}{source} \PYGZti{}/.bash\PYGZus{}profile
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\alph{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
\sphinxstylestrong{Ubuntu Operator Sysytem:} open your \sphinxcode{\sphinxupquote{bashrc}} in Terminal

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
vim \PYGZti{}/.bashrc
\end{sphinxVerbatim}

And add the following lines to your \sphinxcode{\sphinxupquote{bashrc}} (remember to change the path)

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} add for spark}
\PYG{n+nb}{export} \PYG{n+nv}{SPARK\PYGZus{}HOME}\PYG{o}{=}your\PYGZus{}spark\PYGZus{}installation\PYGZus{}path
\PYG{n+nb}{export} \PYG{n+nv}{PATH}\PYG{o}{=}\PYG{n+nv}{\PYGZdl{}PATH}:\PYG{n+nv}{\PYGZdl{}SPARK\PYGZus{}HOME}/bin:\PYG{n+nv}{\PYGZdl{}SPARK\PYGZus{}HOME}/sbin
\PYG{n+nb}{export} \PYG{n+nv}{PATH}\PYG{o}{=}\PYG{n+nv}{\PYGZdl{}PATH}:\PYG{n+nv}{\PYGZdl{}SPARK\PYGZus{}HOME}/bin
\PYG{n+nb}{export} \PYG{n+nv}{PYSPARK\PYGZus{}DRIVE\PYGZus{}PYTHON}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}jupyter\PYGZdq{}}
\PYG{n+nb}{export} \PYG{n+nv}{PYSPARK\PYGZus{}DRIVE\PYGZus{}PYTHON\PYGZus{}OPTS}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}notebook\PYGZdq{}}
\end{sphinxVerbatim}

At last, remember to source your \sphinxcode{\sphinxupquote{bashrc}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nb}{source} \PYGZti{}/.bashrc
\end{sphinxVerbatim}
\end{quote}


\section{Configure Spark on Windows}
\label{\detokenize{setup:configure-spark-on-windows}}
Installing open source software on Windows is always a nightmare for me.
Thanks for Deelesh Mandloi. You can follow the detailed procedures in the
blog \sphinxhref{http://deelesh.github.io/pyspark-windows.html}{Getting Started with PySpark on Windows} to install the Apache Spark™
on your Windows Operator System.


\section{PySpark With Text Editor or IDE}
\label{\detokenize{setup:pyspark-with-text-editor-or-ide}}

\subsection{PySpark With Jupyter Notebook}
\label{\detokenize{setup:pyspark-with-jupyter-notebook}}
After you finishing the above setup steps in {\hyperref[\detokenize{setup:set-up-ubuntu}]{\sphinxcrossref{\DUrole{std,std-ref}{Configure Spark on Mac and Ubuntu}}}},
then you should be good to write and run your PySpark Code
in Jupyter notebook.
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{jupyterWithPySpark}.png}
\end{figure}
\end{quote}


\subsection{PySpark With Apache Zeppelin}
\label{\detokenize{setup:pyspark-with-apache-zeppelin}}
After you finishing the above setup steps in {\hyperref[\detokenize{setup:set-up-ubuntu}]{\sphinxcrossref{\DUrole{std,std-ref}{Configure Spark on Mac and Ubuntu}}}},
then you should be good to write and run your PySpark Code
in Apache Zeppelin.
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{zeppelin}.png}
\end{figure}
\end{quote}


\subsection{PySpark With Sublime Text}
\label{\detokenize{setup:pyspark-with-sublime-text}}
After you finishing the above setup steps in {\hyperref[\detokenize{setup:set-up-ubuntu}]{\sphinxcrossref{\DUrole{std,std-ref}{Configure Spark on Mac and Ubuntu}}}},
then you should be good to use Sublime Text to write your PySpark
Code and run your code as a normal python code in Terminal.
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
python test\PYGZus{}pyspark.py
\end{sphinxVerbatim}
\end{quote}

Then you should get the output results in your terminal.
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{sublimeWithPySpark}.png}
\end{figure}
\end{quote}


\subsection{PySpark With Eclipse}
\label{\detokenize{setup:pyspark-with-eclipse}}
If you want to run PySpark code on Eclipse, you need to add the
paths for the \sphinxstylestrong{External Libraries} for your \sphinxstylestrong{Current Project}
as follows:
\begin{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Open the properties of your project

\end{enumerate}
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{PyDevProperties}.png}
\end{figure}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Add the paths for the \sphinxstylestrong{External Libraries}

\end{enumerate}
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{pydevPath}.png}
\end{figure}
\end{quote}
\end{quote}

And then you should be good to run your code on Eclipse with PyDev.
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{pysparkWithEclipse}.png}
\end{figure}
\end{quote}

\index{Set up Spark on Cloud@\spxentry{Set up Spark on Cloud}}\ignorespaces 

\section{PySparkling Water: Spark + H2O}
\label{\detokenize{setup:pysparkling-water-spark-h2o}}\label{\detokenize{setup:index-2}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Download \sphinxcode{\sphinxupquote{Sparkling Water}} from: \sphinxurl{https://s3.amazonaws.com/h2o-release/sparkling-water/rel-2.4/5/index.html}

\item {} 
Test PySparking

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
unzip sparkling\PYGZhy{}water\PYGZhy{}2.4.5.zip
\PYG{n+nb}{cd}  \PYGZti{}/sparkling\PYGZhy{}water\PYGZhy{}2.4.5/bin
./pysparkling
\end{sphinxVerbatim}

If you have a correct setup for PySpark, then you will get the following results:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Using Spark defined in the \PYG{n+nv}{SPARK\PYGZus{}HOME}\PYG{o}{=}/Users/dt216661/spark environmental property

Python \PYG{l+m}{3}.7.1 \PYG{o}{(}default, Dec \PYG{l+m}{14} \PYG{l+m}{2018}, \PYG{l+m}{13}:28:58\PYG{o}{)}
\PYG{o}{[}GCC \PYG{l+m}{4}.2.1 Compatible Apple LLVM \PYG{l+m}{6}.0 \PYG{o}{(}clang\PYGZhy{}600.0.57\PYG{o}{)}\PYG{o}{]} on darwin
Type \PYG{l+s+s2}{\PYGZdq{}help\PYGZdq{}}, \PYG{l+s+s2}{\PYGZdq{}copyright\PYGZdq{}}, \PYG{l+s+s2}{\PYGZdq{}credits\PYGZdq{}} or \PYG{l+s+s2}{\PYGZdq{}license\PYGZdq{}} \PYG{k}{for} more information.
\PYG{l+m}{2019}\PYGZhy{}02\PYGZhy{}15 \PYG{l+m}{14}:08:30 WARN  NativeCodeLoader:62 \PYGZhy{} Unable to load native\PYGZhy{}hadoop library \PYG{k}{for} your platform... using builtin\PYGZhy{}java classes where applicable
Setting default log level to \PYG{l+s+s2}{\PYGZdq{}WARN\PYGZdq{}}.
Using Spark\PYG{l+s+s1}{\PYGZsq{}s default log4j profile: org/apache/spark/log4j\PYGZhy{}defaults.properties}
\PYG{l+s+s1}{Setting default log level to \PYGZdq{}WARN\PYGZdq{}.}
\PYG{l+s+s1}{To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).}
\PYG{l+s+s1}{2019\PYGZhy{}02\PYGZhy{}15 14:08:31 WARN  Utils:66 \PYGZhy{} Service \PYGZsq{}}SparkUI\PYG{l+s+s1}{\PYGZsq{} could not bind on port 4040. Attempting port 4041.}
\PYG{l+s+s1}{2019\PYGZhy{}02\PYGZhy{}15 14:08:31 WARN  Utils:66 \PYGZhy{} Service \PYGZsq{}}SparkUI\PYG{l+s+s1}{\PYGZsq{} could not bind on port 4041. Attempting port 4042.}
\PYG{l+s+s1}{17/08/30 13:30:12 WARN NativeCodeLoader: Unable to load native\PYGZhy{}hadoop}
\PYG{l+s+s1}{library for your platform... using builtin\PYGZhy{}java classes where applicable}
\PYG{l+s+s1}{17/08/30 13:30:17 WARN ObjectStore: Failed to get database global\PYGZus{}temp,}
\PYG{l+s+s1}{returning NoSuchObjectException}
\PYG{l+s+s1}{Welcome to}
\PYG{l+s+s1}{       \PYGZus{}\PYGZus{}\PYGZus{}\PYGZus{}              \PYGZus{}\PYGZus{}}
\PYG{l+s+s1}{      / \PYGZus{}\PYGZus{}/\PYGZus{}\PYGZus{}  \PYGZus{}\PYGZus{}\PYGZus{} \PYGZus{}\PYGZus{}\PYGZus{}\PYGZus{}\PYGZus{}/ /\PYGZus{}\PYGZus{}}
\PYG{l+s+s1}{     \PYGZus{}\PYGZbs{} \PYGZbs{}/ \PYGZus{} \PYGZbs{}/ \PYGZus{} {}`/ \PYGZus{}\PYGZus{}/  \PYGZsq{}}\PYGZus{}/
    /\PYGZus{}\PYGZus{} / .\PYGZus{}\PYGZus{}/\PYG{l+s+se}{\PYGZbs{}\PYGZus{}},\PYGZus{}/\PYGZus{}/ /\PYGZus{}/\PYG{l+s+se}{\PYGZbs{}\PYGZus{}}\PYG{l+s+se}{\PYGZbs{} }  version \PYG{l+m}{2}.4.0
       /\PYGZus{}/

Using Python version \PYG{l+m}{3}.7.1 \PYG{o}{(}default, Dec \PYG{l+m}{14} \PYG{l+m}{2018} \PYG{l+m}{13}:28:58\PYG{o}{)}
SparkSession available as \PYG{l+s+s1}{\PYGZsq{}spark\PYGZsq{}}.
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Setup \sphinxcode{\sphinxupquote{pysparkling}} with Jupyter notebook

\end{enumerate}

Add the following alias to your \sphinxcode{\sphinxupquote{bashrc}} (Linux systems) or \sphinxcode{\sphinxupquote{bash\_profile}} (Mac system)

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nb}{alias} \PYG{n+nv}{sparkling}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}PYSPARK\PYGZus{}DRIVER\PYGZus{}PYTHON=\PYGZdq{}}ipython\PYG{l+s+s2}{\PYGZdq{} PYSPARK\PYGZus{}DRIVER\PYGZus{}PYTHON\PYGZus{}OPTS=    \PYGZdq{}}notebook\PYG{l+s+s2}{\PYGZdq{} /\PYGZti{}/\PYGZti{}/sparkling\PYGZhy{}water\PYGZhy{}2.4.5/bin/pysparkling\PYGZdq{}}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Open \sphinxcode{\sphinxupquote{pysparkling}} in terminal

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sparkling
\end{sphinxVerbatim}


\section{Set up Spark on Cloud}
\label{\detokenize{setup:set-up-spark-on-cloud}}
Following the setup steps in {\hyperref[\detokenize{setup:set-up-ubuntu}]{\sphinxcrossref{\DUrole{std,std-ref}{Configure Spark on Mac and Ubuntu}}}}, you can set
up your own cluster on the cloud, for example AWS, Google Cloud.
Actually, for those clouds, they have their own Big Data tool.
Yon can run them directly whitout any setting just like
Databricks Community Cloud. If you want more details, please feel
free to contact with me.


\section{Demo Code in this Section}
\label{\detokenize{setup:demo-code-in-this-section}}
The code for this section is available for download \sphinxhref{static/test\_pyspark.py}{test\_pyspark},
and the Jupyter notebook can be download from \sphinxhref{static/test\_pyspark.ipynb}{test\_pyspark\_ipynb}.
\begin{itemize}
\item {} 
Python Source code

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}\PYGZsh{} set up  SparkSession}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{sql} \PYG{k}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark SQL basic example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                               \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                     \PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/home/feng/Spark/Code/data/Advertising.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}                     
\end{sphinxVerbatim}
\end{quote}


\chapter{An Introduction to Apache Spark}
\label{\detokenize{introduction:an-introduction-to-apache-spark}}\label{\detokenize{introduction:introduction}}\label{\detokenize{introduction::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

\sphinxstylestrong{Know yourself and know your enemy, and you will never be defeated} \textendash{} idiom, from Sunzi’s Art of War
\end{sphinxadmonition}


\section{Core Concepts}
\label{\detokenize{introduction:core-concepts}}
Most of the following content comes from \sphinxcite{reference:kirillov2016}. So the copyright belongs to \sphinxstylestrong{Anton Kirillov}.
I will refer you to get more details from \sphinxhref{http://datastrophic.io/core-concepts-architecture-and-internals-of-apache-spark/}{Apache Spark core concepts, architecture and internals}.

Before diving deep into how Apache Spark works, lets understand the jargon of Apache Spark
\begin{itemize}
\item {} 
Job: A piece of code which reads some input from HDFS or local, performs some computation on the data and writes some output data.

\item {} 
Stages: Jobs are divided into stages. Stages are classified as a Map or reduce stages (Its easier to understand if you have worked on Hadoop and want to correlate). Stages are divided based on computational boundaries, all computations (operators) cannot be Updated in a single Stage. It happens over many stages.

\item {} 
Tasks: Each stage has some tasks, one task per partition. One task is executed on one partition of data on one executor (machine).

\item {} 
DAG: DAG stands for Directed Acyclic Graph, in the present context its a DAG of operators.

\item {} 
Executor: The process responsible for executing a task.

\item {} 
Master: The machine on which the Driver program runs

\item {} 
Slave: The machine on which the Executor program runs

\end{itemize}


\section{Spark Components}
\label{\detokenize{introduction:spark-components}}\begin{quote}
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{spark-components}.png}
\end{figure}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Spark Driver

\end{enumerate}
\begin{itemize}
\item {} 
separate process to execute user applications

\item {} 
creates SparkContext to schedule jobs execution
and negotiate with cluster manager

\end{itemize}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Executors

\end{enumerate}
\begin{itemize}
\item {} 
run tasks scheduled by driver

\item {} 
store computation results in memory, on disk or off-heap

\item {} 
interact with storage systems

\end{itemize}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Cluster Manager

\end{enumerate}
\begin{itemize}
\item {} 
Mesos

\item {} 
YARN

\item {} 
Spark Standalone

\end{itemize}
\end{quote}

Spark Driver contains more components responsible for translation
of user code into actual jobs executed on cluster:
\begin{quote}
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{spark-components1}.png}
\end{figure}
\end{quote}
\begin{itemize}
\item {} 
SparkContext
\begin{itemize}
\item {} 
represents the connection to a Spark cluster, and can be used to create RDDs,
accumulators and broadcast variables  on that cluster

\end{itemize}

\item {} 
DAGScheduler
\begin{itemize}
\item {} 
computes a DAG of stages for each job and submits them to TaskScheduler
determines preferred locations for tasks (based on cache status or
shuffle files locations) and finds minimum schedule to run the jobs

\end{itemize}

\item {} 
TaskScheduler
\begin{itemize}
\item {} 
responsible for sending tasks to the cluster, running them,
retrying if there are failures, and mitigating stragglers

\end{itemize}

\item {} 
SchedulerBackend
\begin{itemize}
\item {} 
backend interface for scheduling systems that allows plugging
in different implementations(Mesos, YARN, Standalone, local)

\end{itemize}

\item {} 
BlockManager
\begin{itemize}
\item {} 
provides interfaces for putting and retrieving blocks both locally
and remotely into various stores (memory,  disk, and off-heap)

\end{itemize}

\end{itemize}
\end{quote}


\section{Architecture}
\label{\detokenize{introduction:architecture}}

\section{How Spark Works?}
\label{\detokenize{introduction:how-spark-works}}
Spark has a small code base and the system is divided in various layers. Each layer has some responsibilities. The layers are independent of each other.

The first layer is the interpreter, Spark uses a Scala interpreter, with some modifications.
As you enter your code in spark console (creating RDD’s and applying operators), Spark creates a operator graph.
When the user runs an action (like collect), the Graph is submitted to a DAG Scheduler. The DAG scheduler divides operator graph into (map and reduce) stages.
A stage is comprised of tasks based on partitions of the input data. The DAG scheduler pipelines operators together to optimize the graph. For e.g. Many map operators can be scheduled in a single stage. This optimization is key to Sparks performance. The final result of a DAG scheduler is a set of stages.
The stages are passed on to the Task Scheduler. The task scheduler launches tasks via cluster manager. (Spark Standalone/Yarn/Mesos). The task scheduler doesn’t know about dependencies among stages.
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{work_flow}.png}
\end{figure}
\end{quote}


\chapter{Programming with RDDs}
\label{\detokenize{rdd:programming-with-rdds}}\label{\detokenize{rdd:rdd}}\label{\detokenize{rdd::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

\sphinxstylestrong{If you only know yourself, but not your opponent, you may win or may lose.
If you know neither yourself nor your enemy, you will always endanger yourself}
\textendash{} idiom, from Sunzi’s Art of War
\end{sphinxadmonition}

RDD represents \sphinxstylestrong{Resilient Distributed Dataset}. An RDD in Spark is simply an immutable
distributed collection of objects sets. Each RDD is split into multiple partitions (similar pattern
with smaller sets), which may be computed on different nodes of the cluster.


\section{Create RDD}
\label{\detokenize{rdd:create-rdd}}
Usually, there are two popular way to create the RDDs: loading an external dataset, or distributing
a set of collection of objects. The following examples show some simplest ways to create RDDs by using
\sphinxcode{\sphinxupquote{parallelize()}} fucntion which takes an already existing collection in your program and pass the same
to the Spark Context.
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
By using \sphinxcode{\sphinxupquote{parallelize( )}} fucntion

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark create RDD example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{sparkContext}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{a b c}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
             \PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{d e f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
             \PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{9}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{g h i}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col4}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get the RDD data:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{col1}\PYG{o}{\textbar{}}\PYG{n}{col2}\PYG{o}{\textbar{}}\PYG{n}{col3}\PYG{o}{\textbar{}} \PYG{n}{col4}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}\PYG{n}{a} \PYG{n}{b} \PYG{n}{c}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{n}{d} \PYG{n}{e} \PYG{n}{f}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{7}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{9}\PYG{o}{\textbar{}}\PYG{n}{g} \PYG{n}{h} \PYG{n}{i}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark create RDD example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{myData} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{sparkContext}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{9}\PYG{p}{,}\PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get the RDD data:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{myData}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}

\PYG{p}{[}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{]}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
By using \sphinxcode{\sphinxupquote{createDataFrame( )}} function

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark create RDD example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{Employee} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
                        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Joe}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}   \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{70000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
                        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Henry}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{80000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
                        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sam}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}   \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{60000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
                        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{4}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}   \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{90000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
                        \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sallary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{DepartmentId}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
                       \PYG{p}{)}
\end{sphinxVerbatim}

Then you will get the RDD data:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{n}{Id}\PYG{o}{\textbar{}} \PYG{n}{Name}\PYG{o}{\textbar{}}\PYG{n}{Sallary}\PYG{o}{\textbar{}}\PYG{n}{DepartmentId}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}  \PYG{n}{Joe}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{70000}\PYG{o}{\textbar{}}           \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}\PYG{n}{Henry}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{80000}\PYG{o}{\textbar{}}           \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}  \PYG{n}{Sam}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{60000}\PYG{o}{\textbar{}}           \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}  \PYG{n}{Max}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{90000}\PYG{o}{\textbar{}}           \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
By using \sphinxcode{\sphinxupquote{read}} and \sphinxcode{\sphinxupquote{load}} functions

\end{enumerate}
\begin{quote}
\begin{enumerate}
\def\theenumi{\alph{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
\sphinxstylestrong{Read dataset from .csv file}

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}\PYGZsh{} set up  SparkSession}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark create RDD example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                               \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                \PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/home/feng/Spark/Code/data/Advertising.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}

\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get the RDD data:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{\PYGZus{}c0}\PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{180.8}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.4}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{\PYGZus{}c0}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{TV}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Radio}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Newspaper}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Sales}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Once created, RDDs offer two types of operations: transformations and actions.
\begin{quote}
\begin{enumerate}
\def\theenumi{\alph{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
\sphinxstylestrong{Read dataset from DataBase}

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}\PYGZsh{} set up  SparkSession}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark create RDD example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}\PYGZsh{} User information}
\PYG{n}{user} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{your\PYGZus{}username}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{pw}   \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{your\PYGZus{}password}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{}\PYGZsh{} Database information}
\PYG{n}{table\PYGZus{}name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{table\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{url} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{jdbc:postgresql://\PYGZsh{}\PYGZsh{}.\PYGZsh{}\PYGZsh{}\PYGZsh{}.\PYGZsh{}\PYGZsh{}\PYGZsh{}.\PYGZsh{}\PYGZsh{}:5432/dataset?user=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n}{user}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZam{}password=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n}{pw}
\PYG{n}{properties} \PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{driver}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{org.postgresql.Driver}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{password}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{pw}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{user}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{user}\PYG{p}{\PYGZcb{}}

\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{jdbc}\PYG{p}{(}\PYG{n}{url}\PYG{o}{=}\PYG{n}{url}\PYG{p}{,} \PYG{n}{table}\PYG{o}{=}\PYG{n}{table\PYGZus{}name}\PYG{p}{,} \PYG{n}{properties}\PYG{o}{=}\PYG{n}{properties}\PYG{p}{)}

\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get the RDD data:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{\PYGZus{}c0}\PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{180.8}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.4}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{\PYGZus{}c0}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{TV}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Radio}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Newspaper}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Sales}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

\begin{sphinxadmonition}{note}{Note:}
Reading tables from Database needs the proper drive for the corresponding Database.
For example, the above demo needs \sphinxcode{\sphinxupquote{org.postgresql.Driver}} and you need to download
it and put it in \sphinxcode{\sphinxupquote{jars}} folder of your spark installation path. I download
\sphinxcode{\sphinxupquote{postgresql-42.1.1.jar}} from the official website and put it in \sphinxcode{\sphinxupquote{jars}} folder.
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\Alph{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
\sphinxstylestrong{Read dataset from HDFS}

\end{enumerate}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.conf} \PYG{k+kn}{import} \PYG{n}{SparkConf}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.context} \PYG{k+kn}{import} \PYG{n}{SparkContext}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{HiveContext}

\PYG{n}{sc}\PYG{o}{=} \PYG{n}{SparkContext}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{local}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{example}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{hc} \PYG{o}{=} \PYG{n}{HiveContext}\PYG{p}{(}\PYG{n}{sc}\PYG{p}{)}
\PYG{n}{tf1} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{textFile}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{hdfs://cdhstltest/user/data/demo.CSV}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{n}{tf1}\PYG{o}{.}\PYG{n}{first}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{hc}\PYG{o}{.}\PYG{n}{sql}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{use intg\PYGZus{}cme\PYGZus{}w}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{spf} \PYG{o}{=} \PYG{n}{hc}\PYG{o}{.}\PYG{n}{sql}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SELECT * FROM spf LIMIT 100}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{n}{spf}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}


\section{Spark Operations}
\label{\detokenize{rdd:spark-operations}}
\begin{sphinxadmonition}{warning}{Warning:}
All the figures below are from Jeffrey Thompson. The interested reader is referred to \sphinxhref{https://github.com/jkthompson/pyspark-pictures}{pyspark pictures}
\end{sphinxadmonition}

There are two main types of Spark operations: Transformations and Actions \sphinxcite{reference:karau2015}.
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{visualapi_006}.png}
\end{figure}
\end{quote}

\begin{sphinxadmonition}{note}{Note:}
Some people defined three types of operations: Transformations, Actions and Shuffles.
\end{sphinxadmonition}


\subsection{Spark Transformations}
\label{\detokenize{rdd:spark-transformations}}
Transformations construct a new RDD from a previous one. For example, one common
transformation is filtering data that matches a predicate.
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{transforms1}.png}
\end{figure}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{transforms2}.png}
\end{figure}
\end{quote}


\subsection{Spark Actions}
\label{\detokenize{rdd:spark-actions}}
Actions, on the other hand, compute a result based on an RDD, and either return it to
the driver program or save it to an external storage system (e.g., HDFS).
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{actions1}.png}
\end{figure}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{actions2}.png}
\end{figure}
\end{quote}


\section{\sphinxstyleliteralintitle{\sphinxupquote{rdd.DataFrame}}  vs \sphinxstyleliteralintitle{\sphinxupquote{pd.DataFrame}}}
\label{\detokenize{rdd:rdd-dataframe-vs-pd-dataframe}}

\subsection{Create DataFrame}
\label{\detokenize{rdd:create-dataframe}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
From List

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{my\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{c}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{]}
\PYG{n}{col\PYGZus{}name} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} caution for the columns=}
\PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{n}{my\PYGZus{}list}\PYG{p}{,}\PYG{n}{columns}\PYG{o}{=} \PYG{n}{col\PYGZus{}name}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{my\PYGZus{}list}\PYG{p}{,} \PYG{n}{col\PYGZus{}name}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                  \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                  \PYG{o}{\textbar{}}  \PYG{n}{A}\PYG{o}{\textbar{}}  \PYG{n}{B}\PYG{o}{\textbar{}}  \PYG{n}{C}\PYG{o}{\textbar{}}
   \PYG{n}{A}  \PYG{n}{B}  \PYG{n}{C}        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{n}{a}  \PYG{l+m+mi}{1}  \PYG{l+m+mi}{2}        \PYG{o}{\textbar{}}  \PYG{n}{a}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}  \PYG{n}{b}  \PYG{l+m+mi}{2}  \PYG{l+m+mi}{3}        \PYG{o}{\textbar{}}  \PYG{n}{b}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}  \PYG{n}{c}  \PYG{l+m+mi}{3}  \PYG{l+m+mi}{4}        \PYG{o}{\textbar{}}  \PYG{n}{c}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}
                  \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{attention}{Attention:}
Pay attentation to the parameter \sphinxcode{\sphinxupquote{columns=}} in \sphinxcode{\sphinxupquote{pd.DataFrame}}. Since the default value will make the list as rows.
\begin{quote}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} caution for the columns=}
\PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{n}{my\PYGZus{}list}\PYG{p}{,} \PYG{n}{columns}\PYG{o}{=} \PYG{n}{col\PYGZus{}name}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{n}{my\PYGZus{}list}\PYG{p}{,} \PYG{n}{col\PYGZus{}name}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
   \PYG{n}{A}  \PYG{n}{B}  \PYG{n}{C}             \PYG{l+m+mi}{0}  \PYG{l+m+mi}{1}  \PYG{l+m+mi}{2}
\PYG{l+m+mi}{0}  \PYG{n}{a}  \PYG{l+m+mi}{1}  \PYG{l+m+mi}{2}          \PYG{n}{A}  \PYG{n}{a}  \PYG{l+m+mi}{1}  \PYG{l+m+mi}{2}
\PYG{l+m+mi}{1}  \PYG{n}{b}  \PYG{l+m+mi}{2}  \PYG{l+m+mi}{3}          \PYG{n}{B}  \PYG{n}{b}  \PYG{l+m+mi}{2}  \PYG{l+m+mi}{3}
\PYG{l+m+mi}{2}  \PYG{n}{c}  \PYG{l+m+mi}{3}  \PYG{l+m+mi}{4}          \PYG{n}{C}  \PYG{n}{c}  \PYG{l+m+mi}{3}  \PYG{l+m+mi}{4}
\end{sphinxVerbatim}
\end{quote}
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
From Dict

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{d} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
     \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}
     \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{n}{d}\PYG{p}{)}\PYG{k}{for}
\PYG{c+c1}{\PYGZsh{} Tedious for PySpark}
\PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{n+nb}{list}\PYG{p}{(}\PYG{n}{d}\PYG{o}{.}\PYG{n}{values}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{T}\PYG{o}{.}\PYG{n}{tolist}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}\PYG{n+nb}{list}\PYG{p}{(}\PYG{n}{d}\PYG{o}{.}\PYG{n}{keys}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                   \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                   \PYG{o}{\textbar{}}  \PYG{n}{A}\PYG{o}{\textbar{}}  \PYG{n}{B}\PYG{o}{\textbar{}}  \PYG{n}{C}\PYG{o}{\textbar{}}
   \PYG{n}{A}  \PYG{n}{B}  \PYG{n}{C}         \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{l+m+mi}{0}  \PYG{l+m+mi}{1}  \PYG{l+m+mi}{1}         \PYG{o}{\textbar{}}  \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}  \PYG{l+m+mi}{1}  \PYG{l+m+mi}{0}  \PYG{l+m+mi}{0}         \PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}  \PYG{l+m+mi}{0}  \PYG{l+m+mi}{1}  \PYG{l+m+mi}{0}         \PYG{o}{\textbar{}}  \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}
                   \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}


\subsection{Load DataFrame}
\label{\detokenize{rdd:load-dataframe}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
From DataBase

\end{enumerate}

Most of time, you need to share your code with your colleagues or release your code for Code Review or Quality assurance(QA). You will definitely do not want to have your \sphinxcode{\sphinxupquote{User Information}} in the code. So you can save them
in login.txt:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
runawayhorse001
PythonTips
\end{sphinxVerbatim}

and use the following code to import your \sphinxcode{\sphinxupquote{User Information}}:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}User Information}
\PYG{k}{try}\PYG{p}{:}
    \PYG{n}{login} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{login.txt}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{None}\PYG{p}{)}
    \PYG{n}{user} \PYG{o}{=} \PYG{n}{login}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
    \PYG{n}{pw} \PYG{o}{=} \PYG{n}{login}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}
    \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{User information is ready!}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{except}\PYG{p}{:}
    \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Login information is not available!!!}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Database information}
\PYG{n}{host} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}.\PYGZsh{}\PYGZsh{}\PYGZsh{}.\PYGZsh{}\PYGZsh{}\PYGZsh{}.\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{db\PYGZus{}name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{db\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{table\PYGZus{}name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{table\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{conn} \PYG{o}{=} \PYG{n}{psycopg2}\PYG{o}{.}\PYG{n}{connect}\PYG{p}{(}\PYG{n}{host}\PYG{o}{=}\PYG{n}{host}\PYG{p}{,} \PYG{n}{database}\PYG{o}{=}\PYG{n}{db\PYGZus{}name}\PYG{p}{,} \PYG{n}{user}\PYG{o}{=}\PYG{n}{user}\PYG{p}{,} \PYG{n}{password}\PYG{o}{=}\PYG{n}{pw}\PYG{p}{)}
\PYG{n}{cur} \PYG{o}{=} \PYG{n}{conn}\PYG{o}{.}\PYG{n}{cursor}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{sql} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+s2}{      select *}
\PYG{l+s+s2}{      from \PYGZob{}table\PYGZus{}name\PYGZcb{}}
\PYG{l+s+s2}{      }\PYG{l+s+s2}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{table\PYGZus{}name}\PYG{o}{=}\PYG{n}{table\PYGZus{}name}\PYG{p}{)}
\PYG{n}{dp} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}sql}\PYG{p}{(}\PYG{n}{sql}\PYG{p}{,} \PYG{n}{conn}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} connect to database}
\PYG{n}{url} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{jdbc:postgresql://}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n}{host}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{:5432/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n}{db\PYGZus{}name}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{?user=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n}{user}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZam{}password=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n}{pw}
\PYG{n}{properties} \PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{driver}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{org.postgresql.Driver}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{password}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{pw}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{user}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{user}\PYG{p}{\PYGZcb{}}
\PYG{n}{ds} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{jdbc}\PYG{p}{(}\PYG{n}{url}\PYG{o}{=}\PYG{n}{url}\PYG{p}{,} \PYG{n}{table}\PYG{o}{=}\PYG{n}{table\PYGZus{}name}\PYG{p}{,} \PYG{n}{properties}\PYG{o}{=}\PYG{n}{properties}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{attention}{Attention:}
Reading tables from Database with PySpark needs the proper drive for the corresponding Database. For example, the above demo needs org.postgresql.Driver and you need to download it and put it in \sphinxcode{\sphinxupquote{jars}} folder of your spark installation path. I download postgresql-42.1.1.jar from the official website and put it in jars folder.
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
From \sphinxcode{\sphinxupquote{.csv}}

\end{enumerate}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} pd.DataFrame dp: DataFrame pandas}
\PYG{n}{dp} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Advertising.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}rdd.DataFrame. dp: DataFrame spark}
\PYG{n}{ds} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{csv}\PYG{p}{(}\PYG{n}{path}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Advertising.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
\PYG{c+c1}{\PYGZsh{}                sep=\PYGZsq{},\PYGZsq{},}
\PYG{c+c1}{\PYGZsh{}                encoding=\PYGZsq{}UTF\PYGZhy{}8\PYGZsq{},}
\PYG{c+c1}{\PYGZsh{}                comment=None,}
               \PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,}
               \PYG{n}{inferSchema}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
From \sphinxcode{\sphinxupquote{.json}}

\end{enumerate}

Data from: \sphinxurl{http://api.luftdaten.info/static/v1/data.json}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}json}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{data/data.json}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{ds} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{json}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{data/data.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{p}{[}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{timestamp}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{]}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{p}{[}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{timestamp}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{]}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{o}{\textbar{}}        \PYG{n+nb}{id}\PYG{o}{\textbar{}}          \PYG{n}{timestamp}\PYG{o}{\textbar{}}
            \PYG{n+nb}{id}  \PYG{n}{timestamp}                       \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}   \PYG{l+m+mi}{2994551481}  \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{02}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{28} \PYG{l+m+mi}{17}\PYG{p}{:}\PYG{l+m+mi}{23}\PYG{p}{:}\PYG{l+m+mi}{52}             \PYG{o}{\textbar{}}\PYG{l+m+mi}{2994551481}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{02}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{28} \PYG{l+m+mi}{17}\PYG{p}{:}\PYG{l+m+mi}{23}\PYG{p}{:}\PYG{l+m+mi}{52}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}   \PYG{l+m+mi}{2994551482}  \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{02}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{28} \PYG{l+m+mi}{17}\PYG{p}{:}\PYG{l+m+mi}{23}\PYG{p}{:}\PYG{l+m+mi}{52}             \PYG{o}{\textbar{}}\PYG{l+m+mi}{2994551482}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{02}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{28} \PYG{l+m+mi}{17}\PYG{p}{:}\PYG{l+m+mi}{23}\PYG{p}{:}\PYG{l+m+mi}{52}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}   \PYG{l+m+mi}{2994551483}  \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{02}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{28} \PYG{l+m+mi}{17}\PYG{p}{:}\PYG{l+m+mi}{23}\PYG{p}{:}\PYG{l+m+mi}{52}             \PYG{o}{\textbar{}}\PYG{l+m+mi}{2994551483}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{02}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{28} \PYG{l+m+mi}{17}\PYG{p}{:}\PYG{l+m+mi}{23}\PYG{p}{:}\PYG{l+m+mi}{52}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}   \PYG{l+m+mi}{2994551484}  \PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{02}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{28} \PYG{l+m+mi}{17}\PYG{p}{:}\PYG{l+m+mi}{23}\PYG{p}{:}\PYG{l+m+mi}{52}             \PYG{o}{\textbar{}}\PYG{l+m+mi}{2994551484}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2019}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{02}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{28} \PYG{l+m+mi}{17}\PYG{p}{:}\PYG{l+m+mi}{23}\PYG{p}{:}\PYG{l+m+mi}{52}\PYG{o}{\textbar{}}
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{First \sphinxstyleliteralintitle{\sphinxupquote{n}} Rows}
\label{\detokenize{rdd:first-n-rows}}
\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                        \PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}
      \PYG{n}{TV}  \PYG{n}{Radio}  \PYG{n}{Newspaper}  \PYG{n}{Sales}       \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{l+m+mf}{230.1}   \PYG{l+m+mf}{37.8}       \PYG{l+m+mf}{69.2}   \PYG{l+m+mf}{22.1}       \PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}   \PYG{l+m+mf}{44.5}   \PYG{l+m+mf}{39.3}       \PYG{l+m+mf}{45.1}   \PYG{l+m+mf}{10.4}       \PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}   \PYG{l+m+mf}{17.2}   \PYG{l+m+mf}{45.9}       \PYG{l+m+mf}{69.3}    \PYG{l+m+mf}{9.3}       \PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}  \PYG{l+m+mf}{151.5}   \PYG{l+m+mf}{41.3}       \PYG{l+m+mf}{58.5}   \PYG{l+m+mf}{18.5}       \PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                        \PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{Column Names}
\label{\detokenize{rdd:column-names}}
\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{columns}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{columns}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Index}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TV}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Radio}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Newspaper}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sales}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{dtype}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{object}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TV}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Radio}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Newspaper}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sales}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\end{sphinxVerbatim}


\subsection{Data types}
\label{\detokenize{rdd:data-types}}
\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{dtypes}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{dtypes}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{TV}           \PYG{n}{float64}                    \PYG{p}{[}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TV}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{double}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
\PYG{n}{Radio}        \PYG{n}{float64}                     \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Radio}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{double}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
\PYG{n}{Newspaper}    \PYG{n}{float64}                     \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Newspaper}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{double}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
\PYG{n}{Sales}        \PYG{n}{float64}                     \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sales}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{double}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{dtype}\PYG{p}{:} \PYG{n+nb}{object}
\end{sphinxVerbatim}


\subsection{Fill Null}
\label{\detokenize{rdd:fill-null}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{my\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n+nb+bp}{None}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{c}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{]}
\PYG{n}{dp} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{n}{my\PYGZus{}list}\PYG{p}{,}\PYG{n}{columns}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{ds} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{my\PYGZus{}list}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                        \PYG{o}{\textbar{}}     \PYG{n}{A}\PYG{o}{\textbar{}}  \PYG{n}{B}\PYG{o}{\textbar{}}   \PYG{n}{C}\PYG{o}{\textbar{}}
        \PYG{n}{A}  \PYG{n}{B}    \PYG{n}{C}                       \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}    \PYG{n}{male}  \PYG{l+m+mi}{1}  \PYG{n}{NaN}                       \PYG{o}{\textbar{}}  \PYG{n}{male}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}  \PYG{n}{female}  \PYG{l+m+mi}{2}  \PYG{l+m+mf}{3.0}                       \PYG{o}{\textbar{}}\PYG{n}{female}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}    \PYG{n}{male}  \PYG{l+m+mi}{3}  \PYG{l+m+mf}{4.0}                       \PYG{o}{\textbar{}}  \PYG{n}{male}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{fillna}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{99}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{fillna}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{99}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                        \PYG{o}{\textbar{}}     \PYG{n}{A}\PYG{o}{\textbar{}}  \PYG{n}{B}\PYG{o}{\textbar{}}   \PYG{n}{C}\PYG{o}{\textbar{}}
        \PYG{n}{A}  \PYG{n}{B}    \PYG{n}{C}                       \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}    \PYG{n}{male}  \PYG{l+m+mi}{1}  \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{99}                       \PYG{o}{\textbar{}}  \PYG{n}{male}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{99}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}  \PYG{n}{female}  \PYG{l+m+mi}{2}  \PYG{l+m+mf}{3.0}                       \PYG{o}{\textbar{}}\PYG{n}{female}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}    \PYG{n}{male}  \PYG{l+m+mi}{3}  \PYG{l+m+mf}{4.0}                       \PYG{o}{\textbar{}}  \PYG{n}{male}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}


\subsection{Replace Values}
\label{\detokenize{rdd:replace-values}}
\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} caution: you need to chose specific col}
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{A}\PYG{o}{.}\PYG{n}{replace}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{male}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{female}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{inplace}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
\PYG{n}{dp}
\PYG{c+c1}{\PYGZsh{}caution: Mixed type replacements are not supported}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{na}\PYG{o}{.}\PYG{n}{replace}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{male}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{female}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                \PYG{o}{\textbar{}}  \PYG{n}{A}\PYG{o}{\textbar{}}  \PYG{n}{B}\PYG{o}{\textbar{}}   \PYG{n}{C}\PYG{o}{\textbar{}}
   \PYG{n}{A}  \PYG{n}{B}    \PYG{n}{C}                    \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{l+m+mi}{1}  \PYG{l+m+mi}{1}  \PYG{n}{NaN}                    \PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}  \PYG{l+m+mi}{0}  \PYG{l+m+mi}{2}  \PYG{l+m+mf}{3.0}                    \PYG{o}{\textbar{}}  \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}  \PYG{l+m+mi}{1}  \PYG{l+m+mi}{3}  \PYG{l+m+mf}{4.0}                    \PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}
                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}


\subsection{Rename Columns}
\label{\detokenize{rdd:rename-columns}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Rename all columns

\end{enumerate}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{columns} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{c}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{c}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{o}{\textbar{}}    \PYG{n}{a}\PYG{o}{\textbar{}}   \PYG{n}{b}\PYG{o}{\textbar{}}   \PYG{n}{c}\PYG{o}{\textbar{}}   \PYG{n}{d}\PYG{o}{\textbar{}}
       \PYG{n}{a}     \PYG{n}{b}     \PYG{n}{c}     \PYG{n}{d}                      \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{l+m+mf}{230.1}  \PYG{l+m+mf}{37.8}  \PYG{l+m+mf}{69.2}  \PYG{l+m+mf}{22.1}                      \PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}\PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}}\PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}   \PYG{l+m+mf}{44.5}  \PYG{l+m+mf}{39.3}  \PYG{l+m+mf}{45.1}  \PYG{l+m+mf}{10.4}                      \PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}   \PYG{l+m+mf}{17.2}  \PYG{l+m+mf}{45.9}  \PYG{l+m+mf}{69.3}   \PYG{l+m+mf}{9.3}                      \PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}}\PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}\PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}} \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}  \PYG{l+m+mf}{151.5}  \PYG{l+m+mf}{41.3}  \PYG{l+m+mf}{58.5}  \PYG{l+m+mf}{18.5}                      \PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Rename one or more columns

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{mapping} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Newspaper}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sales}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{D}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{n}{columns}\PYG{o}{=}\PYG{n}{mapping}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{new\PYGZus{}names} \PYG{o}{=} \PYG{p}{[}\PYG{n}{mapping}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{col}\PYG{p}{,}\PYG{n}{col}\PYG{p}{)} \PYG{k}{for} \PYG{n}{col} \PYG{o+ow}{in} \PYG{n}{ds}\PYG{o}{.}\PYG{n}{columns}\PYG{p}{]}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{o}{*}\PYG{n}{new\PYGZus{}names}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                        \PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}   \PYG{n}{C}\PYG{o}{\textbar{}}   \PYG{n}{D}\PYG{o}{\textbar{}}
      \PYG{n}{TV}  \PYG{n}{Radio}     \PYG{n}{C}     \PYG{n}{D}             \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{l+m+mf}{230.1}   \PYG{l+m+mf}{37.8}  \PYG{l+m+mf}{69.2}  \PYG{l+m+mf}{22.1}             \PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}\PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}}\PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}   \PYG{l+m+mf}{44.5}   \PYG{l+m+mf}{39.3}  \PYG{l+m+mf}{45.1}  \PYG{l+m+mf}{10.4}             \PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}   \PYG{l+m+mf}{17.2}   \PYG{l+m+mf}{45.9}  \PYG{l+m+mf}{69.3}   \PYG{l+m+mf}{9.3}             \PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}\PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}} \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}  \PYG{l+m+mf}{151.5}   \PYG{l+m+mf}{41.3}  \PYG{l+m+mf}{58.5}  \PYG{l+m+mf}{18.5}             \PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                        \PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
You can also use \sphinxcode{\sphinxupquote{withColumnRenamed}} to rename one column in PySpark.

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{withColumnRenamed}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Newspaper}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Paper}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Paper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}} \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}} \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}} \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}
\end{sphinxadmonition}


\subsection{Drop Columns}
\label{\detokenize{rdd:drop-columns}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{drop\PYGZus{}name} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Newspaper}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sales}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{drop}\PYG{p}{(}\PYG{n}{drop\PYGZus{}name}\PYG{p}{,}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{drop}\PYG{p}{(}\PYG{o}{*}\PYG{n}{drop\PYGZus{}name}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                \PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}
      \PYG{n}{TV}  \PYG{n}{Radio}                 \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{l+m+mf}{230.1}   \PYG{l+m+mf}{37.8}                 \PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}   \PYG{l+m+mf}{44.5}   \PYG{l+m+mf}{39.3}                 \PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}   \PYG{l+m+mf}{17.2}   \PYG{l+m+mf}{45.9}                 \PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}  \PYG{l+m+mf}{151.5}   \PYG{l+m+mf}{41.3}                 \PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}
                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                \PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{Filter}
\label{\detokenize{rdd:filter}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Advertising.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{csv}\PYG{p}{(}\PYG{n}{path}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Advertising.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                    \PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,}
                    \PYG{n}{inferSchema}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{p}{[}\PYG{n}{dp}\PYG{o}{.}\PYG{n}{Newspaper}\PYG{o}{\PYGZlt{}}\PYG{l+m+mi}{20}\PYG{p}{]}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{p}{[}\PYG{n}{ds}\PYG{o}{.}\PYG{n}{Newspaper}\PYG{o}{\PYGZlt{}}\PYG{l+m+mi}{20}\PYG{p}{]}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}
       \PYG{n}{TV}  \PYG{n}{Radio}  \PYG{n}{Newspaper}  \PYG{n}{Sales}              \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{7}   \PYG{l+m+mf}{120.2}   \PYG{l+m+mf}{19.6}       \PYG{l+m+mf}{11.6}   \PYG{l+m+mf}{13.2}              \PYG{o}{\textbar{}}\PYG{l+m+mf}{120.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{19.6}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{11.6}\PYG{o}{\textbar{}} \PYG{l+m+mf}{13.2}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{8}     \PYG{l+m+mf}{8.6}    \PYG{l+m+mf}{2.1}        \PYG{l+m+mf}{1.0}    \PYG{l+m+mf}{4.8}              \PYG{o}{\textbar{}}  \PYG{l+m+mf}{8.6}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.1}\PYG{o}{\textbar{}}      \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{4.8}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{11}  \PYG{l+m+mf}{214.7}   \PYG{l+m+mf}{24.0}        \PYG{l+m+mf}{4.0}   \PYG{l+m+mf}{17.4}              \PYG{o}{\textbar{}}\PYG{l+m+mf}{214.7}\PYG{o}{\textbar{}} \PYG{l+m+mf}{24.0}\PYG{o}{\textbar{}}      \PYG{l+m+mf}{4.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{17.4}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{13}   \PYG{l+m+mf}{97.5}    \PYG{l+m+mf}{7.6}        \PYG{l+m+mf}{7.2}    \PYG{l+m+mf}{9.7}              \PYG{o}{\textbar{}} \PYG{l+m+mf}{97.5}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.6}\PYG{o}{\textbar{}}      \PYG{l+m+mf}{7.2}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.7}\PYG{o}{\textbar{}}
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{p}{[}\PYG{p}{(}\PYG{n}{dp}\PYG{o}{.}\PYG{n}{Newspaper}\PYG{o}{\PYGZlt{}}\PYG{l+m+mi}{20}\PYG{p}{)}\PYG{o}{\PYGZam{}}\PYG{p}{(}\PYG{n}{dp}\PYG{o}{.}\PYG{n}{TV}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{100}\PYG{p}{)}\PYG{p}{]}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{p}{[}\PYG{p}{(}\PYG{n}{ds}\PYG{o}{.}\PYG{n}{Newspaper}\PYG{o}{\PYGZlt{}}\PYG{l+m+mi}{20}\PYG{p}{)}\PYG{o}{\PYGZam{}}\PYG{p}{(}\PYG{n}{ds}\PYG{o}{.}\PYG{n}{TV}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{100}\PYG{p}{)}\PYG{p}{]}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}
       \PYG{n}{TV}  \PYG{n}{Radio}  \PYG{n}{Newspaper}  \PYG{n}{Sales}              \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{7}   \PYG{l+m+mf}{120.2}   \PYG{l+m+mf}{19.6}       \PYG{l+m+mf}{11.6}   \PYG{l+m+mf}{13.2}              \PYG{o}{\textbar{}}\PYG{l+m+mf}{120.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{19.6}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{11.6}\PYG{o}{\textbar{}} \PYG{l+m+mf}{13.2}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{11}  \PYG{l+m+mf}{214.7}   \PYG{l+m+mf}{24.0}        \PYG{l+m+mf}{4.0}   \PYG{l+m+mf}{17.4}              \PYG{o}{\textbar{}}\PYG{l+m+mf}{214.7}\PYG{o}{\textbar{}} \PYG{l+m+mf}{24.0}\PYG{o}{\textbar{}}      \PYG{l+m+mf}{4.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{17.4}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{19}  \PYG{l+m+mf}{147.3}   \PYG{l+m+mf}{23.9}       \PYG{l+m+mf}{19.1}   \PYG{l+m+mf}{14.6}              \PYG{o}{\textbar{}}\PYG{l+m+mf}{147.3}\PYG{o}{\textbar{}} \PYG{l+m+mf}{23.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{19.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{14.6}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{25}  \PYG{l+m+mf}{262.9}    \PYG{l+m+mf}{3.5}       \PYG{l+m+mf}{19.5}   \PYG{l+m+mf}{12.0}              \PYG{o}{\textbar{}}\PYG{l+m+mf}{262.9}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{3.5}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{19.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.0}\PYG{o}{\textbar{}}
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{With New Column}
\label{\detokenize{rdd:with-new-column}}
\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tv\PYGZus{}norm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{dp}\PYG{o}{.}\PYG{n}{TV}\PYG{o}{/}\PYG{n+nb}{sum}\PYG{p}{(}\PYG{n}{dp}\PYG{o}{.}\PYG{n}{TV}\PYG{p}{)}
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tv\PYGZus{}norm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ds}\PYG{o}{.}\PYG{n}{TV}\PYG{o}{/}\PYG{n}{ds}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{agg}\PYG{p}{(}\PYG{n}{F}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{TV}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}             \PYG{n}{tv\PYGZus{}norm}\PYG{o}{\textbar{}}
      \PYG{n}{TV}  \PYG{n}{Radio}  \PYG{n}{Newspaper}  \PYG{n}{Sales}   \PYG{n}{tv\PYGZus{}norm}     \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{l+m+mf}{230.1}   \PYG{l+m+mf}{37.8}       \PYG{l+m+mf}{69.2}   \PYG{l+m+mf}{22.1}  \PYG{l+m+mf}{0.007824}     \PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.007824268493802813}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}   \PYG{l+m+mf}{44.5}   \PYG{l+m+mf}{39.3}       \PYG{l+m+mf}{45.1}   \PYG{l+m+mf}{10.4}  \PYG{l+m+mf}{0.001513}     \PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.001513167961643}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}   \PYG{l+m+mf}{17.2}   \PYG{l+m+mf}{45.9}       \PYG{l+m+mf}{69.3}    \PYG{l+m+mf}{9.3}  \PYG{l+m+mf}{0.000585}     \PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{5.848649200061207E\PYGZhy{}4}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}  \PYG{l+m+mf}{151.5}   \PYG{l+m+mf}{41.3}       \PYG{l+m+mf}{58.5}   \PYG{l+m+mf}{18.5}  \PYG{l+m+mf}{0.005152}     \PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.005151571824472517}\PYG{o}{\textbar{}}
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cond}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{dp}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{c}\PYG{p}{:} \PYG{l+m+mi}{1} \PYG{k}{if} \PYG{p}{(}\PYG{p}{(}\PYG{n}{c}\PYG{o}{.}\PYG{n}{TV}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{100}\PYG{p}{)}\PYG{o}{\PYGZam{}}\PYG{p}{(}\PYG{n}{c}\PYG{o}{.}\PYG{n}{Radio}\PYG{o}{\PYGZlt{}}\PYG{l+m+mi}{40}\PYG{p}{)}\PYG{p}{)} \PYG{k}{else} \PYG{l+m+mi}{2} \PYG{k}{if} \PYG{n}{c}\PYG{o}{.}\PYG{n}{Sales}\PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{10} \PYG{k}{else} \PYG{l+m+mi}{3}\PYG{p}{,}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cond}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{F}\PYG{o}{.}\PYG{n}{when}\PYG{p}{(}\PYG{p}{(}\PYG{n}{ds}\PYG{o}{.}\PYG{n}{TV}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{100}\PYG{p}{)}\PYG{o}{\PYGZam{}}\PYG{p}{(}\PYG{n}{ds}\PYG{o}{.}\PYG{n}{Radio}\PYG{o}{\PYGZlt{}}\PYG{l+m+mi}{40}\PYG{p}{)}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}\PYGZbs{}
                      \PYG{o}{.}\PYG{n}{when}\PYG{p}{(}\PYG{n}{ds}\PYG{o}{.}\PYG{n}{Sales}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}\PYGZbs{}
                      \PYG{o}{.}\PYG{n}{otherwise}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}\PYG{n}{cond}\PYG{o}{\textbar{}}
      \PYG{n}{TV}  \PYG{n}{Radio}  \PYG{n}{Newspaper}  \PYG{n}{Sales}  \PYG{n}{cond}         \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{l+m+mf}{230.1}   \PYG{l+m+mf}{37.8}       \PYG{l+m+mf}{69.2}   \PYG{l+m+mf}{22.1}     \PYG{l+m+mi}{1}         \PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}   \PYG{l+m+mf}{44.5}   \PYG{l+m+mf}{39.3}       \PYG{l+m+mf}{45.1}   \PYG{l+m+mf}{10.4}     \PYG{l+m+mi}{2}         \PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}   \PYG{l+m+mf}{17.2}   \PYG{l+m+mf}{45.9}       \PYG{l+m+mf}{69.3}    \PYG{l+m+mf}{9.3}     \PYG{l+m+mi}{3}         \PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}  \PYG{l+m+mf}{151.5}   \PYG{l+m+mf}{41.3}       \PYG{l+m+mf}{58.5}   \PYG{l+m+mf}{18.5}     \PYG{l+m+mi}{2}         \PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{log\PYGZus{}tv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{log}\PYG{p}{(}\PYG{n}{dp}\PYG{o}{.}\PYG{n}{TV}\PYG{p}{)}
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{log\PYGZus{}tv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{F}\PYG{o}{.}\PYG{n}{log}\PYG{p}{(}\PYG{n}{ds}\PYG{o}{.}\PYG{n}{TV}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}            \PYG{n}{log\PYGZus{}tv}\PYG{o}{\textbar{}}
      \PYG{n}{TV}  \PYG{n}{Radio}  \PYG{n}{Newspaper}  \PYG{n}{Sales}    \PYG{n}{log\PYGZus{}tv}     \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{l+m+mf}{230.1}   \PYG{l+m+mf}{37.8}       \PYG{l+m+mf}{69.2}   \PYG{l+m+mf}{22.1}  \PYG{l+m+mf}{5.438514}     \PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.43851399704132}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}   \PYG{l+m+mf}{44.5}   \PYG{l+m+mf}{39.3}       \PYG{l+m+mf}{45.1}   \PYG{l+m+mf}{10.4}  \PYG{l+m+mf}{3.795489}     \PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.7954891891721947}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}   \PYG{l+m+mf}{17.2}   \PYG{l+m+mf}{45.9}       \PYG{l+m+mf}{69.3}    \PYG{l+m+mf}{9.3}  \PYG{l+m+mf}{2.844909}     \PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{2.8449093838194073}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}  \PYG{l+m+mf}{151.5}   \PYG{l+m+mf}{41.3}       \PYG{l+m+mf}{58.5}   \PYG{l+m+mf}{18.5}  \PYG{l+m+mf}{5.020586}     \PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5.020585624949423}\PYG{o}{\textbar{}}
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tv+10}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{dp}\PYG{o}{.}\PYG{n}{TV}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{x}\PYG{o}{+}\PYG{l+m+mi}{10}\PYG{p}{)}
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tv+10}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ds}\PYG{o}{.}\PYG{n}{TV}\PYG{o}{+}\PYG{l+m+mi}{10}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}\PYG{n}{tv}\PYG{o}{+}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}
      \PYG{n}{TV}  \PYG{n}{Radio}  \PYG{n}{Newspaper}  \PYG{n}{Sales}  \PYG{n}{tv}\PYG{o}{+}\PYG{l+m+mi}{10}        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{l+m+mf}{230.1}   \PYG{l+m+mf}{37.8}       \PYG{l+m+mf}{69.2}   \PYG{l+m+mf}{22.1}  \PYG{l+m+mf}{240.1}        \PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{240.1}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}   \PYG{l+m+mf}{44.5}   \PYG{l+m+mf}{39.3}       \PYG{l+m+mf}{45.1}   \PYG{l+m+mf}{10.4}   \PYG{l+m+mf}{54.5}        \PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}} \PYG{l+m+mf}{54.5}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}   \PYG{l+m+mf}{17.2}   \PYG{l+m+mf}{45.9}       \PYG{l+m+mf}{69.3}    \PYG{l+m+mf}{9.3}   \PYG{l+m+mf}{27.2}        \PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}} \PYG{l+m+mf}{27.2}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}  \PYG{l+m+mf}{151.5}   \PYG{l+m+mf}{41.3}       \PYG{l+m+mf}{58.5}   \PYG{l+m+mf}{18.5}  \PYG{l+m+mf}{161.5}        \PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{161.5}\PYG{o}{\textbar{}}
                                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                                \PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{Join}
\label{\detokenize{rdd:join}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{leftp} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{D}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{D0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{D1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{D2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{D3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
                    \PYG{n}{index}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{rightp} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A6}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A7}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                       \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{F}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B4}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B6}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B7}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                       \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{G}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C4}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C6}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{C7}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                       \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{H}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{D4}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{D5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{D6}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{D7}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
                       \PYG{n}{index}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{lefts} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{leftp}\PYG{p}{)}
\PYG{n}{rights} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{rightp}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
    \PYG{n}{A}   \PYG{n}{B}   \PYG{n}{C}   \PYG{n}{D}                   \PYG{n}{A}   \PYG{n}{F}   \PYG{n}{G}   \PYG{n}{H}
\PYG{l+m+mi}{0}  \PYG{n}{A0}  \PYG{n}{B0}  \PYG{n}{C0}  \PYG{n}{D0}               \PYG{l+m+mi}{4}  \PYG{n}{A0}  \PYG{n}{B4}  \PYG{n}{C4}  \PYG{n}{D4}
\PYG{l+m+mi}{1}  \PYG{n}{A1}  \PYG{n}{B1}  \PYG{n}{C1}  \PYG{n}{D1}               \PYG{l+m+mi}{5}  \PYG{n}{A1}  \PYG{n}{B5}  \PYG{n}{C5}  \PYG{n}{D5}
\PYG{l+m+mi}{2}  \PYG{n}{A2}  \PYG{n}{B2}  \PYG{n}{C2}  \PYG{n}{D2}               \PYG{l+m+mi}{6}  \PYG{n}{A6}  \PYG{n}{B6}  \PYG{n}{C6}  \PYG{n}{D6}
\PYG{l+m+mi}{3}  \PYG{n}{A3}  \PYG{n}{B3}  \PYG{n}{C3}  \PYG{n}{D3}               \PYG{l+m+mi}{7}  \PYG{n}{A7}  \PYG{n}{B7}  \PYG{n}{C7}  \PYG{n}{D7}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Left Join
\begin{quote}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{leftp}\PYG{o}{.}\PYG{n}{merge}\PYG{p}{(}\PYG{n}{rightp}\PYG{p}{,}\PYG{n}{on}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{lefts}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{rights}\PYG{p}{,}\PYG{n}{on}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
     \PYG{o}{.}\PYG{n}{orderBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{ascending}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                        \PYG{o}{\textbar{}}  \PYG{n}{A}\PYG{o}{\textbar{}}  \PYG{n}{B}\PYG{o}{\textbar{}}  \PYG{n}{C}\PYG{o}{\textbar{}}  \PYG{n}{D}\PYG{o}{\textbar{}}   \PYG{n}{F}\PYG{o}{\textbar{}}   \PYG{n}{G}\PYG{o}{\textbar{}}   \PYG{n}{H}\PYG{o}{\textbar{}}
    \PYG{n}{A}   \PYG{n}{B}   \PYG{n}{C}   \PYG{n}{D}    \PYG{n}{F}    \PYG{n}{G}    \PYG{n}{H}        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{n}{A0}  \PYG{n}{B0}  \PYG{n}{C0}  \PYG{n}{D0}   \PYG{n}{B4}   \PYG{n}{C4}   \PYG{n}{D4}        \PYG{o}{\textbar{}} \PYG{n}{A0}\PYG{o}{\textbar{}} \PYG{n}{B0}\PYG{o}{\textbar{}} \PYG{n}{C0}\PYG{o}{\textbar{}} \PYG{n}{D0}\PYG{o}{\textbar{}}  \PYG{n}{B4}\PYG{o}{\textbar{}}  \PYG{n}{C4}\PYG{o}{\textbar{}}  \PYG{n}{D4}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}  \PYG{n}{A1}  \PYG{n}{B1}  \PYG{n}{C1}  \PYG{n}{D1}   \PYG{n}{B5}   \PYG{n}{C5}   \PYG{n}{D5}        \PYG{o}{\textbar{}} \PYG{n}{A1}\PYG{o}{\textbar{}} \PYG{n}{B1}\PYG{o}{\textbar{}} \PYG{n}{C1}\PYG{o}{\textbar{}} \PYG{n}{D1}\PYG{o}{\textbar{}}  \PYG{n}{B5}\PYG{o}{\textbar{}}  \PYG{n}{C5}\PYG{o}{\textbar{}}  \PYG{n}{D5}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}  \PYG{n}{A2}  \PYG{n}{B2}  \PYG{n}{C2}  \PYG{n}{D2}  \PYG{n}{NaN}  \PYG{n}{NaN}  \PYG{n}{NaN}        \PYG{o}{\textbar{}} \PYG{n}{A2}\PYG{o}{\textbar{}} \PYG{n}{B2}\PYG{o}{\textbar{}} \PYG{n}{C2}\PYG{o}{\textbar{}} \PYG{n}{D2}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}  \PYG{n}{A3}  \PYG{n}{B3}  \PYG{n}{C3}  \PYG{n}{D3}  \PYG{n}{NaN}  \PYG{n}{NaN}  \PYG{n}{NaN}        \PYG{o}{\textbar{}} \PYG{n}{A3}\PYG{o}{\textbar{}} \PYG{n}{B3}\PYG{o}{\textbar{}} \PYG{n}{C3}\PYG{o}{\textbar{}} \PYG{n}{D3}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\end{quote}

\item {} 
Right Join
\begin{quote}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{leftp}\PYG{o}{.}\PYG{n}{merge}\PYG{p}{(}\PYG{n}{rightp}\PYG{p}{,}\PYG{n}{on}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{right}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{lefts}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{rights}\PYG{p}{,}\PYG{n}{on}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{right}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
     \PYG{o}{.}\PYG{n}{orderBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{ascending}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                        \PYG{o}{\textbar{}}  \PYG{n}{A}\PYG{o}{\textbar{}}   \PYG{n}{B}\PYG{o}{\textbar{}}   \PYG{n}{C}\PYG{o}{\textbar{}}   \PYG{n}{D}\PYG{o}{\textbar{}}  \PYG{n}{F}\PYG{o}{\textbar{}}  \PYG{n}{G}\PYG{o}{\textbar{}}  \PYG{n}{H}\PYG{o}{\textbar{}}
    \PYG{n}{A}    \PYG{n}{B}    \PYG{n}{C}    \PYG{n}{D}   \PYG{n}{F}   \PYG{n}{G}   \PYG{n}{H}        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{n}{A0}   \PYG{n}{B0}   \PYG{n}{C0}   \PYG{n}{D0}  \PYG{n}{B4}  \PYG{n}{C4}  \PYG{n}{D4}        \PYG{o}{\textbar{}} \PYG{n}{A0}\PYG{o}{\textbar{}}  \PYG{n}{B0}\PYG{o}{\textbar{}}  \PYG{n}{C0}\PYG{o}{\textbar{}}  \PYG{n}{D0}\PYG{o}{\textbar{}} \PYG{n}{B4}\PYG{o}{\textbar{}} \PYG{n}{C4}\PYG{o}{\textbar{}} \PYG{n}{D4}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}  \PYG{n}{A1}   \PYG{n}{B1}   \PYG{n}{C1}   \PYG{n}{D1}  \PYG{n}{B5}  \PYG{n}{C5}  \PYG{n}{D5}        \PYG{o}{\textbar{}} \PYG{n}{A1}\PYG{o}{\textbar{}}  \PYG{n}{B1}\PYG{o}{\textbar{}}  \PYG{n}{C1}\PYG{o}{\textbar{}}  \PYG{n}{D1}\PYG{o}{\textbar{}} \PYG{n}{B5}\PYG{o}{\textbar{}} \PYG{n}{C5}\PYG{o}{\textbar{}} \PYG{n}{D5}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}  \PYG{n}{A6}  \PYG{n}{NaN}  \PYG{n}{NaN}  \PYG{n}{NaN}  \PYG{n}{B6}  \PYG{n}{C6}  \PYG{n}{D6}        \PYG{o}{\textbar{}} \PYG{n}{A6}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}} \PYG{n}{B6}\PYG{o}{\textbar{}} \PYG{n}{C6}\PYG{o}{\textbar{}} \PYG{n}{D6}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}  \PYG{n}{A7}  \PYG{n}{NaN}  \PYG{n}{NaN}  \PYG{n}{NaN}  \PYG{n}{B7}  \PYG{n}{C7}  \PYG{n}{D7}        \PYG{o}{\textbar{}} \PYG{n}{A7}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}} \PYG{n}{B7}\PYG{o}{\textbar{}} \PYG{n}{C7}\PYG{o}{\textbar{}} \PYG{n}{D7}\PYG{o}{\textbar{}}
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\end{quote}

\item {} 
Inner Join
\begin{quote}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{leftp}\PYG{o}{.}\PYG{n}{merge}\PYG{p}{(}\PYG{n}{rightp}\PYG{p}{,}\PYG{n}{on}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{inner}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{lefts}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{rights}\PYG{p}{,}\PYG{n}{on}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{inner}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
     \PYG{o}{.}\PYG{n}{orderBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{ascending}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                \PYG{o}{\textbar{}}  \PYG{n}{A}\PYG{o}{\textbar{}}  \PYG{n}{B}\PYG{o}{\textbar{}}  \PYG{n}{C}\PYG{o}{\textbar{}}  \PYG{n}{D}\PYG{o}{\textbar{}}  \PYG{n}{F}\PYG{o}{\textbar{}}  \PYG{n}{G}\PYG{o}{\textbar{}}  \PYG{n}{H}\PYG{o}{\textbar{}}
    \PYG{n}{A}   \PYG{n}{B}   \PYG{n}{C}   \PYG{n}{D}   \PYG{n}{F}   \PYG{n}{G}   \PYG{n}{H}   \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{n}{A0}  \PYG{n}{B0}  \PYG{n}{C0}  \PYG{n}{D0}  \PYG{n}{B4}  \PYG{n}{C4}  \PYG{n}{D4}   \PYG{o}{\textbar{}} \PYG{n}{A0}\PYG{o}{\textbar{}} \PYG{n}{B0}\PYG{o}{\textbar{}} \PYG{n}{C0}\PYG{o}{\textbar{}} \PYG{n}{D0}\PYG{o}{\textbar{}} \PYG{n}{B4}\PYG{o}{\textbar{}} \PYG{n}{C4}\PYG{o}{\textbar{}} \PYG{n}{D4}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}  \PYG{n}{A1}  \PYG{n}{B1}  \PYG{n}{C1}  \PYG{n}{D1}  \PYG{n}{B5}  \PYG{n}{C5}  \PYG{n}{D5}   \PYG{o}{\textbar{}} \PYG{n}{A1}\PYG{o}{\textbar{}} \PYG{n}{B1}\PYG{o}{\textbar{}} \PYG{n}{C1}\PYG{o}{\textbar{}} \PYG{n}{D1}\PYG{o}{\textbar{}} \PYG{n}{B5}\PYG{o}{\textbar{}} \PYG{n}{C5}\PYG{o}{\textbar{}} \PYG{n}{D5}\PYG{o}{\textbar{}}
                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\end{quote}

\item {} 
Full Join
\begin{quote}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{leftp}\PYG{o}{.}\PYG{n}{merge}\PYG{p}{(}\PYG{n}{rightp}\PYG{p}{,}\PYG{n}{on}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{full}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{lefts}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{rights}\PYG{p}{,}\PYG{n}{on}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{full}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
     \PYG{o}{.}\PYG{n}{orderBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{A}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{ascending}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                        \PYG{o}{\textbar{}}  \PYG{n}{A}\PYG{o}{\textbar{}}   \PYG{n}{B}\PYG{o}{\textbar{}}   \PYG{n}{C}\PYG{o}{\textbar{}}   \PYG{n}{D}\PYG{o}{\textbar{}}   \PYG{n}{F}\PYG{o}{\textbar{}}   \PYG{n}{G}\PYG{o}{\textbar{}}   \PYG{n}{H}\PYG{o}{\textbar{}}
    \PYG{n}{A}    \PYG{n}{B}    \PYG{n}{C}    \PYG{n}{D}    \PYG{n}{F}    \PYG{n}{G}    \PYG{n}{H}     \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}  \PYG{n}{A0}   \PYG{n}{B0}   \PYG{n}{C0}   \PYG{n}{D0}   \PYG{n}{B4}   \PYG{n}{C4}   \PYG{n}{D4}     \PYG{o}{\textbar{}} \PYG{n}{A0}\PYG{o}{\textbar{}}  \PYG{n}{B0}\PYG{o}{\textbar{}}  \PYG{n}{C0}\PYG{o}{\textbar{}}  \PYG{n}{D0}\PYG{o}{\textbar{}}  \PYG{n}{B4}\PYG{o}{\textbar{}}  \PYG{n}{C4}\PYG{o}{\textbar{}}  \PYG{n}{D4}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}  \PYG{n}{A1}   \PYG{n}{B1}   \PYG{n}{C1}   \PYG{n}{D1}   \PYG{n}{B5}   \PYG{n}{C5}   \PYG{n}{D5}     \PYG{o}{\textbar{}} \PYG{n}{A1}\PYG{o}{\textbar{}}  \PYG{n}{B1}\PYG{o}{\textbar{}}  \PYG{n}{C1}\PYG{o}{\textbar{}}  \PYG{n}{D1}\PYG{o}{\textbar{}}  \PYG{n}{B5}\PYG{o}{\textbar{}}  \PYG{n}{C5}\PYG{o}{\textbar{}}  \PYG{n}{D5}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}  \PYG{n}{A2}   \PYG{n}{B2}   \PYG{n}{C2}   \PYG{n}{D2}  \PYG{n}{NaN}  \PYG{n}{NaN}  \PYG{n}{NaN}     \PYG{o}{\textbar{}} \PYG{n}{A2}\PYG{o}{\textbar{}}  \PYG{n}{B2}\PYG{o}{\textbar{}}  \PYG{n}{C2}\PYG{o}{\textbar{}}  \PYG{n}{D2}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}  \PYG{n}{A3}   \PYG{n}{B3}   \PYG{n}{C3}   \PYG{n}{D3}  \PYG{n}{NaN}  \PYG{n}{NaN}  \PYG{n}{NaN}     \PYG{o}{\textbar{}} \PYG{n}{A3}\PYG{o}{\textbar{}}  \PYG{n}{B3}\PYG{o}{\textbar{}}  \PYG{n}{C3}\PYG{o}{\textbar{}}  \PYG{n}{D3}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{4}  \PYG{n}{A6}  \PYG{n}{NaN}  \PYG{n}{NaN}  \PYG{n}{NaN}   \PYG{n}{B6}   \PYG{n}{C6}   \PYG{n}{D6}     \PYG{o}{\textbar{}} \PYG{n}{A6}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}  \PYG{n}{B6}\PYG{o}{\textbar{}}  \PYG{n}{C6}\PYG{o}{\textbar{}}  \PYG{n}{D6}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{5}  \PYG{n}{A7}  \PYG{n}{NaN}  \PYG{n}{NaN}  \PYG{n}{NaN}   \PYG{n}{B7}   \PYG{n}{C7}   \PYG{n}{D7}     \PYG{o}{\textbar{}} \PYG{n}{A7}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}  \PYG{n}{B7}\PYG{o}{\textbar{}}  \PYG{n}{C7}\PYG{o}{\textbar{}}  \PYG{n}{D7}\PYG{o}{\textbar{}}
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\end{quote}

\end{enumerate}


\subsection{Concat Columns}
\label{\detokenize{rdd:concat-columns}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{my\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{,}
           \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,}
           \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{c}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{9}\PYG{p}{)}\PYG{p}{,}
           \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}\PYG{p}{,}
           \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,}
           \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{c}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{9}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{col\PYGZus{}name} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{dp} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{n}{my\PYGZus{}list}\PYG{p}{,}\PYG{n}{columns}\PYG{o}{=}\PYG{n}{col\PYGZus{}name}\PYG{p}{)}
\PYG{n}{ds} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{my\PYGZus{}list}\PYG{p}{,}\PYG{n}{schema}\PYG{o}{=}\PYG{n}{col\PYGZus{}name}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
  \PYG{n}{col1}  \PYG{n}{col2}  \PYG{n}{col3}
\PYG{l+m+mi}{0}    \PYG{n}{a}     \PYG{l+m+mi}{2}     \PYG{l+m+mi}{3}
\PYG{l+m+mi}{1}    \PYG{n}{b}     \PYG{l+m+mi}{5}     \PYG{l+m+mi}{6}
\PYG{l+m+mi}{2}    \PYG{n}{c}     \PYG{l+m+mi}{8}     \PYG{l+m+mi}{9}
\PYG{l+m+mi}{3}    \PYG{n}{a}     \PYG{l+m+mi}{2}     \PYG{l+m+mi}{3}
\PYG{l+m+mi}{4}    \PYG{n}{b}     \PYG{l+m+mi}{5}     \PYG{l+m+mi}{6}
\PYG{l+m+mi}{5}    \PYG{n}{c}     \PYG{l+m+mi}{8}     \PYG{l+m+mi}{9}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{concat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{dp}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{\PYGZpc{}}\PYG{p}{(}\PYG{n}{x}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}\PYG{n}{x}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{dp}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{concat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{F}\PYG{o}{.}\PYG{n}{concat}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
                                        \PYG{o}{\textbar{}}\PYG{n}{col1}\PYG{o}{\textbar{}}\PYG{n}{col2}\PYG{o}{\textbar{}}\PYG{n}{col3}\PYG{o}{\textbar{}}\PYG{n}{concat}\PYG{o}{\textbar{}}
  \PYG{n}{col1}  \PYG{n}{col2}  \PYG{n}{col3} \PYG{n}{concat}               \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{l+m+mi}{0}    \PYG{n}{a}     \PYG{l+m+mi}{2}     \PYG{l+m+mi}{3}     \PYG{n}{a2}               \PYG{o}{\textbar{}}   \PYG{n}{a}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}    \PYG{n}{a2}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{1}    \PYG{n}{b}     \PYG{l+m+mi}{5}     \PYG{l+m+mi}{6}     \PYG{n}{b5}               \PYG{o}{\textbar{}}   \PYG{n}{b}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}    \PYG{n}{b5}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{2}    \PYG{n}{c}     \PYG{l+m+mi}{8}     \PYG{l+m+mi}{9}     \PYG{n}{c8}               \PYG{o}{\textbar{}}   \PYG{n}{c}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{9}\PYG{o}{\textbar{}}    \PYG{n}{c8}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{3}    \PYG{n}{a}     \PYG{l+m+mi}{2}     \PYG{l+m+mi}{3}     \PYG{n}{a2}               \PYG{o}{\textbar{}}   \PYG{n}{a}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}    \PYG{n}{a2}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{4}    \PYG{n}{b}     \PYG{l+m+mi}{5}     \PYG{l+m+mi}{6}     \PYG{n}{b5}               \PYG{o}{\textbar{}}   \PYG{n}{b}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}    \PYG{n}{b5}\PYG{o}{\textbar{}}
\PYG{l+m+mi}{5}    \PYG{n}{c}     \PYG{l+m+mi}{8}     \PYG{l+m+mi}{9}     \PYG{n}{c8}               \PYG{o}{\textbar{}}   \PYG{n}{c}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{9}\PYG{o}{\textbar{}}    \PYG{n}{c8}\PYG{o}{\textbar{}}
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}


\subsection{GroupBy}
\label{\detokenize{rdd:groupby}}
\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dp}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{agg}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{min}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mean}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{agg}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{min}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{avg}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
      \PYG{n}{col2}  \PYG{n}{col3}                        \PYG{o}{\textbar{}}\PYG{n}{col1}\PYG{o}{\textbar{}}\PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{col2}\PYG{p}{)}\PYG{o}{\textbar{}}\PYG{n}{avg}\PYG{p}{(}\PYG{n}{col3}\PYG{p}{)}\PYG{o}{\textbar{}}
\PYG{n}{col1}                                    \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{a}        \PYG{l+m+mi}{2}     \PYG{l+m+mi}{3}                        \PYG{o}{\textbar{}}   \PYG{n}{c}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}      \PYG{l+m+mf}{9.0}\PYG{o}{\textbar{}}
\PYG{n}{b}        \PYG{l+m+mi}{5}     \PYG{l+m+mi}{6}                        \PYG{o}{\textbar{}}   \PYG{n}{b}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}      \PYG{l+m+mf}{6.0}\PYG{o}{\textbar{}}
\PYG{n}{c}        \PYG{l+m+mi}{8}     \PYG{l+m+mi}{9}                        \PYG{o}{\textbar{}}   \PYG{n}{a}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}      \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}}
                                        \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}


\subsection{Pivot}
\label{\detokenize{rdd:pivot}}
\sphinxcode{\sphinxupquote{:: Python Code:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pd}\PYG{o}{.}\PYG{n}{pivot\PYGZus{}table}\PYG{p}{(}\PYG{n}{dp}\PYG{p}{,} \PYG{n}{values}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{index}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{columns}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{aggfunc}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{ds}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{pivot}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{col3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{:: Comparison:}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{col2}    \PYG{l+m+mi}{2}     \PYG{l+m+mi}{5}     \PYG{l+m+mi}{8}           \PYG{o}{\textbar{}}\PYG{n}{col1}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}
\PYG{n}{col1}                            \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{a}     \PYG{l+m+mf}{6.0}   \PYG{n}{NaN}   \PYG{n}{NaN}           \PYG{o}{\textbar{}}   \PYG{n}{c}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18}\PYG{o}{\textbar{}}
\PYG{n}{b}     \PYG{n}{NaN}  \PYG{l+m+mf}{12.0}   \PYG{n}{NaN}           \PYG{o}{\textbar{}}   \PYG{n}{b}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{12}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}
\PYG{n}{c}     \PYG{n}{NaN}   \PYG{n}{NaN}  \PYG{l+m+mf}{18.0}           \PYG{o}{\textbar{}}   \PYG{n}{a}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}\PYG{n}{null}\PYG{o}{\textbar{}}
                                \PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}


\chapter{Statistics Preliminary}
\label{\detokenize{stats:statistics-preliminary}}\label{\detokenize{stats:stats}}\label{\detokenize{stats::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

\sphinxstylestrong{If you only know yourself, but not your opponent, you may win or may lose.
If you know neither yourself nor your enemy, you will always endanger yourself}
\textendash{} idiom, from Sunzi’s Art of War
\end{sphinxadmonition}


\section{Notations}
\label{\detokenize{stats:notations}}\begin{itemize}
\item {} 
m : the number of the samples

\item {} 
n : the number of the features

\item {} 
\(y_i\) : i-th label

\item {} 
\({\displaystyle {\bar {y}}} = {\frac {1}{m}}\sum _{i=1}^{n}y_{i}\):  the mean of \(y\).

\end{itemize}


\section{Measurement Formula}
\label{\detokenize{stats:measurement-formula}}\begin{itemize}
\item {} 
Mean squared error

\end{itemize}

In statistics, the \sphinxstylestrong{MSE} (\sphinxhref{https://en.wikipedia.org/wiki/Mean\_squared\_error}{Mean Squared Error}) of an estimator (of a procedure for estimating an unobserved quantity) measures the average of the squares of the errors or deviations—that is, the difference between the estimator and what is estimated.
\begin{equation*}
\begin{split}\text{MSE}=\frac{1}{m}\sum_{i=1}^m\left( \hat{y}_i-y_i\right)^2\end{split}
\end{equation*}\begin{itemize}
\item {} 
Root Mean squared error

\end{itemize}
\begin{equation*}
\begin{split}\text{RMSE} = \sqrt{\text{MSE}}=\sqrt{\frac{1}{m}\sum_{i=1}^m\left( \hat{y}_i-y_i\right)^2}\end{split}
\end{equation*}\begin{itemize}
\item {} 
Total sum of squares

\end{itemize}

In statistical data analysis the \sphinxstylestrong{TSS} (\sphinxhref{https://en.wikipedia.org/wiki/Total\_sum\_of\_squares}{Total Sum of Squares}) is a quantity that appears as part of a standard way of presenting results of such analyses. It is defined as being the sum, over all observations, of the squared differences of each observation from the overall mean.
\begin{equation*}
\begin{split}\text{TSS} =  \sum_{i=1}^m\left( y_i-\bar{y}\right)^2\end{split}
\end{equation*}\begin{itemize}
\item {} 
Residual Sum of Squares

\end{itemize}
\begin{equation*}
\begin{split}\text{RSS}=\frac{1}{m}\sum_{i=1}^m\left( \hat{y}_i-y_i\right)^2\end{split}
\end{equation*}\begin{itemize}
\item {} 
Coefficient of determination \(R^2\)

\end{itemize}
\begin{equation*}
\begin{split}R^{2} := 1-{\text{RSS} \over \text{TSS}}.\,\end{split}
\end{equation*}

\section{Statistical Tests}
\label{\detokenize{stats:statistical-tests}}

\subsection{Correlational Test}
\label{\detokenize{stats:correlational-test}}\begin{itemize}
\item {} 
Pearson correlation: Tests for the strength of the association between two continuous variables.

\item {} 
Spearman correlation: Tests for the strength of the association between two ordinal variables (does not rely on the assumption of normal distributed data).

\item {} 
Chi-square: Tests for the strength of the association between two categorical variables.

\end{itemize}


\subsection{Comparison of Means test}
\label{\detokenize{stats:comparison-of-means-test}}\begin{itemize}
\item {} 
Paired T-test: Tests for difference between two related variables.

\item {} 
Independent T-test: Tests for difference between two independent variables.

\item {} 
ANOVA: Tests the difference between group means after any other variance in the outcome variable is accounted for.

\end{itemize}


\subsection{Non-parametric Test}
\label{\detokenize{stats:non-parametric-test}}\begin{itemize}
\item {} 
Wilcoxon rank-sum test: Tests for difference between two independent variables - takes into account magnitude and direction of difference.

\item {} 
Wilcoxon sign-rank test: Tests for difference between two related variables - takes into account magnitude and direction of difference.

\item {} 
Sign test: Tests if two related variables are different \textendash{} ignores magnitude of change, only takes into account direction.

\end{itemize}


\chapter{Data Exploration}
\label{\detokenize{exploration:data-exploration}}\label{\detokenize{exploration:exploration}}\label{\detokenize{exploration::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

\sphinxstylestrong{A journey of a thousand miles begins with a single step}
\textendash{} idiom, from Laozi.
\end{sphinxadmonition}

I wouldn’t say that understanding your dataset is the most difficult thing in data science, but it is really important and time-consuming. Data Exploration is about describing the data by means of statistical and visualization techniques. We explore data in order to understand the features and bring important features to our models.


\section{Univariate Analysis}
\label{\detokenize{exploration:univariate-analysis}}
In mathematics, univariate refers to an expression, equation, function or polynomial of only one variable.  “Uni” means “one”, so in other words your data has only one variable. So you do not need to deal with the causes or relationships in this step. Univariate analysis takes data, summarizes that variables (attributes) one by one and finds patterns in the data.

There are many ways that can describe patterns found in univariate data include central tendency (mean, mode and median) and dispersion: range, variance, maximum, minimum, quartiles (including the interquartile range), coefficient of variation and standard deviation. You also have several options for visualizing and describing data with univariate data. Such as \sphinxcode{\sphinxupquote{frequency Distribution Tables}}, \sphinxcode{\sphinxupquote{bar Charts}}, \sphinxcode{\sphinxupquote{histograms}}, \sphinxcode{\sphinxupquote{frequency Polygons}}, \sphinxcode{\sphinxupquote{pie Charts}}.

The variable could be either categorical or numerical, I will demostrate the different statistical and visulization techniques to investigate each type of the variable.
\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/Data\_exploration.ipynb}{Data Exploration}.

\item {} 
The data can be downloaf from \sphinxhref{\_static/german\_credit.csv}{German Credit}.

\end{itemize}


\subsection{Numerical Variables}
\label{\detokenize{exploration:numerical-variables}}\begin{itemize}
\item {} 
Describe

\end{itemize}

The \sphinxcode{\sphinxupquote{desctibe}} function in \sphinxcode{\sphinxupquote{pandas}} and \sphinxcode{\sphinxupquote{spark}} will give us most of the statistical results, such as \sphinxcode{\sphinxupquote{min}}, \sphinxcode{\sphinxupquote{median}}, \sphinxcode{\sphinxupquote{max}}, \sphinxcode{\sphinxupquote{quartiles}} and \sphinxcode{\sphinxupquote{standard deviation}}. With the help of the user defined function, you can get even more statistical results.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} selected varables for the demonstration}
\PYG{n}{num\PYGZus{}cols} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Account Balance}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{No of dependents}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{num\PYGZus{}cols}\PYG{p}{)}\PYG{o}{.}\PYG{n}{describe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{summary}\PYG{o}{\textbar{}}   \PYG{n}{Account} \PYG{n}{Balance}\PYG{o}{\textbar{}}   \PYG{n}{No} \PYG{n}{of} \PYG{n}{dependents}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{count}\PYG{o}{\textbar{}}              \PYG{l+m+mi}{1000}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{1000}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{n}{mean}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{2.577}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.155}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{n}{stddev}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.2576377271108936}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.36208577175319395}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{min}\PYG{o}{\textbar{}}                 \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}                  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{max}\PYG{o}{\textbar{}}                 \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}                  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

You may find out that the default function in PySpark does not include the quartiles. The following function will help you to get the same
results in Pandas

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{describe\PYGZus{}pd}\PYG{p}{(}\PYG{n}{df\PYGZus{}in}\PYG{p}{,} \PYG{n}{columns}\PYG{p}{,} \PYG{n}{style}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Function to union the basic stats results and deciles}
\PYG{l+s+sd}{    :param df\PYGZus{}in: the input dataframe}
\PYG{l+s+sd}{    :param columns: the cloumn name list of the numerical variable}
\PYG{l+s+sd}{    :param style: the display style}

\PYG{l+s+sd}{    :return : the numerical describe info. of the input dataframe}

\PYG{l+s+sd}{    :author: MIng Chen and Wenqiang Feng}
\PYG{l+s+sd}{    :email:  von198@gmail.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{k}{if} \PYG{n}{style} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{:}
        \PYG{n}{percentiles} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{25}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{,} \PYG{l+m+mi}{75}\PYG{p}{]}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{percentiles} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{110}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}

    \PYG{n}{percs} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{transpose}\PYG{p}{(}\PYG{p}{[}\PYG{n}{np}\PYG{o}{.}\PYG{n}{percentile}\PYG{p}{(}\PYG{n}{df\PYGZus{}in}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{percentiles}\PYG{p}{)} \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n}{columns}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{percs} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{n}{percs}\PYG{p}{,} \PYG{n}{columns}\PYG{o}{=}\PYG{n}{columns}\PYG{p}{)}
    \PYG{n}{percs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{summary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{p}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{for} \PYG{n}{p} \PYG{o+ow}{in} \PYG{n}{percentiles}\PYG{p}{]}

    \PYG{n}{spark\PYGZus{}describe} \PYG{o}{=} \PYG{n}{df\PYGZus{}in}\PYG{o}{.}\PYG{n}{describe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{new\PYGZus{}df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{concat}\PYG{p}{(}\PYG{p}{[}\PYG{n}{spark\PYGZus{}describe}\PYG{p}{,} \PYG{n}{percs}\PYG{p}{]}\PYG{p}{,}\PYG{n}{ignore\PYGZus{}index}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
    \PYG{n}{new\PYGZus{}df} \PYG{o}{=} \PYG{n}{new\PYGZus{}df}\PYG{o}{.}\PYG{n}{round}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{new\PYGZus{}df}\PYG{p}{[}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{summary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{+} \PYG{n}{columns}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{describe\PYGZus{}pd}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{num\PYGZus{}cols}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{summary}\PYG{o}{\textbar{}}   \PYG{n}{Account} \PYG{n}{Balance}\PYG{o}{\textbar{}} \PYG{n}{No} \PYG{n}{of} \PYG{n}{dependents}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{count}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{1000.0}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{1000.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{n}{mean}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{2.577}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{1.155}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{n}{stddev}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.2576377271108936}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.362085771753194}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{min}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{max}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{4.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{2.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{25}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{50}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{2.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{75}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{4.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

Sometimes, because of the confidential data issues, you can not deliver the real data and your clients may ask more statistical results, such as \sphinxcode{\sphinxupquote{deciles}}. You can apply the follwing function to achieve it.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{describe\PYGZus{}pd}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{num\PYGZus{}cols}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{summary}\PYG{o}{\textbar{}}   \PYG{n}{Account} \PYG{n}{Balance}\PYG{o}{\textbar{}} \PYG{n}{No} \PYG{n}{of} \PYG{n}{dependents}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{count}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{1000.0}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{1000.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{n}{mean}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{2.577}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{1.155}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{n}{stddev}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.2576377271108936}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.362085771753194}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{min}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{max}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{4.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{2.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{0}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{10}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{20}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{30}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{2.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{40}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{2.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{50}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{2.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{60}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{70}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{4.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{80}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{4.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{90}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{4.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{2.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{100}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{4.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{2.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Skewness and Kurtosis

This subsection comes from Wikipedia \sphinxhref{https://en.wikipedia.org/wiki/Skewness}{Skewness}.

In probability theory and statistics, skewness is a measure of the asymmetry of the probability distribution of a real-valued random variable about its mean. The skewness value can be positive or negative, or undefined.For a unimodal distribution, negative skew commonly indicates that the tail is on the left side of the distribution, and positive skew indicates that the tail is on the right.

Consider the two distributions in the figure just below. Within each graph, the values on the right side of the distribution taper differently from the values on the left side. These tapering sides are called tails, and they provide a visual means to determine which of the two kinds of skewness a distribution has:
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
negative skew: The left tail is longer; the mass of the distribution is concentrated on the right of the figure. The distribution is said to be left-skewed, left-tailed, or skewed to the left, despite the fact that the curve itself appears to be skewed or leaning to the right; left instead refers to the left tail being drawn out and, often, the mean being skewed to the left of a typical center of the data. A left-skewed distribution usually appears as a right-leaning curve.

\item {} 
positive skew: The right tail is longer; the mass of the distribution is concentrated on the left of the figure. The distribution is said to be right-skewed, right-tailed, or skewed to the right, despite the fact that the curve itself appears to be skewed or leaning to the left; right instead refers to the right tail being drawn out and, often, the mean being skewed to the right of a typical center of the data. A right-skewed distribution usually appears as a left-leaning curve.

\end{enumerate}

This subsection comes from Wikipedia \sphinxhref{https://en.wikipedia.org/wiki/Kurtosis}{Kurtosis}.

In probability theory and statistics, kurtosis (kyrtos or kurtos, meaning “curved, arching”) is a measure of the “tailedness” of the probability distribution of a real-valued random variable. In a similar way to the concept of skewness, kurtosis is a descriptor of the shape of a probability distribution and, just as for skewness, there are different ways of quantifying it for a theoretical distribution and corresponding ways of estimating it from a sample from a population.

\end{itemize}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{skewed}.png}
\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}\PYG{p}{,} \PYG{n}{skewness}\PYG{p}{,} \PYG{n}{kurtosis}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{skewness}\PYG{p}{(}\PYG{n}{var}\PYG{p}{)}\PYG{p}{,}\PYG{n}{kurtosis}\PYG{p}{(}\PYG{n}{var}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{skewness}\PYG{p}{(}\PYG{n}{Age} \PYG{p}{(}\PYG{n}{years}\PYG{p}{)}\PYG{p}{)}\PYG{o}{\textbar{}}\PYG{n}{kurtosis}\PYG{p}{(}\PYG{n}{Age} \PYG{p}{(}\PYG{n}{years}\PYG{p}{)}\PYG{p}{)}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0231743160548064}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.6114371688367672}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxstylestrong{Sometimes the statistics can be misleading!}
\end{sphinxadmonition}

F. J. Anscombe once said that make both calculations and graphs. Both sorts of output should be studied; each will contribute to understanding.
These 13 datasets in Figure {\hyperref[\detokenize{exploration:fig-misleading}]{\sphinxcrossref{\DUrole{std,std-ref}{Same Stats, Different Graphs}}}} (the Datasaurus, plus 12 others) each have the same summary statistics (x/y mean, x/y standard deviation, and Pearson’s correlation) to two decimal places, while being drastically different in appearance. This work describes the technique we developed to create this dataset, and others like it. More details and interesting results can be found in \sphinxhref{https://www.autodeskresearch.com/publications/samestats}{Same Stats Different Graphs}.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{misleading}.png}
\caption{Same Stats, Different Graphs}\label{\detokenize{exploration:id2}}\label{\detokenize{exploration:fig-misleading}}\end{figure}
\begin{itemize}
\item {} 
Histogram

\end{itemize}

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxstylestrong{Histograms are often confused with Bar graphs!}
\end{sphinxadmonition}

The fundamental difference between histogram and bar graph will help you to identify the two easily is that there are gaps between bars in a bar graph but in the histogram, the bars are adjacent to each other. The interested reader is referred to \sphinxhref{https://keydifferences.com/difference-between-histogram-and-bar-graph.html}{Difference Between Histogram and Bar Graph}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{var} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Age (years)}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{x} \PYG{o}{=} \PYG{n}{data1}\PYG{p}{[}\PYG{n}{var}\PYG{p}{]}
\PYG{n}{bins} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{100}\PYG{p}{,} \PYG{l+m+mf}{5.0}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} the histogram of the data}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{hist}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,} \PYG{n}{bins}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,} \PYG{n}{histtype}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bar}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
         \PYG{n}{ec}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{weights}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros\PYGZus{}like}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)} \PYG{o}{+} \PYG{l+m+mf}{100.} \PYG{o}{/} \PYG{n}{x}\PYG{o}{.}\PYG{n}{size}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlabel}\PYG{p}{(}\PYG{n}{var}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{percentage}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xticks}\PYG{p}{(}\PYG{n}{bins}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{fig}\PYG{o}{.}\PYG{n}{savefig}\PYG{p}{(}\PYG{n}{var}\PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.pdf}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}inches}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tight}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{his_s}.png}
\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{var} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Age (years)}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{x} \PYG{o}{=} \PYG{n}{data1}\PYG{p}{[}\PYG{n}{var}\PYG{p}{]}
\PYG{n}{bins} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{100}\PYG{p}{,} \PYG{l+m+mf}{5.0}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}}
\PYG{n}{hist}\PYG{p}{,} \PYG{n}{bin\PYGZus{}edges} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{histogram}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,}\PYG{n}{bins}\PYG{p}{,}
                               \PYG{n}{weights}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros\PYGZus{}like}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)} \PYG{o}{+} \PYG{l+m+mf}{100.} \PYG{o}{/} \PYG{n}{x}\PYG{o}{.}\PYG{n}{size}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} make the histogram}

\PYG{n}{fig} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}subplot}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Plot the histogram heights against integers on the x axis}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{bar}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{hist}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{n}{hist}\PYG{p}{,}\PYG{n}{width}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,}\PYG{n}{ec} \PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} \PYGZsh{} Set the ticks to the middle of the bars}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xticks}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.5}\PYG{o}{+}\PYG{n}{i} \PYG{k}{for} \PYG{n}{i}\PYG{p}{,}\PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{hist}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Set the xticklabels to a string that tells us what the bin edges were}
\PYG{n}{labels} \PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{bins}\PYG{p}{[}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)} \PYG{k}{for} \PYG{n}{i}\PYG{p}{,}\PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{hist}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{labels}\PYG{o}{.}\PYG{n}{insert}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xticklabels}\PYG{p}{(}\PYG{n}{labels}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlabel}\PYG{p}{(}\PYG{n}{var}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{percentage}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}}

\PYG{n}{hist}\PYG{p}{,} \PYG{n}{bin\PYGZus{}edges} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{histogram}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,}\PYG{n}{bins}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} make the histogram}

\PYG{n}{ax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}subplot}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Plot the histogram heights against integers on the x axis}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{bar}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{hist}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{n}{hist}\PYG{p}{,}\PYG{n}{width}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,}\PYG{n}{ec} \PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} \PYGZsh{} Set the ticks to the middle of the bars}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xticks}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.5}\PYG{o}{+}\PYG{n}{i} \PYG{k}{for} \PYG{n}{i}\PYG{p}{,}\PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{hist}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set the xticklabels to a string that tells us what the bin edges were}
\PYG{n}{labels} \PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{bins}\PYG{p}{[}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)} \PYG{k}{for} \PYG{n}{i}\PYG{p}{,}\PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{hist}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{labels}\PYG{o}{.}\PYG{n}{insert}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xticklabels}\PYG{p}{(}\PYG{n}{labels}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlabel}\PYG{p}{(}\PYG{n}{var}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{count}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{suptitle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Histogram of \PYGZob{}\PYGZcb{}: Left with percentage output;Right with count output}\PYG{l+s+s1}{\PYGZsq{}}
             \PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{var}\PYG{p}{)}\PYG{p}{,} \PYG{n}{size}\PYG{o}{=}\PYG{l+m+mi}{16}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{fig}\PYG{o}{.}\PYG{n}{savefig}\PYG{p}{(}\PYG{n}{var}\PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.pdf}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}inches}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tight}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{his_d}.png}
\end{figure}

Sometimes, some people will ask you to plot the unequal width (invalid argument for histogram) of the bars. YOu can still achieve it by the follwing trick.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{var} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Credit Amount}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{plot\PYGZus{}data} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{var}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{x}\PYG{o}{=} \PYG{n}{plot\PYGZus{}data}\PYG{p}{[}\PYG{n}{var}\PYG{p}{]}

\PYG{n}{bins} \PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{200}\PYG{p}{,}\PYG{l+m+mi}{400}\PYG{p}{,}\PYG{l+m+mi}{600}\PYG{p}{,}\PYG{l+m+mi}{700}\PYG{p}{,}\PYG{l+m+mi}{800}\PYG{p}{,}\PYG{l+m+mi}{900}\PYG{p}{,}\PYG{l+m+mi}{1000}\PYG{p}{,}\PYG{l+m+mi}{2000}\PYG{p}{,}\PYG{l+m+mi}{3000}\PYG{p}{,}\PYG{l+m+mi}{4000}\PYG{p}{,}\PYG{l+m+mi}{5000}\PYG{p}{,}\PYG{l+m+mi}{6000}\PYG{p}{,}\PYG{l+m+mi}{10000}\PYG{p}{,}\PYG{l+m+mi}{25000}\PYG{p}{]}

\PYG{n}{hist}\PYG{p}{,} \PYG{n}{bin\PYGZus{}edges} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{histogram}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,}\PYG{n}{bins}\PYG{p}{,}\PYG{n}{weights}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros\PYGZus{}like}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)} \PYG{o}{+} \PYG{l+m+mf}{100.} \PYG{o}{/} \PYG{n}{x}\PYG{o}{.}\PYG{n}{size}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} make the histogram}

\PYG{n}{fig} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}subplot}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Plot the histogram heights against integers on the x axis}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{bar}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{hist}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{n}{hist}\PYG{p}{,}\PYG{n}{width}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,}\PYG{n}{ec} \PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{color} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} \PYGZsh{} Set the ticks to the middle of the bars}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xticks}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.5}\PYG{o}{+}\PYG{n}{i} \PYG{k}{for} \PYG{n}{i}\PYG{p}{,}\PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{hist}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set the xticklabels to a string that tells us what the bin edges were}
\PYG{c+c1}{\PYGZsh{}labels =[\PYGZsq{}\PYGZob{}\PYGZcb{}k\PYGZsq{}.format(int(bins[i+1]/1000)) for i,j in enumerate(hist)]}
\PYG{n}{labels} \PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{bins}\PYG{p}{[}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)} \PYG{k}{for} \PYG{n}{i}\PYG{p}{,}\PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{hist}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{labels}\PYG{o}{.}\PYG{n}{insert}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xticklabels}\PYG{p}{(}\PYG{n}{labels}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}plt.text(\PYGZhy{}0.6, \PYGZhy{}1.4,\PYGZsq{}0\PYGZsq{})}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlabel}\PYG{p}{(}\PYG{n}{var}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{percentage}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{unequal}.png}
\end{figure}
\begin{itemize}
\item {} 
Box plot and violin plot

\end{itemize}

Note that although violin plots are closely related to Tukey’s (1977) box plots, the violin plot can show more information than box plot. When we perform an exploratory analysis, nothing about the samples could be known. So the distribution of the samples can not be assumed to a normal distribution and usually when you get a big data, the normal distribution will show some out liars in box plot.

However, the violin plots are potentially misleading for smaller sample sizes, where the density plots can appear to show interesting features (and group-differences therein) even when produced for standard normal data. Some poster suggested the sample size should larger that 250. The sample sizes (e.g. n\textgreater{}250 or ideally even larger), where the kernel density plots provide a reasonably accurate representation of the distributions, potentially showing nuances such as bimodality or other forms of non-normality that would be invisible or less clear in box plots. More details can be found in \sphinxhref{https://figshare.com/articles/A\_simple\_comparison\_of\_box\_plots\_and\_violin\_plots/1544525}{A simple comparison of box plots and violin plots}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{x} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{var}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{fig} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}subplot}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{ax} \PYG{o}{=} \PYG{n}{sns}\PYG{o}{.}\PYG{n}{boxplot}\PYG{p}{(}\PYG{n}{data}\PYG{o}{=}\PYG{n}{x}\PYG{p}{)}

\PYG{n}{ax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}subplot}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{ax} \PYG{o}{=} \PYG{n}{sns}\PYG{o}{.}\PYG{n}{violinplot}\PYG{p}{(}\PYG{n}{data}\PYG{o}{=}\PYG{n}{x}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{box_vio}.png}
\end{figure}


\subsection{Categorical Variables}
\label{\detokenize{exploration:categorical-variables}}
Compared with the numerical variables, the categorical variables are much more easier to do the exploration.
\begin{itemize}
\item {} 
Frequency table

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{functions} \PYG{k}{as} \PYG{n}{F}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{rank}\PYG{p}{,}\PYG{n+nb}{sum}\PYG{p}{,}\PYG{n}{col}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{Window}

\PYG{n}{window} \PYG{o}{=} \PYG{n}{Window}\PYG{o}{.}\PYG{n}{rowsBetween}\PYG{p}{(}\PYG{n}{Window}\PYG{o}{.}\PYG{n}{unboundedPreceding}\PYG{p}{,}\PYG{n}{Window}\PYG{o}{.}\PYG{n}{unboundedFollowing}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} withColumn(\PYGZsq{}Percent \PYGZpc{}\PYGZsq{},F.format\PYGZus{}string(\PYGZdq{}\PYGZpc{}5.0f\PYGZpc{}\PYGZpc{}\PYGZbs{}n\PYGZdq{},col(\PYGZsq{}Credit\PYGZus{}num\PYGZsq{})*100/col(\PYGZsq{}total\PYGZsq{}))).\PYGZbs{}}
\PYG{n}{tab} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{age\PYGZus{}class}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Credit Amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
   \PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{age\PYGZus{}class}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
   \PYG{n}{agg}\PYG{p}{(}\PYG{n}{F}\PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Credit Amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Credit\PYGZus{}num}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
       \PYG{n}{F}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Credit Amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Credit\PYGZus{}avg}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
       \PYG{n}{F}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Credit Amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Credit\PYGZus{}min}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
       \PYG{n}{F}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Credit Amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Credit\PYGZus{}max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
   \PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n+nb}{sum}\PYG{p}{(}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Credit\PYGZus{}num}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{over}\PYG{p}{(}\PYG{n}{window}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
   \PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Percent}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Credit\PYGZus{}num}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{*}\PYG{l+m+mi}{100}\PYG{o}{/}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
   \PYG{n}{drop}\PYG{p}{(}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{age\PYGZus{}class}\PYG{o}{\textbar{}}\PYG{n}{Credit\PYGZus{}num}\PYG{o}{\textbar{}}        \PYG{n}{Credit\PYGZus{}avg}\PYG{o}{\textbar{}}\PYG{n}{Credit\PYGZus{}min}\PYG{o}{\textbar{}}\PYG{n}{Credit\PYGZus{}max}\PYG{o}{\textbar{}}\PYG{n}{Percent}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{45}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{54}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{120}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3183.0666666666666}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{338}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{12612}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{12.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}      \PYG{o}{\PYGZlt{}}\PYG{l+m+mi}{25}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{150}\PYG{o}{\textbar{}} \PYG{l+m+mf}{2970.733333333333}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{276}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15672}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{15.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{55}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{64}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{56}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3493.660714285714}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{385}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15945}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{5.6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{35}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{44}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{254}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3403.771653543307}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{250}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15857}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{25.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{25}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{34}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{397}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3298.823677581864}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{343}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{18424}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{39.7}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}      \PYG{l+m+mi}{65}\PYG{o}{+}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{23}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3210.1739130434785}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{571}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{14896}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{2.3}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Pie plot

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Data to plot}
\PYG{n}{labels} \PYG{o}{=} \PYG{n}{plot\PYGZus{}data}\PYG{o}{.}\PYG{n}{age\PYGZus{}class}
\PYG{n}{sizes} \PYG{o}{=}  \PYG{n}{plot\PYGZus{}data}\PYG{o}{.}\PYG{n}{Percent}
\PYG{n}{colors} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yellowgreen}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lightcoral}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{blue}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lightskyblue}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{green}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{red}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{explode} \PYG{o}{=} \PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} explode 1st slice}

\PYG{c+c1}{\PYGZsh{} Plot}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{pie}\PYG{p}{(}\PYG{n}{sizes}\PYG{p}{,} \PYG{n}{explode}\PYG{o}{=}\PYG{n}{explode}\PYG{p}{,} \PYG{n}{labels}\PYG{o}{=}\PYG{n}{labels}\PYG{p}{,} \PYG{n}{colors}\PYG{o}{=}\PYG{n}{colors}\PYG{p}{,}
        \PYG{n}{autopct}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZpc{}1.1f}\PYG{l+s+si}{\PYGZpc{}\PYGZpc{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{shadow}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{startangle}\PYG{o}{=}\PYG{l+m+mi}{140}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{axis}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{equal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{pie}.png}
\end{figure}
\begin{itemize}
\item {} 
Bar plot

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{labels} \PYG{o}{=} \PYG{n}{plot\PYGZus{}data}\PYG{o}{.}\PYG{n}{age\PYGZus{}class}
\PYG{n}{missing} \PYG{o}{=} \PYG{n}{plot\PYGZus{}data}\PYG{o}{.}\PYG{n}{Percent}
\PYG{n}{ind} \PYG{o}{=} \PYG{p}{[}\PYG{n}{x} \PYG{k}{for} \PYG{n}{x}\PYG{p}{,} \PYG{n}{\PYGZus{}} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{labels}\PYG{p}{)}\PYG{p}{]}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{bar}\PYG{p}{(}\PYG{n}{ind}\PYG{p}{,} \PYG{n}{missing}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{missing}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xticks}\PYG{p}{(}\PYG{n}{ind}\PYG{p}{,} \PYG{n}{labels}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{percentage}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{bar}.png}
\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{labels} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{missing}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZlt{}25}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{25\PYGZhy{}34}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{35\PYGZhy{}44}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{45\PYGZhy{}54}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{55\PYGZhy{}64}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{65+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{missing} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.000095}\PYG{p}{,} \PYG{l+m+mf}{0.024830}\PYG{p}{,} \PYG{l+m+mf}{0.028665}\PYG{p}{,} \PYG{l+m+mf}{0.029477}\PYG{p}{,} \PYG{l+m+mf}{0.031918}\PYG{p}{,}\PYG{l+m+mf}{0.037073}\PYG{p}{,}\PYG{l+m+mf}{0.026699}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{man} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.000147}\PYG{p}{,} \PYG{l+m+mf}{0.036311}\PYG{p}{,} \PYG{l+m+mf}{0.038684}\PYG{p}{,} \PYG{l+m+mf}{0.044761}\PYG{p}{,} \PYG{l+m+mf}{0.051269}\PYG{p}{,} \PYG{l+m+mf}{0.059542}\PYG{p}{,} \PYG{l+m+mf}{0.054259}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{women} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.004035}\PYG{p}{,} \PYG{l+m+mf}{0.032935}\PYG{p}{,} \PYG{l+m+mf}{0.035351}\PYG{p}{,} \PYG{l+m+mf}{0.041778}\PYG{p}{,} \PYG{l+m+mf}{0.048437}\PYG{p}{,} \PYG{l+m+mf}{0.056236}\PYG{p}{,}\PYG{l+m+mf}{0.048091}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{ind} \PYG{o}{=} \PYG{p}{[}\PYG{n}{x} \PYG{k}{for} \PYG{n}{x}\PYG{p}{,} \PYG{n}{\PYGZus{}} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{labels}\PYG{p}{)}\PYG{p}{]}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{bar}\PYG{p}{(}\PYG{n}{ind}\PYG{p}{,} \PYG{n}{women}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{women}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bottom}\PYG{o}{=}\PYG{n}{man}\PYG{o}{+}\PYG{n}{missing}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{bar}\PYG{p}{(}\PYG{n}{ind}\PYG{p}{,} \PYG{n}{man}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{man}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{silver}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bottom}\PYG{o}{=}\PYG{n}{missing}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{bar}\PYG{p}{(}\PYG{n}{ind}\PYG{p}{,} \PYG{n}{missing}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{missing}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}CD853F}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xticks}\PYG{p}{(}\PYG{n}{ind}\PYG{p}{,} \PYG{n}{labels}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{percentage}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{upper left}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{demo}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{stacked}.png}
\end{figure}


\section{Multivariate Analysis}
\label{\detokenize{exploration:multivariate-analysis}}
In this section, I will only demostrate the bivariate analysis. Since the multivariate analysis is the generation of the bivariate.


\subsection{Numerical V.S. Numerical}
\label{\detokenize{exploration:numerical-v-s-numerical}}\begin{itemize}
\item {} 
Correlation matrix

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.mllib.stat} \PYG{k+kn}{import} \PYG{n}{Statistics}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k+kn}{as} \PYG{n+nn}{pd}

\PYG{n}{corr\PYGZus{}data} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{num\PYGZus{}cols}\PYG{p}{)}

\PYG{n}{col\PYGZus{}names} \PYG{o}{=} \PYG{n}{corr\PYGZus{}data}\PYG{o}{.}\PYG{n}{columns}
\PYG{n}{features} \PYG{o}{=} \PYG{n}{corr\PYGZus{}data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{row}\PYG{p}{:} \PYG{n}{row}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{:}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{corr\PYGZus{}mat}\PYG{o}{=}\PYG{n}{Statistics}\PYG{o}{.}\PYG{n}{corr}\PYG{p}{(}\PYG{n}{features}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pearson}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{corr\PYGZus{}df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{n}{corr\PYGZus{}mat}\PYG{p}{)}
\PYG{n}{corr\PYGZus{}df}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{corr\PYGZus{}df}\PYG{o}{.}\PYG{n}{columns} \PYG{o}{=} \PYG{n}{col\PYGZus{}names}\PYG{p}{,} \PYG{n}{col\PYGZus{}names}

\PYG{k}{print}\PYG{p}{(}\PYG{n}{corr\PYGZus{}df}\PYG{o}{.}\PYG{n}{to\PYGZus{}string}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{n}{Account} \PYG{n}{Balance}\PYG{o}{\textbar{}}    \PYG{n}{No} \PYG{n}{of} \PYG{n}{dependents}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}                 \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.01414542650320914}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.01414542650320914}\PYG{o}{\textbar{}}                 \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Scatter Plot

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{seaborn} \PYG{k+kn}{as} \PYG{n+nn}{sns}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{set}\PYG{p}{(}\PYG{n}{style}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ticks}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{df} \PYG{o}{=} \PYG{n}{sns}\PYG{o}{.}\PYG{n}{load\PYGZus{}dataset}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{iris}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{pairplot}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,} \PYG{n}{hue}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{species}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{pairplot}.png}
\end{figure}


\subsection{Categorical V.S. Categorical}
\label{\detokenize{exploration:categorical-v-s-categorical}}\begin{itemize}
\item {} 
Pearson’s Chi-squared test

\end{itemize}

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxcode{\sphinxupquote{pyspark.ml.stat}} is only available in Spark 2.4.0.
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.stat} \PYG{k+kn}{import} \PYG{n}{ChiSquareTest}

\PYG{n}{data} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mf}{10.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.5}\PYG{p}{,} \PYG{l+m+mf}{20.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.5}\PYG{p}{,} \PYG{l+m+mf}{30.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{3.5}\PYG{p}{,} \PYG{l+m+mf}{30.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{3.5}\PYG{p}{,} \PYG{l+m+mf}{40.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{3.5}\PYG{p}{,} \PYG{l+m+mf}{40.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{data}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{r} \PYG{o}{=} \PYG{n}{ChiSquareTest}\PYG{o}{.}\PYG{n}{test}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pValues: }\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{r}\PYG{o}{.}\PYG{n}{pValues}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{degreesOfFreedom: }\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{r}\PYG{o}{.}\PYG{n}{degreesOfFreedom}\PYG{p}{)}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{statistics: }\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{r}\PYG{o}{.}\PYG{n}{statistics}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pValues}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mf}{0.687289278791}\PYG{p}{,}\PYG{l+m+mf}{0.682270330336}\PYG{p}{]}
\PYG{n}{degreesOfFreedom}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{]}
\PYG{n}{statistics}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mf}{0.75}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{]}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Cross table

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{stat}\PYG{o}{.}\PYG{n}{crosstab}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{age\PYGZus{}class}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Occupation}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{age\PYGZus{}class\PYGZus{}Occupation}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}                 \PYG{o}{\PYGZlt{}}\PYG{l+m+mi}{25}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}} \PYG{l+m+mi}{34}\PYG{o}{\textbar{}}\PYG{l+m+mi}{108}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}               \PYG{l+m+mi}{55}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{64}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}} \PYG{l+m+mi}{15}\PYG{o}{\textbar{}} \PYG{l+m+mi}{31}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{9}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}               \PYG{l+m+mi}{25}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{34}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{7}\PYG{o}{\textbar{}} \PYG{l+m+mi}{61}\PYG{o}{\textbar{}}\PYG{l+m+mi}{269}\PYG{o}{\textbar{}} \PYG{l+m+mi}{60}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}               \PYG{l+m+mi}{35}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{44}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}} \PYG{l+m+mi}{58}\PYG{o}{\textbar{}}\PYG{l+m+mi}{143}\PYG{o}{\textbar{}} \PYG{l+m+mi}{49}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}                 \PYG{l+m+mi}{65}\PYG{o}{+}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{9}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}               \PYG{l+m+mi}{45}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{54}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}} \PYG{l+m+mi}{29}\PYG{o}{\textbar{}} \PYG{l+m+mi}{73}\PYG{o}{\textbar{}} \PYG{l+m+mi}{17}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Stacked plot

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{labels} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{missing}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZlt{}25}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{25\PYGZhy{}34}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{35\PYGZhy{}44}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{45\PYGZhy{}54}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{55\PYGZhy{}64}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{65+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{missing} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.000095}\PYG{p}{,} \PYG{l+m+mf}{0.024830}\PYG{p}{,} \PYG{l+m+mf}{0.028665}\PYG{p}{,} \PYG{l+m+mf}{0.029477}\PYG{p}{,} \PYG{l+m+mf}{0.031918}\PYG{p}{,}\PYG{l+m+mf}{0.037073}\PYG{p}{,}\PYG{l+m+mf}{0.026699}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{man} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.000147}\PYG{p}{,} \PYG{l+m+mf}{0.036311}\PYG{p}{,} \PYG{l+m+mf}{0.038684}\PYG{p}{,} \PYG{l+m+mf}{0.044761}\PYG{p}{,} \PYG{l+m+mf}{0.051269}\PYG{p}{,} \PYG{l+m+mf}{0.059542}\PYG{p}{,} \PYG{l+m+mf}{0.054259}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{women} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.004035}\PYG{p}{,} \PYG{l+m+mf}{0.032935}\PYG{p}{,} \PYG{l+m+mf}{0.035351}\PYG{p}{,} \PYG{l+m+mf}{0.041778}\PYG{p}{,} \PYG{l+m+mf}{0.048437}\PYG{p}{,} \PYG{l+m+mf}{0.056236}\PYG{p}{,}\PYG{l+m+mf}{0.048091}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{ind} \PYG{o}{=} \PYG{p}{[}\PYG{n}{x} \PYG{k}{for} \PYG{n}{x}\PYG{p}{,} \PYG{n}{\PYGZus{}} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{labels}\PYG{p}{)}\PYG{p}{]}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{bar}\PYG{p}{(}\PYG{n}{ind}\PYG{p}{,} \PYG{n}{women}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{women}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bottom}\PYG{o}{=}\PYG{n}{man}\PYG{o}{+}\PYG{n}{missing}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{bar}\PYG{p}{(}\PYG{n}{ind}\PYG{p}{,} \PYG{n}{man}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{man}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{silver}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bottom}\PYG{o}{=}\PYG{n}{missing}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{bar}\PYG{p}{(}\PYG{n}{ind}\PYG{p}{,} \PYG{n}{missing}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{missing}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}CD853F}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xticks}\PYG{p}{(}\PYG{n}{ind}\PYG{p}{,} \PYG{n}{labels}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{percentage}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{upper left}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{demo}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{stacked}.png}
\end{figure}


\subsection{Numerical V.S. Categorical}
\label{\detokenize{exploration:numerical-v-s-categorical}}

\chapter{Regression}
\label{\detokenize{regression:regression}}\label{\detokenize{regression:id1}}\label{\detokenize{regression::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

\sphinxstylestrong{A journey of a thousand miles begins with a single step.} \textendash{} old Chinese proverb
\end{sphinxadmonition}

In statistical modeling, regression analysis focuses on investigating the relationship between a dependent variable and one or more independent variables. \sphinxhref{https://en.wikipedia.org/wiki/Regression\_analysis}{Wikipedia Regression analysis}

In data mining, Regression is a model to represent the relationship between the value of lable ( or target, it is numerical variable) and on one or more features (or predictors they can be numerical and categorical variables).


\section{Linear Regression}
\label{\detokenize{regression:linear-regression}}

\subsection{Introduction}
\label{\detokenize{regression:introduction}}
Given that a data set \({\displaystyle \{\,x_{i1},\ldots ,x_{in},y_{i}\}_{i=1}^{m}}\) which contains n features
(variables) and m samples (data points), in simple linear regression model for modeling \({\displaystyle m}\) data points with one independent variable: \({\displaystyle x_{i1}}\), the formula is given by:
\begin{quote}
\begin{equation*}
\begin{split}y_i = \beta_0 + \beta_1 x_{i1}, \text{where}, i= 1, \cdots m.\end{split}
\end{equation*}\end{quote}

In matrix notation, the data set is written as \(\X = [\X_1,\cdots, \X_n]\) with
\(\X_i = {\displaystyle \{x_{\cdot i}\}_{i=1}^{n}}\),
\(\By = {\displaystyle \{y_{i}\}_{i=1}^{m}}\)
and \(\Bbeta^\top = {\displaystyle \{\beta_{i}\}_{i=1}^{m}}\).
Then the normal equations are written as
\begin{quote}
\begin{equation*}
\begin{split}\By = \X \Bbeta.\end{split}
\end{equation*}\end{quote}


\subsection{How to solve it?}
\label{\detokenize{regression:how-to-solve-it}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Direct Methods (For more information please refer to my \sphinxhref{http://web.utk.edu/~wfeng1/doc/PrelimNum.pdf}{Prelim Notes for Numerical Analysis})
\begin{itemize}
\item {} 
For squared or rectangular matrices
\begin{itemize}
\item {} 
Singular Value Decomposition

\item {} 
Gram-Schmidt orthogonalization

\item {} 
QR Decomposition

\end{itemize}

\item {} 
For squared matrices
\begin{itemize}
\item {} 
LU Decomposition

\item {} 
Cholesky Decomposition

\item {} 
Regular Splittings

\end{itemize}

\end{itemize}

\item {} 
Iterative Methods
\begin{itemize}
\item {} 
Stationary cases iterative method
\begin{itemize}
\item {} 
Jacobi Method

\item {} 
Gauss-Seidel Method

\item {} 
Richardson Method

\item {} 
Successive Over Relaxation (SOR) Method

\end{itemize}

\item {} 
Dynamic cases iterative method
\begin{itemize}
\item {} 
Chebyshev iterative Method

\item {} 
Minimal residuals Method

\item {} 
Minimal correction iterative method

\item {} 
Steepest Descent Method

\item {} 
Conjugate Gradients Method

\end{itemize}

\end{itemize}

\end{enumerate}


\subsection{Demo}
\label{\detokenize{regression:demo}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/LinearRegression.ipynb}{Linear Regression} which was implemented without using Pipeline.

\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/LinearRegressionWpipeline.ipynb}{Linear Regression with Pipeline} which was implemented with using Pipeline.

\item {} 
I will only present the code with pipeline style in the following.

\item {} 
For more details about the parameters, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.regression.LinearRegression.html}{Linear Regression API} .

\end{itemize}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark regression example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                       \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                       \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
            \PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{../data/Advertising.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

check the data set

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{180.8}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.4}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{TV}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Radio}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Newspaper}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Sales}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}

You can also get the Statistical resutls from the data frame
(Unfortunately, it only works for numerical).

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{describe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{summary}\PYG{o}{\textbar{}}               \PYG{n}{TV}\PYG{o}{\textbar{}}             \PYG{n}{Radio}\PYG{o}{\textbar{}}         \PYG{n}{Newspaper}\PYG{o}{\textbar{}}             \PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{count}\PYG{o}{\textbar{}}              \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{n}{mean}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{147.0425}\PYG{o}{\textbar{}}\PYG{l+m+mf}{23.264000000000024}\PYG{o}{\textbar{}}\PYG{l+m+mf}{30.553999999999995}\PYG{o}{\textbar{}}\PYG{l+m+mf}{14.022500000000003}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{n}{stddev}\PYG{o}{\textbar{}}\PYG{l+m+mf}{85.85423631490805}\PYG{o}{\textbar{}}\PYG{l+m+mf}{14.846809176168728}\PYG{o}{\textbar{}} \PYG{l+m+mf}{21.77862083852283}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5.217456565710477}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{min}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.3}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{max}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{296.4}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{49.6}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{114.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{27.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{ad}.png}
\caption{Sales distribution}\label{\detokenize{regression:id19}}\label{\detokenize{regression:fig-adfreq}}\end{figure}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Convert the data to dense vector (\sphinxstylestrong{features} and \sphinxstylestrong{label})

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{Row}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors}

\PYG{c+c1}{\PYGZsh{} I provide two ways to build the features and labels}

\PYG{c+c1}{\PYGZsh{} method 1 (good for small feature):}
\PYG{c+c1}{\PYGZsh{}def transData(row):}
\PYG{c+c1}{\PYGZsh{}    return Row(label=row[\PYGZdq{}Sales\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}               features=Vectors.dense([row[\PYGZdq{}TV\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}                                       row[\PYGZdq{}Radio\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}                                       row[\PYGZdq{}Newspaper\PYGZdq{}]]))}

\PYG{c+c1}{\PYGZsh{} Method 2 (good for large features):}
\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
\PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{n}{r}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
You are strongly encouraged to try my \sphinxcode{\sphinxupquote{get\_dummy}} function for dealing with the categorical data in comple dataset.

Supervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Unsupervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Get dummy variables and concat with continuous variables for unsupervised learning.}
\PYG{l+s+sd}{    :param df: the dataframe}
\PYG{l+s+sd}{    :param categoricalCols: the name list of the categorical data}
\PYG{l+s+sd}{    :param continuousCols:  the name list of the numerical data}
\PYG{l+s+sd}{    :return k: feature matrix}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  von198@gmail.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Transform the dataset to DataFrame

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{transformed}\PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
You will find out that all of the supervised machine learning algorithms in Spark are
based on the \sphinxstylestrong{features} and \sphinxstylestrong{label} (unsupervised machine learning algorithms in Spark are
based on the \sphinxstylestrong{features}). That is to say, you can play with
all of the machine learning algorithms in Spark when you get ready the
\sphinxstylestrong{features} and \sphinxstylestrong{label} in pipeline architecture.
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Deal With Categorical Variables

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.regression} \PYG{k+kn}{import} \PYG{n}{LinearRegression}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{VectorIndexer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{RegressionEvaluator}

\PYG{c+c1}{\PYGZsh{} Automatically identify categorical features, and index them.}
\PYG{c+c1}{\PYGZsh{} We specify maxCategories so features with \PYGZgt{} 4 distinct values are treated as continuous.}

\PYG{n}{featureIndexer} \PYG{o}{=} \PYG{n}{VectorIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYGZbs{}
                               \PYG{n}{maxCategories}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}

\PYG{n}{data} \PYG{o}{=} \PYG{n}{featureIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\end{sphinxVerbatim}

Now you check your dataset with

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}  \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Split the data into training and test sets (40\% held out for testing)

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Split the data into training and test sets (40\PYGZpc{} held out for testing)}
\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{,} \PYG{n}{testData}\PYG{p}{)} \PYG{o}{=} \PYG{n}{transformed}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

You can check your train and test data as follows (In my opinion, it is always
to good to keep tracking your data during prototype pahse):

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{trainingData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{testData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}       \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{11.6}\PYG{p}{,}\PYG{l+m+mf}{5.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{11.6}\PYG{p}{,}\PYG{l+m+mf}{5.7}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{29.9}\PYG{p}{,}\PYG{l+m+mf}{9.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.3}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{29.9}\PYG{p}{,}\PYG{l+m+mf}{9.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.3}\PYG{p}{,}\PYG{l+m+mf}{28.1}\PYG{p}{,}\PYG{l+m+mf}{41.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.5}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.3}\PYG{p}{,}\PYG{l+m+mf}{28.1}\PYG{p}{,}\PYG{l+m+mf}{41.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{6.6}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{8.6}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{4.8}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{8.6}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}        \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}} \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{8.4}\PYG{p}{,}\PYG{l+m+mf}{27.2}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.7}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{8.4}\PYG{p}{,}\PYG{l+m+mf}{27.2}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.7}\PYG{p}{,}\PYG{l+m+mf}{36.9}\PYG{p}{,}\PYG{l+m+mf}{45.2}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.3}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.7}\PYG{p}{,}\PYG{l+m+mf}{36.9}\PYG{p}{,}\PYG{l+m+mf}{45.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{13.2}\PYG{p}{,}\PYG{l+m+mf}{15.9}\PYG{p}{,}\PYG{l+m+mf}{49.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.6}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{13.2}\PYG{p}{,}\PYG{l+m+mf}{15.9}\PYG{p}{,}\PYG{l+m+mf}{49.6}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{16.9}\PYG{p}{,}\PYG{l+m+mf}{43.7}\PYG{p}{,}\PYG{l+m+mf}{89.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{8.7}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{16.9}\PYG{p}{,}\PYG{l+m+mf}{43.7}\PYG{p}{,}\PYG{l+m+mf}{89.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
Fit Ordinary Least Square Regression Model

\end{enumerate}

For more details about the parameters, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.regression.LinearRegression.html}{Linear Regression API} .

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Import LinearRegression class}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.regression} \PYG{k+kn}{import} \PYG{n}{LinearRegression}

\PYG{c+c1}{\PYGZsh{} Define LinearRegression algorithm}
\PYG{n}{lr} \PYG{o}{=} \PYG{n}{LinearRegression}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
Pipeline Architecture

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Chain indexer and tree in a Pipeline}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{featureIndexer}\PYG{p}{,} \PYG{n}{lr}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{8}
\item {} 
Summary of the Model

\end{enumerate}

Spark has a poor summary function for data and model. I wrote a summary
function which has similar format as \sphinxstylestrong{R} output for the linear regression in PySpark.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{modelsummary}\PYG{p}{(}\PYG{n}{model}\PYG{p}{)}\PYG{p}{:}
    \PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
    \PYG{k}{print} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Note: the last rows are the information for Intercept}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{print} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{print} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{  Estimate   \textbar{}   Std.Error \textbar{} t Values  \textbar{}  P\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{coef} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{list}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{coefficients}\PYG{p}{)}\PYG{p}{,}\PYG{n}{model}\PYG{o}{.}\PYG{n}{intercept}\PYG{p}{)}
    \PYG{n}{Summary}\PYG{o}{=}\PYG{n}{model}\PYG{o}{.}\PYG{n}{summary}

    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{Summary}\PYG{o}{.}\PYG{n}{pValues}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{print} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZob{}:10.6f\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{coef}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYGZbs{}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZob{}:10.6f\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{Summary}\PYG{o}{.}\PYG{n}{coefficientStandardErrors}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYGZbs{}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZob{}:8.3f\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{Summary}\PYG{o}{.}\PYG{n}{tValues}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYGZbs{}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZob{}:10.6f\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{Summary}\PYG{o}{.}\PYG{n}{pValues}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{print} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{print} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Mean squared error: }\PYG{l+s+si}{\PYGZpc{} .6f}\PYG{l+s+s2}{\PYGZdq{}} \PYGZbs{}
           \PYG{o}{\PYGZpc{}} \PYG{n}{Summary}\PYG{o}{.}\PYG{n}{meanSquaredError}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{, RMSE: }\PYG{l+s+si}{\PYGZpc{} .6f}\PYG{l+s+s2}{\PYGZdq{}} \PYGZbs{}
           \PYG{o}{\PYGZpc{}} \PYG{n}{Summary}\PYG{o}{.}\PYG{n}{rootMeanSquaredError} \PYG{p}{)}
    \PYG{k}{print} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Multiple R\PYGZhy{}squared: }\PYG{l+s+si}{\PYGZpc{}f}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{Summary}\PYG{o}{.}\PYG{n}{r2}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{, }\PYG{l+s+se}{\PYGZbs{}}
\PYG{l+s+s2}{            Total iterations: }\PYG{l+s+si}{\PYGZpc{}i}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{\PYGZpc{}} \PYG{n}{Summary}\PYG{o}{.}\PYG{n}{totalIterations}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{modelsummary}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

You will get the following summary results:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Note}\PYG{p}{:} \PYG{n}{the} \PYG{n}{last} \PYG{n}{rows} \PYG{n}{are} \PYG{n}{the} \PYG{n}{information} \PYG{k}{for} \PYG{n}{Intercept}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  Estimate   \textbar{}   Std.Error \textbar{} t Values  \textbar{}  P\PYGZhy{}value}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.044186}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.001663}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  26.573}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.000000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.206311}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.010846}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  19.022}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.000000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.001963}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.007467}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{   0.263}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.793113}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  2.596154}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.379550}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{   6.840}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.000000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Mean squared error:  2.588230}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{, RMSE:  1.608798}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Multiple R\PYGZhy{}squared: 0.911869}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,             Total iterations: 1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{9}
\item {} 
Make predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Make predictions.}
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testData}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Select example rows to display.}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}        \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}        \PYG{n}{prediction}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.81405928637388}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{8.4}\PYG{p}{,}\PYG{l+m+mf}{27.2}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.7}\PYG{o}{\textbar{}} \PYG{l+m+mf}{8.583086404079918}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.7}\PYG{p}{,}\PYG{l+m+mf}{36.9}\PYG{p}{,}\PYG{l+m+mf}{45.2}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{10.814712818232422}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{13.2}\PYG{p}{,}\PYG{l+m+mf}{15.9}\PYG{p}{,}\PYG{l+m+mf}{49.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.6}\PYG{o}{\textbar{}} \PYG{l+m+mf}{6.557106943899219}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{16.9}\PYG{p}{,}\PYG{l+m+mf}{43.7}\PYG{p}{,}\PYG{l+m+mf}{89.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{8.7}\PYG{o}{\textbar{}}\PYG{l+m+mf}{12.534151375058645}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{8}
\item {} 
Evaluation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{RegressionEvaluator}
\PYG{c+c1}{\PYGZsh{} Select (prediction, true label) and compute test error}
\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{RegressionEvaluator}\PYG{p}{(}\PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                                \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                                \PYG{n}{metricName}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rmse}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{rmse} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Root Mean Squared Error (RMSE) on test data = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{rmse}\PYG{p}{)}
\end{sphinxVerbatim}

The final Root Mean Squared Error (RMSE) is as follows:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Root} \PYG{n}{Mean} \PYG{n}{Squared} \PYG{n}{Error} \PYG{p}{(}\PYG{n}{RMSE}\PYG{p}{)} \PYG{n}{on} \PYG{n}{test} \PYG{n}{data} \PYG{o}{=} \PYG{l+m+mf}{1.63114}
\end{sphinxVerbatim}

You can also check the \(R^2\) value for the test data:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{k+kn}{import} \PYG{n+nn}{sklearn.metrics}
\PYG{n}{r2\PYGZus{}score} \PYG{o}{=} \PYG{n}{sklearn}\PYG{o}{.}\PYG{n}{metrics}\PYG{o}{.}\PYG{n}{r2\PYGZus{}score}\PYG{p}{(}\PYG{n}{y\PYGZus{}true}\PYG{p}{,} \PYG{n}{y\PYGZus{}pred}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r2\PYGZus{}score: \PYGZob{}0\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{r2\PYGZus{}score}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{r2\PYGZus{}score}\PYG{p}{:} \PYG{l+m+mf}{0.854486655585}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{warning}{Warning:}
You should know most softwares are using different formula to calculate the
\(R^2\) value when no intercept is included in the model. You can get more
information from the \sphinxhref{https://stats.stackexchange.com/questions/26176/removal-of-statistically-significant-intercept-term-increases-r2-in-linear-mo}{disscussion at StackExchange}.
\end{sphinxadmonition}


\section{Generalized linear regression}
\label{\detokenize{regression:generalized-linear-regression}}

\subsection{Introduction}
\label{\detokenize{regression:id3}}

\subsection{How to solve it?}
\label{\detokenize{regression:id4}}

\subsection{Demo}
\label{\detokenize{regression:id5}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/GLM.ipynb}{Generalized Linear Regression}.

\item {} 
For more details about the parameters, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.regression.GeneralizedLinearRegression.html}{Generalized Linear Regression API} .

\end{itemize}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark regression example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                       \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                       \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
            \PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{../data/Advertising.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

check the data set

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{180.8}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.4}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{TV}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Radio}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Newspaper}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Sales}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}

You can also get the Statistical resutls from the data frame
(Unfortunately, it only works for numerical).

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{describe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{summary}\PYG{o}{\textbar{}}               \PYG{n}{TV}\PYG{o}{\textbar{}}             \PYG{n}{Radio}\PYG{o}{\textbar{}}         \PYG{n}{Newspaper}\PYG{o}{\textbar{}}             \PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{count}\PYG{o}{\textbar{}}              \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{n}{mean}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{147.0425}\PYG{o}{\textbar{}}\PYG{l+m+mf}{23.264000000000024}\PYG{o}{\textbar{}}\PYG{l+m+mf}{30.553999999999995}\PYG{o}{\textbar{}}\PYG{l+m+mf}{14.022500000000003}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{n}{stddev}\PYG{o}{\textbar{}}\PYG{l+m+mf}{85.85423631490805}\PYG{o}{\textbar{}}\PYG{l+m+mf}{14.846809176168728}\PYG{o}{\textbar{}} \PYG{l+m+mf}{21.77862083852283}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5.217456565710477}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{min}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.3}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{max}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{296.4}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{49.6}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{114.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{27.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Convert the data to dense vector (\sphinxstylestrong{features} and \sphinxstylestrong{label})

\end{enumerate}

\begin{sphinxadmonition}{note}{Note:}
You are strongly encouraged to try my \sphinxcode{\sphinxupquote{get\_dummy}} function for dealing with the categorical data in comple dataset.

Supervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Unsupervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Get dummy variables and concat with continuous variables for unsupervised learning.}
\PYG{l+s+sd}{    :param df: the dataframe}
\PYG{l+s+sd}{    :param categoricalCols: the name list of the categorical data}
\PYG{l+s+sd}{    :param continuousCols:  the name list of the numerical data}
\PYG{l+s+sd}{    :return k: feature matrix}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  von198@gmail.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{Row}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors}

\PYG{c+c1}{\PYGZsh{} I provide two ways to build the features and labels}

\PYG{c+c1}{\PYGZsh{} method 1 (good for small feature):}
\PYG{c+c1}{\PYGZsh{}def transData(row):}
\PYG{c+c1}{\PYGZsh{}    return Row(label=row[\PYGZdq{}Sales\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}               features=Vectors.dense([row[\PYGZdq{}TV\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}                                       row[\PYGZdq{}Radio\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}                                       row[\PYGZdq{}Newspaper\PYGZdq{}]]))}

\PYG{c+c1}{\PYGZsh{} Method 2 (good for large features):}
\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
\PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{n}{r}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{transformed}\PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
You will find out that all of the machine learning algorithms in Spark are
based on the \sphinxstylestrong{features} and \sphinxstylestrong{label}. That is to say, you can play with
all of the machine learning algorithms in Spark when you get ready the
\sphinxstylestrong{features} and \sphinxstylestrong{label}.
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Convert the data to dense vector

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} convert the data to dense vector}
\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{r}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
           \PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{Row}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors}

\PYG{n}{data}\PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Deal with the Categorical variables

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.regression} \PYG{k+kn}{import} \PYG{n}{LinearRegression}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{VectorIndexer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{RegressionEvaluator}

\PYG{c+c1}{\PYGZsh{} Automatically identify categorical features, and index them.}
\PYG{c+c1}{\PYGZsh{} We specify maxCategories so features with \PYGZgt{} 4}
\PYG{c+c1}{\PYGZsh{} distinct values are treated as continuous.}

\PYG{n}{featureIndexer} \PYG{o}{=} \PYG{n}{VectorIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYGZbs{}
                               \PYG{n}{maxCategories}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}

\PYG{n}{data} \PYG{o}{=} \PYG{n}{featureIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\end{sphinxVerbatim}

When you check you data at this point, you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}  \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Split the data into training and test sets (40\% held out for testing)

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Split the data into training and test sets (40\PYGZpc{} held out for testing)}
\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{,} \PYG{n}{testData}\PYG{p}{)} \PYG{o}{=} \PYG{n}{transformed}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

You can check your train and test data as follows (In my opinion, it is always
to good to keep tracking your data during prototype pahse):

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{trainingData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{testData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}        \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}} \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{29.9}\PYG{p}{,}\PYG{l+m+mf}{9.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.3}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{29.9}\PYG{p}{,}\PYG{l+m+mf}{9.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{6.6}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{8.4}\PYG{p}{,}\PYG{l+m+mf}{27.2}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.7}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{8.4}\PYG{p}{,}\PYG{l+m+mf}{27.2}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.7}\PYG{p}{,}\PYG{l+m+mf}{48.9}\PYG{p}{,}\PYG{l+m+mf}{75.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.2}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.7}\PYG{p}{,}\PYG{l+m+mf}{48.9}\PYG{p}{,}\PYG{l+m+mf}{75.0}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.7}\PYG{p}{,}\PYG{l+m+mf}{36.9}\PYG{p}{,}\PYG{l+m+mf}{45.2}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.3}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.7}\PYG{p}{,}\PYG{l+m+mf}{36.9}\PYG{p}{,}\PYG{l+m+mf}{45.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}       \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{11.6}\PYG{p}{,}\PYG{l+m+mf}{5.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{11.6}\PYG{p}{,}\PYG{l+m+mf}{5.7}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.3}\PYG{p}{,}\PYG{l+m+mf}{28.1}\PYG{p}{,}\PYG{l+m+mf}{41.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.5}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.3}\PYG{p}{,}\PYG{l+m+mf}{28.1}\PYG{p}{,}\PYG{l+m+mf}{41.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{8.6}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{4.8}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{8.6}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{31.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.9}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{31.6}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
Fit Generalized Linear Regression Model

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Import LinearRegression class}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.regression} \PYG{k+kn}{import} \PYG{n}{GeneralizedLinearRegression}

\PYG{c+c1}{\PYGZsh{} Define LinearRegression algorithm}
\PYG{n}{glr} \PYG{o}{=} \PYG{n}{GeneralizedLinearRegression}\PYG{p}{(}\PYG{n}{family}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{gaussian}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{link}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{identity}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYGZbs{}
                                  \PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{regParam}\PYG{o}{=}\PYG{l+m+mf}{0.3}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
Pipeline Architecture

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Chain indexer and tree in a Pipeline}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{featureIndexer}\PYG{p}{,} \PYG{n}{glr}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{8}
\item {} 
Summary of the Model

\end{enumerate}

Spark has a poor summary function for data and model. I wrote a summary
function which has similar format as \sphinxstylestrong{R} output for the linear regression in PySpark.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{modelsummary}\PYG{p}{(}\PYG{n}{model}\PYG{p}{)}\PYG{p}{:}
    \PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
    \PYG{k}{print} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Note: the last rows are the information for Intercept}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{print} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{print} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{  Estimate   \textbar{}   Std.Error \textbar{} t Values  \textbar{}  P\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{coef} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{list}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{coefficients}\PYG{p}{)}\PYG{p}{,}\PYG{n}{model}\PYG{o}{.}\PYG{n}{intercept}\PYG{p}{)}
    \PYG{n}{Summary}\PYG{o}{=}\PYG{n}{model}\PYG{o}{.}\PYG{n}{summary}

    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{Summary}\PYG{o}{.}\PYG{n}{pValues}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{print} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZob{}:10.6f\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{coef}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYGZbs{}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZob{}:10.6f\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{Summary}\PYG{o}{.}\PYG{n}{coefficientStandardErrors}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYGZbs{}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZob{}:8.3f\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{Summary}\PYG{o}{.}\PYG{n}{tValues}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYGZbs{}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZob{}:10.6f\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{Summary}\PYG{o}{.}\PYG{n}{pValues}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{print} \PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}     print (\PYGZdq{}\PYGZsh{}\PYGZsh{}\PYGZdq{},\PYGZdq{}Mean squared error: \PYGZpc{} .6f\PYGZdq{} \PYGZbs{}}
\PYG{c+c1}{\PYGZsh{}            \PYGZpc{} Summary.meanSquaredError, \PYGZdq{}, RMSE: \PYGZpc{} .6f\PYGZdq{} \PYGZbs{}}
\PYG{c+c1}{\PYGZsh{}            \PYGZpc{} Summary.rootMeanSquaredError )}
\PYG{c+c1}{\PYGZsh{}     print (\PYGZdq{}\PYGZsh{}\PYGZsh{}\PYGZdq{},\PYGZdq{}Multiple R\PYGZhy{}squared: \PYGZpc{}f\PYGZdq{} \PYGZpc{} Summary.r2, \PYGZdq{}, \PYGZbs{}}
\PYG{c+c1}{\PYGZsh{}             Total iterations: \PYGZpc{}i\PYGZdq{}\PYGZpc{} Summary.totalIterations)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{modelsummary}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

You will get the following summary results:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Note}\PYG{p}{:} \PYG{n}{the} \PYG{n}{last} \PYG{n}{rows} \PYG{n}{are} \PYG{n}{the} \PYG{n}{information} \PYG{k}{for} \PYG{n}{Intercept}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  Estimate   \textbar{}   Std.Error \textbar{} t Values  \textbar{}  P\PYGZhy{}value}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.042857}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.001668}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  25.692}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.000000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.199922}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.009881}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  20.232}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.000000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ \PYGZhy{}0.001957}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.006917}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  \PYGZhy{}0.283}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.777757}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  3.007515}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.406389}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{   7.401}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{  0.000000}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}\PYGZsh{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{9}
\item {} 
Make predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Make predictions.}
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testData}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Select example rows to display.}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}       \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}        \PYG{n}{prediction}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}}\PYG{l+m+mf}{10.937383732327625}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{11.6}\PYG{p}{,}\PYG{l+m+mf}{5.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5.491166258750164}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.3}\PYG{p}{,}\PYG{l+m+mf}{28.1}\PYG{p}{,}\PYG{l+m+mf}{41.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.5}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{8.8571603947873}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{8.6}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{4.8}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3.793966281660073}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{31.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.9}\PYG{o}{\textbar{}} \PYG{l+m+mf}{4.502507124763654}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{10}
\item {} 
Evaluation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{RegressionEvaluator}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{RegressionEvaluator}
\PYG{c+c1}{\PYGZsh{} Select (prediction, true label) and compute test error}
\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{RegressionEvaluator}\PYG{p}{(}\PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                                \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                                \PYG{n}{metricName}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rmse}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{rmse} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Root Mean Squared Error (RMSE) on test data = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{rmse}\PYG{p}{)}
\end{sphinxVerbatim}

The final Root Mean Squared Error (RMSE) is as follows:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Root} \PYG{n}{Mean} \PYG{n}{Squared} \PYG{n}{Error} \PYG{p}{(}\PYG{n}{RMSE}\PYG{p}{)} \PYG{n}{on} \PYG{n}{test} \PYG{n}{data} \PYG{o}{=} \PYG{l+m+mf}{1.89857}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{k+kn}{import} \PYG{n+nn}{sklearn.metrics}
\PYG{n}{r2\PYGZus{}score} \PYG{o}{=} \PYG{n}{sklearn}\PYG{o}{.}\PYG{n}{metrics}\PYG{o}{.}\PYG{n}{r2\PYGZus{}score}\PYG{p}{(}\PYG{n}{y\PYGZus{}true}\PYG{p}{,} \PYG{n}{y\PYGZus{}pred}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r2\PYGZus{}score: \PYGZob{}0\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{r2\PYGZus{}score}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get the \(R^2\) value:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{r2\PYGZus{}score}\PYG{p}{:} \PYG{l+m+mf}{0.87707391843}
\end{sphinxVerbatim}


\section{Decision tree Regression}
\label{\detokenize{regression:decision-tree-regression}}

\subsection{Introduction}
\label{\detokenize{regression:id7}}

\subsection{How to solve it?}
\label{\detokenize{regression:id8}}

\subsection{Demo}
\label{\detokenize{regression:id9}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/DecisionTreeR.ipynb}{Decision Tree Regression}.

\item {} 
For more details about the parameters, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.regression.DecisionTreeRegressor.html}{Decision Tree Regressor API} .

\end{itemize}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark regression example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                       \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                       \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
            \PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{../data/Advertising.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

check the data set

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{180.8}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.4}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{TV}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Radio}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Newspaper}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Sales}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}

You can also get the Statistical resutls from the data frame
(Unfortunately, it only works for numerical).

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{describe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{summary}\PYG{o}{\textbar{}}               \PYG{n}{TV}\PYG{o}{\textbar{}}             \PYG{n}{Radio}\PYG{o}{\textbar{}}         \PYG{n}{Newspaper}\PYG{o}{\textbar{}}             \PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{count}\PYG{o}{\textbar{}}              \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{n}{mean}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{147.0425}\PYG{o}{\textbar{}}\PYG{l+m+mf}{23.264000000000024}\PYG{o}{\textbar{}}\PYG{l+m+mf}{30.553999999999995}\PYG{o}{\textbar{}}\PYG{l+m+mf}{14.022500000000003}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{n}{stddev}\PYG{o}{\textbar{}}\PYG{l+m+mf}{85.85423631490805}\PYG{o}{\textbar{}}\PYG{l+m+mf}{14.846809176168728}\PYG{o}{\textbar{}} \PYG{l+m+mf}{21.77862083852283}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5.217456565710477}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{min}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.3}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{max}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{296.4}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{49.6}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{114.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{27.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Convert the data to dense vector (\sphinxstylestrong{features} and \sphinxstylestrong{label})

\end{enumerate}

\begin{sphinxadmonition}{note}{Note:}
You are strongly encouraged to try my \sphinxcode{\sphinxupquote{get\_dummy}} function for dealing with the categorical data in comple dataset.

Supervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Unsupervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Get dummy variables and concat with continuous variables for unsupervised learning.}
\PYG{l+s+sd}{    :param df: the dataframe}
\PYG{l+s+sd}{    :param categoricalCols: the name list of the categorical data}
\PYG{l+s+sd}{    :param continuousCols:  the name list of the numerical data}
\PYG{l+s+sd}{    :return k: feature matrix}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  von198@gmail.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{Row}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors}

\PYG{c+c1}{\PYGZsh{} I provide two ways to build the features and labels}

\PYG{c+c1}{\PYGZsh{} method 1 (good for small feature):}
\PYG{c+c1}{\PYGZsh{}def transData(row):}
\PYG{c+c1}{\PYGZsh{}    return Row(label=row[\PYGZdq{}Sales\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}               features=Vectors.dense([row[\PYGZdq{}TV\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}                                       row[\PYGZdq{}Radio\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}                                       row[\PYGZdq{}Newspaper\PYGZdq{}]]))}

\PYG{c+c1}{\PYGZsh{} Method 2 (good for large features):}
\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
\PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{n}{r}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{transformed}\PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
You will find out that all of the machine learning algorithms in Spark are
based on the \sphinxstylestrong{features} and \sphinxstylestrong{label}. That is to say, you can play with
all of the machine learning algorithms in Spark when you get ready the
\sphinxstylestrong{features} and \sphinxstylestrong{label}.
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Convert the data to dense vector

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} convert the data to dense vector}
\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{r}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
           \PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{transformed} \PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Deal with the Categorical variables

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.regression} \PYG{k+kn}{import} \PYG{n}{LinearRegression}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{VectorIndexer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{RegressionEvaluator}

\PYG{c+c1}{\PYGZsh{} Automatically identify categorical features, and index them.}
\PYG{c+c1}{\PYGZsh{} We specify maxCategories so features with \PYGZgt{} 4}
\PYG{c+c1}{\PYGZsh{} distinct values are treated as continuous.}

\PYG{n}{featureIndexer} \PYG{o}{=} \PYG{n}{VectorIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYGZbs{}
                               \PYG{n}{maxCategories}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}

\PYG{n}{data} \PYG{o}{=} \PYG{n}{featureIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\end{sphinxVerbatim}

When you check you data at this point, you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}  \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Split the data into training and test sets (40\% held out for testing)

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Split the data into training and test sets (40\PYGZpc{} held out for testing)}
\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{,} \PYG{n}{testData}\PYG{p}{)} \PYG{o}{=} \PYG{n}{transformed}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

You can check your train and test data as follows (In my opinion, it is always
to good to keep tracking your data during prototype pahse):

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{trainingData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{testData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}       \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{11.6}\PYG{p}{,}\PYG{l+m+mf}{5.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{11.6}\PYG{p}{,}\PYG{l+m+mf}{5.7}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.3}\PYG{p}{,}\PYG{l+m+mf}{28.1}\PYG{p}{,}\PYG{l+m+mf}{41.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.5}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.3}\PYG{p}{,}\PYG{l+m+mf}{28.1}\PYG{p}{,}\PYG{l+m+mf}{41.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.4}\PYG{p}{,}\PYG{l+m+mf}{27.2}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.7}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.4}\PYG{p}{,}\PYG{l+m+mf}{27.2}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{8.6}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{4.8}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{8.6}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{8.7}\PYG{p}{,}\PYG{l+m+mf}{48.9}\PYG{p}{,}\PYG{l+m+mf}{75.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.2}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{8.7}\PYG{p}{,}\PYG{l+m+mf}{48.9}\PYG{p}{,}\PYG{l+m+mf}{75.0}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}        \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}} \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{29.9}\PYG{p}{,}\PYG{l+m+mf}{9.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.3}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{29.9}\PYG{p}{,}\PYG{l+m+mf}{9.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{6.6}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{18.7}\PYG{p}{,}\PYG{l+m+mf}{12.1}\PYG{p}{,}\PYG{l+m+mf}{23.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{6.7}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{18.7}\PYG{p}{,}\PYG{l+m+mf}{12.1}\PYG{p}{,}\PYG{l+m+mf}{23.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
Fit Decision Tree Regression Model

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.regression} \PYG{k+kn}{import} \PYG{n}{DecisionTreeRegressor}

\PYG{c+c1}{\PYGZsh{} Train a DecisionTree model.}
\PYG{n}{dt} \PYG{o}{=} \PYG{n}{DecisionTreeRegressor}\PYG{p}{(}\PYG{n}{featuresCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
Pipeline Architecture

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Chain indexer and tree in a Pipeline}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{featureIndexer}\PYG{p}{,} \PYG{n}{dt}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{8}
\item {} 
Make predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Make predictions.}
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testData}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Select example rows to display.}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{prediction}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}        \PYG{n}{features}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}       \PYG{l+m+mf}{7.2}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}       \PYG{l+m+mf}{7.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.3}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{29.9}\PYG{p}{,}\PYG{l+m+mf}{9.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}       \PYG{l+m+mf}{7.2}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{6.6}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}      \PYG{l+m+mf}{8.64}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}      \PYG{l+m+mf}{6.45}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{6.7}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{18.7}\PYG{p}{,}\PYG{l+m+mf}{12.1}\PYG{p}{,}\PYG{l+m+mf}{23.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{9}
\item {} 
Evaluation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{RegressionEvaluator}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{RegressionEvaluator}
\PYG{c+c1}{\PYGZsh{} Select (prediction, true label) and compute test error}
\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{RegressionEvaluator}\PYG{p}{(}\PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                                \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                                \PYG{n}{metricName}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rmse}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{rmse} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Root Mean Squared Error (RMSE) on test data = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{rmse}\PYG{p}{)}
\end{sphinxVerbatim}

The final Root Mean Squared Error (RMSE) is as follows:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Root} \PYG{n}{Mean} \PYG{n}{Squared} \PYG{n}{Error} \PYG{p}{(}\PYG{n}{RMSE}\PYG{p}{)} \PYG{n}{on} \PYG{n}{test} \PYG{n}{data} \PYG{o}{=} \PYG{l+m+mf}{1.50999}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{k+kn}{import} \PYG{n+nn}{sklearn.metrics}
\PYG{n}{r2\PYGZus{}score} \PYG{o}{=} \PYG{n}{sklearn}\PYG{o}{.}\PYG{n}{metrics}\PYG{o}{.}\PYG{n}{r2\PYGZus{}score}\PYG{p}{(}\PYG{n}{y\PYGZus{}true}\PYG{p}{,} \PYG{n}{y\PYGZus{}pred}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r2\PYGZus{}score: \PYGZob{}0\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{r2\PYGZus{}score}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get the \(R^2\) value:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{r2\PYGZus{}score}\PYG{p}{:} \PYG{l+m+mf}{0.911024318967}
\end{sphinxVerbatim}

You may also check the importance of the features:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{featureImportances}
\end{sphinxVerbatim}

The you will get the weight for each features

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{SparseVector}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{l+m+mi}{0}\PYG{p}{:} \PYG{l+m+mf}{0.6811}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{:} \PYG{l+m+mf}{0.3187}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{:} \PYG{l+m+mf}{0.0002}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Random Forest Regression}
\label{\detokenize{regression:random-forest-regression}}

\subsection{Introduction}
\label{\detokenize{regression:id11}}

\subsection{How to solve it?}
\label{\detokenize{regression:id12}}

\subsection{Demo}
\label{\detokenize{regression:id13}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/RandomForestR.ipynb}{Random Forest Regression}.

\item {} 
For more details about the parameters, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.regression.RandomForestRegressor.html}{Random Forest Regressor API} .

\end{itemize}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark RandomForest Regression example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                               \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                               \PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{../data/Advertising.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}

\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{180.8}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.4}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{TV}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Radio}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Newspaper}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Sales}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{describe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{summary}\PYG{o}{\textbar{}}               \PYG{n}{TV}\PYG{o}{\textbar{}}             \PYG{n}{Radio}\PYG{o}{\textbar{}}         \PYG{n}{Newspaper}\PYG{o}{\textbar{}}             \PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{count}\PYG{o}{\textbar{}}              \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{n}{mean}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{147.0425}\PYG{o}{\textbar{}}\PYG{l+m+mf}{23.264000000000024}\PYG{o}{\textbar{}}\PYG{l+m+mf}{30.553999999999995}\PYG{o}{\textbar{}}\PYG{l+m+mf}{14.022500000000003}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{n}{stddev}\PYG{o}{\textbar{}}\PYG{l+m+mf}{85.85423631490805}\PYG{o}{\textbar{}}\PYG{l+m+mf}{14.846809176168728}\PYG{o}{\textbar{}} \PYG{l+m+mf}{21.77862083852283}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5.217456565710477}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{min}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.3}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{max}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{296.4}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{49.6}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{114.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{27.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Convert the data to dense vector (\sphinxstylestrong{features} and \sphinxstylestrong{label})

\end{enumerate}

\begin{sphinxadmonition}{note}{Note:}
You are strongly encouraged to try my \sphinxcode{\sphinxupquote{get\_dummy}} function for dealing with the categorical data in comple dataset.

Supervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Unsupervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Get dummy variables and concat with continuous variables for unsupervised learning.}
\PYG{l+s+sd}{    :param df: the dataframe}
\PYG{l+s+sd}{    :param categoricalCols: the name list of the categorical data}
\PYG{l+s+sd}{    :param continuousCols:  the name list of the numerical data}
\PYG{l+s+sd}{    :return k: feature matrix}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  von198@gmail.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{Row}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors}

\PYG{c+c1}{\PYGZsh{} convert the data to dense vector}
\PYG{c+c1}{\PYGZsh{}def transData(row):}
\PYG{c+c1}{\PYGZsh{}    return Row(label=row[\PYGZdq{}Sales\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}               features=Vectors.dense([row[\PYGZdq{}TV\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}                                       row[\PYGZdq{}Radio\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}                                       row[\PYGZdq{}Newspaper\PYGZdq{}]]))}
\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{n}{r}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Convert the data to dense vector

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{transformed}\PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Deal with the Categorical variables

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.regression} \PYG{k+kn}{import} \PYG{n}{LinearRegression}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{VectorIndexer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{RegressionEvaluator}

\PYG{n}{featureIndexer} \PYG{o}{=} \PYG{n}{VectorIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYGZbs{}
                               \PYG{n}{maxCategories}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}

\PYG{n}{data} \PYG{o}{=} \PYG{n}{featureIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}  \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Split the data into training and test sets (40\% held out for testing)

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Split the data into training and test sets (40\PYGZpc{} held out for testing)}
\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{,} \PYG{n}{testData}\PYG{p}{)} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{trainingData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{testData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}        \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}} \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{p}{[}\PYG{l+m+mf}{8.6}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{4.8}\PYG{o}{\textbar{}}   \PYG{p}{[}\PYG{l+m+mf}{8.6}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.7}\PYG{p}{,}\PYG{l+m+mf}{48.9}\PYG{p}{,}\PYG{l+m+mf}{75.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.2}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.7}\PYG{p}{,}\PYG{l+m+mf}{48.9}\PYG{p}{,}\PYG{l+m+mf}{75.0}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.7}\PYG{p}{,}\PYG{l+m+mf}{36.9}\PYG{p}{,}\PYG{l+m+mf}{45.2}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.3}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.7}\PYG{p}{,}\PYG{l+m+mf}{36.9}\PYG{p}{,}\PYG{l+m+mf}{45.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{13.2}\PYG{p}{,}\PYG{l+m+mf}{15.9}\PYG{p}{,}\PYG{l+m+mf}{49.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.6}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{13.2}\PYG{p}{,}\PYG{l+m+mf}{15.9}\PYG{p}{,}\PYG{l+m+mf}{49.6}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}       \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{11.6}\PYG{p}{,}\PYG{l+m+mf}{5.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{11.6}\PYG{p}{,}\PYG{l+m+mf}{5.7}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{29.9}\PYG{p}{,}\PYG{l+m+mf}{9.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.3}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{29.9}\PYG{p}{,}\PYG{l+m+mf}{9.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.3}\PYG{p}{,}\PYG{l+m+mf}{28.1}\PYG{p}{,}\PYG{l+m+mf}{41.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.5}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.3}\PYG{p}{,}\PYG{l+m+mf}{28.1}\PYG{p}{,}\PYG{l+m+mf}{41.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{6.6}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.4}\PYG{p}{,}\PYG{l+m+mf}{27.2}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.7}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.4}\PYG{p}{,}\PYG{l+m+mf}{27.2}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
Fit RandomForest Regression Model

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Import LinearRegression class}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.regression} \PYG{k+kn}{import} \PYG{n}{RandomForestRegressor}

\PYG{c+c1}{\PYGZsh{} Define LinearRegression algorithm}
\PYG{n}{rf} \PYG{o}{=} \PYG{n}{RandomForestRegressor}\PYG{p}{(}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} featuresCol=\PYGZdq{}indexedFeatures\PYGZdq{},numTrees=2, maxDepth=2, seed=42}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
If you decide to use the \sphinxcode{\sphinxupquote{indexedFeatures}} features, you need to add the parameter \sphinxcode{\sphinxupquote{featuresCol="indexedFeatures"}}.
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
Pipeline Architecture

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Chain indexer and tree in a Pipeline}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{featureIndexer}\PYG{p}{,} \PYG{n}{rf}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{8}
\item {} 
Make predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testData}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Select example rows to display.}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}       \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}        \PYG{n}{prediction}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{11.6}\PYG{p}{,}\PYG{l+m+mf}{5.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{8.155439814814816}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{29.9}\PYG{p}{,}\PYG{l+m+mf}{9.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{10.412769901394899}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.3}\PYG{p}{,}\PYG{l+m+mf}{28.1}\PYG{p}{,}\PYG{l+m+mf}{41.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.13735648148148}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{6.6}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.321796703296704}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.4}\PYG{p}{,}\PYG{l+m+mf}{27.2}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.7}\PYG{o}{\textbar{}}\PYG{l+m+mf}{12.071421957671957}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{9}
\item {} 
Evaluation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Select (prediction, true label) and compute test error}
\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{RegressionEvaluator}\PYG{p}{(}
    \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{metricName}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rmse}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{rmse} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Root Mean Squared Error (RMSE) on test data = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{rmse}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Root} \PYG{n}{Mean} \PYG{n}{Squared} \PYG{n}{Error} \PYG{p}{(}\PYG{n}{RMSE}\PYG{p}{)} \PYG{n}{on} \PYG{n}{test} \PYG{n}{data} \PYG{o}{=} \PYG{l+m+mf}{2.35912}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sklearn.metrics}
\PYG{n}{r2\PYGZus{}score} \PYG{o}{=} \PYG{n}{sklearn}\PYG{o}{.}\PYG{n}{metrics}\PYG{o}{.}\PYG{n}{r2\PYGZus{}score}\PYG{p}{(}\PYG{n}{y\PYGZus{}true}\PYG{p}{,} \PYG{n}{y\PYGZus{}pred}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r2\PYGZus{}score: \PYGZob{}:4.3f\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{r2\PYGZus{}score}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{r2\PYGZus{}score}\PYG{p}{:} \PYG{l+m+mf}{0.831}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{10}
\item {} 
Feature importances

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{featureImportances}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{SparseVector}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{l+m+mi}{0}\PYG{p}{:} \PYG{l+m+mf}{0.4994}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{:} \PYG{l+m+mf}{0.3196}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{:} \PYG{l+m+mf}{0.181}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{trees}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}\PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}c75f1c75442c}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{43} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}70fc2d441581}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{45} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}bc8464f545a7}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{31} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}a8a7e5367154}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{59} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}3ea01314fcbc}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{47} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}be9a04ac22a6}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{45} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}38610d47328a}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{51} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}bf14aea0ad3b}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{49} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}cde24ebd6bb6}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{39} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}a1fc9bd4fbeb}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{57} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}37798d6db1ba}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{41} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}c078b73ada63}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{41} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}fd00e3a070ad}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{55} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}9d01d5fb8604}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{45} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}8bd8bdddf642}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{41} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}e53b7bae30f8}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{49} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}808a869db21c}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{47} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}64d0916bceb0}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{33} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}0891055fff94}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{55} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}19c8bbad26c2}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{51} \PYG{n}{nodes}\PYG{p}{]}
\end{sphinxVerbatim}


\section{Gradient-boosted tree regression}
\label{\detokenize{regression:gradient-boosted-tree-regression}}

\subsection{Introduction}
\label{\detokenize{regression:id15}}

\subsection{How to solve it?}
\label{\detokenize{regression:id16}}

\subsection{Demo}
\label{\detokenize{regression:id17}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/GLM.ipynb}{Gradient-boosted tree regression}.

\item {} 
For more details about the parameters, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.regression.GBTRegressor.html}{Gradient boosted tree API} .

\end{itemize}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark GBTRegressor example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                               \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                               \PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{../data/Advertising.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}

\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n}{TV}\PYG{o}{\textbar{}}\PYG{n}{Radio}\PYG{o}{\textbar{}}\PYG{n}{Newspaper}\PYG{o}{\textbar{}}\PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{230.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{37.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{44.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{39.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{45.1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{17.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{45.9}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{69.3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{41.3}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{180.8}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{58.4}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{TV}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Radio}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Newspaper}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Sales}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{describe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{summary}\PYG{o}{\textbar{}}               \PYG{n}{TV}\PYG{o}{\textbar{}}             \PYG{n}{Radio}\PYG{o}{\textbar{}}         \PYG{n}{Newspaper}\PYG{o}{\textbar{}}             \PYG{n}{Sales}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{count}\PYG{o}{\textbar{}}              \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{200}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{n}{mean}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{147.0425}\PYG{o}{\textbar{}}\PYG{l+m+mf}{23.264000000000024}\PYG{o}{\textbar{}}\PYG{l+m+mf}{30.553999999999995}\PYG{o}{\textbar{}}\PYG{l+m+mf}{14.022500000000003}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{n}{stddev}\PYG{o}{\textbar{}}\PYG{l+m+mf}{85.85423631490805}\PYG{o}{\textbar{}}\PYG{l+m+mf}{14.846809176168728}\PYG{o}{\textbar{}} \PYG{l+m+mf}{21.77862083852283}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5.217456565710477}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{min}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.3}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{max}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{296.4}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{49.6}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{114.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{27.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Convert the data to dense vector (\sphinxstylestrong{features} and \sphinxstylestrong{label})

\end{enumerate}

\begin{sphinxadmonition}{note}{Note:}
You are strongly encouraged to try my \sphinxcode{\sphinxupquote{get\_dummy}} function for dealing with the categorical data in comple dataset.

Supervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Unsupervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Get dummy variables and concat with continuous variables for unsupervised learning.}
\PYG{l+s+sd}{    :param df: the dataframe}
\PYG{l+s+sd}{    :param categoricalCols: the name list of the categorical data}
\PYG{l+s+sd}{    :param continuousCols:  the name list of the numerical data}
\PYG{l+s+sd}{    :return k: feature matrix}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  von198@gmail.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{Row}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors}

\PYG{c+c1}{\PYGZsh{} convert the data to dense vector}
\PYG{c+c1}{\PYGZsh{}def transData(row):}
\PYG{c+c1}{\PYGZsh{}    return Row(label=row[\PYGZdq{}Sales\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}               features=Vectors.dense([row[\PYGZdq{}TV\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}                                       row[\PYGZdq{}Radio\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}                                       row[\PYGZdq{}Newspaper\PYGZdq{}]]))}
\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{n}{r}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Convert the data to dense vector

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{transformed}\PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Deal with the Categorical variables

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.regression} \PYG{k+kn}{import} \PYG{n}{GBTRegressor}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{VectorIndexer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{RegressionEvaluator}

\PYG{n}{featureIndexer} \PYG{o}{=} \PYG{n}{VectorIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYGZbs{}
                               \PYG{n}{maxCategories}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}

\PYG{n}{data} \PYG{o}{=} \PYG{n}{featureIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}  \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.1}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{230.1}\PYG{p}{,}\PYG{l+m+mf}{37.8}\PYG{p}{,}\PYG{l+m+mf}{69.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{10.4}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{44.5}\PYG{p}{,}\PYG{l+m+mf}{39.3}\PYG{p}{,}\PYG{l+m+mf}{45.1}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{17.2}\PYG{p}{,}\PYG{l+m+mf}{45.9}\PYG{p}{,}\PYG{l+m+mf}{69.3}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{18.5}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{151.5}\PYG{p}{,}\PYG{l+m+mf}{41.3}\PYG{p}{,}\PYG{l+m+mf}{58.5}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}} \PYG{l+m+mf}{12.9}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{180.8}\PYG{p}{,}\PYG{l+m+mf}{10.8}\PYG{p}{,}\PYG{l+m+mf}{58.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Split the data into training and test sets (40\% held out for testing)

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Split the data into training and test sets (40\PYGZpc{} held out for testing)}
\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{,} \PYG{n}{testData}\PYG{p}{)} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{trainingData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{testData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}        \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}} \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.6}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{39.6}\PYG{p}{,}\PYG{l+m+mf}{8.7}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{p}{[}\PYG{l+m+mf}{8.6}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{4.8}\PYG{o}{\textbar{}}   \PYG{p}{[}\PYG{l+m+mf}{8.6}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.7}\PYG{p}{,}\PYG{l+m+mf}{48.9}\PYG{p}{,}\PYG{l+m+mf}{75.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.2}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.7}\PYG{p}{,}\PYG{l+m+mf}{48.9}\PYG{p}{,}\PYG{l+m+mf}{75.0}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.7}\PYG{p}{,}\PYG{l+m+mf}{36.9}\PYG{p}{,}\PYG{l+m+mf}{45.2}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.3}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.7}\PYG{p}{,}\PYG{l+m+mf}{36.9}\PYG{p}{,}\PYG{l+m+mf}{45.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{13.2}\PYG{p}{,}\PYG{l+m+mf}{15.9}\PYG{p}{,}\PYG{l+m+mf}{49.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.6}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{13.2}\PYG{p}{,}\PYG{l+m+mf}{15.9}\PYG{p}{,}\PYG{l+m+mf}{49.6}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}       \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{11.6}\PYG{p}{,}\PYG{l+m+mf}{5.7}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{4.1}\PYG{p}{,}\PYG{l+m+mf}{11.6}\PYG{p}{,}\PYG{l+m+mf}{5.7}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{29.9}\PYG{p}{,}\PYG{l+m+mf}{9.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.3}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{29.9}\PYG{p}{,}\PYG{l+m+mf}{9.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.3}\PYG{p}{,}\PYG{l+m+mf}{28.1}\PYG{p}{,}\PYG{l+m+mf}{41.4}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.5}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.3}\PYG{p}{,}\PYG{l+m+mf}{28.1}\PYG{p}{,}\PYG{l+m+mf}{41.4}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{6.6}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.4}\PYG{p}{,}\PYG{l+m+mf}{27.2}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.7}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.4}\PYG{p}{,}\PYG{l+m+mf}{27.2}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
Fit RandomForest Regression Model

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Import LinearRegression class}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.regression} \PYG{k+kn}{import} \PYG{n}{GBTRegressor}

\PYG{c+c1}{\PYGZsh{} Define LinearRegression algorithm}
\PYG{n}{rf} \PYG{o}{=} \PYG{n}{GBTRegressor}\PYG{p}{(}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}numTrees=2, maxDepth=2, seed=42}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
If you decide to use the \sphinxcode{\sphinxupquote{indexedFeatures}} features, you need to add the parameter \sphinxcode{\sphinxupquote{featuresCol="indexedFeatures"}}.
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
Pipeline Architecture

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Chain indexer and tree in a Pipeline}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{featureIndexer}\PYG{p}{,} \PYG{n}{rf}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{8}
\item {} 
Make predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testData}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Select example rows to display.}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}        \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}        \PYG{n}{prediction}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{38.9}\PYG{p}{,}\PYG{l+m+mf}{50.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{6.6}\PYG{o}{\textbar{}} \PYG{l+m+mf}{6.836040343319862}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{p}{[}\PYG{l+m+mf}{8.6}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{4.8}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5.652202764688849}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{8.7}\PYG{p}{,}\PYG{l+m+mf}{48.9}\PYG{p}{,}\PYG{l+m+mf}{75.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{6.908750296855572}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{13.1}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{,}\PYG{l+m+mf}{25.6}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{5.3}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5.784020210692574}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{19.6}\PYG{p}{,}\PYG{l+m+mf}{20.1}\PYG{p}{,}\PYG{l+m+mf}{17.0}\PYG{p}{]}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.6}\PYG{o}{\textbar{}}\PYG{l+m+mf}{6.8678921062629295}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{9}
\item {} 
Evaluation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Select (prediction, true label) and compute test error}
\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{RegressionEvaluator}\PYG{p}{(}
    \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{metricName}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rmse}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{rmse} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Root Mean Squared Error (RMSE) on test data = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{rmse}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Root} \PYG{n}{Mean} \PYG{n}{Squared} \PYG{n}{Error} \PYG{p}{(}\PYG{n}{RMSE}\PYG{p}{)} \PYG{n}{on} \PYG{n}{test} \PYG{n}{data} \PYG{o}{=} \PYG{l+m+mf}{1.36939}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sklearn.metrics}
\PYG{n}{r2\PYGZus{}score} \PYG{o}{=} \PYG{n}{sklearn}\PYG{o}{.}\PYG{n}{metrics}\PYG{o}{.}\PYG{n}{r2\PYGZus{}score}\PYG{p}{(}\PYG{n}{y\PYGZus{}true}\PYG{p}{,} \PYG{n}{y\PYGZus{}pred}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r2\PYGZus{}score: \PYGZob{}:4.3f\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{r2\PYGZus{}score}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{r2\PYGZus{}score}\PYG{p}{:} \PYG{l+m+mf}{0.932}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{10}
\item {} 
Feature importances

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{featureImportances}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{SparseVector}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{l+m+mi}{0}\PYG{p}{:} \PYG{l+m+mf}{0.3716}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{:} \PYG{l+m+mf}{0.3525}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{:} \PYG{l+m+mf}{0.2759}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{trees}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}\PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}7f5cd2ef7cb6}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{61} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}ef3ab6baeac9}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{39} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}07c6e3cf3819}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{45} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}ce724af79a2b}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{47} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}d149ecc71658}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{55} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}d3a79bdea516}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{43} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}7abc1a337844}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{51} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}480834b46d8f}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{33} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}0cbd1eaa3874}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{39} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}8088ac71a204}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{57} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}2ceb9e8deb45}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{47} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}cc334e84e9a2}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{57} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}a665c562929e}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{41} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}2999b1ffd2dc}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{45} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}29965cbe8cfc}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{55} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}731df51bf0ad}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{41} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}354cf33424da}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{51} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}4230f200b1c0}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{41} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}3279cdc1ce1d}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{45} \PYG{n}{nodes}\PYG{p}{,}
 \PYG{n}{DecisionTreeRegressionModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{dtr\PYGZus{}f474a99ff06e}\PYG{p}{)} \PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{55} \PYG{n}{nodes}\PYG{p}{]}
\end{sphinxVerbatim}


\chapter{Regularization}
\label{\detokenize{reg:regularization}}\label{\detokenize{reg:id1}}\label{\detokenize{reg::doc}}
In mathematics, statistics, and computer science, particularly in the fields of machine learning and inverse problems, regularization is a process of introducing additional information in order to solve an ill-posed problem or to prevent overfitting (\sphinxhref{https://en.wikipedia.org/wiki/Regularization\_(mathematics)}{Wikipedia Regularization}).

Due to the sparsity within our data, our training sets will often be ill-posed (singular).  Applying regularization to the regression has many advantages, including:
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Converting ill-posed problems to well-posed by adding additional information via the penalty parameter \(\lambda\)

\item {} 
Preventing overfitting

\item {} 
Variable selection and the removal of correlated variables (\sphinxhref{https://web.stanford.edu/~hastie/Papers/Glmnet\_Vignette.pdf}{Glmnet Vignette}).  The Ridge method shrinks the coefficients of correlated variables while the LASSO method picks one variable and discards the others.  The elastic net penalty is a mixture of these two; if variables are correlated in groups then \(\alpha=0.5\) tends to select the groups as in or out. If \(\alpha\) is close to 1, the elastic net performs much like the LASSO method and removes any degeneracies and wild behavior caused by extreme correlations.

\end{enumerate}


\section{Ordinary least squares regression}
\label{\detokenize{reg:ordinary-least-squares-regression}}\begin{equation*}
\begin{split}\min _{\beta\in \mathbb {R} ^{p}}{\frac {1}{n}}\|{\hat {X}}\beta-{\hat {Y}}\|^{2}\end{split}
\end{equation*}
When \(\lambda=0\) (i.e. \sphinxcode{\sphinxupquote{regParam}} \(=0\)), then there is no penalty.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{LinearRegression}\PYG{p}{(}\PYG{n}{featuresCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,}
\PYG{n}{regParam}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{elasticNetParam}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{tol}\PYG{o}{=}\PYG{l+m+mf}{1e\PYGZhy{}6}\PYG{p}{,} \PYG{n}{fitIntercept}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{standardization}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{solver}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{auto}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
\PYG{n}{weightCol}\PYG{o}{=}\PYG{n+nb+bp}{None}\PYG{p}{,} \PYG{n}{aggregationDepth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Ridge regression}
\label{\detokenize{reg:ridge-regression}}\begin{equation*}
\begin{split}\min _{\beta\in \mathbb {R} ^{p}}{\frac {1}{n}}\|{\hat {X}}\beta-{\hat {Y}}\|^{2}+\lambda \|\beta\|_{2}^{2}\end{split}
\end{equation*}
When \(\lambda>0\) (i.e. \sphinxcode{\sphinxupquote{regParam}} \(>0\)) and \(\alpha=0\) (i.e. \sphinxcode{\sphinxupquote{elasticNetParam}} \(=0\))  , then the penalty is an L2 penalty.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{LinearRegression}\PYG{p}{(}\PYG{n}{featuresCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,}
\PYG{n}{regParam}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{n}{elasticNetParam}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{tol}\PYG{o}{=}\PYG{l+m+mf}{1e\PYGZhy{}6}\PYG{p}{,} \PYG{n}{fitIntercept}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{standardization}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{solver}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{auto}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
\PYG{n}{weightCol}\PYG{o}{=}\PYG{n+nb+bp}{None}\PYG{p}{,} \PYG{n}{aggregationDepth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Least Absolute Shrinkage and Selection Operator (LASSO)}
\label{\detokenize{reg:least-absolute-shrinkage-and-selection-operator-lasso}}\begin{equation*}
\begin{split}\min _{\beta\in \mathbb {R} ^{p}}{\frac {1}{n}}\|{\hat {X}}\beta-{\hat {Y}}\|^{2}+\lambda\|\beta\|_{1}\end{split}
\end{equation*}
When \(\lambda>0\) (i.e. \sphinxcode{\sphinxupquote{regParam}} \(>0\)) and \(\alpha=1\) (i.e. \sphinxcode{\sphinxupquote{elasticNetParam}} \(=1\)), then the penalty is an L1 penalty.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{LinearRegression}\PYG{p}{(}\PYG{n}{featuresCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,}
\PYG{n}{regParam}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{elasticNetParam}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{tol}\PYG{o}{=}\PYG{l+m+mf}{1e\PYGZhy{}6}\PYG{p}{,} \PYG{n}{fitIntercept}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{standardization}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{solver}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{auto}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
\PYG{n}{weightCol}\PYG{o}{=}\PYG{n+nb+bp}{None}\PYG{p}{,} \PYG{n}{aggregationDepth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Elastic net}
\label{\detokenize{reg:elastic-net}}\begin{equation*}
\begin{split}\min _{\beta\in \mathbb {R} ^{p}}{\frac {1}{n}}\|{\hat {X}}\beta-{\hat {Y}}\|^{2}+\lambda (\alpha \|\beta\|_{1}+(1-\alpha )\|\beta\|_{2}^{2}),\alpha \in (0,1)\end{split}
\end{equation*}
When \(\lambda>0\) (i.e. \sphinxcode{\sphinxupquote{regParam}} \(>0\)) and \sphinxcode{\sphinxupquote{elasticNetParam}} \(\in (0,1)\) (i.e. \(\alpha\in (0,1)\)) , then the penalty is an L1 + L2 penalty.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{LinearRegression}\PYG{p}{(}\PYG{n}{featuresCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,}
\PYG{n}{regParam}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{elasticNetParam}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{tol}\PYG{o}{=}\PYG{l+m+mf}{1e\PYGZhy{}6}\PYG{p}{,} \PYG{n}{fitIntercept}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{standardization}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{solver}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{auto}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
\PYG{n}{weightCol}\PYG{o}{=}\PYG{n+nb+bp}{None}\PYG{p}{,} \PYG{n}{aggregationDepth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}
\end{sphinxVerbatim}


\chapter{Classification}
\label{\detokenize{classification:classification}}\label{\detokenize{classification:id1}}\label{\detokenize{classification::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

\sphinxstylestrong{Birds of a feather folock together.} \textendash{} old Chinese proverb
\end{sphinxadmonition}


\section{Binomial logistic regression}
\label{\detokenize{classification:binomial-logistic-regression}}

\subsection{Introduction}
\label{\detokenize{classification:introduction}}

\subsection{Demo}
\label{\detokenize{classification:demo}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/logisticRegression.ipynb}{Logistic Regression}.

\item {} 
For more details, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.classification.BinaryLogisticRegressionSummary.html}{Logistic Regression API} .

\end{itemize}

\begin{sphinxadmonition}{note}{Note:}
In this demo, I introduced a new function \sphinxcode{\sphinxupquote{get\_dummy}} to deal with the categorical data. I highly recommend you to use my \sphinxcode{\sphinxupquote{get\_dummy}} function in the other cases. This function will save a lot of time for you.
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

        \PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark Logistic Regression example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{./data/bank.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{drop}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{poutcome}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{age}\PYG{o}{\textbar{}}         \PYG{n}{job}\PYG{o}{\textbar{}}\PYG{n}{marital}\PYG{o}{\textbar{}}\PYG{n}{education}\PYG{o}{\textbar{}}\PYG{n}{default}\PYG{o}{\textbar{}}\PYG{n}{balance}\PYG{o}{\textbar{}}\PYG{n}{housing}\PYG{o}{\textbar{}}\PYG{n}{loan}\PYG{o}{\textbar{}}\PYG{n}{contact}\PYG{o}{\textbar{}}\PYG{n}{duration}\PYG{o}{\textbar{}}\PYG{n}{campaign}\PYG{o}{\textbar{}}\PYG{n}{pdays}\PYG{o}{\textbar{}}\PYG{n}{previous}\PYG{o}{\textbar{}}  \PYG{n}{y}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{l+m+mi}{58}\PYG{o}{\textbar{}}  \PYG{n}{management}\PYG{o}{\textbar{}}\PYG{n}{married}\PYG{o}{\textbar{}} \PYG{n}{tertiary}\PYG{o}{\textbar{}}     \PYG{n}{no}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{2143}\PYG{o}{\textbar{}}    \PYG{n}{yes}\PYG{o}{\textbar{}}  \PYG{n}{no}\PYG{o}{\textbar{}}\PYG{n}{unknown}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{261}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}   \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mi}{44}\PYG{o}{\textbar{}}  \PYG{n}{technician}\PYG{o}{\textbar{}} \PYG{n}{single}\PYG{o}{\textbar{}}\PYG{n}{secondary}\PYG{o}{\textbar{}}     \PYG{n}{no}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{29}\PYG{o}{\textbar{}}    \PYG{n}{yes}\PYG{o}{\textbar{}}  \PYG{n}{no}\PYG{o}{\textbar{}}\PYG{n}{unknown}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{151}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}   \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mi}{33}\PYG{o}{\textbar{}}\PYG{n}{entrepreneur}\PYG{o}{\textbar{}}\PYG{n}{married}\PYG{o}{\textbar{}}\PYG{n}{secondary}\PYG{o}{\textbar{}}     \PYG{n}{no}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}    \PYG{n}{yes}\PYG{o}{\textbar{}} \PYG{n}{yes}\PYG{o}{\textbar{}}\PYG{n}{unknown}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{76}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}   \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mi}{47}\PYG{o}{\textbar{}} \PYG{n}{blue}\PYG{o}{\PYGZhy{}}\PYG{n}{collar}\PYG{o}{\textbar{}}\PYG{n}{married}\PYG{o}{\textbar{}}  \PYG{n}{unknown}\PYG{o}{\textbar{}}     \PYG{n}{no}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{1506}\PYG{o}{\textbar{}}    \PYG{n}{yes}\PYG{o}{\textbar{}}  \PYG{n}{no}\PYG{o}{\textbar{}}\PYG{n}{unknown}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{92}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}   \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mi}{33}\PYG{o}{\textbar{}}     \PYG{n}{unknown}\PYG{o}{\textbar{}} \PYG{n}{single}\PYG{o}{\textbar{}}  \PYG{n}{unknown}\PYG{o}{\textbar{}}     \PYG{n}{no}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}     \PYG{n}{no}\PYG{o}{\textbar{}}  \PYG{n}{no}\PYG{o}{\textbar{}}\PYG{n}{unknown}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{198}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}   \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{age}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{job}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{marital}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{education}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{default}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{balance}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{housing}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{loan}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{contact}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{day}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{month}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{duration}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{campaign}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{pdays}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{previous}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{poutcome}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{y}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
You are strongly encouraged to try my \sphinxcode{\sphinxupquote{get\_dummy}} function for dealing with the categorical data in complex dataset.

Supervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Unsupervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Get dummy variables and concat with continuous variables for unsupervised learning.}
\PYG{l+s+sd}{    :param df: the dataframe}
\PYG{l+s+sd}{    :param categoricalCols: the name list of the categorical data}
\PYG{l+s+sd}{    :param continuousCols:  the name list of the numerical data}
\PYG{l+s+sd}{    :return k: feature matrix}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  von198@gmail.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Deal with categorical data and Convert the data to dense vector

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{catcols} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{job}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{marital}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{education}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{default}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
           \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{housing}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{loan}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{contact}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{poutcome}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

\PYG{n}{num\PYGZus{}cols} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{balance}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{duration}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{campaign}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{pdays}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{previous}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{p}{]}
\PYG{n}{labelCol} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{y}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{n}{data} \PYG{o}{=} \PYG{n}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{catcols}\PYG{p}{,}\PYG{n}{num\PYGZus{}cols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{14}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{20}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Deal with Categorical Label and Variables

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}
\PYG{c+c1}{\PYGZsh{} Index labels, adding metadata to the label column}
\PYG{n}{labelIndexer} \PYG{o}{=} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedLabel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}
\PYG{n}{labelIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{indexedLabel}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{14}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{20}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{VectorIndexer}
\PYG{c+c1}{\PYGZsh{} Automatically identify categorical features, and index them.}
\PYG{c+c1}{\PYGZsh{} Set maxCategories so features with \PYGZgt{} 4 distinct values are treated as continuous.}
\PYG{n}{featureIndexer} \PYG{o}{=}\PYG{n}{VectorIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                                  \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                                  \PYG{n}{maxCategories}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}
\PYG{n}{featureIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}     \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{14}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{14}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{20}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{20}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Split the data to training and test data sets

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Split the data into training and test sets (40\PYGZpc{} held out for testing)}
\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{,} \PYG{n}{testData}\PYG{p}{)} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{trainingData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{False}\PYG{p}{)}
\PYG{n}{testData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{features}                                                                                         \PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{19}\PYG{p}{,}\PYG{l+m+mi}{21}\PYG{p}{,}\PYG{l+m+mi}{24}\PYG{p}{,}\PYG{l+m+mi}{25}\PYG{p}{,}\PYG{l+m+mi}{26}\PYG{p}{,}\PYG{l+m+mi}{27}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{731.0}\PYG{p}{,}\PYG{l+m+mf}{401.0}\PYG{p}{,}\PYG{l+m+mf}{4.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\textbar{}}\PYG{n}{no}   \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{19}\PYG{p}{,}\PYG{l+m+mi}{21}\PYG{p}{,}\PYG{l+m+mi}{24}\PYG{p}{,}\PYG{l+m+mi}{25}\PYG{p}{,}\PYG{l+m+mi}{26}\PYG{p}{,}\PYG{l+m+mi}{27}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{723.0}\PYG{p}{,}\PYG{l+m+mf}{112.0}\PYG{p}{,}\PYG{l+m+mf}{2.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\textbar{}}\PYG{n}{no}   \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{19}\PYG{p}{,}\PYG{l+m+mi}{21}\PYG{p}{,}\PYG{l+m+mi}{24}\PYG{p}{,}\PYG{l+m+mi}{25}\PYG{p}{,}\PYG{l+m+mi}{26}\PYG{p}{,}\PYG{l+m+mi}{27}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{626.0}\PYG{p}{,}\PYG{l+m+mf}{205.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\textbar{}}\PYG{n}{no}   \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{19}\PYG{p}{,}\PYG{l+m+mi}{21}\PYG{p}{,}\PYG{l+m+mi}{24}\PYG{p}{,}\PYG{l+m+mi}{25}\PYG{p}{,}\PYG{l+m+mi}{26}\PYG{p}{,}\PYG{l+m+mi}{27}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{498.0}\PYG{p}{,}\PYG{l+m+mf}{357.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\textbar{}}\PYG{n}{no}   \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{19}\PYG{p}{,}\PYG{l+m+mi}{21}\PYG{p}{,}\PYG{l+m+mi}{24}\PYG{p}{,}\PYG{l+m+mi}{25}\PYG{p}{,}\PYG{l+m+mi}{26}\PYG{p}{,}\PYG{l+m+mi}{27}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{477.0}\PYG{p}{,}\PYG{l+m+mf}{473.0}\PYG{p}{,}\PYG{l+m+mf}{2.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\textbar{}}\PYG{n}{no}   \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{features}                                                                                         \PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{19}\PYG{p}{,}\PYG{l+m+mi}{21}\PYG{p}{,}\PYG{l+m+mi}{24}\PYG{p}{,}\PYG{l+m+mi}{25}\PYG{p}{,}\PYG{l+m+mi}{26}\PYG{p}{,}\PYG{l+m+mi}{27}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{648.0}\PYG{p}{,}\PYG{l+m+mf}{280.0}\PYG{p}{,}\PYG{l+m+mf}{2.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\textbar{}}\PYG{n}{no}   \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{19}\PYG{p}{,}\PYG{l+m+mi}{21}\PYG{p}{,}\PYG{l+m+mi}{24}\PYG{p}{,}\PYG{l+m+mi}{25}\PYG{p}{,}\PYG{l+m+mi}{26}\PYG{p}{,}\PYG{l+m+mi}{27}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{596.0}\PYG{p}{,}\PYG{l+m+mf}{147.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\textbar{}}\PYG{n}{no}   \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{19}\PYG{p}{,}\PYG{l+m+mi}{21}\PYG{p}{,}\PYG{l+m+mi}{24}\PYG{p}{,}\PYG{l+m+mi}{25}\PYG{p}{,}\PYG{l+m+mi}{26}\PYG{p}{,}\PYG{l+m+mi}{27}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{529.0}\PYG{p}{,}\PYG{l+m+mf}{416.0}\PYG{p}{,}\PYG{l+m+mf}{4.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\textbar{}}\PYG{n}{no}   \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{19}\PYG{p}{,}\PYG{l+m+mi}{21}\PYG{p}{,}\PYG{l+m+mi}{24}\PYG{p}{,}\PYG{l+m+mi}{25}\PYG{p}{,}\PYG{l+m+mi}{26}\PYG{p}{,}\PYG{l+m+mi}{27}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{518.0}\PYG{p}{,}\PYG{l+m+mf}{46.0}\PYG{p}{,}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)} \PYG{o}{\textbar{}}\PYG{n}{no}   \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mi}{18}\PYG{p}{,}\PYG{l+m+mi}{19}\PYG{p}{,}\PYG{l+m+mi}{21}\PYG{p}{,}\PYG{l+m+mi}{24}\PYG{p}{,}\PYG{l+m+mi}{25}\PYG{p}{,}\PYG{l+m+mi}{26}\PYG{p}{,}\PYG{l+m+mi}{27}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{470.0}\PYG{p}{,}\PYG{l+m+mf}{275.0}\PYG{p}{,}\PYG{l+m+mf}{2.0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\textbar{}}\PYG{n}{no}   \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Fit Logistic Regression Model

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.classification} \PYG{k+kn}{import} \PYG{n}{LogisticRegression}
\PYG{n}{logr} \PYG{o}{=} \PYG{n}{LogisticRegression}\PYG{p}{(}\PYG{n}{featuresCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedFeatures}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedLabel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
Pipeline Architecture

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Convert indexed labels back to original labels.}
\PYG{n}{labelConverter} \PYG{o}{=} \PYG{n}{IndexToString}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                               \PYG{n}{labels}\PYG{o}{=}\PYG{n}{labelIndexer}\PYG{o}{.}\PYG{n}{labels}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Chain indexers and tree in a Pipeline}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{labelIndexer}\PYG{p}{,} \PYG{n}{featureIndexer}\PYG{p}{,} \PYG{n}{logr}\PYG{p}{,}\PYG{n}{labelConverter}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Train model.  This also runs the indexers.}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
Make predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Make predictions.}
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testData}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Select example rows to display.}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{predictedLabel}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}            \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}            \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}            \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}            \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{29}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mi}{16}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{no}\PYG{o}{\textbar{}}            \PYG{n}{no}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{8}
\item {} 
Evaluation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{MulticlassClassificationEvaluator}

\PYG{c+c1}{\PYGZsh{} Select (prediction, true label) and compute test error}
\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{MulticlassClassificationEvaluator}\PYG{p}{(}
    \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{metricName}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{accuracy}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{accuracy} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Test Error = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{l+m+mf}{1.0} \PYG{o}{\PYGZhy{}} \PYG{n}{accuracy}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Test} \PYG{n}{Error} \PYG{o}{=} \PYG{l+m+mf}{0.0987688}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{lrModel} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}
\PYG{n}{trainingSummary} \PYG{o}{=} \PYG{n}{lrModel}\PYG{o}{.}\PYG{n}{summary}

\PYG{c+c1}{\PYGZsh{} Obtain the objective per iteration}
\PYG{c+c1}{\PYGZsh{} objectiveHistory = trainingSummary.objectiveHistory}
\PYG{c+c1}{\PYGZsh{} print(\PYGZdq{}objectiveHistory:\PYGZdq{})}
\PYG{c+c1}{\PYGZsh{} for objective in objectiveHistory:}
\PYG{c+c1}{\PYGZsh{}     print(objective)}

\PYG{c+c1}{\PYGZsh{} Obtain the receiver\PYGZhy{}operating characteristic as a dataframe and areaUnderROC.}
\PYG{n}{trainingSummary}\PYG{o}{.}\PYG{n}{roc}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{areaUnderROC: }\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{trainingSummary}\PYG{o}{.}\PYG{n}{areaUnderROC}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set the model threshold to maximize F\PYGZhy{}Measure}
\PYG{n}{fMeasure} \PYG{o}{=} \PYG{n}{trainingSummary}\PYG{o}{.}\PYG{n}{fMeasureByThreshold}
\PYG{n}{maxFMeasure} \PYG{o}{=} \PYG{n}{fMeasure}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{F\PYGZhy{}Measure}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max(F\PYGZhy{}Measure)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} bestThreshold = fMeasure.where(fMeasure[\PYGZsq{}F\PYGZhy{}Measure\PYGZsq{}] == maxFMeasure[\PYGZsq{}max(F\PYGZhy{}Measure)\PYGZsq{}]) \PYGZbs{}}
\PYG{c+c1}{\PYGZsh{}     .select(\PYGZsq{}threshold\PYGZsq{}).head()[\PYGZsq{}threshold\PYGZsq{}]}
\PYG{c+c1}{\PYGZsh{} lr.setThreshold(bestThreshold)}
\end{sphinxVerbatim}

You can use \sphinxcode{\sphinxupquote{z.show()}} to get the data and plot the ROC curves:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{roc_z}.png}
\end{figure}

You can also register a TempTable \sphinxcode{\sphinxupquote{data.registerTempTable('roc\_data')}} and then
use \sphinxcode{\sphinxupquote{sql}} to plot the ROC curve:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{roc}.png}
\end{figure}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{9}
\item {} 
visualization

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.pyplot} \PYG{k+kn}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{itertools}

\PYG{k}{def} \PYG{n+nf}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{,}
                          \PYG{n}{normalize}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,}
                          \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                          \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{Blues}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    This function prints and plots the confusion matrix.}
\PYG{l+s+sd}{    Normalization can be applied by setting {}`normalize=True{}`.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{k}{if} \PYG{n}{normalize}\PYG{p}{:}
        \PYG{n}{cm} \PYG{o}{=} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{float}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{/} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{newaxis}\PYG{p}{]}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Normalized confusion matrix}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix, without normalization}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{print}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{,} \PYG{n}{interpolation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nearest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{cmap}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{n}{title}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{tick\PYGZus{}marks} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{classes}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{xticks}\PYG{p}{(}\PYG{n}{tick\PYGZus{}marks}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{,} \PYG{n}{rotation}\PYG{o}{=}\PYG{l+m+mi}{45}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{yticks}\PYG{p}{(}\PYG{n}{tick\PYGZus{}marks}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{)}

    \PYG{n}{fmt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.2f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{n}{normalize} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{d}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{thresh} \PYG{o}{=} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)} \PYG{o}{/} \PYG{l+m+mf}{2.}
    \PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n}{itertools}\PYG{o}{.}\PYG{n}{product}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{plt}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{j}\PYG{p}{,} \PYG{n}{i}\PYG{p}{,} \PYG{n}{format}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]}\PYG{p}{,} \PYG{n}{fmt}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{center}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                 \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{white}\PYG{l+s+s2}{\PYGZdq{}} \PYG{k}{if} \PYG{n}{cm}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{n}{thresh} \PYG{k}{else} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{black}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{True label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Predicted label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{class\PYGZus{}temp} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYGZbs{}
                        \PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{count}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ascending}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{class\PYGZus{}temp} \PYG{o}{=} \PYG{n}{class\PYGZus{}temp}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{o}{.}\PYG{n}{tolist}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{class\PYGZus{}names} \PYG{o}{=} \PYG{n+nb}{map}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{,} \PYG{n}{class\PYGZus{}temp}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} \PYGZsh{} \PYGZsh{} print(class\PYGZus{}name)}
\PYG{n}{class\PYGZus{}names}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{no}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yes}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sklearn.metrics} \PYG{k+kn}{import} \PYG{n}{confusion\PYGZus{}matrix}
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{y\PYGZus{}true}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{y\PYGZus{}pred}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{cnf\PYGZus{}matrix} \PYG{o}{=} \PYG{n}{confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{y\PYGZus{}true}\PYG{p}{,} \PYG{n}{y\PYGZus{}pred}\PYG{p}{,}\PYG{n}{labels}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{)}
\PYG{n}{cnf\PYGZus{}matrix}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{15657}\PYG{p}{,}   \PYG{l+m+mi}{379}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mi}{1410}\PYG{p}{,}   \PYG{l+m+mi}{667}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Plot non\PYGZhy{}normalized confusion matrix}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cnf\PYGZus{}matrix}\PYG{p}{,} \PYG{n}{classes}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{,}
                      \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix, without normalization}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Confusion} \PYG{n}{matrix}\PYG{p}{,} \PYG{n}{without} \PYG{n}{normalization}
\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{15657}   \PYG{l+m+mi}{379}\PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mi}{1410}   \PYG{l+m+mi}{667}\PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{logr_b1}.png}
\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Plot normalized confusion matrix}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cnf\PYGZus{}matrix}\PYG{p}{,} \PYG{n}{classes}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{,} \PYG{n}{normalize}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,}
                      \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Normalized confusion matrix}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Normalized} \PYG{n}{confusion} \PYG{n}{matrix}
\PYG{p}{[}\PYG{p}{[} \PYG{l+m+mf}{0.97636568}  \PYG{l+m+mf}{0.02363432}\PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mf}{0.67886375}  \PYG{l+m+mf}{0.32113625}\PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{logr_b2}.png}
\end{figure}


\section{Multinomial logistic regression}
\label{\detokenize{classification:multinomial-logistic-regression}}

\subsection{Introduction}
\label{\detokenize{classification:id2}}

\subsection{Demo}
\label{\detokenize{classification:id3}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/logisticRegression.ipynb}{Logistic Regression}.

\item {} 
For more details, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.classification.BinaryLogisticRegressionSummary.html}{Logistic Regression API} .

\end{itemize}

\begin{sphinxadmonition}{note}{Note:}
In this demo, I introduced a new function \sphinxcode{\sphinxupquote{get\_dummy}} to deal with the categorical data. I highly recommend you to use my \sphinxcode{\sphinxupquote{get\_dummy}} function in the other cases. This function will save a lot of time for you.
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark MultinomialLogisticRegression classification}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{./data/WineData2.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{fixed}\PYG{o}{\textbar{}}\PYG{n}{volatile}\PYG{o}{\textbar{}}\PYG{n}{citric}\PYG{o}{\textbar{}}\PYG{n}{sugar}\PYG{o}{\textbar{}}\PYG{n}{chlorides}\PYG{o}{\textbar{}}\PYG{n}{free}\PYG{o}{\textbar{}}\PYG{n}{total}\PYG{o}{\textbar{}}\PYG{n}{density}\PYG{o}{\textbar{}}  \PYG{n}{pH}\PYG{o}{\textbar{}}\PYG{n}{sulphates}\PYG{o}{\textbar{}}\PYG{n}{alcohol}\PYG{o}{\textbar{}}\PYG{n}{quality}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.88}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.6}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.098}\PYG{o}{\textbar{}}\PYG{l+m+mf}{25.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{67.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9968}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.68}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.76}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.04}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.3}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.092}\PYG{o}{\textbar{}}\PYG{l+m+mf}{15.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{54.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.997}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.65}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{11.2}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.28}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.075}\PYG{o}{\textbar{}}\PYG{l+m+mf}{17.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{60.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.998}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.16}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.58}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{fixed}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{volatile}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{citric}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sugar}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{chlorides}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{free}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{total}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{density}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{pH}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sulphates}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{alcohol}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{quality}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Convert to float format}
\PYG{k}{def} \PYG{n+nf}{string\PYGZus{}to\PYGZus{}float}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}}
\PYG{k}{def} \PYG{n+nf}{condition}\PYG{p}{(}\PYG{n}{r}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{p}{(}\PYG{l+m+mi}{0}\PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{r} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{low}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{elif}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{o}{\PYGZlt{}} \PYG{n}{r} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{medium}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{high}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{return} \PYG{n}{label}

\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{udf}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StringType}\PYG{p}{,} \PYG{n}{DoubleType}
\PYG{n}{string\PYGZus{}to\PYGZus{}float\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{string\PYGZus{}to\PYGZus{}float}\PYG{p}{,} \PYG{n}{DoubleType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{quality\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{condition}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{df} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{quality}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{quality\PYGZus{}udf}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{quality}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{fixed}\PYG{o}{\textbar{}}\PYG{n}{volatile}\PYG{o}{\textbar{}}\PYG{n}{citric}\PYG{o}{\textbar{}}\PYG{n}{sugar}\PYG{o}{\textbar{}}\PYG{n}{chlorides}\PYG{o}{\textbar{}}\PYG{n}{free}\PYG{o}{\textbar{}}\PYG{n}{total}\PYG{o}{\textbar{}}\PYG{n}{density}\PYG{o}{\textbar{}}  \PYG{n}{pH}\PYG{o}{\textbar{}}\PYG{n}{sulphates}\PYG{o}{\textbar{}}\PYG{n}{alcohol}\PYG{o}{\textbar{}}\PYG{n}{quality}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.88}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.6}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.098}\PYG{o}{\textbar{}}\PYG{l+m+mf}{25.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{67.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9968}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.68}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.76}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.04}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.3}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.092}\PYG{o}{\textbar{}}\PYG{l+m+mf}{15.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{54.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.997}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.65}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{11.2}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.28}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.075}\PYG{o}{\textbar{}}\PYG{l+m+mf}{17.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{60.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.998}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.16}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.58}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{fixed}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{volatile}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{citric}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sugar}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{chlorides}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{free}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{total}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{density}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{pH}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sulphates}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{alcohol}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{quality}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Deal with categorical data and Convert the data to dense vector

\end{enumerate}

\begin{sphinxadmonition}{note}{Note:}
You are strongly encouraged to try my \sphinxcode{\sphinxupquote{get\_dummy}} function for dealing with the categorical data in complex dataset.

Supervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Unsupervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Get dummy variables and concat with continuous variables for unsupervised learning.}
\PYG{l+s+sd}{    :param df: the dataframe}
\PYG{l+s+sd}{    :param categoricalCols: the name list of the categorical data}
\PYG{l+s+sd}{    :param continuousCols:  the name list of the numerical data}
\PYG{l+s+sd}{    :return k: feature matrix}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  von198@gmail.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Transform the dataset to DataFrame

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors} \PYG{c+c1}{\PYGZsh{} !!!!caution: not from pyspark.mllib.linalg import Vectors}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{IndexToString}\PYG{p}{,}\PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{VectorIndexer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.tuning} \PYG{k+kn}{import} \PYG{n}{CrossValidator}\PYG{p}{,} \PYG{n}{ParamGridBuilder}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{MulticlassClassificationEvaluator}

\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
\PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{n}{r}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{transformed} \PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Deal with Categorical Label and Variables

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Index labels, adding metadata to the label column}
\PYG{n}{labelIndexer} \PYG{o}{=} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedLabel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\PYG{n}{labelIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{indexedLabel}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Automatically identify categorical features, and index them.}
\PYG{c+c1}{\PYGZsh{} Set maxCategories so features with \PYGZgt{} 4 distinct values are treated as continuous.}
\PYG{n}{featureIndexer} \PYG{o}{=}\PYG{n}{VectorIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                              \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                              \PYG{n}{maxCategories}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\PYG{n}{featureIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}     \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Split the data to training and test data sets

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Split the data into training and test sets (40\PYGZpc{} held out for testing)}
\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{,} \PYG{n}{testData}\PYG{p}{)} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{trainingData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{False}\PYG{p}{)}
\PYG{n}{testData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{features}                                                 \PYG{o}{\textbar{}}\PYG{n}{label} \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.7}\PYG{p}{,}\PYG{l+m+mf}{0.6}\PYG{p}{,}\PYG{l+m+mf}{0.17}\PYG{p}{,}\PYG{l+m+mf}{2.3}\PYG{p}{,}\PYG{l+m+mf}{0.058}\PYG{p}{,}\PYG{l+m+mf}{17.0}\PYG{p}{,}\PYG{l+m+mf}{106.0}\PYG{p}{,}\PYG{l+m+mf}{0.9932}\PYG{p}{,}\PYG{l+m+mf}{3.85}\PYG{p}{,}\PYG{l+m+mf}{0.6}\PYG{p}{,}\PYG{l+m+mf}{12.9}\PYG{p}{]} \PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.38}\PYG{p}{,}\PYG{l+m+mf}{0.01}\PYG{p}{,}\PYG{l+m+mf}{1.6}\PYG{p}{,}\PYG{l+m+mf}{0.048}\PYG{p}{,}\PYG{l+m+mf}{26.0}\PYG{p}{,}\PYG{l+m+mf}{60.0}\PYG{p}{,}\PYG{l+m+mf}{0.99084}\PYG{p}{,}\PYG{l+m+mf}{3.7}\PYG{p}{,}\PYG{l+m+mf}{0.75}\PYG{p}{,}\PYG{l+m+mf}{14.0}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{,}\PYG{l+m+mf}{0.5}\PYG{p}{,}\PYG{l+m+mf}{4.3}\PYG{p}{,}\PYG{l+m+mf}{0.046}\PYG{p}{,}\PYG{l+m+mf}{29.0}\PYG{p}{,}\PYG{l+m+mf}{80.0}\PYG{p}{,}\PYG{l+m+mf}{0.9902}\PYG{p}{,}\PYG{l+m+mf}{3.49}\PYG{p}{,}\PYG{l+m+mf}{0.66}\PYG{p}{,}\PYG{l+m+mf}{13.6}\PYG{p}{]}  \PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.74}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.2}\PYG{p}{,}\PYG{l+m+mf}{0.041}\PYG{p}{,}\PYG{l+m+mf}{16.0}\PYG{p}{,}\PYG{l+m+mf}{46.0}\PYG{p}{,}\PYG{l+m+mf}{0.99258}\PYG{p}{,}\PYG{l+m+mf}{4.01}\PYG{p}{,}\PYG{l+m+mf}{0.59}\PYG{p}{,}\PYG{l+m+mf}{12.5}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.1}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.8}\PYG{p}{,}\PYG{l+m+mf}{0.044}\PYG{p}{,}\PYG{l+m+mf}{18.0}\PYG{p}{,}\PYG{l+m+mf}{88.0}\PYG{p}{,}\PYG{l+m+mf}{0.99157}\PYG{p}{,}\PYG{l+m+mf}{3.68}\PYG{p}{,}\PYG{l+m+mf}{0.73}\PYG{p}{,}\PYG{l+m+mf}{13.6}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{n}{high}  \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{features}                                                 \PYG{o}{\textbar{}}\PYG{n}{label} \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{0.52}\PYG{p}{,}\PYG{l+m+mf}{0.15}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{0.054}\PYG{p}{,}\PYG{l+m+mf}{8.0}\PYG{p}{,}\PYG{l+m+mf}{65.0}\PYG{p}{,}\PYG{l+m+mf}{0.9934}\PYG{p}{,}\PYG{l+m+mf}{3.9}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{13.1}\PYG{p}{]}  \PYG{o}{\textbar{}}\PYG{n}{low}   \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{0.048}\PYG{p}{,}\PYG{l+m+mf}{16.0}\PYG{p}{,}\PYG{l+m+mf}{42.0}\PYG{p}{,}\PYG{l+m+mf}{0.99154}\PYG{p}{,}\PYG{l+m+mf}{3.71}\PYG{p}{,}\PYG{l+m+mf}{0.74}\PYG{p}{,}\PYG{l+m+mf}{14.0}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{n}{high}  \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.24}\PYG{p}{,}\PYG{l+m+mf}{2.0}\PYG{p}{,}\PYG{l+m+mf}{0.06}\PYG{p}{,}\PYG{l+m+mf}{19.0}\PYG{p}{,}\PYG{l+m+mf}{50.0}\PYG{p}{,}\PYG{l+m+mf}{0.9917}\PYG{p}{,}\PYG{l+m+mf}{3.72}\PYG{p}{,}\PYG{l+m+mf}{0.74}\PYG{p}{,}\PYG{l+m+mf}{14.0}\PYG{p}{]} \PYG{o}{\textbar{}}\PYG{n}{high}  \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1.02}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.045}\PYG{p}{,}\PYG{l+m+mf}{41.0}\PYG{p}{,}\PYG{l+m+mf}{85.0}\PYG{p}{,}\PYG{l+m+mf}{0.9938}\PYG{p}{,}\PYG{l+m+mf}{3.75}\PYG{p}{,}\PYG{l+m+mf}{0.48}\PYG{p}{,}\PYG{l+m+mf}{10.5}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{n}{low}   \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1.04}\PYG{p}{,}\PYG{l+m+mf}{0.24}\PYG{p}{,}\PYG{l+m+mf}{1.6}\PYG{p}{,}\PYG{l+m+mf}{0.05}\PYG{p}{,}\PYG{l+m+mf}{32.0}\PYG{p}{,}\PYG{l+m+mf}{96.0}\PYG{p}{,}\PYG{l+m+mf}{0.9934}\PYG{p}{,}\PYG{l+m+mf}{3.74}\PYG{p}{,}\PYG{l+m+mf}{0.62}\PYG{p}{,}\PYG{l+m+mf}{11.5}\PYG{p}{]} \PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Fit Multinomial logisticRegression Classification Model

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.classification} \PYG{k+kn}{import} \PYG{n}{LogisticRegression}
\PYG{n}{logr} \PYG{o}{=} \PYG{n}{LogisticRegression}\PYG{p}{(}\PYG{n}{featuresCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedFeatures}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedLabel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
Pipeline Architecture

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Convert indexed labels back to original labels.}
\PYG{n}{labelConverter} \PYG{o}{=} \PYG{n}{IndexToString}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                               \PYG{n}{labels}\PYG{o}{=}\PYG{n}{labelIndexer}\PYG{o}{.}\PYG{n}{labels}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Chain indexers and tree in a Pipeline}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{labelIndexer}\PYG{p}{,} \PYG{n}{featureIndexer}\PYG{p}{,} \PYG{n}{logr}\PYG{p}{,}\PYG{n}{labelConverter}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Train model.  This also runs the indexers.}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
Make predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Make predictions.}
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testData}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Select example rows to display.}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{predictedLabel}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{0.52}\PYG{p}{,}\PYG{l+m+mf}{0.15}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{low}\PYG{o}{\textbar{}}        \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{high}\PYG{o}{\textbar{}}          \PYG{n}{high}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.24}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{high}\PYG{o}{\textbar{}}          \PYG{n}{high}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1.02}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{low}\PYG{o}{\textbar{}}        \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1.04}\PYG{p}{,}\PYG{l+m+mf}{0.24}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}        \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{8}
\item {} 
Evaluation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{MulticlassClassificationEvaluator}

\PYG{c+c1}{\PYGZsh{} Select (prediction, true label) and compute test error}
\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{MulticlassClassificationEvaluator}\PYG{p}{(}
    \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{metricName}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{accuracy}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{accuracy} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Test Error = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{l+m+mf}{1.0} \PYG{o}{\PYGZhy{}} \PYG{n}{accuracy}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Test} \PYG{n}{Error} \PYG{o}{=} \PYG{l+m+mf}{0.181287}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{lrModel} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}
\PYG{n}{trainingSummary} \PYG{o}{=} \PYG{n}{lrModel}\PYG{o}{.}\PYG{n}{summary}

\PYG{c+c1}{\PYGZsh{} Obtain the objective per iteration}
\PYG{c+c1}{\PYGZsh{} objectiveHistory = trainingSummary.objectiveHistory}
\PYG{c+c1}{\PYGZsh{} print(\PYGZdq{}objectiveHistory:\PYGZdq{})}
\PYG{c+c1}{\PYGZsh{} for objective in objectiveHistory:}
\PYG{c+c1}{\PYGZsh{}     print(objective)}

\PYG{c+c1}{\PYGZsh{} Obtain the receiver\PYGZhy{}operating characteristic as a dataframe and areaUnderROC.}
\PYG{n}{trainingSummary}\PYG{o}{.}\PYG{n}{roc}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{areaUnderROC: }\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{trainingSummary}\PYG{o}{.}\PYG{n}{areaUnderROC}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set the model threshold to maximize F\PYGZhy{}Measure}
\PYG{n}{fMeasure} \PYG{o}{=} \PYG{n}{trainingSummary}\PYG{o}{.}\PYG{n}{fMeasureByThreshold}
\PYG{n}{maxFMeasure} \PYG{o}{=} \PYG{n}{fMeasure}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{F\PYGZhy{}Measure}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max(F\PYGZhy{}Measure)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} bestThreshold = fMeasure.where(fMeasure[\PYGZsq{}F\PYGZhy{}Measure\PYGZsq{}] == maxFMeasure[\PYGZsq{}max(F\PYGZhy{}Measure)\PYGZsq{}]) \PYGZbs{}}
\PYG{c+c1}{\PYGZsh{}     .select(\PYGZsq{}threshold\PYGZsq{}).head()[\PYGZsq{}threshold\PYGZsq{}]}
\PYG{c+c1}{\PYGZsh{} lr.setThreshold(bestThreshold)}
\end{sphinxVerbatim}

You can use \sphinxcode{\sphinxupquote{z.show()}} to get the data and plot the ROC curves:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{roc_z}.png}
\end{figure}

You can also register a TempTable \sphinxcode{\sphinxupquote{data.registerTempTable('roc\_data')}} and then
use \sphinxcode{\sphinxupquote{sql}} to plot the ROC curve:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{roc}.png}
\end{figure}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{9}
\item {} 
visualization

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.pyplot} \PYG{k+kn}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{itertools}

\PYG{k}{def} \PYG{n+nf}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{,}
                          \PYG{n}{normalize}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,}
                          \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                          \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{Blues}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    This function prints and plots the confusion matrix.}
\PYG{l+s+sd}{    Normalization can be applied by setting {}`normalize=True{}`.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{k}{if} \PYG{n}{normalize}\PYG{p}{:}
        \PYG{n}{cm} \PYG{o}{=} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{float}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{/} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{newaxis}\PYG{p}{]}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Normalized confusion matrix}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix, without normalization}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{print}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{,} \PYG{n}{interpolation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nearest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{cmap}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{n}{title}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{tick\PYGZus{}marks} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{classes}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{xticks}\PYG{p}{(}\PYG{n}{tick\PYGZus{}marks}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{,} \PYG{n}{rotation}\PYG{o}{=}\PYG{l+m+mi}{45}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{yticks}\PYG{p}{(}\PYG{n}{tick\PYGZus{}marks}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{)}

    \PYG{n}{fmt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.2f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{n}{normalize} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{d}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{thresh} \PYG{o}{=} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)} \PYG{o}{/} \PYG{l+m+mf}{2.}
    \PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n}{itertools}\PYG{o}{.}\PYG{n}{product}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{plt}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{j}\PYG{p}{,} \PYG{n}{i}\PYG{p}{,} \PYG{n}{format}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]}\PYG{p}{,} \PYG{n}{fmt}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{center}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                 \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{white}\PYG{l+s+s2}{\PYGZdq{}} \PYG{k}{if} \PYG{n}{cm}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{n}{thresh} \PYG{k}{else} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{black}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{True label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Predicted label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{class\PYGZus{}temp} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYGZbs{}
                        \PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{count}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ascending}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{class\PYGZus{}temp} \PYG{o}{=} \PYG{n}{class\PYGZus{}temp}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{o}{.}\PYG{n}{tolist}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{class\PYGZus{}names} \PYG{o}{=} \PYG{n+nb}{map}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{,} \PYG{n}{class\PYGZus{}temp}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} \PYGZsh{} \PYGZsh{} print(class\PYGZus{}name)}
\PYG{n}{class\PYGZus{}names}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{medium}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{high}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{low}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sklearn.metrics} \PYG{k+kn}{import} \PYG{n}{confusion\PYGZus{}matrix}
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{y\PYGZus{}true}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{y\PYGZus{}pred}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{cnf\PYGZus{}matrix} \PYG{o}{=} \PYG{n}{confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{y\PYGZus{}true}\PYG{p}{,} \PYG{n}{y\PYGZus{}pred}\PYG{p}{,}\PYG{n}{labels}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{)}
\PYG{n}{cnf\PYGZus{}matrix}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{526}\PYG{p}{,}  \PYG{l+m+mi}{11}\PYG{p}{,}   \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mi}{73}\PYG{p}{,}  \PYG{l+m+mi}{33}\PYG{p}{,}   \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mi}{38}\PYG{p}{,}   \PYG{l+m+mi}{0}\PYG{p}{,}   \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Plot non\PYGZhy{}normalized confusion matrix}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cnf\PYGZus{}matrix}\PYG{p}{,} \PYG{n}{classes}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{,}
                      \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix, without normalization}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Confusion} \PYG{n}{matrix}\PYG{p}{,} \PYG{n}{without} \PYG{n}{normalization}
\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{526}  \PYG{l+m+mi}{11}   \PYG{l+m+mi}{2}\PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mi}{73}  \PYG{l+m+mi}{33}   \PYG{l+m+mi}{0}\PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mi}{38}   \PYG{l+m+mi}{0}   \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{mlrconfu1}.png}
\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Plot normalized confusion matrix}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cnf\PYGZus{}matrix}\PYG{p}{,} \PYG{n}{classes}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{,} \PYG{n}{normalize}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,}
                      \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Normalized confusion matrix}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Normalized} \PYG{n}{confusion} \PYG{n}{matrix}
\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mf}{0.97588126} \PYG{l+m+mf}{0.02040816} \PYG{l+m+mf}{0.00371058}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.68867925} \PYG{l+m+mf}{0.31132075} \PYG{l+m+mf}{0.}        \PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.97435897} \PYG{l+m+mf}{0.}         \PYG{l+m+mf}{0.02564103}\PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{mlrconfu2}.png}
\end{figure}


\section{Decision tree Classification}
\label{\detokenize{classification:decision-tree-classification}}

\subsection{Introduction}
\label{\detokenize{classification:id5}}

\subsection{Demo}
\label{\detokenize{classification:id6}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/DecisionTreeC.ipynb}{Decision Tree Classification}.

\item {} 
For more details, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.classification.DecisionTreeClassifier.html}{DecisionTreeClassifier API} .

\end{itemize}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

        \PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark Decision Tree classification}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                               \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYGZbs{}
                \PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{../data/WineData2.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{fixed}\PYG{o}{\textbar{}}\PYG{n}{volatile}\PYG{o}{\textbar{}}\PYG{n}{citric}\PYG{o}{\textbar{}}\PYG{n}{sugar}\PYG{o}{\textbar{}}\PYG{n}{chlorides}\PYG{o}{\textbar{}}\PYG{n}{free}\PYG{o}{\textbar{}}\PYG{n}{total}\PYG{o}{\textbar{}}\PYG{n}{density}\PYG{o}{\textbar{}}  \PYG{n}{pH}\PYG{o}{\textbar{}}\PYG{n}{sulphates}\PYG{o}{\textbar{}}\PYG{n}{alcohol}\PYG{o}{\textbar{}}\PYG{n}{quality}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.88}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.6}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.098}\PYG{o}{\textbar{}}\PYG{l+m+mf}{25.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{67.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9968}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.68}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.76}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.04}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.3}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.092}\PYG{o}{\textbar{}}\PYG{l+m+mf}{15.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{54.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.997}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.65}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{11.2}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.28}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.075}\PYG{o}{\textbar{}}\PYG{l+m+mf}{17.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{60.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.998}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.16}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.58}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Convert to float format}
\PYG{k}{def} \PYG{n+nf}{string\PYGZus{}to\PYGZus{}float}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}}
\PYG{k}{def} \PYG{n+nf}{condition}\PYG{p}{(}\PYG{n}{r}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{p}{(}\PYG{l+m+mi}{0}\PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{r} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{low}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{elif}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{o}{\PYGZlt{}} \PYG{n}{r} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{medium}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{high}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{return} \PYG{n}{label}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{udf}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StringType}\PYG{p}{,} \PYG{n}{DoubleType}
\PYG{n}{string\PYGZus{}to\PYGZus{}float\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{string\PYGZus{}to\PYGZus{}float}\PYG{p}{,} \PYG{n}{DoubleType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{quality\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{condition}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{quality}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{quality\PYGZus{}udf}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{quality}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{fixed}\PYG{o}{\textbar{}}\PYG{n}{volatile}\PYG{o}{\textbar{}}\PYG{n}{citric}\PYG{o}{\textbar{}}\PYG{n}{sugar}\PYG{o}{\textbar{}}\PYG{n}{chlorides}\PYG{o}{\textbar{}}\PYG{n}{free}\PYG{o}{\textbar{}}\PYG{n}{total}\PYG{o}{\textbar{}}\PYG{n}{density}\PYG{o}{\textbar{}}  \PYG{n}{pH}\PYG{o}{\textbar{}}\PYG{n}{sulphates}\PYG{o}{\textbar{}}\PYG{n}{alcohol}\PYG{o}{\textbar{}}\PYG{n}{quality}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.88}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.6}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.098}\PYG{o}{\textbar{}}\PYG{l+m+mf}{25.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{67.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9968}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.68}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.76}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.04}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.3}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.092}\PYG{o}{\textbar{}}\PYG{l+m+mf}{15.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{54.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.997}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.65}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{11.2}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.28}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.075}\PYG{o}{\textbar{}}\PYG{l+m+mf}{17.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{60.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.998}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.16}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.58}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{fixed}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{volatile}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{citric}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sugar}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{chlorides}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{free}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{total}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{density}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{pH}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sulphates}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{alcohol}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{quality}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Convert the data to dense vector

\end{enumerate}

\begin{sphinxadmonition}{note}{Note:}
You are strongly encouraged to try my \sphinxcode{\sphinxupquote{get\_dummy}} function for dealing with the categorical data in complex dataset.

Supervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Unsupervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Get dummy variables and concat with continuous variables for unsupervised learning.}
\PYG{l+s+sd}{    :param df: the dataframe}
\PYG{l+s+sd}{    :param categoricalCols: the name list of the categorical data}
\PYG{l+s+sd}{    :param continuousCols:  the name list of the numerical data}
\PYG{l+s+sd}{    :return k: feature matrix}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  von198@gmail.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} !!!!caution: not from pyspark.mllib.linalg import Vectors}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{IndexToString}\PYG{p}{,}\PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{VectorIndexer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.tuning} \PYG{k+kn}{import} \PYG{n}{CrossValidator}\PYG{p}{,} \PYG{n}{ParamGridBuilder}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{MulticlassClassificationEvaluator}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{n}{r}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Transform the dataset to DataFrame

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{transformed} \PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Deal with Categorical Label and Variables

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Index labels, adding metadata to the label column}
\PYG{n}{labelIndexer} \PYG{o}{=} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedLabel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\PYG{n}{labelIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{indexedLabel}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
    \PYG{c+c1}{\PYGZsh{} Automatically identify categorical features, and index them.}
    \PYG{c+c1}{\PYGZsh{} Set maxCategories so features with \PYGZgt{} 4 distinct values are treated as continuous.}
    \PYG{n}{featureIndexer} \PYG{o}{=}\PYG{n}{VectorIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                                  \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                                  \PYG{n}{maxCategories}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\PYG{n}{featureIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}     \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Split the data to training and test data sets

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Split the data into training and test sets (40\PYGZpc{} held out for testing)}
\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{,} \PYG{n}{testData}\PYG{p}{)} \PYG{o}{=} \PYG{n}{transformed}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{trainingData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{testData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{0.52}\PYG{p}{,}\PYG{l+m+mf}{0.15}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.7}\PYG{p}{,}\PYG{l+m+mf}{0.6}\PYG{p}{,}\PYG{l+m+mf}{0.17}\PYG{p}{,}\PYG{l+m+mf}{2.3}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1.02}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1.04}\PYG{p}{,}\PYG{l+m+mf}{0.24}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.1}\PYG{p}{,}\PYG{l+m+mf}{0.585}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{high}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{high}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.38}\PYG{p}{,}\PYG{l+m+mf}{0.01}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{,}\PYG{l+m+mf}{0.5}\PYG{p}{,}\PYG{l+m+mf}{4.3}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.24}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{high}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.74}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.2}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
Fit Decision Tree Classification Model

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.classification} \PYG{k+kn}{import} \PYG{n}{DecisionTreeClassifier}

\PYG{c+c1}{\PYGZsh{} Train a DecisionTree model}
\PYG{n}{dTree} \PYG{o}{=} \PYG{n}{DecisionTreeClassifier}\PYG{p}{(}\PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedLabel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{featuresCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedFeatures}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
Pipeline Architecture

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Convert indexed labels back to original labels.}
\PYG{n}{labelConverter} \PYG{o}{=} \PYG{n}{IndexToString}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                               \PYG{n}{labels}\PYG{o}{=}\PYG{n}{labelIndexer}\PYG{o}{.}\PYG{n}{labels}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Chain indexers and tree in a Pipeline}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{labelIndexer}\PYG{p}{,} \PYG{n}{featureIndexer}\PYG{p}{,} \PYG{n}{dTree}\PYG{p}{,}\PYG{n}{labelConverter}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Train model.  This also runs the indexers.}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{8}
\item {} 
Make predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Make predictions.}
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testData}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Select example rows to display.}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{predictedLabel}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{high}\PYG{o}{\textbar{}}          \PYG{n}{high}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.38}\PYG{p}{,}\PYG{l+m+mf}{0.01}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}        \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{,}\PYG{l+m+mf}{0.5}\PYG{p}{,}\PYG{l+m+mf}{4.3}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}        \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.24}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{high}\PYG{o}{\textbar{}}        \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.74}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.2}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}        \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{9}
\item {} 
Evaluation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{MulticlassClassificationEvaluator}

\PYG{c+c1}{\PYGZsh{} Select (prediction, true label) and compute test error}
\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{MulticlassClassificationEvaluator}\PYG{p}{(}
    \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{metricName}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{accuracy}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{accuracy} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Test Error = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{l+m+mf}{1.0} \PYG{o}{\PYGZhy{}} \PYG{n}{accuracy}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{rfModel} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}\PYG{p}{]}
\PYG{k}{print}\PYG{p}{(}\PYG{n}{rfModel}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} summary only}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Test} \PYG{n}{Error} \PYG{o}{=} \PYG{l+m+mf}{0.45509}
\PYG{n}{DecisionTreeClassificationModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{DecisionTreeClassifier\PYGZus{}4545ac8dca9c8438ef2a}\PYG{p}{)}
\PYG{n}{of} \PYG{n}{depth} \PYG{l+m+mi}{5} \PYG{k}{with} \PYG{l+m+mi}{59} \PYG{n}{nodes}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{10}
\item {} 
visualization

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.pyplot} \PYG{k+kn}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{itertools}

\PYG{k}{def} \PYG{n+nf}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{,}
                          \PYG{n}{normalize}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,}
                          \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                          \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{Blues}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    This function prints and plots the confusion matrix.}
\PYG{l+s+sd}{    Normalization can be applied by setting {}`normalize=True{}`.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{k}{if} \PYG{n}{normalize}\PYG{p}{:}
        \PYG{n}{cm} \PYG{o}{=} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{float}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{/} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{newaxis}\PYG{p}{]}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Normalized confusion matrix}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix, without normalization}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{print}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{,} \PYG{n}{interpolation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nearest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{cmap}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{n}{title}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{tick\PYGZus{}marks} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{classes}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{xticks}\PYG{p}{(}\PYG{n}{tick\PYGZus{}marks}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{,} \PYG{n}{rotation}\PYG{o}{=}\PYG{l+m+mi}{45}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{yticks}\PYG{p}{(}\PYG{n}{tick\PYGZus{}marks}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{)}

    \PYG{n}{fmt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.2f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{n}{normalize} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{d}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{thresh} \PYG{o}{=} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)} \PYG{o}{/} \PYG{l+m+mf}{2.}
    \PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n}{itertools}\PYG{o}{.}\PYG{n}{product}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{plt}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{j}\PYG{p}{,} \PYG{n}{i}\PYG{p}{,} \PYG{n}{format}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]}\PYG{p}{,} \PYG{n}{fmt}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{center}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                 \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{white}\PYG{l+s+s2}{\PYGZdq{}} \PYG{k}{if} \PYG{n}{cm}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{n}{thresh} \PYG{k}{else} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{black}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{True label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Predicted label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{class\PYGZus{}temp} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYGZbs{}
                        \PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{count}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ascending}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{class\PYGZus{}temp} \PYG{o}{=} \PYG{n}{class\PYGZus{}temp}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{o}{.}\PYG{n}{tolist}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{class\PYGZus{}names} \PYG{o}{=} \PYG{n+nb}{map}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{,} \PYG{n}{class\PYGZus{}temp}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} \PYGZsh{} \PYGZsh{} print(class\PYGZus{}name)}
\PYG{n}{class\PYGZus{}names}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{medium}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{high}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{low}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sklearn.metrics} \PYG{k+kn}{import} \PYG{n}{confusion\PYGZus{}matrix}
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{y\PYGZus{}true}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{y\PYGZus{}pred}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{cnf\PYGZus{}matrix} \PYG{o}{=} \PYG{n}{confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{y\PYGZus{}true}\PYG{p}{,} \PYG{n}{y\PYGZus{}pred}\PYG{p}{,}\PYG{n}{labels}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{)}
\PYG{n}{cnf\PYGZus{}matrix}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{497}\PYG{p}{,}  \PYG{l+m+mi}{29}\PYG{p}{,}   \PYG{l+m+mi}{7}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mi}{40}\PYG{p}{,}  \PYG{l+m+mi}{42}\PYG{p}{,}   \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mi}{22}\PYG{p}{,}   \PYG{l+m+mi}{0}\PYG{p}{,}   \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Plot non\PYGZhy{}normalized confusion matrix}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cnf\PYGZus{}matrix}\PYG{p}{,} \PYG{n}{classes}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{,}
                      \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix, without normalization}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Confusion} \PYG{n}{matrix}\PYG{p}{,} \PYG{n}{without} \PYG{n}{normalization}
\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{497}  \PYG{l+m+mi}{29}   \PYG{l+m+mi}{7}\PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mi}{40}  \PYG{l+m+mi}{42}   \PYG{l+m+mi}{0}\PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mi}{22}   \PYG{l+m+mi}{0}   \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{dt_cm_c3}.png}
\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Plot normalized confusion matrix}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cnf\PYGZus{}matrix}\PYG{p}{,} \PYG{n}{classes}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{,} \PYG{n}{normalize}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,}
                      \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Normalized confusion matrix}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Normalized} \PYG{n}{confusion} \PYG{n}{matrix}
\PYG{p}{[}\PYG{p}{[} \PYG{l+m+mf}{0.93245779}  \PYG{l+m+mf}{0.05440901}  \PYG{l+m+mf}{0.01313321}\PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mf}{0.48780488}  \PYG{l+m+mf}{0.51219512}  \PYG{l+m+mf}{0.}        \PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mf}{0.91666667}  \PYG{l+m+mf}{0.}          \PYG{l+m+mf}{0.08333333}\PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{dt_cm_c3}.png}
\end{figure}


\section{Random forest Classification}
\label{\detokenize{classification:random-forest-classification}}

\subsection{Introduction}
\label{\detokenize{classification:id8}}



\subsection{Demo}
\label{\detokenize{classification:id9}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/RandomForestC3.ipynb}{Random forest Classification}.

\item {} 
For more details, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.classification.RandomForestClassifier.html}{RandomForestClassifier API} .

\end{itemize}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

        \PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark Decision Tree classification}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                               \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYGZbs{}
                \PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{../data/WineData2.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{fixed}\PYG{o}{\textbar{}}\PYG{n}{volatile}\PYG{o}{\textbar{}}\PYG{n}{citric}\PYG{o}{\textbar{}}\PYG{n}{sugar}\PYG{o}{\textbar{}}\PYG{n}{chlorides}\PYG{o}{\textbar{}}\PYG{n}{free}\PYG{o}{\textbar{}}\PYG{n}{total}\PYG{o}{\textbar{}}\PYG{n}{density}\PYG{o}{\textbar{}}  \PYG{n}{pH}\PYG{o}{\textbar{}}\PYG{n}{sulphates}\PYG{o}{\textbar{}}\PYG{n}{alcohol}\PYG{o}{\textbar{}}\PYG{n}{quality}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.88}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.6}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.098}\PYG{o}{\textbar{}}\PYG{l+m+mf}{25.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{67.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9968}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.68}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.76}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.04}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.3}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.092}\PYG{o}{\textbar{}}\PYG{l+m+mf}{15.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{54.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.997}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.65}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{11.2}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.28}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.075}\PYG{o}{\textbar{}}\PYG{l+m+mf}{17.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{60.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.998}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.16}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.58}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Convert to float format}
\PYG{k}{def} \PYG{n+nf}{string\PYGZus{}to\PYGZus{}float}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}}
\PYG{k}{def} \PYG{n+nf}{condition}\PYG{p}{(}\PYG{n}{r}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{p}{(}\PYG{l+m+mi}{0}\PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{r} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{low}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{elif}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{o}{\PYGZlt{}} \PYG{n}{r} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{medium}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{high}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{return} \PYG{n}{label}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{udf}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StringType}\PYG{p}{,} \PYG{n}{DoubleType}
\PYG{n}{string\PYGZus{}to\PYGZus{}float\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{string\PYGZus{}to\PYGZus{}float}\PYG{p}{,} \PYG{n}{DoubleType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{quality\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{condition}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{quality}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{quality\PYGZus{}udf}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{quality}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{fixed}\PYG{o}{\textbar{}}\PYG{n}{volatile}\PYG{o}{\textbar{}}\PYG{n}{citric}\PYG{o}{\textbar{}}\PYG{n}{sugar}\PYG{o}{\textbar{}}\PYG{n}{chlorides}\PYG{o}{\textbar{}}\PYG{n}{free}\PYG{o}{\textbar{}}\PYG{n}{total}\PYG{o}{\textbar{}}\PYG{n}{density}\PYG{o}{\textbar{}}  \PYG{n}{pH}\PYG{o}{\textbar{}}\PYG{n}{sulphates}\PYG{o}{\textbar{}}\PYG{n}{alcohol}\PYG{o}{\textbar{}}\PYG{n}{quality}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.88}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.6}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.098}\PYG{o}{\textbar{}}\PYG{l+m+mf}{25.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{67.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9968}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.68}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.76}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.04}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.3}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.092}\PYG{o}{\textbar{}}\PYG{l+m+mf}{15.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{54.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.997}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.65}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{11.2}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.28}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.075}\PYG{o}{\textbar{}}\PYG{l+m+mf}{17.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{60.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.998}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.16}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.58}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{fixed}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{volatile}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{citric}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sugar}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{chlorides}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{free}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{total}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{density}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{pH}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sulphates}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{alcohol}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{quality}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Convert the data to dense vector

\end{enumerate}

\begin{sphinxadmonition}{note}{Note:}
You are strongly encouraged to try my \sphinxcode{\sphinxupquote{get\_dummy}} function for dealing with the categorical data in complex dataset.

Supervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Unsupervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Get dummy variables and concat with continuous variables for unsupervised learning.}
\PYG{l+s+sd}{    :param df: the dataframe}
\PYG{l+s+sd}{    :param categoricalCols: the name list of the categorical data}
\PYG{l+s+sd}{    :param continuousCols:  the name list of the numerical data}
\PYG{l+s+sd}{    :return k: feature matrix}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  von198@gmail.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} !!!!caution: not from pyspark.mllib.linalg import Vectors}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{IndexToString}\PYG{p}{,}\PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{VectorIndexer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.tuning} \PYG{k+kn}{import} \PYG{n}{CrossValidator}\PYG{p}{,} \PYG{n}{ParamGridBuilder}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{MulticlassClassificationEvaluator}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{n}{r}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Transform the dataset to DataFrame

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{transformed} \PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Deal with Categorical Label and Variables

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Index labels, adding metadata to the label column}
\PYG{n}{labelIndexer} \PYG{o}{=} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedLabel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\PYG{n}{labelIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{indexedLabel}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
    \PYG{c+c1}{\PYGZsh{} Automatically identify categorical features, and index them.}
    \PYG{c+c1}{\PYGZsh{} Set maxCategories so features with \PYGZgt{} 4 distinct values are treated as continuous.}
    \PYG{n}{featureIndexer} \PYG{o}{=}\PYG{n}{VectorIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                                  \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                                  \PYG{n}{maxCategories}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\PYG{n}{featureIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}     \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Split the data to training and test data sets

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Split the data into training and test sets (40\PYGZpc{} held out for testing)}
\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{,} \PYG{n}{testData}\PYG{p}{)} \PYG{o}{=} \PYG{n}{transformed}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{trainingData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{testData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{0.52}\PYG{p}{,}\PYG{l+m+mf}{0.15}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.7}\PYG{p}{,}\PYG{l+m+mf}{0.6}\PYG{p}{,}\PYG{l+m+mf}{0.17}\PYG{p}{,}\PYG{l+m+mf}{2.3}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1.02}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1.04}\PYG{p}{,}\PYG{l+m+mf}{0.24}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.1}\PYG{p}{,}\PYG{l+m+mf}{0.585}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{high}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{high}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.38}\PYG{p}{,}\PYG{l+m+mf}{0.01}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{,}\PYG{l+m+mf}{0.5}\PYG{p}{,}\PYG{l+m+mf}{4.3}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.24}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{high}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.74}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.2}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
Fit Random Forest Classification Model

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.classification} \PYG{k+kn}{import} \PYG{n}{RandomForestClassifier}

\PYG{c+c1}{\PYGZsh{} Train a RandomForest model.}
\PYG{n}{rf} \PYG{o}{=} \PYG{n}{RandomForestClassifier}\PYG{p}{(}\PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{featuresCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{numTrees}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
Pipeline Architecture

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Convert indexed labels back to original labels.}
\PYG{n}{labelConverter} \PYG{o}{=} \PYG{n}{IndexToString}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                               \PYG{n}{labels}\PYG{o}{=}\PYG{n}{labelIndexer}\PYG{o}{.}\PYG{n}{labels}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Chain indexers and tree in a Pipeline}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{labelIndexer}\PYG{p}{,} \PYG{n}{featureIndexer}\PYG{p}{,} \PYG{n}{rf}\PYG{p}{,}\PYG{n}{labelConverter}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Train model.  This also runs the indexers.}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{8}
\item {} 
Make predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Make predictions.}
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testData}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Select example rows to display.}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}} \PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{predictedLabel}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{high}\PYG{o}{\textbar{}}          \PYG{n}{high}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.38}\PYG{p}{,}\PYG{l+m+mf}{0.01}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}        \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{,}\PYG{l+m+mf}{0.5}\PYG{p}{,}\PYG{l+m+mf}{4.3}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}        \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.24}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{high}\PYG{o}{\textbar{}}        \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.74}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.2}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{medium}\PYG{o}{\textbar{}}        \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{9}
\item {} 
Evaluation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{MulticlassClassificationEvaluator}

\PYG{c+c1}{\PYGZsh{} Select (prediction, true label) and compute test error}
\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{MulticlassClassificationEvaluator}\PYG{p}{(}
    \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{metricName}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{accuracy}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{accuracy} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Test Error = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{l+m+mf}{1.0} \PYG{o}{\PYGZhy{}} \PYG{n}{accuracy}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{rfModel} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}\PYG{p}{]}
\PYG{k}{print}\PYG{p}{(}\PYG{n}{rfModel}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} summary only}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Test} \PYG{n}{Error} \PYG{o}{=} \PYG{l+m+mf}{0.173502}
\PYG{n}{RandomForestClassificationModel} \PYG{p}{(}\PYG{n}{uid}\PYG{o}{=}\PYG{n}{rfc\PYGZus{}a3395531f1d2}\PYG{p}{)} \PYG{k}{with} \PYG{l+m+mi}{10} \PYG{n}{trees}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{10}
\item {} 
visualization

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.pyplot} \PYG{k+kn}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{itertools}

\PYG{k}{def} \PYG{n+nf}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{,}
                          \PYG{n}{normalize}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,}
                          \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                          \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{Blues}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    This function prints and plots the confusion matrix.}
\PYG{l+s+sd}{    Normalization can be applied by setting {}`normalize=True{}`.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{k}{if} \PYG{n}{normalize}\PYG{p}{:}
        \PYG{n}{cm} \PYG{o}{=} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{float}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{/} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{newaxis}\PYG{p}{]}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Normalized confusion matrix}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix, without normalization}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{print}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{,} \PYG{n}{interpolation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nearest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{cmap}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{n}{title}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{tick\PYGZus{}marks} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{classes}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{xticks}\PYG{p}{(}\PYG{n}{tick\PYGZus{}marks}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{,} \PYG{n}{rotation}\PYG{o}{=}\PYG{l+m+mi}{45}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{yticks}\PYG{p}{(}\PYG{n}{tick\PYGZus{}marks}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{)}

    \PYG{n}{fmt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.2f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{n}{normalize} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{d}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{thresh} \PYG{o}{=} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)} \PYG{o}{/} \PYG{l+m+mf}{2.}
    \PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n}{itertools}\PYG{o}{.}\PYG{n}{product}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{plt}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{j}\PYG{p}{,} \PYG{n}{i}\PYG{p}{,} \PYG{n}{format}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]}\PYG{p}{,} \PYG{n}{fmt}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{center}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                 \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{white}\PYG{l+s+s2}{\PYGZdq{}} \PYG{k}{if} \PYG{n}{cm}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{n}{thresh} \PYG{k}{else} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{black}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{True label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Predicted label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{class\PYGZus{}temp} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYGZbs{}
                        \PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{count}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ascending}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{class\PYGZus{}temp} \PYG{o}{=} \PYG{n}{class\PYGZus{}temp}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{o}{.}\PYG{n}{tolist}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{class\PYGZus{}names} \PYG{o}{=} \PYG{n+nb}{map}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{,} \PYG{n}{class\PYGZus{}temp}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} \PYGZsh{} \PYGZsh{} print(class\PYGZus{}name)}
\PYG{n}{class\PYGZus{}names}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{medium}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{high}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{low}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sklearn.metrics} \PYG{k+kn}{import} \PYG{n}{confusion\PYGZus{}matrix}
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{y\PYGZus{}true}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{y\PYGZus{}pred}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{cnf\PYGZus{}matrix} \PYG{o}{=} \PYG{n}{confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{y\PYGZus{}true}\PYG{p}{,} \PYG{n}{y\PYGZus{}pred}\PYG{p}{,}\PYG{n}{labels}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{)}
\PYG{n}{cnf\PYGZus{}matrix}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{502}\PYG{p}{,}   \PYG{l+m+mi}{9}\PYG{p}{,}   \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mi}{73}\PYG{p}{,}  \PYG{l+m+mi}{22}\PYG{p}{,}   \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mi}{28}\PYG{p}{,}   \PYG{l+m+mi}{0}\PYG{p}{,}   \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Plot non\PYGZhy{}normalized confusion matrix}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cnf\PYGZus{}matrix}\PYG{p}{,} \PYG{n}{classes}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{,}
                      \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix, without normalization}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Confusion} \PYG{n}{matrix}\PYG{p}{,} \PYG{n}{without} \PYG{n}{normalization}
\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{502}   \PYG{l+m+mi}{9}   \PYG{l+m+mi}{0}\PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mi}{73}  \PYG{l+m+mi}{22}   \PYG{l+m+mi}{0}\PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mi}{28}   \PYG{l+m+mi}{0}   \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{rf_cm_c3}.png}
\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Plot normalized confusion matrix}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cnf\PYGZus{}matrix}\PYG{p}{,} \PYG{n}{classes}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{,} \PYG{n}{normalize}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,}
                      \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Normalized confusion matrix}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Normalized} \PYG{n}{confusion} \PYG{n}{matrix}
\PYG{p}{[}\PYG{p}{[} \PYG{l+m+mf}{0.98238748}  \PYG{l+m+mf}{0.01761252}  \PYG{l+m+mf}{0.}        \PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mf}{0.76842105}  \PYG{l+m+mf}{0.23157895}  \PYG{l+m+mf}{0.}        \PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mf}{1.}          \PYG{l+m+mf}{0.}          \PYG{l+m+mf}{0.}        \PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{rf_cm_c3}.png}
\end{figure}


\section{Gradient-boosted tree Classification}
\label{\detokenize{classification:gradient-boosted-tree-classification}}

\subsection{Introduction}
\label{\detokenize{classification:id11}}



\subsection{Demo}
\label{\detokenize{classification:id12}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/gbtC3.ipynb}{Gradient boosted tree Classification}.

\item {} 
For more details, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.classification.GBTClassifier.html}{GBTClassifier API} .

\end{itemize}

\begin{sphinxadmonition}{warning}{Warning:}
Unfortunately, the GBTClassifier currently only supports binary labels.
\end{sphinxadmonition}


\section{XGBoost: Gradient-boosted tree Classification}
\label{\detokenize{classification:xgboost-gradient-boosted-tree-classification}}

\subsection{Introduction}
\label{\detokenize{classification:id14}}

\subsection{Demo}
\label{\detokenize{classification:id15}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/gbtC3.ipynb}{Gradient boosted tree Classification}.

\item {} 
For more details, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.classification.GBTClassifier.html}{GBTClassifier API} .

\end{itemize}

\begin{sphinxadmonition}{warning}{Warning:}
Unfortunately, I didn’t find a good way to setup the XGBoost directly in Spark. But I do get the XGBoost work with \sphinxcode{\sphinxupquote{pysparkling}}
on my machine.
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Start H2O cluster inside the Spark environment

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pysparkling} \PYG{k+kn}{import} \PYG{o}{*}
\PYG{n}{hc} \PYG{o}{=} \PYG{n}{H2OContext}\PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{n}{spark}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Connecting} \PYG{n}{to} \PYG{n}{H2O} \PYG{n}{server} \PYG{n}{at} \PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mf}{192.168}\PYG{o}{.}\PYG{l+m+mf}{0.102}\PYG{p}{:}\PYG{l+m+mf}{54323.}\PYG{o}{.}\PYG{o}{.} \PYG{n}{successful}\PYG{o}{.}
\PYG{n}{H2O} \PYG{n}{cluster} \PYG{n}{uptime}\PYG{p}{:}     \PYG{l+m+mo}{07} \PYG{n}{secs}
\PYG{n}{H2O} \PYG{n}{cluster} \PYG{n}{timezone}\PYG{p}{:}   \PYG{n}{America}\PYG{o}{/}\PYG{n}{Chicago}
\PYG{n}{H2O} \PYG{n}{data} \PYG{n}{parsing} \PYG{n}{timezone}\PYG{p}{:}      \PYG{n}{UTC}
\PYG{n}{H2O} \PYG{n}{cluster} \PYG{n}{version}\PYG{p}{:}    \PYG{l+m+mf}{3.22}\PYG{o}{.}\PYG{l+m+mf}{1.3}
\PYG{n}{H2O} \PYG{n}{cluster} \PYG{n}{version} \PYG{n}{age}\PYG{p}{:}        \PYG{l+m+mi}{20} \PYG{n}{days}
\PYG{n}{H2O} \PYG{n}{cluster} \PYG{n}{name}\PYG{p}{:}       \PYG{n}{sparkling}\PYG{o}{\PYGZhy{}}\PYG{n}{water}\PYG{o}{\PYGZhy{}}\PYG{n}{dt216661\PYGZus{}local}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1550259209801}
\PYG{n}{H2O} \PYG{n}{cluster} \PYG{n}{total} \PYG{n}{nodes}\PYG{p}{:}        \PYG{l+m+mi}{1}
\PYG{n}{H2O} \PYG{n}{cluster} \PYG{n}{free} \PYG{n}{memory}\PYG{p}{:}        \PYG{l+m+mi}{848} \PYG{n}{Mb}
\PYG{n}{H2O} \PYG{n}{cluster} \PYG{n}{total} \PYG{n}{cores}\PYG{p}{:}        \PYG{l+m+mi}{8}
\PYG{n}{H2O} \PYG{n}{cluster} \PYG{n}{allowed} \PYG{n}{cores}\PYG{p}{:}      \PYG{l+m+mi}{8}
\PYG{n}{H2O} \PYG{n}{cluster} \PYG{n}{status}\PYG{p}{:}     \PYG{n}{accepting} \PYG{n}{new} \PYG{n}{members}\PYG{p}{,} \PYG{n}{healthy}
\PYG{n}{H2O} \PYG{n}{connection} \PYG{n}{url}\PYG{p}{:}     \PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mf}{192.168}\PYG{o}{.}\PYG{l+m+mf}{0.102}\PYG{p}{:}\PYG{l+m+mi}{54323}
\PYG{n}{H2O} \PYG{n}{connection} \PYG{n}{proxy}\PYG{p}{:}   \PYG{n+nb+bp}{None}
\PYG{n}{H2O} \PYG{n}{internal} \PYG{n}{security}\PYG{p}{:}  \PYG{n+nb+bp}{False}
\PYG{n}{H2O} \PYG{n}{API} \PYG{n}{Extensions}\PYG{p}{:}     \PYG{n}{XGBoost}\PYG{p}{,} \PYG{n}{Algos}\PYG{p}{,} \PYG{n}{AutoML}\PYG{p}{,} \PYG{n}{Core} \PYG{n}{V3}\PYG{p}{,} \PYG{n}{Core} \PYG{n}{V4}
\PYG{n}{Python} \PYG{n}{version}\PYG{p}{:} \PYG{l+m+mf}{3.7}\PYG{o}{.}\PYG{l+m+mi}{1} \PYG{n}{final}

\PYG{n}{Sparkling} \PYG{n}{Water} \PYG{n}{Context}\PYG{p}{:}
 \PYG{o}{*} \PYG{n}{H2O} \PYG{n}{name}\PYG{p}{:} \PYG{n}{sparkling}\PYG{o}{\PYGZhy{}}\PYG{n}{water}\PYG{o}{\PYGZhy{}}\PYG{n}{dt216661\PYGZus{}local}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1550259209801}
 \PYG{o}{*} \PYG{n}{cluster} \PYG{n}{size}\PYG{p}{:} \PYG{l+m+mi}{1}
 \PYG{o}{*} \PYG{n+nb}{list} \PYG{n}{of} \PYG{n}{used} \PYG{n}{nodes}\PYG{p}{:}
  \PYG{p}{(}\PYG{n}{executorId}\PYG{p}{,} \PYG{n}{host}\PYG{p}{,} \PYG{n}{port}\PYG{p}{)}
  \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}
  \PYG{p}{(}\PYG{n}{driver}\PYG{p}{,}\PYG{l+m+mf}{192.168}\PYG{o}{.}\PYG{l+m+mf}{0.102}\PYG{p}{,}\PYG{l+m+mi}{54323}\PYG{p}{)}
  \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}

  \PYG{n}{Open} \PYG{n}{H2O} \PYG{n}{Flow} \PYG{o+ow}{in} \PYG{n}{browser}\PYG{p}{:} \PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mf}{192.168}\PYG{o}{.}\PYG{l+m+mf}{0.102}\PYG{p}{:}\PYG{l+m+mi}{54323} \PYG{p}{(}\PYG{n}{CMD} \PYG{o}{+} \PYG{n}{click} \PYG{o+ow}{in} \PYG{n}{Mac} \PYG{n}{OSX}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Parse the data using H2O and convert them to Spark Frame

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{h2o}
\PYG{n}{frame} \PYG{o}{=} \PYG{n}{h2o}\PYG{o}{.}\PYG{n}{import\PYGZus{}file}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://raw.githubusercontent.com/h2oai/sparkling\PYGZhy{}water/master/examples/smalldata/prostate/prostate.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{spark\PYGZus{}frame} \PYG{o}{=} \PYG{n}{hc}\PYG{o}{.}\PYG{n}{as\PYGZus{}spark\PYGZus{}frame}\PYG{p}{(}\PYG{n}{frame}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{sparling_process}.png}
\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{spark\PYGZus{}frame}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{n}{ID}\PYG{o}{\textbar{}}\PYG{n}{CAPSULE}\PYG{o}{\textbar{}}\PYG{n}{AGE}\PYG{o}{\textbar{}}\PYG{n}{RACE}\PYG{o}{\textbar{}}\PYG{n}{DPROS}\PYG{o}{\textbar{}}\PYG{n}{DCAPS}\PYG{o}{\textbar{}} \PYG{n}{PSA}\PYG{o}{\textbar{}} \PYG{n}{VOL}\PYG{o}{\textbar{}}\PYG{n}{GLEASON}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{l+m+mi}{65}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{1.4}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{l+m+mi}{72}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{6.7}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{7}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{l+m+mi}{70}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{4.9}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{l+m+mi}{76}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{51.2}\PYG{o}{\textbar{}}\PYG{l+m+mf}{20.0}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{7}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Train the model

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pysparkling.ml} \PYG{k+kn}{import} \PYG{n}{H2OXGBoost}
\PYG{n}{estimator} \PYG{o}{=} \PYG{n}{H2OXGBoost}\PYG{p}{(}\PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{AGE}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{estimator}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{spark\PYGZus{}frame}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Run Predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{spark\PYGZus{}frame}\PYG{p}{)}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{n}{ID}\PYG{o}{\textbar{}}\PYG{n}{CAPSULE}\PYG{o}{\textbar{}}\PYG{n}{AGE}\PYG{o}{\textbar{}}\PYG{n}{RACE}\PYG{o}{\textbar{}}\PYG{n}{DPROS}\PYG{o}{\textbar{}}\PYG{n}{DCAPS}\PYG{o}{\textbar{}} \PYG{n}{PSA}\PYG{o}{\textbar{}} \PYG{n}{VOL}\PYG{o}{\textbar{}}\PYG{n}{GLEASON}\PYG{o}{\textbar{}}  \PYG{n}{prediction\PYGZus{}output}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{l+m+mi}{65}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}} \PYG{l+m+mf}{1.4}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{64.85852813720703}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{l+m+mi}{72}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{6.7}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{7}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{72.0611801147461}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{l+m+mi}{70}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}} \PYG{l+m+mf}{4.9}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{70.26496887207031}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{l+m+mi}{76}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{51.2}\PYG{o}{\textbar{}}\PYG{l+m+mf}{20.0}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{7}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{75.26521301269531}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}


\section{Naive Bayes Classification}
\label{\detokenize{classification:naive-bayes-classification}}

\subsection{Introduction}
\label{\detokenize{classification:id17}}

\subsection{Demo}
\label{\detokenize{classification:id18}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/NaiveBayes.ipynb}{Naive Bayes Classification}.

\item {} 
For more details, please visit \sphinxhref{http://takwatanabe.me/pyspark/generated/generated/ml.classification.NaiveBayes.html}{NaiveBayes API} .

\end{itemize}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark  Naive Bayes classification}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{./data/WineData2.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{fixed}\PYG{o}{\textbar{}}\PYG{n}{volatile}\PYG{o}{\textbar{}}\PYG{n}{citric}\PYG{o}{\textbar{}}\PYG{n}{sugar}\PYG{o}{\textbar{}}\PYG{n}{chlorides}\PYG{o}{\textbar{}}\PYG{n}{free}\PYG{o}{\textbar{}}\PYG{n}{total}\PYG{o}{\textbar{}}\PYG{n}{density}\PYG{o}{\textbar{}}  \PYG{n}{pH}\PYG{o}{\textbar{}}\PYG{n}{sulphates}\PYG{o}{\textbar{}}\PYG{n}{alcohol}\PYG{o}{\textbar{}}\PYG{n}{quality}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.88}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.6}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.098}\PYG{o}{\textbar{}}\PYG{l+m+mf}{25.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{67.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9968}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.68}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.76}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.04}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.3}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.092}\PYG{o}{\textbar{}}\PYG{l+m+mf}{15.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{54.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.997}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.65}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{11.2}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.28}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.075}\PYG{o}{\textbar{}}\PYG{l+m+mf}{17.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{60.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.998}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.16}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.58}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{fixed}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{volatile}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{citric}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sugar}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{chlorides}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{free}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{total}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{density}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{pH}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sulphates}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{alcohol}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{quality}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Convert to float format}
\PYG{k}{def} \PYG{n+nf}{string\PYGZus{}to\PYGZus{}float}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}}
\PYG{k}{def} \PYG{n+nf}{condition}\PYG{p}{(}\PYG{n}{r}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{p}{(}\PYG{l+m+mi}{0}\PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{r} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{low}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{high}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{return} \PYG{n}{label}

\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{udf}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StringType}\PYG{p}{,} \PYG{n}{DoubleType}
\PYG{n}{string\PYGZus{}to\PYGZus{}float\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{string\PYGZus{}to\PYGZus{}float}\PYG{p}{,} \PYG{n}{DoubleType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{quality\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{condition}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{df} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{quality}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{quality\PYGZus{}udf}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{quality}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{fixed}\PYG{o}{\textbar{}}\PYG{n}{volatile}\PYG{o}{\textbar{}}\PYG{n}{citric}\PYG{o}{\textbar{}}\PYG{n}{sugar}\PYG{o}{\textbar{}}\PYG{n}{chlorides}\PYG{o}{\textbar{}}\PYG{n}{free}\PYG{o}{\textbar{}}\PYG{n}{total}\PYG{o}{\textbar{}}\PYG{n}{density}\PYG{o}{\textbar{}}  \PYG{n}{pH}\PYG{o}{\textbar{}}\PYG{n}{sulphates}\PYG{o}{\textbar{}}\PYG{n}{alcohol}\PYG{o}{\textbar{}}\PYG{n}{quality}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.88}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.6}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.098}\PYG{o}{\textbar{}}\PYG{l+m+mf}{25.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{67.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9968}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.68}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.76}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.04}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.3}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.092}\PYG{o}{\textbar{}}\PYG{l+m+mf}{15.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{54.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.997}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.65}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{11.2}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.28}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.075}\PYG{o}{\textbar{}}\PYG{l+m+mf}{17.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{60.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.998}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.16}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.58}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}} \PYG{n}{medium}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{fixed}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{volatile}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{citric}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sugar}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{chlorides}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{free}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{total}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{density}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{pH}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sulphates}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{alcohol}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{quality}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Deal with categorical data and Convert the data to dense vector

\end{enumerate}

\begin{sphinxadmonition}{note}{Note:}
You are strongly encouraged to try my \sphinxcode{\sphinxupquote{get\_dummy}} function for dealing with the categorical data in complex dataset.

Supervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Unsupervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Get dummy variables and concat with continuous variables for unsupervised learning.}
\PYG{l+s+sd}{    :param df: the dataframe}
\PYG{l+s+sd}{    :param categoricalCols: the name list of the categorical data}
\PYG{l+s+sd}{    :param continuousCols:  the name list of the numerical data}
\PYG{l+s+sd}{    :return k: feature matrix}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  von198@gmail.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Transform the dataset to DataFrame

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors} \PYG{c+c1}{\PYGZsh{} !!!!caution: not from pyspark.mllib.linalg import Vectors}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{IndexToString}\PYG{p}{,}\PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{VectorIndexer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.tuning} \PYG{k+kn}{import} \PYG{n}{CrossValidator}\PYG{p}{,} \PYG{n}{ParamGridBuilder}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{MulticlassClassificationEvaluator}

\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
\PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{n}{r}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{transformed} \PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Deal with Categorical Label and Variables

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Index labels, adding metadata to the label column}
\PYG{n}{labelIndexer} \PYG{o}{=} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedLabel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\PYG{n}{labelIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{indexedLabel}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Automatically identify categorical features, and index them.}
\PYG{c+c1}{\PYGZsh{} Set maxCategories so features with \PYGZgt{} 4 distinct values are treated as continuous.}
\PYG{n}{featureIndexer} \PYG{o}{=}\PYG{n}{VectorIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                              \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                              \PYG{n}{maxCategories}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\PYG{n}{featureIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}     \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.88}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.6}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.8}\PYG{p}{,}\PYG{l+m+mf}{0.76}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{11.2}\PYG{p}{,}\PYG{l+m+mf}{0.28}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{7.4}\PYG{p}{,}\PYG{l+m+mf}{0.7}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Split the data to training and test data sets

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Split the data into training and test sets (40\PYGZpc{} held out for testing)}
\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{,} \PYG{n}{testData}\PYG{p}{)} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{trainingData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{False}\PYG{p}{)}
\PYG{n}{testData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{features}                                                 \PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.38}\PYG{p}{,}\PYG{l+m+mf}{0.01}\PYG{p}{,}\PYG{l+m+mf}{1.6}\PYG{p}{,}\PYG{l+m+mf}{0.048}\PYG{p}{,}\PYG{l+m+mf}{26.0}\PYG{p}{,}\PYG{l+m+mf}{60.0}\PYG{p}{,}\PYG{l+m+mf}{0.99084}\PYG{p}{,}\PYG{l+m+mf}{3.7}\PYG{p}{,}\PYG{l+m+mf}{0.75}\PYG{p}{,}\PYG{l+m+mf}{14.0}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{n}{low}  \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.24}\PYG{p}{,}\PYG{l+m+mf}{2.0}\PYG{p}{,}\PYG{l+m+mf}{0.06}\PYG{p}{,}\PYG{l+m+mf}{19.0}\PYG{p}{,}\PYG{l+m+mf}{50.0}\PYG{p}{,}\PYG{l+m+mf}{0.9917}\PYG{p}{,}\PYG{l+m+mf}{3.72}\PYG{p}{,}\PYG{l+m+mf}{0.74}\PYG{p}{,}\PYG{l+m+mf}{14.0}\PYG{p}{]} \PYG{o}{\textbar{}}\PYG{n}{high} \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.74}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{1.2}\PYG{p}{,}\PYG{l+m+mf}{0.041}\PYG{p}{,}\PYG{l+m+mf}{16.0}\PYG{p}{,}\PYG{l+m+mf}{46.0}\PYG{p}{,}\PYG{l+m+mf}{0.99258}\PYG{p}{,}\PYG{l+m+mf}{4.01}\PYG{p}{,}\PYG{l+m+mf}{0.59}\PYG{p}{,}\PYG{l+m+mf}{12.5}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{n}{low}  \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1.02}\PYG{p}{,}\PYG{l+m+mf}{0.04}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.045}\PYG{p}{,}\PYG{l+m+mf}{41.0}\PYG{p}{,}\PYG{l+m+mf}{85.0}\PYG{p}{,}\PYG{l+m+mf}{0.9938}\PYG{p}{,}\PYG{l+m+mf}{3.75}\PYG{p}{,}\PYG{l+m+mf}{0.48}\PYG{p}{,}\PYG{l+m+mf}{10.5}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{n}{low}  \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1.04}\PYG{p}{,}\PYG{l+m+mf}{0.24}\PYG{p}{,}\PYG{l+m+mf}{1.6}\PYG{p}{,}\PYG{l+m+mf}{0.05}\PYG{p}{,}\PYG{l+m+mf}{32.0}\PYG{p}{,}\PYG{l+m+mf}{96.0}\PYG{p}{,}\PYG{l+m+mf}{0.9934}\PYG{p}{,}\PYG{l+m+mf}{3.74}\PYG{p}{,}\PYG{l+m+mf}{0.62}\PYG{p}{,}\PYG{l+m+mf}{11.5}\PYG{p}{]} \PYG{o}{\textbar{}}\PYG{n}{low}  \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{features}                                                 \PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{0.52}\PYG{p}{,}\PYG{l+m+mf}{0.15}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{0.054}\PYG{p}{,}\PYG{l+m+mf}{8.0}\PYG{p}{,}\PYG{l+m+mf}{65.0}\PYG{p}{,}\PYG{l+m+mf}{0.9934}\PYG{p}{,}\PYG{l+m+mf}{3.9}\PYG{p}{,}\PYG{l+m+mf}{0.56}\PYG{p}{,}\PYG{l+m+mf}{13.1}\PYG{p}{]}  \PYG{o}{\textbar{}}\PYG{n}{low}  \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.7}\PYG{p}{,}\PYG{l+m+mf}{0.6}\PYG{p}{,}\PYG{l+m+mf}{0.17}\PYG{p}{,}\PYG{l+m+mf}{2.3}\PYG{p}{,}\PYG{l+m+mf}{0.058}\PYG{p}{,}\PYG{l+m+mf}{17.0}\PYG{p}{,}\PYG{l+m+mf}{106.0}\PYG{p}{,}\PYG{l+m+mf}{0.9932}\PYG{p}{,}\PYG{l+m+mf}{3.85}\PYG{p}{,}\PYG{l+m+mf}{0.6}\PYG{p}{,}\PYG{l+m+mf}{12.9}\PYG{p}{]} \PYG{o}{\textbar{}}\PYG{n}{low}  \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{p}{,}\PYG{l+m+mf}{0.048}\PYG{p}{,}\PYG{l+m+mf}{16.0}\PYG{p}{,}\PYG{l+m+mf}{42.0}\PYG{p}{,}\PYG{l+m+mf}{0.99154}\PYG{p}{,}\PYG{l+m+mf}{3.71}\PYG{p}{,}\PYG{l+m+mf}{0.74}\PYG{p}{,}\PYG{l+m+mf}{14.0}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{n}{high} \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{,}\PYG{l+m+mf}{0.5}\PYG{p}{,}\PYG{l+m+mf}{4.3}\PYG{p}{,}\PYG{l+m+mf}{0.046}\PYG{p}{,}\PYG{l+m+mf}{29.0}\PYG{p}{,}\PYG{l+m+mf}{80.0}\PYG{p}{,}\PYG{l+m+mf}{0.9902}\PYG{p}{,}\PYG{l+m+mf}{3.49}\PYG{p}{,}\PYG{l+m+mf}{0.66}\PYG{p}{,}\PYG{l+m+mf}{13.6}\PYG{p}{]}  \PYG{o}{\textbar{}}\PYG{n}{low}  \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.2}\PYG{p}{,}\PYG{l+m+mf}{0.49}\PYG{p}{,}\PYG{l+m+mf}{0.26}\PYG{p}{,}\PYG{l+m+mf}{2.3}\PYG{p}{,}\PYG{l+m+mf}{0.09}\PYG{p}{,}\PYG{l+m+mf}{23.0}\PYG{p}{,}\PYG{l+m+mf}{74.0}\PYG{p}{,}\PYG{l+m+mf}{0.9953}\PYG{p}{,}\PYG{l+m+mf}{3.71}\PYG{p}{,}\PYG{l+m+mf}{0.62}\PYG{p}{,}\PYG{l+m+mf}{12.2}\PYG{p}{]} \PYG{o}{\textbar{}}\PYG{n}{low}  \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Fit Naive Bayes Classification Model

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.classification} \PYG{k+kn}{import} \PYG{n}{NaiveBayes}
\PYG{n}{nb} \PYG{o}{=} \PYG{n}{NaiveBayes}\PYG{p}{(}\PYG{n}{featuresCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedFeatures}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedLabel}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
Pipeline Architecture

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Convert indexed labels back to original labels.}
\PYG{n}{labelConverter} \PYG{o}{=} \PYG{n}{IndexToString}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                               \PYG{n}{labels}\PYG{o}{=}\PYG{n}{labelIndexer}\PYG{o}{.}\PYG{n}{labels}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Chain indexers and tree in a Pipeline}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{labelIndexer}\PYG{p}{,} \PYG{n}{featureIndexer}\PYG{p}{,} \PYG{n}{nb}\PYG{p}{,}\PYG{n}{labelConverter}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Train model.  This also runs the indexers.}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
Make predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Make predictions.}
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testData}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Select example rows to display.}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{predictedLabel}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{0.52}\PYG{p}{,}\PYG{l+m+mf}{0.15}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}           \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.7}\PYG{p}{,}\PYG{l+m+mf}{0.6}\PYG{p}{,}\PYG{l+m+mf}{0.17}\PYG{p}{,}\PYG{l+m+mf}{2.3}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}           \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{0.42}\PYG{p}{,}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{2.1}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}} \PYG{n}{high}\PYG{o}{\textbar{}}           \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{,}\PYG{l+m+mf}{0.5}\PYG{p}{,}\PYG{l+m+mf}{4.3}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}           \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.2}\PYG{p}{,}\PYG{l+m+mf}{0.49}\PYG{p}{,}\PYG{l+m+mf}{0.26}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{n}{low}\PYG{o}{\textbar{}}           \PYG{n}{low}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{8}
\item {} 
Evaluation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{MulticlassClassificationEvaluator}

\PYG{c+c1}{\PYGZsh{} Select (prediction, true label) and compute test error}
\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{MulticlassClassificationEvaluator}\PYG{p}{(}
    \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{metricName}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{accuracy}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{accuracy} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Test Error = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{l+m+mf}{1.0} \PYG{o}{\PYGZhy{}} \PYG{n}{accuracy}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Test} \PYG{n}{Error} \PYG{o}{=} \PYG{l+m+mf}{0.307339}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{lrModel} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}
\PYG{n}{trainingSummary} \PYG{o}{=} \PYG{n}{lrModel}\PYG{o}{.}\PYG{n}{summary}

\PYG{c+c1}{\PYGZsh{} Obtain the objective per iteration}
\PYG{c+c1}{\PYGZsh{} objectiveHistory = trainingSummary.objectiveHistory}
\PYG{c+c1}{\PYGZsh{} print(\PYGZdq{}objectiveHistory:\PYGZdq{})}
\PYG{c+c1}{\PYGZsh{} for objective in objectiveHistory:}
\PYG{c+c1}{\PYGZsh{}     print(objective)}

\PYG{c+c1}{\PYGZsh{} Obtain the receiver\PYGZhy{}operating characteristic as a dataframe and areaUnderROC.}
\PYG{n}{trainingSummary}\PYG{o}{.}\PYG{n}{roc}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{areaUnderROC: }\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{trainingSummary}\PYG{o}{.}\PYG{n}{areaUnderROC}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set the model threshold to maximize F\PYGZhy{}Measure}
\PYG{n}{fMeasure} \PYG{o}{=} \PYG{n}{trainingSummary}\PYG{o}{.}\PYG{n}{fMeasureByThreshold}
\PYG{n}{maxFMeasure} \PYG{o}{=} \PYG{n}{fMeasure}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{F\PYGZhy{}Measure}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max(F\PYGZhy{}Measure)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} bestThreshold = fMeasure.where(fMeasure[\PYGZsq{}F\PYGZhy{}Measure\PYGZsq{}] == maxFMeasure[\PYGZsq{}max(F\PYGZhy{}Measure)\PYGZsq{}]) \PYGZbs{}}
\PYG{c+c1}{\PYGZsh{}     .select(\PYGZsq{}threshold\PYGZsq{}).head()[\PYGZsq{}threshold\PYGZsq{}]}
\PYG{c+c1}{\PYGZsh{} lr.setThreshold(bestThreshold)}
\end{sphinxVerbatim}

You can use \sphinxcode{\sphinxupquote{z.show()}} to get the data and plot the ROC curves:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{roc_z}.png}
\end{figure}

You can also register a TempTable \sphinxcode{\sphinxupquote{data.registerTempTable('roc\_data')}} and then
use \sphinxcode{\sphinxupquote{sql}} to plot the ROC curve:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{roc}.png}
\end{figure}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{9}
\item {} 
visualization

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.pyplot} \PYG{k+kn}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{itertools}

\PYG{k}{def} \PYG{n+nf}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{,}
                          \PYG{n}{normalize}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,}
                          \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                          \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{Blues}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    This function prints and plots the confusion matrix.}
\PYG{l+s+sd}{    Normalization can be applied by setting {}`normalize=True{}`.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{k}{if} \PYG{n}{normalize}\PYG{p}{:}
        \PYG{n}{cm} \PYG{o}{=} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{float}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{/} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{newaxis}\PYG{p}{]}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Normalized confusion matrix}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix, without normalization}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{print}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{imshow}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{,} \PYG{n}{interpolation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nearest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{cmap}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{n}{title}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{tick\PYGZus{}marks} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{classes}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{xticks}\PYG{p}{(}\PYG{n}{tick\PYGZus{}marks}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{,} \PYG{n}{rotation}\PYG{o}{=}\PYG{l+m+mi}{45}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{yticks}\PYG{p}{(}\PYG{n}{tick\PYGZus{}marks}\PYG{p}{,} \PYG{n}{classes}\PYG{p}{)}

    \PYG{n}{fmt} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.2f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{n}{normalize} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{d}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{thresh} \PYG{o}{=} \PYG{n}{cm}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)} \PYG{o}{/} \PYG{l+m+mf}{2.}
    \PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n}{itertools}\PYG{o}{.}\PYG{n}{product}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{plt}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{j}\PYG{p}{,} \PYG{n}{i}\PYG{p}{,} \PYG{n}{format}\PYG{p}{(}\PYG{n}{cm}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]}\PYG{p}{,} \PYG{n}{fmt}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{center}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                 \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{white}\PYG{l+s+s2}{\PYGZdq{}} \PYG{k}{if} \PYG{n}{cm}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{n}{thresh} \PYG{k}{else} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{black}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{True label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Predicted label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{class\PYGZus{}temp} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYGZbs{}
                        \PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{count}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ascending}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{class\PYGZus{}temp} \PYG{o}{=} \PYG{n}{class\PYGZus{}temp}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{o}{.}\PYG{n}{tolist}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{class\PYGZus{}names} \PYG{o}{=} \PYG{n+nb}{map}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{,} \PYG{n}{class\PYGZus{}temp}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} \PYGZsh{} \PYGZsh{} print(class\PYGZus{}name)}
\PYG{n}{class\PYGZus{}names}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{low}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{high}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{sklearn.metrics} \PYG{k+kn}{import} \PYG{n}{confusion\PYGZus{}matrix}
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{y\PYGZus{}true} \PYG{o}{=} \PYG{n}{y\PYGZus{}true}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{y\PYGZus{}pred} \PYG{o}{=} \PYG{n}{y\PYGZus{}pred}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{cnf\PYGZus{}matrix} \PYG{o}{=} \PYG{n}{confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{y\PYGZus{}true}\PYG{p}{,} \PYG{n}{y\PYGZus{}pred}\PYG{p}{,}\PYG{n}{labels}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{)}
\PYG{n}{cnf\PYGZus{}matrix}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{392}\PYG{p}{,} \PYG{l+m+mi}{169}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mi}{32}\PYG{p}{,}  \PYG{l+m+mi}{61}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Plot non\PYGZhy{}normalized confusion matrix}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cnf\PYGZus{}matrix}\PYG{p}{,} \PYG{n}{classes}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{,}
                      \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Confusion matrix, without normalization}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Confusion} \PYG{n}{matrix}\PYG{p}{,} \PYG{n}{without} \PYG{n}{normalization}
\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{392} \PYG{l+m+mi}{169}\PYG{p}{]}
 \PYG{p}{[} \PYG{l+m+mi}{32}  \PYG{l+m+mi}{61}\PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{nb_c1}.png}
\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Plot normalized confusion matrix}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{plot\PYGZus{}confusion\PYGZus{}matrix}\PYG{p}{(}\PYG{n}{cnf\PYGZus{}matrix}\PYG{p}{,} \PYG{n}{classes}\PYG{o}{=}\PYG{n}{class\PYGZus{}names}\PYG{p}{,} \PYG{n}{normalize}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,}
                      \PYG{n}{title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Normalized confusion matrix}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Normalized} \PYG{n}{confusion} \PYG{n}{matrix}
\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mf}{0.69875223} \PYG{l+m+mf}{0.30124777}\PYG{p}{]}
 \PYG{p}{[}\PYG{l+m+mf}{0.34408602} \PYG{l+m+mf}{0.65591398}\PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{nb_c2}.png}
\end{figure}


\chapter{Clustering}
\label{\detokenize{clustering:clustering}}\label{\detokenize{clustering:id1}}\label{\detokenize{clustering::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

Sharpening the knife longer can make it easier to hack the firewood \textendash{} old Chinese proverb
\end{sphinxadmonition}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{clustering_logo}.png}
\end{figure}

The above figure was generated by the code from: \sphinxhref{https://jakevdp.github.io/PythonDataScienceHandbook/06.00-figure-code.html\#Expectation-Maximization}{Python Data Science Handbook}.


\section{K-Means Model}
\label{\detokenize{clustering:k-means-model}}

\subsection{Introduction}
\label{\detokenize{clustering:introduction}}

\subsection{Demo}
\label{\detokenize{clustering:demo}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark K\PYGZhy{}means example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                       \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                       \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
            \PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{../data/iris.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

check the data set

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{sepal\PYGZus{}length}\PYG{o}{\textbar{}}\PYG{n}{sepal\PYGZus{}width}\PYG{o}{\textbar{}}\PYG{n}{petal\PYGZus{}length}\PYG{o}{\textbar{}}\PYG{n}{petal\PYGZus{}width}\PYG{o}{\textbar{}}\PYG{n}{species}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{l+m+mf}{5.1}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{3.5}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{1.4}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{0.2}\PYG{o}{\textbar{}} \PYG{n}{setosa}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}         \PYG{l+m+mf}{4.9}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{1.4}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{0.2}\PYG{o}{\textbar{}} \PYG{n}{setosa}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}         \PYG{l+m+mf}{4.7}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{1.3}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{0.2}\PYG{o}{\textbar{}} \PYG{n}{setosa}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}         \PYG{l+m+mf}{4.6}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{3.1}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{1.5}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{0.2}\PYG{o}{\textbar{}} \PYG{n}{setosa}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}         \PYG{l+m+mf}{5.0}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{3.6}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{1.4}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{0.2}\PYG{o}{\textbar{}} \PYG{n}{setosa}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sepal\PYGZus{}length}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{sepal\PYGZus{}width}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{petal\PYGZus{}length}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{petal\PYGZus{}width}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{species}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}

You can also get the Statistical resutls from the data frame
(Unfortunately, it only works for numerical).

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{describe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{summary}\PYG{o}{\textbar{}}      \PYG{n}{sepal\PYGZus{}length}\PYG{o}{\textbar{}}        \PYG{n}{sepal\PYGZus{}width}\PYG{o}{\textbar{}}      \PYG{n}{petal\PYGZus{}length}\PYG{o}{\textbar{}}       \PYG{n}{petal\PYGZus{}width}\PYG{o}{\textbar{}}  \PYG{n}{species}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{count}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{150}\PYG{o}{\textbar{}}                \PYG{l+m+mi}{150}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{150}\PYG{o}{\textbar{}}               \PYG{l+m+mi}{150}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{150}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{n}{mean}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5.843333333333335}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3.0540000000000007}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.7586666666666693}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.1986666666666672}\PYG{o}{\textbar{}}     \PYG{n}{null}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{n}{stddev}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.8280661279778637}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.43359431136217375}\PYG{o}{\textbar{}} \PYG{l+m+mf}{1.764420419952262}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.7631607417008414}\PYG{o}{\textbar{}}     \PYG{n}{null}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{min}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{4.3}\PYG{o}{\textbar{}}                \PYG{l+m+mf}{2.0}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.1}\PYG{o}{\textbar{}}   \PYG{n}{setosa}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{max}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{7.9}\PYG{o}{\textbar{}}                \PYG{l+m+mf}{4.4}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{6.9}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{2.5}\PYG{o}{\textbar{}}\PYG{n}{virginica}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Convert the data to dense vector (\sphinxstylestrong{features})

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} convert the data to dense vector}
\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
You are strongly encouraged to try my \sphinxcode{\sphinxupquote{get\_dummy}} function for dealing with the categorical data in complex dataset.

Supervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{,}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{:}

    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
    \PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{n}{data} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{n}{labelCol}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}

Unsupervised learning version:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}dummy}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,}\PYG{n}{indexCol}\PYG{p}{,}\PYG{n}{categoricalCols}\PYG{p}{,}\PYG{n}{continuousCols}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Get dummy variables and concat with continuous variables for unsupervised learning.}
\PYG{l+s+sd}{    :param df: the dataframe}
\PYG{l+s+sd}{    :param categoricalCols: the name list of the categorical data}
\PYG{l+s+sd}{    :param continuousCols:  the name list of the numerical data}
\PYG{l+s+sd}{    :return k: feature matrix}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  von198@gmail.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{indexers} \PYG{o}{=} \PYG{p}{[} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{c}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{categoricalCols} \PYG{p}{]}

    \PYG{c+c1}{\PYGZsh{} default setting: dropLast=True}
    \PYG{n}{encoders} \PYG{o}{=} \PYG{p}{[} \PYG{n}{OneHotEncoder}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
                 \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}0\PYGZcb{}\PYGZus{}encoded}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{indexer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
                 \PYG{k}{for} \PYG{n}{indexer} \PYG{o+ow}{in} \PYG{n}{indexers} \PYG{p}{]}

    \PYG{n}{assembler} \PYG{o}{=} \PYG{n}{VectorAssembler}\PYG{p}{(}\PYG{n}{inputCols}\PYG{o}{=}\PYG{p}{[}\PYG{n}{encoder}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{encoder} \PYG{o+ow}{in} \PYG{n}{encoders}\PYG{p}{]}
                                \PYG{o}{+} \PYG{n}{continuousCols}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{n}{indexers} \PYG{o}{+} \PYG{n}{encoders} \PYG{o}{+} \PYG{p}{[}\PYG{n}{assembler}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{model}\PYG{o}{=}\PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
    \PYG{n}{data} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{indexCol}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Transform the dataset to DataFrame

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{transformed}\PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n+nb+bp}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{features}         \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.1}\PYG{p}{,}\PYG{l+m+mf}{3.5}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.7}\PYG{p}{,}\PYG{l+m+mf}{3.2}\PYG{p}{,}\PYG{l+m+mf}{1.3}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{3.1}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{3.6}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Deal With Categorical Variables

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.regression} \PYG{k+kn}{import} \PYG{n}{LinearRegression}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{VectorIndexer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{RegressionEvaluator}

\PYG{c+c1}{\PYGZsh{} Automatically identify categorical features, and index them.}
\PYG{c+c1}{\PYGZsh{} We specify maxCategories so features with \PYGZgt{} 4 distinct values are treated as continuous.}

\PYG{n}{featureIndexer} \PYG{o}{=} \PYG{n}{VectorIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYGZbs{}
                               \PYG{n}{maxCategories}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}

\PYG{n}{data} \PYG{o}{=} \PYG{n}{featureIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\end{sphinxVerbatim}

Now you check your dataset with

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{features}\PYG{o}{\textbar{}}  \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.1}\PYG{p}{,}\PYG{l+m+mf}{3.5}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.1}\PYG{p}{,}\PYG{l+m+mf}{3.5}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.7}\PYG{p}{,}\PYG{l+m+mf}{3.2}\PYG{p}{,}\PYG{l+m+mf}{1.3}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.7}\PYG{p}{,}\PYG{l+m+mf}{3.2}\PYG{p}{,}\PYG{l+m+mf}{1.3}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{3.1}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{3.1}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{3.6}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{3.6}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Elbow method to determine the optimal number of clusters for k-means clustering

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
\PYG{n}{cost} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{kmeans} \PYG{o}{=} \PYG{n}{KMeans}\PYG{p}{(}\PYG{p}{)}\PYGZbs{}
            \PYG{o}{.}\PYG{n}{setK}\PYG{p}{(}\PYG{n}{k}\PYG{p}{)}\PYGZbs{}
            \PYG{o}{.}\PYG{n}{setSeed}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{setFeaturesCol}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYGZbs{}
            \PYG{o}{.}\PYG{n}{setPredictionCol}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cluster}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{model} \PYG{o}{=} \PYG{n}{kmeans}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}
    \PYG{n}{cost}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{computeCost}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} requires Spark 2.0 or later}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.mlab} \PYG{k+kn}{as} \PYG{n+nn}{mlab}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.pyplot} \PYG{k+kn}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{seaborn} \PYG{k+kn}{as} \PYG{n+nn}{sbs}
\PYG{k+kn}{from} \PYG{n+nn}{matplotlib.ticker} \PYG{k+kn}{import} \PYG{n}{MaxNLocator}

\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize} \PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{,}\PYG{n}{cost}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{:}\PYG{l+m+mi}{20}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{k}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cost}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{xaxis}\PYG{o}{.}\PYG{n}{set\PYGZus{}major\PYGZus{}locator}\PYG{p}{(}\PYG{n}{MaxNLocator}\PYG{p}{(}\PYG{n}{integer}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{elbow}.png}
\end{figure}

In my opinion, sometimes it’s hard to choose the optimal number of the clusters by using the \sphinxcode{\sphinxupquote{elbow method}}. As shown in the following Figure, you can choose 3, 5 or even 8. I will choose \sphinxcode{\sphinxupquote{3}} in this demo.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{elbow_rfm}.png}
\end{figure}
\begin{itemize}
\item {} 
Silhouette analysis

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}PySpark libraries}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}\PYG{p}{,} \PYG{n}{percent\PYGZus{}rank}\PYG{p}{,} \PYG{n}{lit}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.window} \PYG{k+kn}{import} \PYG{n}{Window}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{DataFrame}\PYG{p}{,} \PYG{n}{Row}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StructType}
\PYG{k+kn}{from} \PYG{n+nn}{functools} \PYG{k+kn}{import} \PYG{n+nb}{reduce}  \PYG{c+c1}{\PYGZsh{} For Python 3.x}

\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.clustering} \PYG{k+kn}{import} \PYG{n}{KMeans}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{ClusteringEvaluator}

\PYG{k}{def} \PYG{n+nf}{optimal\PYGZus{}k}\PYG{p}{(}\PYG{n}{df\PYGZus{}in}\PYG{p}{,}\PYG{n}{index\PYGZus{}col}\PYG{p}{,}\PYG{n}{k\PYGZus{}min}\PYG{p}{,} \PYG{n}{k\PYGZus{}max}\PYG{p}{,}\PYG{n}{num\PYGZus{}runs}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Determine optimal number of clusters by using Silhoutte Score Analysis.}
\PYG{l+s+sd}{    :param df\PYGZus{}in: the input dataframe}
\PYG{l+s+sd}{    :param index\PYGZus{}col: the name of the index column}
\PYG{l+s+sd}{    :param k\PYGZus{}min: the train dataset}
\PYG{l+s+sd}{    :param k\PYGZus{}min: the minmum number of the clusters}
\PYG{l+s+sd}{    :param k\PYGZus{}max: the maxmum number of the clusters}
\PYG{l+s+sd}{    :param num\PYGZus{}runs: the number of runs for each fixed clusters}

\PYG{l+s+sd}{    :return k: optimal number of the clusters}
\PYG{l+s+sd}{    :return silh\PYGZus{}lst: Silhouette score}
\PYG{l+s+sd}{    :return r\PYGZus{}table: the running results table}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  WFeng@dstsystems.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{start} \PYG{o}{=} \PYG{n}{time}\PYG{o}{.}\PYG{n}{time}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{silh\PYGZus{}lst} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{n}{k\PYGZus{}lst} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n}{k\PYGZus{}min}\PYG{p}{,} \PYG{n}{k\PYGZus{}max}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}

    \PYG{n}{r\PYGZus{}table} \PYG{o}{=} \PYG{n}{df\PYGZus{}in}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{index\PYGZus{}col}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{r\PYGZus{}table} \PYG{o}{=} \PYG{n}{r\PYGZus{}table}\PYG{o}{.}\PYG{n}{set\PYGZus{}index}\PYG{p}{(}\PYG{n}{index\PYGZus{}col}\PYG{p}{)}
    \PYG{n}{centers} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{)}

    \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n}{k\PYGZus{}lst}\PYG{p}{:}
        \PYG{n}{silh\PYGZus{}val} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{run} \PYG{o+ow}{in} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{num\PYGZus{}runs}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}

            \PYG{c+c1}{\PYGZsh{} Trains a k\PYGZhy{}means model.}
            \PYG{n}{kmeans} \PYG{o}{=} \PYG{n}{KMeans}\PYG{p}{(}\PYG{p}{)}\PYGZbs{}
                    \PYG{o}{.}\PYG{n}{setK}\PYG{p}{(}\PYG{n}{k}\PYG{p}{)}\PYGZbs{}
                    \PYG{o}{.}\PYG{n}{setSeed}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{n}{size}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
            \PYG{n}{model} \PYG{o}{=} \PYG{n}{kmeans}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df\PYGZus{}in}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} Make predictions}
            \PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df\PYGZus{}in}\PYG{p}{)}
            \PYG{n}{r\PYGZus{}table}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cluster\PYGZus{}\PYGZob{}k\PYGZcb{}\PYGZus{}\PYGZob{}run\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{k}\PYG{o}{=}\PYG{n}{k}\PYG{p}{,} \PYG{n}{run}\PYG{o}{=}\PYG{n}{run}\PYG{p}{)}\PYG{p}{]}\PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prediction}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} Evaluate clustering by computing Silhouette score}
            \PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{ClusteringEvaluator}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{silhouette} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
            \PYG{n}{silh\PYGZus{}val}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{silhouette}\PYG{p}{)}

        \PYG{n}{silh\PYGZus{}array}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{asanyarray}\PYG{p}{(}\PYG{n}{silh\PYGZus{}val}\PYG{p}{)}
        \PYG{n}{silh\PYGZus{}lst}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{silh\PYGZus{}array}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}

    \PYG{n}{elapsed} \PYG{o}{=}  \PYG{n}{time}\PYG{o}{.}\PYG{n}{time}\PYG{p}{(}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{start}

    \PYG{n}{silhouette} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{k\PYGZus{}lst}\PYG{p}{,}\PYG{n}{silh\PYGZus{}lst}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{n}{columns} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{k}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{silhouette}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

    \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\textbar{}         The finding optimal k phase took }\PYG{l+s+si}{\PYGZpc{}8.0f}\PYG{l+s+s2}{ s.       \textbar{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}}\PYG{p}{(}\PYG{n}{elapsed}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}


    \PYG{k}{return} \PYG{n}{k\PYGZus{}lst}\PYG{p}{[}\PYG{n}{np}\PYG{o}{.}\PYG{n}{argmax}\PYG{p}{(}\PYG{n}{silh\PYGZus{}lst}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{silhouette} \PYG{p}{,} \PYG{n}{r\PYGZus{}table}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{k}\PYG{p}{,} \PYG{n}{silh\PYGZus{}lst}\PYG{p}{,} \PYG{n}{r\PYGZus{}table} \PYG{o}{=} \PYG{n}{optimal\PYGZus{}k}\PYG{p}{(}\PYG{n}{scaledData}\PYG{p}{,}\PYG{n}{index\PYGZus{}col}\PYG{p}{,}\PYG{n}{k\PYGZus{}min}\PYG{p}{,} \PYG{n}{k\PYGZus{}max}\PYG{p}{,}\PYG{n}{num\PYGZus{}runs}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{The} \PYG{n}{finding} \PYG{n}{optimal} \PYG{n}{k} \PYG{n}{phase} \PYG{n}{took}     \PYG{l+m+mi}{1783} \PYG{n}{s}\PYG{o}{.}       \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{silh\PYGZus{}lst}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{k}\PYG{o}{\textbar{}}        \PYG{n}{silhouette}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.8045154385557953}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.6993528775512052}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.6689286654221447}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.6356184024841809}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{7}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.7174102265711756}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.6720861758298997}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{9}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.601771359881241}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mi}{10}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.6292447334578428}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

From the silhouette list, we can choose \sphinxcode{\sphinxupquote{3}} as the optimal number of the clusters.

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxcode{\sphinxupquote{ClusteringEvaluator}} in \sphinxcode{\sphinxupquote{pyspark.ml.evaluation}} requires Spark 2.4 or later!!
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
Pipeline Architecture

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.clustering} \PYG{k+kn}{import} \PYG{n}{KMeans}\PYG{p}{,} \PYG{n}{KMeansModel}

\PYG{n}{kmeans} \PYG{o}{=} \PYG{n}{KMeans}\PYG{p}{(}\PYG{p}{)} \PYGZbs{}
          \PYG{o}{.}\PYG{n}{setK}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)} \PYGZbs{}
          \PYG{o}{.}\PYG{n}{setFeaturesCol}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYGZbs{}
          \PYG{o}{.}\PYG{n}{setPredictionCol}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cluster}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Chain indexer and tree in a Pipeline}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{featureIndexer}\PYG{p}{,} \PYG{n}{kmeans}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}

\PYG{n}{cluster} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
k-means clusters

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cluster} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{features}\PYG{o}{\textbar{}}  \PYG{n}{indexedFeatures}\PYG{o}{\textbar{}}\PYG{n}{cluster}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.1}\PYG{p}{,}\PYG{l+m+mf}{3.5}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.1}\PYG{p}{,}\PYG{l+m+mf}{3.5}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.7}\PYG{p}{,}\PYG{l+m+mf}{3.2}\PYG{p}{,}\PYG{l+m+mf}{1.3}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.7}\PYG{p}{,}\PYG{l+m+mf}{3.2}\PYG{p}{,}\PYG{l+m+mf}{1.3}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{3.1}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{3.1}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{3.6}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{3.6}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{3.9}\PYG{p}{,}\PYG{l+m+mf}{1.7}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{3.9}\PYG{p}{,}\PYG{l+m+mf}{1.7}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{3.4}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.3}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.6}\PYG{p}{,}\PYG{l+m+mf}{3.4}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.3}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{3.4}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{3.4}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.4}\PYG{p}{,}\PYG{l+m+mf}{2.9}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.4}\PYG{p}{,}\PYG{l+m+mf}{2.9}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{3.1}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.1}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.9}\PYG{p}{,}\PYG{l+m+mf}{3.1}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.1}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{3.7}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{3.7}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.8}\PYG{p}{,}\PYG{l+m+mf}{3.4}\PYG{p}{,}\PYG{l+m+mf}{1.6}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.8}\PYG{p}{,}\PYG{l+m+mf}{3.4}\PYG{p}{,}\PYG{l+m+mf}{1.6}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.8}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.1}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.8}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.1}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.3}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{1.1}\PYG{p}{,}\PYG{l+m+mf}{0.1}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{4.3}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{1.1}\PYG{p}{,}\PYG{l+m+mf}{0.1}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.8}\PYG{p}{,}\PYG{l+m+mf}{4.0}\PYG{p}{,}\PYG{l+m+mf}{1.2}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.8}\PYG{p}{,}\PYG{l+m+mf}{4.0}\PYG{p}{,}\PYG{l+m+mf}{1.2}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.7}\PYG{p}{,}\PYG{l+m+mf}{4.4}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.7}\PYG{p}{,}\PYG{l+m+mf}{4.4}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{3.9}\PYG{p}{,}\PYG{l+m+mf}{1.3}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.4}\PYG{p}{,}\PYG{l+m+mf}{3.9}\PYG{p}{,}\PYG{l+m+mf}{1.3}\PYG{p}{,}\PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.1}\PYG{p}{,}\PYG{l+m+mf}{3.5}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.3}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.1}\PYG{p}{,}\PYG{l+m+mf}{3.5}\PYG{p}{,}\PYG{l+m+mf}{1.4}\PYG{p}{,}\PYG{l+m+mf}{0.3}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.7}\PYG{p}{,}\PYG{l+m+mf}{3.8}\PYG{p}{,}\PYG{l+m+mf}{1.7}\PYG{p}{,}\PYG{l+m+mf}{0.3}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.7}\PYG{p}{,}\PYG{l+m+mf}{3.8}\PYG{p}{,}\PYG{l+m+mf}{1.7}\PYG{p}{,}\PYG{l+m+mf}{0.3}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.1}\PYG{p}{,}\PYG{l+m+mf}{3.8}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.3}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{5.1}\PYG{p}{,}\PYG{l+m+mf}{3.8}\PYG{p}{,}\PYG{l+m+mf}{1.5}\PYG{p}{,}\PYG{l+m+mf}{0.3}\PYG{p}{]}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{20} \PYG{n}{rows}
\end{sphinxVerbatim}


\chapter{RFM Analysis}
\label{\detokenize{rfm:rfm-analysis}}\label{\detokenize{rfm:rfm}}\label{\detokenize{rfm::doc}}
\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{rfm_business}.png}
\end{figure}

The above figure source: Blast Analytics Marketing

RFM is a method used for analyzing customer value. It is commonly used in database marketing and direct marketing and has received particular attention in retail and professional services industries. More details can be found at
Wikipedia \sphinxhref{https://en.wikipedia.org/wiki/RFM\_(customer\_value)}{RFM\_wikipedia}.

RFM stands for the three dimensions:
\begin{itemize}
\item {} 
Recency \textendash{} How recently did the customer purchase? i.e. Duration since last purchase

\item {} 
Frequency \textendash{} How often do they purchase?  i.e. Total number of purchases

\item {} 
Monetary Value \textendash{} How much do they spend? i.e. Total money this customer spent

\end{itemize}


\section{RFM Analysis Methodology}
\label{\detokenize{rfm:rfm-analysis-methodology}}
RFM Analysis contains three main steps:


\subsection{1. Build the RFM features matrix for each customer}
\label{\detokenize{rfm:build-the-rfm-features-matrix-for-each-customer}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{n}{Recency}\PYG{o}{\textbar{}}\PYG{n}{Frequency}\PYG{o}{\textbar{}} \PYG{n}{Monetary}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{14911}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{248}\PYG{o}{\textbar{}}\PYG{l+m+mf}{132572.62}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{12748}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{224}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{29072.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17841}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{169}\PYG{o}{\textbar{}} \PYG{l+m+mf}{40340.78}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{14606}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{128}\PYG{o}{\textbar{}} \PYG{l+m+mf}{11713.85}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15311}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{118}\PYG{o}{\textbar{}} \PYG{l+m+mf}{59419.34}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{2. Determine cutting points for each feature}
\label{\detokenize{rfm:determine-cutting-points-for-each-feature}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{n}{Recency}\PYG{o}{\textbar{}}\PYG{n}{Frequency}\PYG{o}{\textbar{}}\PYG{n}{Monetary}\PYG{o}{\textbar{}}\PYG{n}{r\PYGZus{}seg}\PYG{o}{\textbar{}}\PYG{n}{f\PYGZus{}seg}\PYG{o}{\textbar{}}\PYG{n}{m\PYGZus{}seg}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17420}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{50}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{598.83}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16861}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{59}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{151.65}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{106}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{1421.43}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15727}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{7}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5178.96}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17389}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{43}\PYG{o}{\textbar{}}\PYG{l+m+mf}{31300.08}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{3. Determine the RFM scores and summarize the corresponding business value}
\label{\detokenize{rfm:determine-the-rfm-scores-and-summarize-the-corresponding-business-value}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{n}{Recency}\PYG{o}{\textbar{}}\PYG{n}{Frequency}\PYG{o}{\textbar{}}\PYG{n}{Monetary}\PYG{o}{\textbar{}}\PYG{n}{r\PYGZus{}seg}\PYG{o}{\textbar{}}\PYG{n}{f\PYGZus{}seg}\PYG{o}{\textbar{}}\PYG{n}{m\PYGZus{}seg}\PYG{o}{\textbar{}}\PYG{n}{RFMScore}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17988}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{11}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{191.17}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{111}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16892}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{7}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{496.84}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{112}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16668}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{306.72}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{112}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16554}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{7}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{641.55}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{112}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16500}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{400.86}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{112}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

The corresponding business description and marketing value:

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{rfm_business}.png}
\caption{Source: Blast Analytics Marketing}\label{\detokenize{rfm:id2}}\label{\detokenize{rfm:fig-rfm-business}}\end{figure}


\section{Demo}
\label{\detokenize{rfm:demo}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/RFM.ipynb}{Data Exploration}.

\item {} 
The data can be downloaf from \sphinxhref{\_static/OnlineRetail.csv}{German Credit}.

\end{itemize}


\subsection{Load and clean data}
\label{\detokenize{rfm:load-and-clean-data}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark RFM example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df\PYGZus{}raw} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                       \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                       \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
            \PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Online Retail.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

check the data set

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df\PYGZus{}raw}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{df\PYGZus{}raw}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{InvoiceNo}\PYG{o}{\textbar{}}\PYG{n}{StockCode}\PYG{o}{\textbar{}}         \PYG{n}{Description}\PYG{o}{\textbar{}}\PYG{n}{Quantity}\PYG{o}{\textbar{}} \PYG{n}{InvoiceDate}\PYG{o}{\textbar{}}\PYG{n}{UnitPrice}\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}       \PYG{n}{Country}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{85123}\PYG{n}{A}\PYG{o}{\textbar{}}\PYG{n}{WHITE} \PYG{n}{HANGING} \PYG{n}{HEA}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{2.55}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{71053}\PYG{o}{\textbar{}} \PYG{n}{WHITE} \PYG{n}{METAL} \PYG{n}{LANTERN}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{3.39}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{84406}\PYG{n}{B}\PYG{o}{\textbar{}}\PYG{n}{CREAM} \PYG{n}{CUPID} \PYG{n}{HEART}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{2.75}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{84029}\PYG{n}{G}\PYG{o}{\textbar{}}\PYG{n}{KNITTED} \PYG{n}{UNION} \PYG{n}{FLA}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{3.39}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{84029}\PYG{n}{E}\PYG{o}{\textbar{}}\PYG{n}{RED} \PYG{n}{WOOLLY} \PYG{n}{HOTTIE}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{3.39}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{InvoiceNo}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{StockCode}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Description}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Quantity}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{InvoiceDate}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{UnitPrice}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{CustomerID}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Country}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Data clean and data manipulation

\end{enumerate}
\begin{itemize}
\item {} 
check and remove the \sphinxcode{\sphinxupquote{null}} values

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{count}

\PYG{k}{def} \PYG{n+nf}{my\PYGZus{}count}\PYG{p}{(}\PYG{n}{df\PYGZus{}in}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{df\PYGZus{}in}\PYG{o}{.}\PYG{n}{agg}\PYG{p}{(} \PYG{o}{*}\PYG{p}{[} \PYG{n}{count}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)} \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{df\PYGZus{}in}\PYG{o}{.}\PYG{n}{columns} \PYG{p}{]} \PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{my\PYGZus{}count}\PYG{p}{(}\PYG{n}{df\PYGZus{}raw}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{InvoiceNo}\PYG{o}{\textbar{}}\PYG{n}{StockCode}\PYG{o}{\textbar{}}\PYG{n}{Description}\PYG{o}{\textbar{}}\PYG{n}{Quantity}\PYG{o}{\textbar{}}\PYG{n}{InvoiceDate}\PYG{o}{\textbar{}}\PYG{n}{UnitPrice}\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{n}{Country}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{541909}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{541909}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{540455}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{541909}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{541909}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{541909}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{406829}\PYG{o}{\textbar{}} \PYG{l+m+mi}{541909}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

Since the count results are not the same, we have some null value in the \sphinxcode{\sphinxupquote{CustomerID}} column. We can drop these records from the dataset.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{df\PYGZus{}raw}\PYG{o}{.}\PYG{n}{dropna}\PYG{p}{(}\PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{any}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{my\PYGZus{}count}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{InvoiceNo}\PYG{o}{\textbar{}}\PYG{n}{StockCode}\PYG{o}{\textbar{}}\PYG{n}{Description}\PYG{o}{\textbar{}}\PYG{n}{Quantity}\PYG{o}{\textbar{}}\PYG{n}{InvoiceDate}\PYG{o}{\textbar{}}\PYG{n}{UnitPrice}\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{n}{Country}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{406829}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{406829}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{406829}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{406829}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{406829}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{406829}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{406829}\PYG{o}{\textbar{}} \PYG{l+m+mi}{406829}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Dealwith the InvoiceDate

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{to\PYGZus{}utc\PYGZus{}timestamp}\PYG{p}{,} \PYG{n}{unix\PYGZus{}timestamp}\PYG{p}{,} \PYG{n}{lit}\PYG{p}{,} \PYG{n}{datediff}\PYG{p}{,} \PYG{n}{col}

\PYG{n}{timeFmt} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{MM/dd/yy HH:mm}\PYG{l+s+s2}{\PYGZdq{}}

\PYG{n}{df} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NewInvoiceDate}\PYG{l+s+s1}{\PYGZsq{}}
                 \PYG{p}{,} \PYG{n}{to\PYGZus{}utc\PYGZus{}timestamp}\PYG{p}{(}\PYG{n}{unix\PYGZus{}timestamp}\PYG{p}{(}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{InvoiceDate}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}\PYG{n}{timeFmt}\PYG{p}{)}\PYG{o}{.}\PYG{n}{cast}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{timestamp}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
                 \PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{UTC}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{InvoiceNo}\PYG{o}{\textbar{}}\PYG{n}{StockCode}\PYG{o}{\textbar{}}         \PYG{n}{Description}\PYG{o}{\textbar{}}\PYG{n}{Quantity}\PYG{o}{\textbar{}} \PYG{n}{InvoiceDate}\PYG{o}{\textbar{}}\PYG{n}{UnitPrice}\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}       \PYG{n}{Country}\PYG{o}{\textbar{}}      \PYG{n}{NewInvoiceDate}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{85123}\PYG{n}{A}\PYG{o}{\textbar{}}\PYG{n}{WHITE} \PYG{n}{HANGING} \PYG{n}{HEA}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{2.55}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2010}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{01} \PYG{l+m+mi}{08}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{p}{:}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{71053}\PYG{o}{\textbar{}} \PYG{n}{WHITE} \PYG{n}{METAL} \PYG{n}{LANTERN}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{3.39}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2010}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{01} \PYG{l+m+mi}{08}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{p}{:}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{84406}\PYG{n}{B}\PYG{o}{\textbar{}}\PYG{n}{CREAM} \PYG{n}{CUPID} \PYG{n}{HEART}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{2.75}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2010}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{01} \PYG{l+m+mi}{08}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{p}{:}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{84029}\PYG{n}{G}\PYG{o}{\textbar{}}\PYG{n}{KNITTED} \PYG{n}{UNION} \PYG{n}{FLA}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{3.39}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2010}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{01} \PYG{l+m+mi}{08}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{p}{:}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{84029}\PYG{n}{E}\PYG{o}{\textbar{}}\PYG{n}{RED} \PYG{n}{WOOLLY} \PYG{n}{HOTTIE}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{3.39}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2010}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{01} \PYG{l+m+mi}{08}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{p}{:}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{warning}{Warning:}
The spark is pretty sensitive to the date format!
\end{sphinxadmonition}
\begin{itemize}
\item {} 
calculate total price

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n+nb}{round}

\PYG{n}{df} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TotalPrice}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n+nb}{round}\PYG{p}{(} \PYG{n}{df}\PYG{o}{.}\PYG{n}{Quantity} \PYG{o}{*} \PYG{n}{df}\PYG{o}{.}\PYG{n}{UnitPrice}\PYG{p}{,} \PYG{l+m+mi}{2} \PYG{p}{)} \PYG{p}{)}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
calculate the time difference

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{mean}\PYG{p}{,} \PYG{n+nb}{min}\PYG{p}{,} \PYG{n+nb}{max}\PYG{p}{,} \PYG{n+nb}{sum}\PYG{p}{,} \PYG{n}{datediff}\PYG{p}{,} \PYG{n}{to\PYGZus{}date}

\PYG{n}{date\PYGZus{}max} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n+nb}{max}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NewInvoiceDate}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{current} \PYG{o}{=} \PYG{n}{to\PYGZus{}utc\PYGZus{}timestamp}\PYG{p}{(} \PYG{n}{unix\PYGZus{}timestamp}\PYG{p}{(}\PYG{n}{lit}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{date\PYGZus{}max}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,} \PYGZbs{}
                              \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yy\PYGZhy{}MM\PYGZhy{}dd HH:mm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{cast}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{timestamp}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{UTC}\PYG{l+s+s1}{\PYGZsq{}} \PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Calculatre Duration}
\PYG{n}{df} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Duration}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{datediff}\PYG{p}{(}\PYG{n}{lit}\PYG{p}{(}\PYG{n}{current}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NewInvoiceDate}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
build the Recency, Frequency and Monetary

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{recency} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{agg}\PYG{p}{(}\PYG{n+nb}{min}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Duration}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Recency}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{frequency} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{InvoiceNo}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{p}{)}\PYGZbs{}
                        \PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYGZbs{}
                        \PYG{o}{.}\PYG{n}{agg}\PYG{p}{(}\PYG{n}{count}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{*}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Frequency}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{monetary} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{agg}\PYG{p}{(}\PYG{n+nb}{round}\PYG{p}{(}\PYG{n+nb}{sum}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TotalPrice}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Monetary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{rfm} \PYG{o}{=} \PYG{n}{recency}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{frequency}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{how} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{inner}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYGZbs{}
             \PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{monetary}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{how} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{inner}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rfm}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{n}{Recency}\PYG{o}{\textbar{}}\PYG{n}{Frequency}\PYG{o}{\textbar{}}\PYG{n}{Monetary}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17420}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{50}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{598.83}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16861}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{59}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{151.65}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{106}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{1421.43}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15727}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{7}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5178.96}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17389}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{43}\PYG{o}{\textbar{}}\PYG{l+m+mf}{31300.08}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{RFM Segmentation}
\label{\detokenize{rfm:rfm-segmentation}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Determine cutting points

\end{enumerate}

In this section, you can use the techniques (statistical results and visualizations) in {\hyperref[\detokenize{exploration:exploration}]{\sphinxcrossref{\DUrole{std,std-ref}{Data Exploration}}}} section to help you determine the cutting points for each attribute. In my opinion, the cutting points are mainly depend on the business sense. You’s better talk to your makrting people and get feedback and suggestion from them. I will use the quantile as the cutting points in this demo.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cols} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Recency}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Frequency}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Monetary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{describe\PYGZus{}pd}\PYG{p}{(}\PYG{n}{rfm}\PYG{p}{,}\PYG{n}{cols}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{summary}\PYG{o}{\textbar{}}          \PYG{n}{Recency}\PYG{o}{\textbar{}}        \PYG{n}{Frequency}\PYG{o}{\textbar{}}          \PYG{n}{Monetary}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{count}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{4372.0}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{4372.0}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{4372.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{n}{mean}\PYG{o}{\textbar{}}\PYG{l+m+mf}{91.58119853613907}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5.07548032936871}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1898.4597003659655}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{n}{stddev}\PYG{o}{\textbar{}}\PYG{l+m+mf}{100.7721393138483}\PYG{o}{\textbar{}}\PYG{l+m+mf}{9.338754163574727}\PYG{o}{\textbar{}} \PYG{l+m+mf}{8219.345141139722}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{min}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}          \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{4287.63}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{max}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{373.0}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{248.0}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{279489.02}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{25}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{16.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{l+m+mf}{293.36249999999995}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{50}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{50.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{648.075}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{75}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{143.0}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{5.0}\PYG{o}{\textbar{}}          \PYG{l+m+mf}{1611.725}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

The user defined function by using the cutting points:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{RScore}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if}  \PYG{n}{x} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{16}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+m+mi}{1}
    \PYG{k}{elif} \PYG{n}{x}\PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{50}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+m+mi}{2}
    \PYG{k}{elif} \PYG{n}{x}\PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{143}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+m+mi}{3}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+m+mi}{4}

\PYG{k}{def} \PYG{n+nf}{FScore}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if}  \PYG{n}{x} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{1}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+m+mi}{4}
    \PYG{k}{elif} \PYG{n}{x} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{3}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+m+mi}{3}
    \PYG{k}{elif} \PYG{n}{x} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{5}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+m+mi}{2}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+m+mi}{1}

\PYG{k}{def} \PYG{n+nf}{MScore}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if}  \PYG{n}{x} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{293}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+m+mi}{4}
    \PYG{k}{elif} \PYG{n}{x} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{648}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+m+mi}{3}
    \PYG{k}{elif} \PYG{n}{x} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{1611}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+m+mi}{2}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+m+mi}{1}

\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{udf}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StringType}\PYG{p}{,} \PYG{n}{DoubleType}

\PYG{n}{R\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{RScore}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{F\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{FScore}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{M\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{MScore}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
RFM Segmentation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rfm\PYGZus{}seg} \PYG{o}{=} \PYG{n}{rfm}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{r\PYGZus{}seg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{R\PYGZus{}udf}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Recency}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{rfm\PYGZus{}seg} \PYG{o}{=} \PYG{n}{rfm\PYGZus{}seg}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{f\PYGZus{}seg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{F\PYGZus{}udf}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Frequency}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{rfm\PYGZus{}seg} \PYG{o}{=} \PYG{n}{rfm\PYGZus{}seg}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{m\PYGZus{}seg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{M\PYGZus{}udf}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Monetary}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{rfm\PYGZus{}seg}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{n}{Recency}\PYG{o}{\textbar{}}\PYG{n}{Frequency}\PYG{o}{\textbar{}}\PYG{n}{Monetary}\PYG{o}{\textbar{}}\PYG{n}{r\PYGZus{}seg}\PYG{o}{\textbar{}}\PYG{n}{f\PYGZus{}seg}\PYG{o}{\textbar{}}\PYG{n}{m\PYGZus{}seg}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17420}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{50}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{598.83}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16861}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{59}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{151.65}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{106}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{5}\PYG{o}{\textbar{}} \PYG{l+m+mf}{1421.43}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15727}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{7}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5178.96}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17389}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{43}\PYG{o}{\textbar{}}\PYG{l+m+mf}{31300.08}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rfm\PYGZus{}seg} \PYG{o}{=} \PYG{n}{rfm\PYGZus{}seg}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RFMScore}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{F}\PYG{o}{.}\PYG{n}{concat}\PYG{p}{(}\PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r\PYGZus{}seg}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}\PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{f\PYGZus{}seg}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m\PYGZus{}seg}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{rfm\PYGZus{}seg}\PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RFMScore}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{n}{Recency}\PYG{o}{\textbar{}}\PYG{n}{Frequency}\PYG{o}{\textbar{}}\PYG{n}{Monetary}\PYG{o}{\textbar{}}\PYG{n}{r\PYGZus{}seg}\PYG{o}{\textbar{}}\PYG{n}{f\PYGZus{}seg}\PYG{o}{\textbar{}}\PYG{n}{m\PYGZus{}seg}\PYG{o}{\textbar{}}\PYG{n}{RFMScore}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17988}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{11}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{191.17}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{111}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16892}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{7}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{496.84}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{112}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16668}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{306.72}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{112}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16554}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{7}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{641.55}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{112}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16500}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{400.86}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{112}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{Statistical Summary}
\label{\detokenize{rfm:statistical-summary}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Statistical Summary

\end{enumerate}
\begin{itemize}
\item {} 
simple summary

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rfm\PYGZus{}seg}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RFMScore}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYGZbs{}
       \PYG{o}{.}\PYG{n}{agg}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Recency}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mean}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Frequency}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mean}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Monetary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mean}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}} \PYG{p}{)}\PYGZbs{}
        \PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RFMScore}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{RFMScore}\PYG{o}{\textbar{}}     \PYG{n}{avg}\PYG{p}{(}\PYG{n}{Recency}\PYG{p}{)}\PYG{o}{\textbar{}}     \PYG{n}{avg}\PYG{p}{(}\PYG{n}{Monetary}\PYG{p}{)}\PYG{o}{\textbar{}}    \PYG{n}{avg}\PYG{p}{(}\PYG{n}{Frequency}\PYG{p}{)}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{111}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{191.17}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{112}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}}          \PYG{l+m+mf}{505.9775}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{7.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{113}\PYG{o}{\textbar{}}\PYG{l+m+mf}{7.237113402061856}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1223.3604123711339}\PYG{o}{\textbar{}} \PYG{l+m+mf}{7.752577319587629}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{114}\PYG{o}{\textbar{}}\PYG{l+m+mf}{6.035123966942149}\PYG{o}{\textbar{}} \PYG{l+m+mf}{8828.888595041324}\PYG{o}{\textbar{}}\PYG{l+m+mf}{18.882231404958677}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{121}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{9.6}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{207.24}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{4.4}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
complex summary

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{grp} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RFMScore}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{num\PYGZus{}cols} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Recency}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Frequency}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Monetary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{df\PYGZus{}input} \PYG{o}{=} \PYG{n}{rfm\PYGZus{}seg}

\PYG{n}{quantile\PYGZus{}grouped} \PYG{o}{=} \PYG{n}{quantile\PYGZus{}agg}\PYG{p}{(}\PYG{n}{df\PYGZus{}input}\PYG{p}{,}\PYG{n}{grp}\PYG{p}{,}\PYG{n}{num\PYGZus{}cols}\PYG{p}{)}
\PYG{n}{quantile\PYGZus{}grouped}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{quantile\PYGZus{}grouped.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{deciles\PYGZus{}grouped} \PYG{o}{=} \PYG{n}{deciles\PYGZus{}agg}\PYG{p}{(}\PYG{n}{df\PYGZus{}input}\PYG{p}{,}\PYG{n}{grp}\PYG{p}{,}\PYG{n}{num\PYGZus{}cols}\PYG{p}{)}
\PYG{n}{deciles\PYGZus{}grouped}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{deciles\PYGZus{}grouped.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Extension}
\label{\detokenize{rfm:extension}}
You can also apply the K-means clustering in {\hyperref[\detokenize{clustering:clustering}]{\sphinxcrossref{\DUrole{std,std-ref}{Clustering}}}} section to do the segmentation.


\subsection{Build feature matrix}
\label{\detokenize{rfm:build-feature-matrix}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
build dense feature matrix

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{Row}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors}

\PYG{c+c1}{\PYGZsh{} method 1 (good for small feature):}
\PYG{c+c1}{\PYGZsh{}def transData(row):}
\PYG{c+c1}{\PYGZsh{}    return Row(label=row[\PYGZdq{}Sales\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}               features=Vectors.dense([row[\PYGZdq{}TV\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}                                       row[\PYGZdq{}Radio\PYGZdq{}],}
\PYG{c+c1}{\PYGZsh{}                                       row[\PYGZdq{}Newspaper\PYGZdq{}]]))}

\PYG{c+c1}{\PYGZsh{} Method 2 (good for large features):}
\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{r}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rfm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{transformed}\PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{rfm}\PYG{p}{)}
\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}                \PYG{n}{rfm}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17420}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{50.0}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{598.83}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16861}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{59.0}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{151.65}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{106.0}\PYG{p}{,}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1421.43}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15727}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{16.0}\PYG{p}{,}\PYG{l+m+mf}{7.0}\PYG{p}{,}\PYG{l+m+mf}{5178.96}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17389}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{43.0}\PYG{p}{,}\PYG{l+m+mf}{31300.08}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Scaler the feature matrix

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{MinMaxScaler}

\PYG{n}{scaler} \PYG{o}{=} \PYG{n}{MinMaxScaler}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rfm}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYGZbs{}
         \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{scalerModel} \PYG{o}{=}  \PYG{n}{scaler}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\PYG{n}{scaledData} \PYG{o}{=} \PYG{n}{scalerModel}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{transformed}\PYG{p}{)}
\PYG{n}{scaledData}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{n}{rfm}                \PYG{o}{\textbar{}}\PYG{n}{features}                                                      \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{17420}     \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{50.0}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{598.83}\PYG{p}{]}  \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.13404825737265416}\PYG{p}{,}\PYG{l+m+mf}{0.008097165991902834}\PYG{p}{,}\PYG{l+m+mf}{0.01721938714830836}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{16861}     \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{59.0}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{151.65}\PYG{p}{]}  \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.1581769436997319}\PYG{p}{,}\PYG{l+m+mf}{0.008097165991902834}\PYG{p}{,}\PYG{l+m+mf}{0.01564357039241953}\PYG{p}{]} \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{16503}     \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{106.0}\PYG{p}{,}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1421.43}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.28418230563002683}\PYG{p}{,}\PYG{l+m+mf}{0.016194331983805668}\PYG{p}{,}\PYG{l+m+mf}{0.02011814573186342}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{15727}     \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{16.0}\PYG{p}{,}\PYG{l+m+mf}{7.0}\PYG{p}{,}\PYG{l+m+mf}{5178.96}\PYG{p}{]} \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.04289544235924933}\PYG{p}{,}\PYG{l+m+mf}{0.024291497975708502}\PYG{p}{,}\PYG{l+m+mf}{0.03335929858922501}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{17389}     \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{43.0}\PYG{p}{,}\PYG{l+m+mf}{31300.08}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{0.1700404858299595}\PYG{p}{,}\PYG{l+m+mf}{0.12540746393334334}\PYG{p}{]}                  \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{K-means clustering}
\label{\detokenize{rfm:k-means-clustering}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Find optimal number of cluster

\end{enumerate}

I will present two popular ways to determine the optimal number of the cluster.
\begin{itemize}
\item {} 
elbow analysis

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}PySpark libraries}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}\PYG{p}{,} \PYG{n}{percent\PYGZus{}rank}\PYG{p}{,} \PYG{n}{lit}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.window} \PYG{k+kn}{import} \PYG{n}{Window}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{DataFrame}\PYG{p}{,} \PYG{n}{Row}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StructType}
\PYG{k+kn}{from} \PYG{n+nn}{functools} \PYG{k+kn}{import} \PYG{n+nb}{reduce}  \PYG{c+c1}{\PYGZsh{} For Python 3.x}

\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.clustering} \PYG{k+kn}{import} \PYG{n}{KMeans}
\PYG{c+c1}{\PYGZsh{}from pyspark.ml.evaluation import ClusteringEvaluator  \PYGZsh{} requires Spark 2.4 or later}

\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
\PYG{n}{cost} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{zeros}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{kmeans} \PYG{o}{=} \PYG{n}{KMeans}\PYG{p}{(}\PYG{p}{)}\PYGZbs{}
            \PYG{o}{.}\PYG{n}{setK}\PYG{p}{(}\PYG{n}{k}\PYG{p}{)}\PYGZbs{}
            \PYG{o}{.}\PYG{n}{setSeed}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)} \PYGZbs{}
            \PYG{o}{.}\PYG{n}{setFeaturesCol}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYGZbs{}
            \PYG{o}{.}\PYG{n}{setPredictionCol}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cluster}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{model} \PYG{o}{=} \PYG{n}{kmeans}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{scaledData}\PYG{p}{)}
    \PYG{n}{cost}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{computeCost}\PYG{p}{(}\PYG{n}{scaledData}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} requires Spark 2.0 or later}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.mlab} \PYG{k+kn}{as} \PYG{n+nn}{mlab}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.pyplot} \PYG{k+kn}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{seaborn} \PYG{k+kn}{as} \PYG{n+nn}{sbs}
\PYG{k+kn}{from} \PYG{n+nn}{matplotlib.ticker} \PYG{k+kn}{import} \PYG{n}{MaxNLocator}

\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{figsize} \PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{,}\PYG{n}{cost}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{:}\PYG{l+m+mi}{20}\PYG{p}{]}\PYG{p}{,} \PYG{n}{marker} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{o}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{k}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cost}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{xaxis}\PYG{o}{.}\PYG{n}{set\PYGZus{}major\PYGZus{}locator}\PYG{p}{(}\PYG{n}{MaxNLocator}\PYG{p}{(}\PYG{n}{integer}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{elbow_rfm}.png}
\caption{Cost v.s. the number of the clusters}\label{\detokenize{rfm:id3}}\label{\detokenize{rfm:fig-elbow-rfm}}\end{figure}

In my opinion, sometimes it’s hard to choose the number of the clusters. As shown in Figure {\hyperref[\detokenize{rfm:fig-elbow-rfm}]{\sphinxcrossref{\DUrole{std,std-ref}{Cost v.s. the number of the clusters}}}}, you can choose 3, 5 or even 8. I will choose \sphinxcode{\sphinxupquote{3}} in this demo.
\begin{itemize}
\item {} 
Silhouette analysis

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}PySpark libraries}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{OneHotEncoder}\PYG{p}{,} \PYG{n}{VectorAssembler}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}\PYG{p}{,} \PYG{n}{percent\PYGZus{}rank}\PYG{p}{,} \PYG{n}{lit}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.window} \PYG{k+kn}{import} \PYG{n}{Window}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{DataFrame}\PYG{p}{,} \PYG{n}{Row}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StructType}
\PYG{k+kn}{from} \PYG{n+nn}{functools} \PYG{k+kn}{import} \PYG{n+nb}{reduce}  \PYG{c+c1}{\PYGZsh{} For Python 3.x}

\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.clustering} \PYG{k+kn}{import} \PYG{n}{KMeans}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{ClusteringEvaluator}

\PYG{k}{def} \PYG{n+nf}{optimal\PYGZus{}k}\PYG{p}{(}\PYG{n}{df\PYGZus{}in}\PYG{p}{,}\PYG{n}{index\PYGZus{}col}\PYG{p}{,}\PYG{n}{k\PYGZus{}min}\PYG{p}{,} \PYG{n}{k\PYGZus{}max}\PYG{p}{,}\PYG{n}{num\PYGZus{}runs}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{    Determine optimal number of clusters by using Silhoutte Score Analysis.}
\PYG{l+s+sd}{    :param df\PYGZus{}in: the input dataframe}
\PYG{l+s+sd}{    :param index\PYGZus{}col: the name of the index column}
\PYG{l+s+sd}{    :param k\PYGZus{}min: the train dataset}
\PYG{l+s+sd}{    :param k\PYGZus{}min: the minmum number of the clusters}
\PYG{l+s+sd}{    :param k\PYGZus{}max: the maxmum number of the clusters}
\PYG{l+s+sd}{    :param num\PYGZus{}runs: the number of runs for each fixed clusters}

\PYG{l+s+sd}{    :return k: optimal number of the clusters}
\PYG{l+s+sd}{    :return silh\PYGZus{}lst: Silhouette score}
\PYG{l+s+sd}{    :return r\PYGZus{}table: the running results table}

\PYG{l+s+sd}{    :author: Wenqiang Feng}
\PYG{l+s+sd}{    :email:  WFeng@dstsystems.com}
\PYG{l+s+sd}{    \PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{n}{start} \PYG{o}{=} \PYG{n}{time}\PYG{o}{.}\PYG{n}{time}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{silh\PYGZus{}lst} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{n}{k\PYGZus{}lst} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n}{k\PYGZus{}min}\PYG{p}{,} \PYG{n}{k\PYGZus{}max}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}

    \PYG{n}{r\PYGZus{}table} \PYG{o}{=} \PYG{n}{df\PYGZus{}in}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{index\PYGZus{}col}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{r\PYGZus{}table} \PYG{o}{=} \PYG{n}{r\PYGZus{}table}\PYG{o}{.}\PYG{n}{set\PYGZus{}index}\PYG{p}{(}\PYG{n}{index\PYGZus{}col}\PYG{p}{)}
    \PYG{n}{centers} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{)}

    \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n}{k\PYGZus{}lst}\PYG{p}{:}
        \PYG{n}{silh\PYGZus{}val} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{run} \PYG{o+ow}{in} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{num\PYGZus{}runs}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}

            \PYG{c+c1}{\PYGZsh{} Trains a k\PYGZhy{}means model.}
            \PYG{n}{kmeans} \PYG{o}{=} \PYG{n}{KMeans}\PYG{p}{(}\PYG{p}{)}\PYGZbs{}
                    \PYG{o}{.}\PYG{n}{setK}\PYG{p}{(}\PYG{n}{k}\PYG{p}{)}\PYGZbs{}
                    \PYG{o}{.}\PYG{n}{setSeed}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{n}{size}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
            \PYG{n}{model} \PYG{o}{=} \PYG{n}{kmeans}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df\PYGZus{}in}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} Make predictions}
            \PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df\PYGZus{}in}\PYG{p}{)}
            \PYG{n}{r\PYGZus{}table}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cluster\PYGZus{}\PYGZob{}k\PYGZcb{}\PYGZus{}\PYGZob{}run\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{k}\PYG{o}{=}\PYG{n}{k}\PYG{p}{,} \PYG{n}{run}\PYG{o}{=}\PYG{n}{run}\PYG{p}{)}\PYG{p}{]}\PYG{o}{=} \PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prediction}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} Evaluate clustering by computing Silhouette score}
            \PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{ClusteringEvaluator}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{silhouette} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
            \PYG{n}{silh\PYGZus{}val}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{silhouette}\PYG{p}{)}

        \PYG{n}{silh\PYGZus{}array}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{asanyarray}\PYG{p}{(}\PYG{n}{silh\PYGZus{}val}\PYG{p}{)}
        \PYG{n}{silh\PYGZus{}lst}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{silh\PYGZus{}array}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}

    \PYG{n}{elapsed} \PYG{o}{=}  \PYG{n}{time}\PYG{o}{.}\PYG{n}{time}\PYG{p}{(}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{start}

    \PYG{n}{silhouette} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{k\PYGZus{}lst}\PYG{p}{,}\PYG{n}{silh\PYGZus{}lst}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{n}{columns} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{k}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{silhouette}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

    \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\textbar{}         The finding optimal k phase took }\PYG{l+s+si}{\PYGZpc{}8.0f}\PYG{l+s+s2}{ s.       \textbar{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}}\PYG{p}{(}\PYG{n}{elapsed}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}


    \PYG{k}{return} \PYG{n}{k\PYGZus{}lst}\PYG{p}{[}\PYG{n}{np}\PYG{o}{.}\PYG{n}{argmax}\PYG{p}{(}\PYG{n}{silh\PYGZus{}lst}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{silhouette} \PYG{p}{,} \PYG{n}{r\PYGZus{}table}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{k}\PYG{p}{,} \PYG{n}{silh\PYGZus{}lst}\PYG{p}{,} \PYG{n}{r\PYGZus{}table} \PYG{o}{=} \PYG{n}{optimal\PYGZus{}k}\PYG{p}{(}\PYG{n}{scaledData}\PYG{p}{,}\PYG{n}{index\PYGZus{}col}\PYG{p}{,}\PYG{n}{k\PYGZus{}min}\PYG{p}{,} \PYG{n}{k\PYGZus{}max}\PYG{p}{,}\PYG{n}{num\PYGZus{}runs}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{The} \PYG{n}{finding} \PYG{n}{optimal} \PYG{n}{k} \PYG{n}{phase} \PYG{n}{took}     \PYG{l+m+mi}{1783} \PYG{n}{s}\PYG{o}{.}       \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{silh\PYGZus{}lst}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{k}\PYG{o}{\textbar{}}        \PYG{n}{silhouette}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.8045154385557953}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.6993528775512052}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.6689286654221447}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.6356184024841809}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{7}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.7174102265711756}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.6720861758298997}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mi}{9}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.601771359881241}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mi}{10}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.6292447334578428}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

From the silhouette list, we can choose \sphinxcode{\sphinxupquote{3}} as the optimal number of the clusters.

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxcode{\sphinxupquote{ClusteringEvaluator}} in \sphinxcode{\sphinxupquote{pyspark.ml.evaluation}} requires Spark 2.4 or later!!
\end{sphinxadmonition}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
K-means clustering

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{k} \PYG{o}{=} \PYG{l+m+mi}{3}
\PYG{n}{kmeans} \PYG{o}{=} \PYG{n}{KMeans}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{setK}\PYG{p}{(}\PYG{n}{k}\PYG{p}{)}\PYG{o}{.}\PYG{n}{setSeed}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{kmeans}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{scaledData}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Make predictions}
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{scaledData}\PYG{p}{)}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}                \PYG{n}{rfm}\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}}\PYG{n}{prediction}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17420}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{50.0}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{598.83}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.13404825737265}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}         \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16861}\PYG{o}{\textbar{}}  \PYG{p}{[}\PYG{l+m+mf}{59.0}\PYG{p}{,}\PYG{l+m+mf}{3.0}\PYG{p}{,}\PYG{l+m+mf}{151.65}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.15817694369973}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}         \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{106.0}\PYG{p}{,}\PYG{l+m+mf}{5.0}\PYG{p}{,}\PYG{l+m+mf}{1421.43}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.28418230563002}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}         \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15727}\PYG{o}{\textbar{}} \PYG{p}{[}\PYG{l+m+mf}{16.0}\PYG{p}{,}\PYG{l+m+mf}{7.0}\PYG{p}{,}\PYG{l+m+mf}{5178.96}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.04289544235924}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}         \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17389}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{43.0}\PYG{p}{,}\PYG{l+m+mf}{31300.08}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,}\PYG{l+m+mf}{0.1700404858}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}         \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{Statistical summary}
\label{\detokenize{rfm:id1}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
statistical summary

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{results} \PYG{o}{=} \PYG{n}{rfm}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prediction}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{results}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{n}{Recency}\PYG{o}{\textbar{}}\PYG{n}{Frequency}\PYG{o}{\textbar{}}\PYG{n}{Monetary}\PYG{o}{\textbar{}}\PYG{n}{prediction}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{13098}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{41}\PYG{o}{\textbar{}}\PYG{l+m+mf}{28658.88}\PYG{o}{\textbar{}}         \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{13248}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{124}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{465.68}\PYG{o}{\textbar{}}         \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{13452}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{259}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{590.0}\PYG{o}{\textbar{}}         \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{13460}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{29}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{183.44}\PYG{o}{\textbar{}}         \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{13518}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{85}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{659.44}\PYG{o}{\textbar{}}         \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
simple summary

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{results}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prediction}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYGZbs{}
       \PYG{o}{.}\PYG{n}{agg}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Recency}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mean}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Frequency}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mean}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Monetary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mean}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}} \PYG{p}{)}\PYGZbs{}
        \PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{prediction}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{prediction}\PYG{o}{\textbar{}}      \PYG{n}{avg}\PYG{p}{(}\PYG{n}{Recency}\PYG{p}{)}\PYG{o}{\textbar{}}     \PYG{n}{avg}\PYG{p}{(}\PYG{n}{Monetary}\PYG{p}{)}\PYG{o}{\textbar{}}    \PYG{n}{avg}\PYG{p}{(}\PYG{n}{Frequency}\PYG{p}{)}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}\PYG{l+m+mf}{30.966337980278816}\PYG{o}{\textbar{}}\PYG{l+m+mf}{2543.0355321319284}\PYG{o}{\textbar{}} \PYG{l+m+mf}{6.514450867052023}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}         \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{296.02403846153845}\PYG{o}{\textbar{}}\PYG{l+m+mf}{407.16831730769206}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.5592948717948718}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}         \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}\PYG{l+m+mf}{154.40148698884758}\PYG{o}{\textbar{}} \PYG{l+m+mf}{702.5096406443623}\PYG{o}{\textbar{}} \PYG{l+m+mf}{2.550185873605948}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
complex summary

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{grp} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RFMScore}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{num\PYGZus{}cols} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Recency}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Frequency}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Monetary}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{df\PYGZus{}input} \PYG{o}{=} \PYG{n}{results}

\PYG{n}{quantile\PYGZus{}grouped} \PYG{o}{=} \PYG{n}{quantile\PYGZus{}agg}\PYG{p}{(}\PYG{n}{df\PYGZus{}input}\PYG{p}{,}\PYG{n}{grp}\PYG{p}{,}\PYG{n}{num\PYGZus{}cols}\PYG{p}{)}
\PYG{n}{quantile\PYGZus{}grouped}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{quantile\PYGZus{}grouped.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{deciles\PYGZus{}grouped} \PYG{o}{=} \PYG{n}{deciles\PYGZus{}agg}\PYG{p}{(}\PYG{n}{df\PYGZus{}input}\PYG{p}{,}\PYG{n}{grp}\PYG{p}{,}\PYG{n}{num\PYGZus{}cols}\PYG{p}{)}
\PYG{n}{deciles\PYGZus{}grouped}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{deciles\PYGZus{}grouped.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}


\chapter{Text Mining}
\label{\detokenize{textmining:text-mining}}\label{\detokenize{textmining:textmining}}\label{\detokenize{textmining::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

\sphinxstylestrong{Articles showed more than intended.}  \textendash{} Xianglong Shen
\end{sphinxadmonition}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{sen_word_freq}.png}
\end{figure}


\section{Text Collection}
\label{\detokenize{textmining:text-collection}}\label{\detokenize{textmining:textcollection}}

\subsection{Image to text}
\label{\detokenize{textmining:image-to-text}}\label{\detokenize{textmining:img2text}}\begin{itemize}
\item {} 
My \sphinxcode{\sphinxupquote{img2txt}} function

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{img2txt}\PYG{p}{(}\PYG{n}{img\PYGZus{}dir}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    convert images to text}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{k+kn}{import} \PYG{n+nn}{os}\PYG{o}{,} \PYG{n+nn}{PythonMagick}
    \PYG{k+kn}{from} \PYG{n+nn}{datetime} \PYG{k+kn}{import} \PYG{n}{datetime}
    \PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}

    \PYG{k+kn}{from} \PYG{n+nn}{PIL} \PYG{k+kn}{import} \PYG{n}{Image}
    \PYG{k+kn}{import} \PYG{n+nn}{pytesseract}

    \PYG{n}{f} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{doc4img.txt}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{wa}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{img} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{img\PYGZus{}file} \PYG{k}{for} \PYG{n}{img\PYGZus{}file} \PYG{o+ow}{in} \PYG{n}{os}\PYG{o}{.}\PYG{n}{listdir}\PYG{p}{(}\PYG{n}{img\PYGZus{}dir}\PYG{p}{)}
                \PYG{k}{if} \PYG{p}{(}\PYG{n}{img\PYGZus{}file}\PYG{o}{.}\PYG{n}{endswith}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.png}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{o+ow}{or}
                    \PYG{n}{img\PYGZus{}file}\PYG{o}{.}\PYG{n}{endswith}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.jpg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{o+ow}{or}
                    \PYG{n}{img\PYGZus{}file}\PYG{o}{.}\PYG{n}{endswith}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.jpeg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{:}

        \PYG{n}{start\PYGZus{}time} \PYG{o}{=} \PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)}

        \PYG{n}{input\PYGZus{}img} \PYG{o}{=} \PYG{n}{img\PYGZus{}dir} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{img}

        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{print}\PYG{p}{(}\PYG{n}{img}\PYG{p}{)}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Converting }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{img} \PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.......}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} extract the text information from images}
        \PYG{n}{text} \PYG{o}{=} \PYG{n}{pytesseract}\PYG{o}{.}\PYG{n}{image\PYGZus{}to\PYGZus{}string}\PYG{p}{(}\PYG{n}{Image}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{input\PYGZus{}img}\PYG{p}{)}\PYG{p}{)}
        \PYG{k}{print}\PYG{p}{(}\PYG{n}{text}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} ouput text file}
        \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(} \PYG{n}{img} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(}\PYG{n}{text}\PYG{o}{.}\PYG{n}{encode}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{utf\PYGZhy{}8}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}


        \PYG{k}{print} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{CPU Time for converting}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{img} \PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{:}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{start\PYGZus{}time}\PYG{p}{)} \PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{f}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Demo

\end{itemize}

I applied my \sphinxcode{\sphinxupquote{img2txt}} function to the  image in \sphinxhref{static/feng.pdf\_0.png}{Image folder}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{image\PYGZus{}dir} \PYG{o}{=} \PYG{l+s+sa}{r}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Image}\PYG{l+s+s2}{\PYGZdq{}}

\PYG{n}{img2txt}\PYG{p}{(}\PYG{n}{image\PYGZus{}dir}\PYG{p}{)}
\end{sphinxVerbatim}

Then I got the following results:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
feng.pdf\PYGZus{}0.png
Converting feng.pdf\PYGZus{}0.png.......
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
l I l w

Wenqiang Feng
Data Scientist
DST APPLIED ANALYTICS GROUP



Wenqiang Feng is Data Scientist \PYG{k}{for} DST’s Applied Analytics Group. Dr. Feng’s responsibilities
include providing DST clients with access to cutting—edge skills and technologies, including Big
Data analytic solutions, advanced analytic and data enhancement techniques and modeling.

Dr. Feng has deep analytic expertise in data mining, analytic systems, machine learning
algorithms, business intelligence, and applying Big Data tools to strategically solve industry
problems in a cross—functional business. Before joining the DST Applied Analytics Group, Dr.
Feng holds a MA Data Science Fellow at The Institute \PYG{k}{for} Mathematics and Its Applications
\PYG{o}{\PYGZob{}}IMA\PYG{o}{)} at the University of Minnesota. While there, he helped startup companies make
marketing decisions based on deep predictive analytics.

Dr. Feng graduated from University of Tennessee, Knoxville with PhD in Computational
mathematics and Master’s degree in Statistics. He also holds Master’s degree in Computational
Mathematics at Missouri University of Science and Technology \PYG{o}{(}MST\PYG{o}{)} and Master’s degree in
Applied Mathematics at University of science and technology of China \PYG{o}{(}USTC\PYG{o}{)}.
CPU Time \PYG{k}{for} convertingfeng.pdf\PYGZus{}0.png:0:00:02.061208
\end{sphinxVerbatim}


\subsection{Image Enhnaced to text}
\label{\detokenize{textmining:image-enhnaced-to-text}}\begin{itemize}
\item {} 
My \sphinxcode{\sphinxupquote{img2txt\_enhance}} function

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{img2txt\PYGZus{}enhance}\PYG{p}{(}\PYG{n}{img\PYGZus{}dir}\PYG{p}{,}\PYG{n}{scaler}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    convert images files to text}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}

    \PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
    \PYG{k+kn}{import} \PYG{n+nn}{os}\PYG{o}{,} \PYG{n+nn}{PythonMagick}
    \PYG{k+kn}{from} \PYG{n+nn}{datetime} \PYG{k+kn}{import} \PYG{n}{datetime}
    \PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}

    \PYG{k+kn}{from} \PYG{n+nn}{PIL} \PYG{k+kn}{import} \PYG{n}{Image}\PYG{p}{,} \PYG{n}{ImageEnhance}\PYG{p}{,} \PYG{n}{ImageFilter}
    \PYG{k+kn}{import} \PYG{n+nn}{pytesseract}

    \PYG{n}{f} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{doc4img.txt}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{wa}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{img} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{img\PYGZus{}file} \PYG{k}{for} \PYG{n}{img\PYGZus{}file} \PYG{o+ow}{in} \PYG{n}{os}\PYG{o}{.}\PYG{n}{listdir}\PYG{p}{(}\PYG{n}{img\PYGZus{}dir}\PYG{p}{)}
                \PYG{k}{if} \PYG{p}{(}\PYG{n}{img\PYGZus{}file}\PYG{o}{.}\PYG{n}{endswith}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.png}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{o+ow}{or}
                    \PYG{n}{img\PYGZus{}file}\PYG{o}{.}\PYG{n}{endswith}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.jpg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{o+ow}{or}
                    \PYG{n}{img\PYGZus{}file}\PYG{o}{.}\PYG{n}{endswith}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.jpeg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{:}

        \PYG{n}{start\PYGZus{}time} \PYG{o}{=} \PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)}

        \PYG{n}{input\PYGZus{}img} \PYG{o}{=} \PYG{n}{img\PYGZus{}dir} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{img}
        \PYG{n}{enhanced\PYGZus{}img} \PYG{o}{=} \PYG{n}{img\PYGZus{}dir} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Enhanced}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{+} \PYG{n}{img}

        \PYG{n}{im} \PYG{o}{=} \PYG{n}{Image}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{input\PYGZus{}img}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} the second one}
        \PYG{n}{im} \PYG{o}{=} \PYG{n}{im}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{n}{ImageFilter}\PYG{o}{.}\PYG{n}{MedianFilter}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{enhancer} \PYG{o}{=} \PYG{n}{ImageEnhance}\PYG{o}{.}\PYG{n}{Contrast}\PYG{p}{(}\PYG{n}{im}\PYG{p}{)}
        \PYG{n}{im} \PYG{o}{=} \PYG{n}{enhancer}\PYG{o}{.}\PYG{n}{enhance}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
        \PYG{n}{im} \PYG{o}{=} \PYG{n}{im}\PYG{o}{.}\PYG{n}{convert}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{im}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{enhanced\PYGZus{}img}\PYG{p}{)}

        \PYG{k}{for} \PYG{n}{scale} \PYG{o+ow}{in} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ones}\PYG{p}{(}\PYG{n}{scaler}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{im} \PYG{o}{=} \PYG{n}{Image}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{enhanced\PYGZus{}img}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} the second one}
            \PYG{n}{im} \PYG{o}{=} \PYG{n}{im}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{n}{ImageFilter}\PYG{o}{.}\PYG{n}{MedianFilter}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
            \PYG{n}{enhancer} \PYG{o}{=} \PYG{n}{ImageEnhance}\PYG{o}{.}\PYG{n}{Contrast}\PYG{p}{(}\PYG{n}{im}\PYG{p}{)}
            \PYG{n}{im} \PYG{o}{=} \PYG{n}{enhancer}\PYG{o}{.}\PYG{n}{enhance}\PYG{p}{(}\PYG{n}{scale}\PYG{p}{)}
            \PYG{n}{im} \PYG{o}{=} \PYG{n}{im}\PYG{o}{.}\PYG{n}{convert}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
            \PYG{n}{im}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{enhanced\PYGZus{}img}\PYG{p}{)}



        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{print}\PYG{p}{(}\PYG{n}{img}\PYG{p}{)}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Converting }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{img} \PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.......}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} extract the text information from images}
        \PYG{n}{text} \PYG{o}{=} \PYG{n}{pytesseract}\PYG{o}{.}\PYG{n}{image\PYGZus{}to\PYGZus{}string}\PYG{p}{(}\PYG{n}{Image}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{enhanced\PYGZus{}img}\PYG{p}{)}\PYG{p}{)}
        \PYG{k}{print}\PYG{p}{(}\PYG{n}{text}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} ouput text file}
        \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(} \PYG{n}{img} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(}\PYG{n}{text}\PYG{o}{.}\PYG{n}{encode}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{utf\PYGZhy{}8}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}


        \PYG{k}{print} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{CPU Time for converting}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{img} \PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{:}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{start\PYGZus{}time}\PYG{p}{)} \PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}
        \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

    \PYG{n}{f}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Demo

\end{itemize}

I applied my \sphinxcode{\sphinxupquote{img2txt\_enhance}} function to the following noised image in \sphinxhref{images/noised.jpg}{Enhance folder}.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{noised}.jpg}
\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{image\PYGZus{}dir} \PYG{o}{=} \PYG{l+s+sa}{r}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Enhance}\PYG{l+s+s2}{\PYGZdq{}}

\PYG{n}{pdf2txt\PYGZus{}enhance}\PYG{p}{(}\PYG{n}{image\PYGZus{}dir}\PYG{p}{)}
\end{sphinxVerbatim}

Then I got the following results:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
noised.jpg
Converting noised.jpg.......
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
zHHH
CPU Time \PYG{k}{for} convertingnoised.jpg:0:00:00.135465
\end{sphinxVerbatim}

while the result from \sphinxcode{\sphinxupquote{img2txt}} function is

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
noised.jpg
Converting noised.jpg.......
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
,2 WW
CPU Time \PYG{k}{for} convertingnoised.jpg:0:00:00.133508
\end{sphinxVerbatim}

which is not correct.


\subsection{PDF to text}
\label{\detokenize{textmining:pdf-to-text}}\label{\detokenize{textmining:pdf2text}}\begin{itemize}
\item {} 
My \sphinxcode{\sphinxupquote{pdf2txt}} function

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{pdf2txt}\PYG{p}{(}\PYG{n}{pdf\PYGZus{}dir}\PYG{p}{,}\PYG{n}{image\PYGZus{}dir}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    convert PDF to text}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}

    \PYG{k+kn}{import} \PYG{n+nn}{os}\PYG{o}{,} \PYG{n+nn}{PythonMagick}
    \PYG{k+kn}{from} \PYG{n+nn}{datetime} \PYG{k+kn}{import} \PYG{n}{datetime}
    \PYG{k+kn}{import} \PYG{n+nn}{PyPDF2}

    \PYG{k+kn}{from} \PYG{n+nn}{PIL} \PYG{k+kn}{import} \PYG{n}{Image}
    \PYG{k+kn}{import} \PYG{n+nn}{pytesseract}

    \PYG{n}{f} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{doc.txt}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{wa}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{pdf} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{pdf\PYGZus{}file} \PYG{k}{for} \PYG{n}{pdf\PYGZus{}file} \PYG{o+ow}{in} \PYG{n}{os}\PYG{o}{.}\PYG{n}{listdir}\PYG{p}{(}\PYG{n}{pdf\PYGZus{}dir}\PYG{p}{)} \PYG{k}{if} \PYG{n}{pdf\PYGZus{}file}\PYG{o}{.}\PYG{n}{endswith}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.pdf}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{]}\PYG{p}{:}

        \PYG{n}{start\PYGZus{}time} \PYG{o}{=} \PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)}

        \PYG{n}{input\PYGZus{}pdf} \PYG{o}{=} \PYG{n}{pdf\PYGZus{}dir} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{pdf}

        \PYG{n}{pdf\PYGZus{}im} \PYG{o}{=} \PYG{n}{PyPDF2}\PYG{o}{.}\PYG{n}{PdfFileReader}\PYG{p}{(}\PYG{n+nb}{file}\PYG{p}{(}\PYG{n}{input\PYGZus{}pdf}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rb}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{npage} \PYG{o}{=} \PYG{n}{pdf\PYGZus{}im}\PYG{o}{.}\PYG{n}{getNumPages}\PYG{p}{(}\PYG{p}{)}

        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{print}\PYG{p}{(}\PYG{n}{pdf}\PYG{p}{)}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Converting }\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{ pages.}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{npage}\PYG{p}{)}
        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

        \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

        \PYG{k}{for} \PYG{n}{p} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{npage}\PYG{p}{)}\PYG{p}{:}

            \PYG{n}{pdf\PYGZus{}file} \PYG{o}{=} \PYG{n}{input\PYGZus{}pdf} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{[}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{p}\PYG{p}{)} \PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{]}\PYG{l+s+s1}{\PYGZsq{}}
            \PYG{n}{image\PYGZus{}file} \PYG{o}{=}  \PYG{n}{image\PYGZus{}dir}  \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{pdf}\PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZus{}}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{p}\PYG{p}{)}\PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.png}\PYG{l+s+s1}{\PYGZsq{}}

            \PYG{c+c1}{\PYGZsh{} convert PDF files to Images}
            \PYG{n}{im} \PYG{o}{=} \PYG{n}{PythonMagick}\PYG{o}{.}\PYG{n}{Image}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{im}\PYG{o}{.}\PYG{n}{density}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{300}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
            \PYG{n}{im}\PYG{o}{.}\PYG{n}{read}\PYG{p}{(}\PYG{n}{pdf\PYGZus{}file}\PYG{p}{)}
            \PYG{n}{im}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(}\PYG{n}{image\PYGZus{}file}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{} extract the text information from images}
            \PYG{n}{text} \PYG{o}{=} \PYG{n}{pytesseract}\PYG{o}{.}\PYG{n}{image\PYGZus{}to\PYGZus{}string}\PYG{p}{(}\PYG{n}{Image}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{n}{image\PYGZus{}file}\PYG{p}{)}\PYG{p}{)}

            \PYG{c+c1}{\PYGZsh{}print(text)}

            \PYG{c+c1}{\PYGZsh{} ouput text file}
            \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(} \PYG{n}{pdf} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
            \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(}\PYG{n}{text}\PYG{o}{.}\PYG{n}{encode}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{utf\PYGZhy{}8}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}


        \PYG{k}{print} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{CPU Time for converting}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{pdf} \PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{:}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{start\PYGZus{}time}\PYG{p}{)} \PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}

    \PYG{n}{f}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Demo

\end{itemize}

I applied my \sphinxcode{\sphinxupquote{pdf2txt}} function to my scaned bio pdf file in \sphinxhref{static/pdf}{pdf folder}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pdf\PYGZus{}dir} \PYG{o}{=} \PYG{l+s+sa}{r}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pdf}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{image\PYGZus{}dir} \PYG{o}{=} \PYG{l+s+sa}{r}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Image}\PYG{l+s+s2}{\PYGZdq{}}

\PYG{n}{pdf2txt}\PYG{p}{(}\PYG{n}{pdf\PYGZus{}dir}\PYG{p}{,}\PYG{n}{image\PYGZus{}dir}\PYG{p}{)}
\end{sphinxVerbatim}

Then I got the following results:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
feng.pdf
Converting \PYG{l+m}{1} pages.
\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}
l I l w

Wenqiang Feng
Data Scientist
DST APPLIED ANALYTICS GROUP



Wenqiang Feng is Data Scientist \PYG{k}{for} DST’s Applied Analytics Group. Dr. Feng’s responsibilities
include providing DST clients with access to cutting—edge skills and technologies, including Big
Data analytic solutions, advanced analytic and data enhancement techniques and modeling.

Dr. Feng has deep analytic expertise in data mining, analytic systems, machine learning
algorithms, business intelligence, and applying Big Data tools to strategically solve industry
problems in a cross—functional business. Before joining the DST Applied Analytics Group, Dr.
Feng holds a MA Data Science Fellow at The Institute \PYG{k}{for} Mathematics and Its Applications
\PYG{o}{\PYGZob{}}IMA\PYG{o}{)} at the University of Minnesota. While there, he helped startup companies make
marketing decisions based on deep predictive analytics.

Dr. Feng graduated from University of Tennessee, Knoxville with PhD in Computational
mathematics and Master’s degree in Statistics. He also holds Master’s degree in Computational
Mathematics at Missouri University of Science and Technology \PYG{o}{(}MST\PYG{o}{)} and Master’s degree in
Applied Mathematics at University of science and technology of China \PYG{o}{(}USTC\PYG{o}{)}.
CPU Time \PYG{k}{for} convertingfeng.pdf:0:00:03.143800
\end{sphinxVerbatim}


\subsection{Audio to text}
\label{\detokenize{textmining:audio-to-text}}\label{\detokenize{textmining:audio2text}}\begin{itemize}
\item {} 
My \sphinxcode{\sphinxupquote{audio2txt}} function

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{audio2txt}\PYG{p}{(}\PYG{n}{audio\PYGZus{}dir}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{} convert audio to text\PYGZsq{}\PYGZsq{}\PYGZsq{}}

    \PYG{k+kn}{import} \PYG{n+nn}{speech\PYGZus{}recognition} \PYG{k+kn}{as} \PYG{n+nn}{sr}
    \PYG{n}{r} \PYG{o}{=} \PYG{n}{sr}\PYG{o}{.}\PYG{n}{Recognizer}\PYG{p}{(}\PYG{p}{)}

    \PYG{n}{f} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{doc.txt}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{wa}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{audio\PYGZus{}n} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{audio\PYGZus{}file} \PYG{k}{for} \PYG{n}{audio\PYGZus{}file} \PYG{o+ow}{in} \PYG{n}{os}\PYG{o}{.}\PYG{n}{listdir}\PYG{p}{(}\PYG{n}{audio\PYGZus{}dir}\PYG{p}{)} \PYGZbs{}
                  \PYG{k}{if} \PYG{n}{audio\PYGZus{}file}\PYG{o}{.}\PYG{n}{endswith}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.wav}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{]}\PYG{p}{:}

        \PYG{n}{filename} \PYG{o}{=} \PYG{n}{audio\PYGZus{}dir} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{audio\PYGZus{}n}

        \PYG{c+c1}{\PYGZsh{} Read audio data}
        \PYG{k}{with} \PYG{n}{sr}\PYG{o}{.}\PYG{n}{AudioFile}\PYG{p}{(}\PYG{n}{filename}\PYG{p}{)} \PYG{k}{as} \PYG{n}{source}\PYG{p}{:}
            \PYG{n}{audio} \PYG{o}{=} \PYG{n}{r}\PYG{o}{.}\PYG{n}{record}\PYG{p}{(}\PYG{n}{source}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} read the entire audio file}

        \PYG{c+c1}{\PYGZsh{} Google Speech Recognition}
        \PYG{n}{text} \PYG{o}{=} \PYG{n}{r}\PYG{o}{.}\PYG{n}{recognize\PYGZus{}google}\PYG{p}{(}\PYG{n}{audio}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} ouput text file}
        \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(} \PYG{n}{audio\PYGZus{}n} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{: }\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(}\PYG{n}{text}\PYG{o}{.}\PYG{n}{encode}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{utf\PYGZhy{}8}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

        \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{You said: }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{text}\PYG{p}{)}

    \PYG{n}{f}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Demo

\end{itemize}

I applied my \sphinxcode{\sphinxupquote{audio2txt}} function to my audio records in \sphinxhref{static/audio}{audio folder}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{audio\PYGZus{}dir} \PYG{o}{=} \PYG{l+s+sa}{r}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{audio}\PYG{l+s+s2}{\PYGZdq{}}

\PYG{n}{audio2txt}\PYG{p}{(}\PYG{n}{audio\PYGZus{}dir}\PYG{p}{)}
\end{sphinxVerbatim}

Then I got the following results:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{You} \PYG{n}{said}\PYG{p}{:} \PYG{n}{hello} \PYG{n}{this} \PYG{o+ow}{is} \PYG{n}{George} \PYG{n}{welcome} \PYG{n}{to} \PYG{n}{my} \PYG{n}{tutorial}
\PYG{n}{You} \PYG{n}{said}\PYG{p}{:} \PYG{n}{mathematics} \PYG{o+ow}{is} \PYG{n}{important} \PYG{o+ow}{in} \PYG{n}{daily} \PYG{n}{life}
\PYG{n}{You} \PYG{n}{said}\PYG{p}{:} \PYG{n}{call} \PYG{n}{me} \PYG{n}{tomorrow}
\PYG{n}{You} \PYG{n}{said}\PYG{p}{:} \PYG{n}{do} \PYG{n}{you} \PYG{n}{want} \PYG{n}{something} \PYG{n}{to} \PYG{n}{eat}
\PYG{n}{You} \PYG{n}{said}\PYG{p}{:} \PYG{n}{I} \PYG{n}{want} \PYG{n}{to} \PYG{n}{speak} \PYG{k}{with} \PYG{n}{him}
\PYG{n}{You} \PYG{n}{said}\PYG{p}{:} \PYG{n}{nice} \PYG{n}{to} \PYG{n}{see} \PYG{n}{you}
\PYG{n}{You} \PYG{n}{said}\PYG{p}{:} \PYG{n}{can} \PYG{n}{you} \PYG{n}{speak} \PYG{n}{slowly}
\PYG{n}{You} \PYG{n}{said}\PYG{p}{:} \PYG{n}{have} \PYG{n}{a} \PYG{n}{good} \PYG{n}{day}
\end{sphinxVerbatim}

By the way, you can use my following python code to record your own audio and play with \sphinxcode{\sphinxupquote{audio2txt}} function in Command-line \sphinxcode{\sphinxupquote{python record.py "demo2.wav"}}:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}\PYG{o}{,} \PYG{n+nn}{getopt}

\PYG{k+kn}{import} \PYG{n+nn}{speech\PYGZus{}recognition} \PYG{k+kn}{as} \PYG{n+nn}{sr}

\PYG{n}{audio\PYGZus{}filename} \PYG{o}{=} \PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}

\PYG{n}{r} \PYG{o}{=} \PYG{n}{sr}\PYG{o}{.}\PYG{n}{Recognizer}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{with} \PYG{n}{sr}\PYG{o}{.}\PYG{n}{Microphone}\PYG{p}{(}\PYG{p}{)} \PYG{k}{as} \PYG{n}{source}\PYG{p}{:}
    \PYG{n}{r}\PYG{o}{.}\PYG{n}{adjust\PYGZus{}for\PYGZus{}ambient\PYGZus{}noise}\PYG{p}{(}\PYG{n}{source}\PYG{p}{)}
    \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Hey there, say something, I am recording!}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{audio} \PYG{o}{=} \PYG{n}{r}\PYG{o}{.}\PYG{n}{listen}\PYG{p}{(}\PYG{n}{source}\PYG{p}{)}
    \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Done listening!}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{k}{with} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{audio\PYGZus{}filename}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{wb}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{k}{as} \PYG{n}{f}\PYG{p}{:}
    \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(}\PYG{n}{audio}\PYG{o}{.}\PYG{n}{get\PYGZus{}wav\PYGZus{}data}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Text Preprocessing}
\label{\detokenize{textmining:text-preprocessing}}\label{\detokenize{textmining:textpreprocessing}}\begin{itemize}
\item {} 
check to see if a row only contains whitespace

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{check\PYGZus{}blanks}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{is\PYGZus{}blank} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{isspace}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{is\PYGZus{}blank}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Determine whether the language of the text content is english or not: Use langid module to classify the language to make sure we are applying the correct cleanup actions for English langid

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{check\PYGZus{}lang}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{predict\PYGZus{}lang} \PYG{o}{=} \PYG{n}{langid}\PYG{o}{.}\PYG{n}{classify}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{k}{if} \PYG{n}{predict\PYGZus{}lang}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{o}{.}\PYG{l+m+mi}{9}\PYG{p}{:}
        \PYG{n}{language} \PYG{o}{=} \PYG{n}{predict\PYGZus{}lang}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{language} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NA}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{k}{return} \PYG{n}{language}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Remove features

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{remove\PYGZus{}features}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} compile regex}
    \PYG{n}{url\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https?://(www.)?}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{w+}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{.}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{w+(/}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{w+)*/?}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{punc\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{[}\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+s1}{]}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{re}\PYG{o}{.}\PYG{n}{escape}\PYG{p}{(}\PYG{n}{string}\PYG{o}{.}\PYG{n}{punctuation}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{num\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{(}\PYG{l+s+se}{\PYGZbs{}\PYGZbs{}}\PYG{l+s+s1}{d+)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{mention\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{@(}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{w+)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{alpha\PYGZus{}num\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZca{}[a\PYGZhy{}z0\PYGZhy{}9\PYGZus{}.]+\PYGZdl{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} convert to lowercase}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{lower}\PYG{p}{(}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove hyperlinks}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{url\PYGZus{}re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove @mentions}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{mention\PYGZus{}re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove puncuation}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{punc\PYGZus{}re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove numeric \PYGZsq{}words\PYGZsq{}}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{num\PYGZus{}re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove non a\PYGZhy{}z 0\PYGZhy{}9 characters and words shorter than 3 characters}
    \PYG{n}{list\PYGZus{}pos} \PYG{o}{=} \PYG{l+m+mi}{0}
    \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{k}{for} \PYG{n}{word} \PYG{o+ow}{in} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{list\PYGZus{}pos} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{alpha\PYGZus{}num\PYGZus{}re}\PYG{o}{.}\PYG{n}{match}\PYG{p}{(}\PYG{n}{word}\PYG{p}{)} \PYG{o+ow}{and} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{word}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{2}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{word}
            \PYG{k}{else}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{alpha\PYGZus{}num\PYGZus{}re}\PYG{o}{.}\PYG{n}{match}\PYG{p}{(}\PYG{n}{word}\PYG{p}{)} \PYG{o+ow}{and} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{word}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{2}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{word}
            \PYG{k}{else}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{+}\PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}
        \PYG{n}{list\PYGZus{}pos} \PYG{o}{+}\PYG{o}{=} \PYG{l+m+mi}{1}
    \PYG{k}{return} \PYG{n}{cleaned\PYGZus{}str}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
removes stop words

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{remove\PYGZus{}stops}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} expects a string}
    \PYG{n}{stops} \PYG{o}{=} \PYG{n+nb}{set}\PYG{p}{(}\PYG{n}{stopwords}\PYG{o}{.}\PYG{n}{words}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{english}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{list\PYGZus{}pos} \PYG{o}{=} \PYG{l+m+mi}{0}
    \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{text} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{word} \PYG{o+ow}{in} \PYG{n}{text}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{word} \PYG{o+ow}{not} \PYG{o+ow}{in} \PYG{n}{stops}\PYG{p}{:}
            \PYG{c+c1}{\PYGZsh{} rebuild cleaned\PYGZus{}str}
            \PYG{k}{if} \PYG{n}{list\PYGZus{}pos} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{word}
            \PYG{k}{else}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{word}
            \PYG{n}{list\PYGZus{}pos} \PYG{o}{+}\PYG{o}{=} \PYG{l+m+mi}{1}
    \PYG{k}{return} \PYG{n}{cleaned\PYGZus{}str}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
tagging text

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{tag\PYGZus{}and\PYGZus{}remove}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{c+c1}{\PYGZsh{} noun tags}
    \PYG{n}{nn\PYGZus{}tags} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NN}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NNP}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NNP}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NNPS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NNS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
    \PYG{c+c1}{\PYGZsh{} adjectives}
    \PYG{n}{jj\PYGZus{}tags} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{JJ}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{JJR}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{JJS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
    \PYG{c+c1}{\PYGZsh{} verbs}
    \PYG{n}{vb\PYGZus{}tags} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VB}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VBD}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VBG}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VBN}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VBP}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VBZ}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
    \PYG{n}{nltk\PYGZus{}tags} \PYG{o}{=} \PYG{n}{nn\PYGZus{}tags} \PYG{o}{+} \PYG{n}{jj\PYGZus{}tags} \PYG{o}{+} \PYG{n}{vb\PYGZus{}tags}

    \PYG{c+c1}{\PYGZsh{} break string into \PYGZsq{}words\PYGZsq{}}
    \PYG{n}{text} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} tag the text and keep only those with the right tags}
    \PYG{n}{tagged\PYGZus{}text} \PYG{o}{=} \PYG{n}{pos\PYGZus{}tag}\PYG{p}{(}\PYG{n}{text}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{tagged\PYGZus{}word} \PYG{o+ow}{in} \PYG{n}{tagged\PYGZus{}text}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{tagged\PYGZus{}word}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o+ow}{in} \PYG{n}{nltk\PYGZus{}tags}\PYG{p}{:}
            \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{+}\PYG{o}{=} \PYG{n}{tagged\PYGZus{}word}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}

    \PYG{k}{return} \PYG{n}{cleaned\PYGZus{}str}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
lemmatization

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{lemmatize}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} expects a string}
    \PYG{n}{list\PYGZus{}pos} \PYG{o}{=} \PYG{l+m+mi}{0}
    \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{lmtzr} \PYG{o}{=} \PYG{n}{WordNetLemmatizer}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{text} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{tagged\PYGZus{}words} \PYG{o}{=} \PYG{n}{pos\PYGZus{}tag}\PYG{p}{(}\PYG{n}{text}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{word} \PYG{o+ow}{in} \PYG{n}{tagged\PYGZus{}words}\PYG{p}{:}
        \PYG{k}{if} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{v}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o+ow}{in} \PYG{n}{word}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{lower}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{lemma} \PYG{o}{=} \PYG{n}{lmtzr}\PYG{o}{.}\PYG{n}{lemmatize}\PYG{p}{(}\PYG{n}{word}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{pos}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{v}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{n}{lemma} \PYG{o}{=} \PYG{n}{lmtzr}\PYG{o}{.}\PYG{n}{lemmatize}\PYG{p}{(}\PYG{n}{word}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{pos}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{n}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{if} \PYG{n}{list\PYGZus{}pos} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
            \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{lemma}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{lemma}
        \PYG{n}{list\PYGZus{}pos} \PYG{o}{+}\PYG{o}{=} \PYG{l+m+mi}{1}
    \PYG{k}{return} \PYG{n}{cleaned\PYGZus{}str}
\end{sphinxVerbatim}

\sphinxstylestrong{define the preprocessing function in PySpark}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{udf}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StringType}
\PYG{k+kn}{import} \PYG{n+nn}{preproc} \PYG{k+kn}{as} \PYG{n+nn}{pp}

\PYG{n}{check\PYGZus{}lang\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{pp}\PYG{o}{.}\PYG{n}{check\PYGZus{}lang}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{remove\PYGZus{}stops\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{pp}\PYG{o}{.}\PYG{n}{remove\PYGZus{}stops}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{remove\PYGZus{}features\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{pp}\PYG{o}{.}\PYG{n}{remove\PYGZus{}features}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{tag\PYGZus{}and\PYGZus{}remove\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{pp}\PYG{o}{.}\PYG{n}{tag\PYGZus{}and\PYGZus{}remove}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{lemmatize\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{pp}\PYG{o}{.}\PYG{n}{lemmatize}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{check\PYGZus{}blanks\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{pp}\PYG{o}{.}\PYG{n}{check\PYGZus{}blanks}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Text Classification}
\label{\detokenize{textmining:text-classification}}\label{\detokenize{textmining:textclassification}}
Theoretically speaking, you may apply any classification algorithms to do classification. I will only
present Naive Bayes method is the following.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{text_classification}.png}
\end{figure}


\subsection{Introduction}
\label{\detokenize{textmining:introduction}}

\subsection{Demo}
\label{\detokenize{textmining:demo}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
create spark contexts

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{pyspark}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SQLContext}

\PYG{c+c1}{\PYGZsh{} create spark contexts}
\PYG{n}{sc} \PYG{o}{=} \PYG{n}{pyspark}\PYG{o}{.}\PYG{n}{SparkContext}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{sqlContext} \PYG{o}{=} \PYG{n}{SQLContext}\PYG{p}{(}\PYG{n}{sc}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Load a text file and convert each line to a Row.}
\PYG{n}{data\PYGZus{}rdd} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{textFile}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{../data/raw\PYGZus{}data.txt}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{parts\PYGZus{}rdd} \PYG{o}{=} \PYG{n}{data\PYGZus{}rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{l}\PYG{p}{:} \PYG{n}{l}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}t}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Filter bad rows out}
\PYG{n}{garantee\PYGZus{}col\PYGZus{}rdd} \PYG{o}{=} \PYG{n}{parts\PYGZus{}rdd}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{l}\PYG{p}{:} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{l}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{n}{typed\PYGZus{}rdd} \PYG{o}{=} \PYG{n}{garantee\PYGZus{}col\PYGZus{}rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{p}\PYG{p}{:} \PYG{p}{(}\PYG{n}{p}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{p}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{p}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Create DataFrame}
\PYG{n}{data\PYGZus{}df} \PYG{o}{=} \PYG{n}{sqlContext}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{typed\PYGZus{}rdd}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{id}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} get the raw columns}
\PYG{n}{raw\PYGZus{}cols} \PYG{o}{=} \PYG{n}{data\PYGZus{}df}\PYG{o}{.}\PYG{n}{columns}

\PYG{c+c1}{\PYGZsh{}data\PYGZus{}df.show()}
\PYG{n}{data\PYGZus{}df}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{text}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n+nb}{id}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{label}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}                \PYG{n}{text}\PYG{o}{\textbar{}}                \PYG{n+nb}{id}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{Fresh} \PYG{n}{install} \PYG{n}{of} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{1018769417}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{Well}\PYG{o}{.} \PYG{n}{Now} \PYG{n}{I} \PYG{n}{know} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{10284216536}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Literally six we...\textbar{}       10298589026\textbar{}  1.0\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{Mitsubishi} \PYG{n}{i} \PYG{n}{MiEV}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{109017669432377344}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
setup pyspark udf function

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{udf}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StringType}
\PYG{k+kn}{import} \PYG{n+nn}{preproc} \PYG{k+kn}{as} \PYG{n+nn}{pp}

\PYG{c+c1}{\PYGZsh{} Register all the functions in Preproc with Spark Context}
\PYG{n}{check\PYGZus{}lang\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{pp}\PYG{o}{.}\PYG{n}{check\PYGZus{}lang}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{remove\PYGZus{}stops\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{pp}\PYG{o}{.}\PYG{n}{remove\PYGZus{}stops}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{remove\PYGZus{}features\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{pp}\PYG{o}{.}\PYG{n}{remove\PYGZus{}features}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{tag\PYGZus{}and\PYGZus{}remove\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{pp}\PYG{o}{.}\PYG{n}{tag\PYGZus{}and\PYGZus{}remove}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{lemmatize\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{pp}\PYG{o}{.}\PYG{n}{lemmatize}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{check\PYGZus{}blanks\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{pp}\PYG{o}{.}\PYG{n}{check\PYGZus{}blanks}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
language identification

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{lang\PYGZus{}df} \PYG{o}{=} \PYG{n}{data\PYGZus{}df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{lang}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{check\PYGZus{}lang\PYGZus{}udf}\PYG{p}{(}\PYG{n}{data\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{en\PYGZus{}df} \PYG{o}{=} \PYG{n}{lang\PYGZus{}df}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{n}{lang\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{lang}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{en}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{en\PYGZus{}df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{p}{\textbar{}}                text\PYG{p}{\textbar{}}                id\PYG{p}{\textbar{}}label\PYG{p}{\textbar{}}lang\PYG{p}{\textbar{}}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{p}{\textbar{}}RT @goeentertain:...\PYG{p}{\textbar{}}\PYG{l+m}{665305154954989568}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}  en\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}Teforia Uses Mach...\PYG{p}{\textbar{}}\PYG{l+m}{660668007975268352}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}  en\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}   Apple TV or Roku?\PYG{p}{\textbar{}}       \PYG{l+m}{25842461136}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}  en\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}Finished http://t...\PYG{p}{\textbar{}}        \PYG{l+m}{9412369614}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}  en\PYG{p}{\textbar{}}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
only showing top \PYG{l+m}{4} rows
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
remove stop words

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rm\PYGZus{}stops\PYGZus{}df} \PYG{o}{=} \PYG{n}{en\PYGZus{}df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{raw\PYGZus{}cols}\PYG{p}{)}\PYGZbs{}
                   \PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{stop\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{remove\PYGZus{}stops\PYGZus{}udf}\PYG{p}{(}\PYG{n}{en\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{rm\PYGZus{}stops\PYGZus{}df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{p}{\textbar{}}                text\PYG{p}{\textbar{}}                id\PYG{p}{\textbar{}}label\PYG{p}{\textbar{}}           stop\PYGZus{}text\PYG{p}{\textbar{}}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{p}{\textbar{}}RT @goeentertain:...\PYG{p}{\textbar{}}\PYG{l+m}{665305154954989568}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}RT @goeentertain:...\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}Teforia Uses Mach...\PYG{p}{\textbar{}}\PYG{l+m}{660668007975268352}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}Teforia Uses Mach...\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}   Apple TV or Roku?\PYG{p}{\textbar{}}       \PYG{l+m}{25842461136}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}      Apple TV Roku?\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}Finished http://t...\PYG{p}{\textbar{}}        \PYG{l+m}{9412369614}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}Finished http://t...\PYG{p}{\textbar{}}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
only showing top \PYG{l+m}{4} rows
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
remove irrelevant features

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rm\PYGZus{}features\PYGZus{}df} \PYG{o}{=} \PYG{n}{rm\PYGZus{}stops\PYGZus{}df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{raw\PYGZus{}cols}\PYG{o}{+}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{stop\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}\PYGZbs{}
                            \PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{feat\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                            \PYG{n}{remove\PYGZus{}features\PYGZus{}udf}\PYG{p}{(}\PYG{n}{rm\PYGZus{}stops\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{stop\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{rm\PYGZus{}features\PYGZus{}df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{p}{\textbar{}}                text\PYG{p}{\textbar{}}                id\PYG{p}{\textbar{}}label\PYG{p}{\textbar{}}           stop\PYGZus{}text\PYG{p}{\textbar{}}           feat\PYGZus{}text\PYG{p}{\textbar{}}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{p}{\textbar{}}RT @goeentertain:...\PYG{p}{\textbar{}}\PYG{l+m}{665305154954989568}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}RT @goeentertain:...\PYG{p}{\textbar{}}  future blase   ...\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}Teforia Uses Mach...\PYG{p}{\textbar{}}\PYG{l+m}{660668007975268352}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}Teforia Uses Mach...\PYG{p}{\textbar{}}teforia uses mach...\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}   Apple TV or Roku?\PYG{p}{\textbar{}}       \PYG{l+m}{25842461136}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}      Apple TV Roku?\PYG{p}{\textbar{}}         apple  roku\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}Finished http://t...\PYG{p}{\textbar{}}        \PYG{l+m}{9412369614}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}Finished http://t...\PYG{p}{\textbar{}}            finished\PYG{p}{\textbar{}}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
only showing top \PYG{l+m}{4} rows
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
tag the words

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{tagged\PYGZus{}df} \PYG{o}{=} \PYG{n}{rm\PYGZus{}features\PYGZus{}df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{raw\PYGZus{}cols}\PYG{o}{+}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{feat\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)} \PYGZbs{}
                          \PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{tagged\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                           \PYG{n}{tag\PYGZus{}and\PYGZus{}remove\PYGZus{}udf}\PYG{p}{(}\PYG{n}{rm\PYGZus{}features\PYGZus{}df}\PYG{o}{.}\PYG{n}{feat\PYGZus{}text}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{tagged\PYGZus{}df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{p}{\textbar{}}                text\PYG{p}{\textbar{}}                id\PYG{p}{\textbar{}}label\PYG{p}{\textbar{}}           feat\PYGZus{}text\PYG{p}{\textbar{}}         tagged\PYGZus{}text\PYG{p}{\textbar{}}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{p}{\textbar{}}RT @goeentertain:...\PYG{p}{\textbar{}}\PYG{l+m}{665305154954989568}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}  future blase   ...\PYG{p}{\textbar{}} future blase vic...\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}Teforia Uses Mach...\PYG{p}{\textbar{}}\PYG{l+m}{660668007975268352}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}teforia uses mach...\PYG{p}{\textbar{}} teforia uses mac...\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}   Apple TV or Roku?\PYG{p}{\textbar{}}       \PYG{l+m}{25842461136}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}         apple  roku\PYG{p}{\textbar{}}         apple roku \PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}Finished http://t...\PYG{p}{\textbar{}}        \PYG{l+m}{9412369614}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}            finished\PYG{p}{\textbar{}}           finished \PYG{p}{\textbar{}}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
only showing top \PYG{l+m}{4} rows
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
lemmatization of words

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{lemm\PYGZus{}df} \PYG{o}{=} \PYG{n}{tagged\PYGZus{}df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{raw\PYGZus{}cols}\PYG{o}{+}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{tagged\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)} \PYGZbs{}
                   \PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{lemm\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{lemmatize\PYGZus{}udf}\PYG{p}{(}\PYG{n}{tagged\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{tagged\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{lemm\PYGZus{}df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{p}{\textbar{}}                text\PYG{p}{\textbar{}}                id\PYG{p}{\textbar{}}label\PYG{p}{\textbar{}}         tagged\PYGZus{}text\PYG{p}{\textbar{}}           lemm\PYGZus{}text\PYG{p}{\textbar{}}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{p}{\textbar{}}RT @goeentertain:...\PYG{p}{\textbar{}}\PYG{l+m}{665305154954989568}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}} future blase vic...\PYG{p}{\textbar{}}future blase vice...\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}Teforia Uses Mach...\PYG{p}{\textbar{}}\PYG{l+m}{660668007975268352}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}} teforia uses mac...\PYG{p}{\textbar{}}teforia use machi...\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}   Apple TV or Roku?\PYG{p}{\textbar{}}       \PYG{l+m}{25842461136}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}         apple roku \PYG{p}{\textbar{}}          apple roku\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}Finished http://t...\PYG{p}{\textbar{}}        \PYG{l+m}{9412369614}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}           finished \PYG{p}{\textbar{}}              finish\PYG{p}{\textbar{}}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
only showing top \PYG{l+m}{4} rows
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{8}
\item {} 
remove blank rows and drop duplicates

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
    \PYG{n}{check\PYGZus{}blanks\PYGZus{}df} \PYG{o}{=} \PYG{n}{lemm\PYGZus{}df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{raw\PYGZus{}cols}\PYG{o}{+}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{lemm\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}\PYGZbs{}
                             \PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{is\PYGZus{}blank}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{check\PYGZus{}blanks\PYGZus{}udf}\PYG{p}{(}\PYG{n}{lemm\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{lemm\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove blanks}
    \PYG{n}{no\PYGZus{}blanks\PYGZus{}df} \PYG{o}{=} \PYG{n}{check\PYGZus{}blanks\PYGZus{}df}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{n}{check\PYGZus{}blanks\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{is\PYGZus{}blank}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{False}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} drop duplicates}
\PYG{n}{dedup\PYGZus{}df} \PYG{o}{=} \PYG{n}{no\PYGZus{}blanks\PYGZus{}df}\PYG{o}{.}\PYG{n}{dropDuplicates}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

    \PYG{n}{dedup\PYGZus{}df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{p}{\textbar{}}                text\PYG{p}{\textbar{}}                id\PYG{p}{\textbar{}}label\PYG{p}{\textbar{}}           lemm\PYGZus{}text\PYG{p}{\textbar{}}is\PYGZus{}blank\PYG{p}{\textbar{}}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
\PYG{p}{\textbar{}}RT @goeentertain:...\PYG{p}{\textbar{}}\PYG{l+m}{665305154954989568}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}future blase vice...\PYG{p}{\textbar{}}   False\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}Teforia Uses Mach...\PYG{p}{\textbar{}}\PYG{l+m}{660668007975268352}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}teforia use machi...\PYG{p}{\textbar{}}   False\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}   Apple TV or Roku?\PYG{p}{\textbar{}}       \PYG{l+m}{25842461136}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}          apple roku\PYG{p}{\textbar{}}   False\PYG{p}{\textbar{}}
\PYG{p}{\textbar{}}Finished http://t...\PYG{p}{\textbar{}}        \PYG{l+m}{9412369614}\PYG{p}{\textbar{}}  \PYG{l+m}{1}.0\PYG{p}{\textbar{}}              finish\PYG{p}{\textbar{}}   False\PYG{p}{\textbar{}}
+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+
only showing top \PYG{l+m}{4} rows
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{9}
\item {} 
add unieuq ID

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{monotonically\PYGZus{}increasing\PYGZus{}id}
\PYG{c+c1}{\PYGZsh{} Create Unique ID}
\PYG{n}{dedup\PYGZus{}df} \PYG{o}{=} \PYG{n}{dedup\PYGZus{}df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{uid}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{monotonically\PYGZus{}increasing\PYGZus{}id}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{dedup\PYGZus{}df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}                \PYG{n}{text}\PYG{o}{\textbar{}}                \PYG{n+nb}{id}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}           \PYG{n}{lemm\PYGZus{}text}\PYG{o}{\textbar{}}\PYG{n}{is\PYGZus{}blank}\PYG{o}{\textbar{}}         \PYG{n}{uid}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}              \PYG{n}{dragon}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{1546813742}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}              \PYG{n}{dragon}\PYG{o}{\textbar{}}   \PYG{n+nb+bp}{False}\PYG{o}{\textbar{}} \PYG{l+m+mi}{85899345920}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}           \PYG{n}{hurt} \PYG{n}{much}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{1558492525}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}           \PYG{n}{hurt} \PYG{n}{much}\PYG{o}{\textbar{}}   \PYG{n+nb+bp}{False}\PYG{o}{\textbar{}}\PYG{l+m+mi}{111669149696}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{seth} \PYG{n}{blog} \PYG{n}{word} \PYG{n}{se}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{383221484023709697}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{seth} \PYG{n}{blog} \PYG{n}{word} \PYG{n}{se}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n+nb+bp}{False}\PYG{o}{\textbar{}}\PYG{l+m+mi}{128849018880}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{teforia} \PYG{n}{use} \PYG{n}{machi}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{660668007975268352}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{teforia} \PYG{n}{use} \PYG{n}{machi}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n+nb+bp}{False}\PYG{o}{\textbar{}}\PYG{l+m+mi}{137438953472}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{10}
\item {} 
create final dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data} \PYG{o}{=} \PYG{n}{dedup\PYGZus{}df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{uid}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}         \PYG{n}{uid}\PYG{o}{\textbar{}}                \PYG{n+nb}{id}\PYG{o}{\textbar{}}                \PYG{n}{text}\PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{l+m+mi}{85899345920}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{1546813742}\PYG{o}{\textbar{}}              \PYG{n}{dragon}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{111669149696}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{1558492525}\PYG{o}{\textbar{}}           \PYG{n}{hurt} \PYG{n}{much}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{128849018880}\PYG{o}{\textbar{}}\PYG{l+m+mi}{383221484023709697}\PYG{o}{\textbar{}}\PYG{n}{seth} \PYG{n}{blog} \PYG{n}{word} \PYG{n}{se}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{137438953472}\PYG{o}{\textbar{}}\PYG{l+m+mi}{660668007975268352}\PYG{o}{\textbar{}}\PYG{n}{teforia} \PYG{n}{use} \PYG{n}{machi}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{11}
\item {} 
Create taining and test sets

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Split the data into training and test sets (40\PYGZpc{} held out for testing)}
\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{,} \PYG{n}{testData}\PYG{p}{)} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{12}
\item {} 
NaiveBayes Pipeline

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{HashingTF}\PYG{p}{,} \PYG{n}{IDF}\PYG{p}{,} \PYG{n}{Tokenizer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.classification} \PYG{k+kn}{import} \PYG{n}{NaiveBayes}\PYG{p}{,} \PYG{n}{RandomForestClassifier}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.classification} \PYG{k+kn}{import} \PYG{n}{DecisionTreeClassifier}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{MulticlassClassificationEvaluator}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.tuning} \PYG{k+kn}{import} \PYG{n}{ParamGridBuilder}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.tuning} \PYG{k+kn}{import} \PYG{n}{CrossValidator}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{IndexToString}\PYG{p}{,} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{VectorIndexer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{CountVectorizer}

\PYG{c+c1}{\PYGZsh{} Configure an ML pipeline, which consists of tree stages: tokenizer, hashingTF, and nb.}
\PYG{n}{tokenizer} \PYG{o}{=} \PYG{n}{Tokenizer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{words}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{hashingTF} \PYG{o}{=} \PYG{n}{HashingTF}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{n}{tokenizer}\PYG{o}{.}\PYG{n}{getOutputCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rawFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} vectorizer = CountVectorizer(inputCol= \PYGZdq{}words\PYGZdq{}, outputCol=\PYGZdq{}rawFeatures\PYGZdq{})}
\PYG{n}{idf} \PYG{o}{=} \PYG{n}{IDF}\PYG{p}{(}\PYG{n}{minDocFreq}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rawFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Naive Bayes model}
\PYG{n}{nb} \PYG{o}{=} \PYG{n}{NaiveBayes}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Pipeline Architecture}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{tokenizer}\PYG{p}{,} \PYG{n}{hashingTF}\PYG{p}{,} \PYG{n}{idf}\PYG{p}{,} \PYG{n}{nb}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Train model.  This also runs the indexers.}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{13}
\item {} 
Make predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testData}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Select example rows to display.}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{text}                                           \PYG{o}{\textbar{}}\PYG{n}{label}\PYG{o}{\textbar{}}\PYG{n}{prediction}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{finish}                                         \PYG{o}{\textbar{}}\PYG{l+m+mf}{1.0}  \PYG{o}{\textbar{}}\PYG{l+m+mf}{1.0}       \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{meet} \PYG{n}{rolo} \PYG{n}{dogsofthinkgeek} \PYG{n}{happy} \PYG{n}{nationaldogday} \PYG{o}{\textbar{}}\PYG{l+m+mf}{1.0}  \PYG{o}{\textbar{}}\PYG{l+m+mf}{1.0}       \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{pumpkin} \PYG{n}{family}                                 \PYG{o}{\textbar{}}\PYG{l+m+mf}{1.0}  \PYG{o}{\textbar{}}\PYG{l+m+mf}{1.0}       \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{meet} \PYG{n}{jet} \PYG{n}{dogsofthinkgeek} \PYG{n}{happy} \PYG{n}{nationaldogday}  \PYG{o}{\textbar{}}\PYG{l+m+mf}{1.0}  \PYG{o}{\textbar{}}\PYG{l+m+mf}{1.0}       \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{meet} \PYG{n}{vixie} \PYG{n}{dogsofthinkgeek} \PYG{n}{happy} \PYG{n}{nationaldogday}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.0}  \PYG{o}{\textbar{}}\PYG{l+m+mf}{1.0}       \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{14}
\item {} 
evaluation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{MulticlassClassificationEvaluator}
\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{MulticlassClassificationEvaluator}\PYG{p}{(}\PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{l+m+mf}{0.912655971479501}
\end{sphinxVerbatim}


\section{Sentiment analysis}
\label{\detokenize{textmining:sentiment-analysis}}\label{\detokenize{textmining:sentimentanalysis}}
\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{sen_class}.png}
\end{figure}


\subsection{Introduction}
\label{\detokenize{textmining:id1}}
\sphinxhref{https://en.wikipedia.org/wiki/Sentiment\_analysis}{Sentiment analysis} (sometimes known as opinion mining or emotion AI) refers to the use of natural language processing, text analysis, computational linguistics, and biometrics to systematically identify, extract, quantify, and study affective states and subjective information. Sentiment analysis is widely applied to voice of the customer materials such as reviews and survey responses, online and social media, and healthcare materials for applications that range from marketing to customer service to clinical medicine.

Generally speaking, sentiment analysis aims to \sphinxstylestrong{determine the attitude} of a speaker, writer, or other subject with respect to some topic or the overall contextual polarity or emotional reaction to a document, interaction, or event. The attitude may be a judgment or evaluation (see appraisal theory), affective state (that is to say, the emotional state of the author or speaker), or the intended emotional communication (that is to say, the emotional effect intended by the author or interlocutor).

Sentiment analysis in business, also known as opinion mining is a process of identifying and cataloging a piece of text according to the tone conveyed by it. It has broad application:
\begin{itemize}
\item {} 
Sentiment Analysis in Business Intelligence Build up

\item {} 
Sentiment Analysis in Business for Competitive Advantage

\item {} 
Enhancing the Customer Experience through Sentiment Analysis in Business

\end{itemize}


\subsection{Pipeline}
\label{\detokenize{textmining:pipeline}}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{sentiment_analysis_pipeline}.png}
\caption{Sentiment Analysis Pipeline}\label{\detokenize{textmining:id6}}\label{\detokenize{textmining:fig-sa-pipeline}}\end{figure}


\subsection{Demo}
\label{\detokenize{textmining:id2}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark Sentiment Analysis example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                               \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                               \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
            \PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{../data/newtwitter.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}                \PYG{n}{text}\PYG{o}{\textbar{}}        \PYG{n+nb}{id}\PYG{o}{\textbar{}}\PYG{n}{pubdate}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10} \PYG{n}{Things} \PYG{n}{Missing}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602860537}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18536}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@\PYGZus{}NATURALBWINN...}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602850443}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18536}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@HBO24} \PYG{n}{yo} \PYG{n}{the} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602761852}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18535}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{Aaaaaaaand} \PYG{n}{I} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602738438}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18535}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{can} \PYG{n}{I} \PYG{n}{please} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602684185}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18535}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Text Preprocessing

\end{enumerate}
\begin{itemize}
\item {} 
remove non ASCII characters

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{udf}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StringType}

\PYG{k+kn}{from} \PYG{n+nn}{nltk.stem.wordnet} \PYG{k+kn}{import} \PYG{n}{WordNetLemmatizer}
\PYG{k+kn}{from} \PYG{n+nn}{nltk.corpus} \PYG{k+kn}{import} \PYG{n}{stopwords}
\PYG{k+kn}{from} \PYG{n+nn}{nltk} \PYG{k+kn}{import} \PYG{n}{pos\PYGZus{}tag}
\PYG{k+kn}{import} \PYG{n+nn}{string}
\PYG{k+kn}{import} \PYG{n+nn}{re}

\PYG{c+c1}{\PYGZsh{} remove non ASCII characters}
\PYG{k}{def} \PYG{n+nf}{strip\PYGZus{}non\PYGZus{}ascii}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{} Returns the string without non ASCII characters\PYGZsq{}\PYGZsq{}\PYGZsq{}}
    \PYG{n}{stripped} \PYG{o}{=} \PYG{p}{(}\PYG{n}{c} \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{data\PYGZus{}str} \PYG{k}{if} \PYG{l+m+mi}{0} \PYG{o}{\PYGZlt{}} \PYG{n+nb}{ord}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mi}{127}\PYG{p}{)}
    \PYG{k}{return} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{stripped}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} setup pyspark udf function}
\PYG{n}{strip\PYGZus{}non\PYGZus{}ascii\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{strip\PYGZus{}non\PYGZus{}ascii}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

check:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{text\PYGZus{}non\PYGZus{}asci}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{strip\PYGZus{}non\PYGZus{}ascii\PYGZus{}udf}\PYG{p}{(}\PYG{n}{df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

ouput:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}                \PYG{n}{text}\PYG{o}{\textbar{}}        \PYG{n+nb}{id}\PYG{o}{\textbar{}}\PYG{n}{pubdate}\PYG{o}{\textbar{}}       \PYG{n}{text\PYGZus{}non\PYGZus{}asci}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10} \PYG{n}{Things} \PYG{n}{Missing}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602860537}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18536}\PYG{o}{\textbar{}}\PYG{l+m+mi}{10} \PYG{n}{Things} \PYG{n}{Missing}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@\PYGZus{}NATURALBWINN...}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602850443}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18536}\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@\PYGZus{}NATURALBWINN...}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@HBO24} \PYG{n}{yo} \PYG{n}{the} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602761852}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18535}\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@HBO24} \PYG{n}{yo} \PYG{n}{the} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{Aaaaaaaand} \PYG{n}{I} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602738438}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18535}\PYG{o}{\textbar{}}\PYG{n}{Aaaaaaaand} \PYG{n}{I} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{can} \PYG{n}{I} \PYG{n}{please} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602684185}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18535}\PYG{o}{\textbar{}}\PYG{n}{can} \PYG{n}{I} \PYG{n}{please} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
fixed abbreviation

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} fixed abbreviation}
\PYG{k}{def} \PYG{n+nf}{fix\PYGZus{}abbreviation}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{lower}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bthats}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{that is}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bive}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{i have}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bim}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{i am}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bya}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yeah}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bcant}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{can not}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bdont}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{do not}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bwont}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{will not}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bid}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{i would}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{wtf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{what the fuck}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bwth}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{what the hell}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{br}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{are}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bu}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{you}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bk}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{OK}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bsux}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sucks}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bno+}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{no}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bcoo+}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cool}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rt}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{strip}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{data\PYGZus{}str}

\PYG{n}{fix\PYGZus{}abbreviation\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{fix\PYGZus{}abbreviation}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{description}
\item[{check:}] \leavevmode
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fixed\PYGZus{}abbrev}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{fix\PYGZus{}abbreviation\PYGZus{}udf}\PYG{p}{(}\PYG{n}{df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{text\PYGZus{}non\PYGZus{}asci}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\end{description}

ouput:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}                \PYG{n}{text}\PYG{o}{\textbar{}}        \PYG{n+nb}{id}\PYG{o}{\textbar{}}\PYG{n}{pubdate}\PYG{o}{\textbar{}}       \PYG{n}{text\PYGZus{}non\PYGZus{}asci}\PYG{o}{\textbar{}}        \PYG{n}{fixed\PYGZus{}abbrev}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10} \PYG{n}{Things} \PYG{n}{Missing}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602860537}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18536}\PYG{o}{\textbar{}}\PYG{l+m+mi}{10} \PYG{n}{Things} \PYG{n}{Missing}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{10} \PYG{n}{things} \PYG{n}{missing}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@\PYGZus{}NATURALBWINN...}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602850443}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18536}\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@\PYGZus{}NATURALBWINN...}\PYG{o}{\textbar{}}\PYG{n+nd}{@\PYGZus{}naturalbwinner} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@HBO24} \PYG{n}{yo} \PYG{n}{the} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602761852}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18535}\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@HBO24} \PYG{n}{yo} \PYG{n}{the} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n+nd}{@hbo24} \PYG{n}{yo} \PYG{n}{the} \PYG{c+c1}{\PYGZsh{}ne...\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{Aaaaaaaand} \PYG{n}{I} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602738438}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18535}\PYG{o}{\textbar{}}\PYG{n}{Aaaaaaaand} \PYG{n}{I} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{aaaaaaaand} \PYG{n}{i} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{can} \PYG{n}{I} \PYG{n}{please} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602684185}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18535}\PYG{o}{\textbar{}}\PYG{n}{can} \PYG{n}{I} \PYG{n}{please} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{can} \PYG{n}{i} \PYG{n}{please} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
remove irrelevant features

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{remove\PYGZus{}features}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} compile regex}
    \PYG{n}{url\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https?://(www.)?}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{w+}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{.}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{w+(/}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{w+)*/?}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{punc\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{[}\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+s1}{]}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{re}\PYG{o}{.}\PYG{n}{escape}\PYG{p}{(}\PYG{n}{string}\PYG{o}{.}\PYG{n}{punctuation}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{num\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{(}\PYG{l+s+se}{\PYGZbs{}\PYGZbs{}}\PYG{l+s+s1}{d+)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{mention\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{@(}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{w+)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{alpha\PYGZus{}num\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZca{}[a\PYGZhy{}z0\PYGZhy{}9\PYGZus{}.]+\PYGZdl{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} convert to lowercase}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{lower}\PYG{p}{(}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove hyperlinks}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{url\PYGZus{}re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove @mentions}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{mention\PYGZus{}re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove puncuation}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{punc\PYGZus{}re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove numeric \PYGZsq{}words\PYGZsq{}}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{num\PYGZus{}re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove non a\PYGZhy{}z 0\PYGZhy{}9 characters and words shorter than 1 characters}
    \PYG{n}{list\PYGZus{}pos} \PYG{o}{=} \PYG{l+m+mi}{0}
    \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{k}{for} \PYG{n}{word} \PYG{o+ow}{in} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{list\PYGZus{}pos} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{alpha\PYGZus{}num\PYGZus{}re}\PYG{o}{.}\PYG{n}{match}\PYG{p}{(}\PYG{n}{word}\PYG{p}{)} \PYG{o+ow}{and} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{word}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{1}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{word}
            \PYG{k}{else}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{alpha\PYGZus{}num\PYGZus{}re}\PYG{o}{.}\PYG{n}{match}\PYG{p}{(}\PYG{n}{word}\PYG{p}{)} \PYG{o+ow}{and} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{word}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{1}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{word}
            \PYG{k}{else}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{+}\PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}
        \PYG{n}{list\PYGZus{}pos} \PYG{o}{+}\PYG{o}{=} \PYG{l+m+mi}{1}
    \PYG{c+c1}{\PYGZsh{} remove unwanted space, *.split() will automatically split on}
    \PYG{c+c1}{\PYGZsh{} whitespace and discard duplicates, the \PYGZdq{} \PYGZdq{}.join() joins the}
    \PYG{c+c1}{\PYGZsh{} resulting list into one string.}
    \PYG{k}{return} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ }\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{cleaned\PYGZus{}str}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} setup pyspark udf function}
\PYG{n}{remove\PYGZus{}features\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{remove\PYGZus{}features}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{description}
\item[{check:}] \leavevmode
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{removed}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{remove\PYGZus{}features\PYGZus{}udf}\PYG{p}{(}\PYG{n}{df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fixed\PYGZus{}abbrev}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}

\end{description}

ouput:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}                \PYG{n}{text}\PYG{o}{\textbar{}}        \PYG{n+nb}{id}\PYG{o}{\textbar{}}\PYG{n}{pubdate}\PYG{o}{\textbar{}}       \PYG{n}{text\PYGZus{}non\PYGZus{}asci}\PYG{o}{\textbar{}}        \PYG{n}{fixed\PYGZus{}abbrev}\PYG{o}{\textbar{}}             \PYG{n}{removed}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10} \PYG{n}{Things} \PYG{n}{Missing}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602860537}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18536}\PYG{o}{\textbar{}}\PYG{l+m+mi}{10} \PYG{n}{Things} \PYG{n}{Missing}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{10} \PYG{n}{things} \PYG{n}{missing}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{things} \PYG{n}{missing} \PYG{o+ow}{in}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@\PYGZus{}NATURALBWINN...}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602850443}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18536}\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@\PYGZus{}NATURALBWINN...}\PYG{o}{\textbar{}}\PYG{n+nd}{@\PYGZus{}naturalbwinner} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{oh} \PYG{o+ow}{and} \PYG{n}{do} \PYG{o+ow}{not} \PYG{n}{lik}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@HBO24} \PYG{n}{yo} \PYG{n}{the} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602761852}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18535}\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@HBO24} \PYG{n}{yo} \PYG{n}{the} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n+nd}{@hbo24} \PYG{n}{yo} \PYG{n}{the} \PYG{c+c1}{\PYGZsh{}ne...\textbar{}yo the newtwitter...\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{Aaaaaaaand} \PYG{n}{I} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602738438}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18535}\PYG{o}{\textbar{}}\PYG{n}{Aaaaaaaand} \PYG{n}{I} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{aaaaaaaand} \PYG{n}{i} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{aaaaaaaand} \PYG{n}{have} \PYG{n}{t}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{can} \PYG{n}{I} \PYG{n}{please} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2602684185}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{18535}\PYG{o}{\textbar{}}\PYG{n}{can} \PYG{n}{I} \PYG{n}{please} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{can} \PYG{n}{i} \PYG{n}{please} \PYG{n}{have}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{can} \PYG{n}{please} \PYG{n}{have} \PYG{n}{t}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Sentiment Analysis  main function

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{FloatType}

\PYG{k+kn}{from} \PYG{n+nn}{textblob} \PYG{k+kn}{import} \PYG{n}{TextBlob}

\PYG{k}{def} \PYG{n+nf}{sentiment\PYGZus{}analysis}\PYG{p}{(}\PYG{n}{text}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{TextBlob}\PYG{p}{(}\PYG{n}{text}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sentiment}\PYG{o}{.}\PYG{n}{polarity}

\PYG{n}{sentiment\PYGZus{}analysis\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{sentiment\PYGZus{}analysis} \PYG{p}{,} \PYG{n}{FloatType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}  \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{sentiment\PYGZus{}score}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{sentiment\PYGZus{}analysis\PYGZus{}udf}\PYG{p}{(} \PYG{n}{df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{removed}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{p}{)}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n+nb+bp}{True}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Sentiment score

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}             \PYG{n}{removed}\PYG{o}{\textbar{}}\PYG{n}{sentiment\PYGZus{}score}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{things} \PYG{n}{missing} \PYG{o+ow}{in}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}    \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.03181818}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{oh} \PYG{o+ow}{and} \PYG{n}{do} \PYG{o+ow}{not} \PYG{n}{lik}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}    \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.03181818}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{yo} \PYG{n}{the} \PYG{n}{newtwitter}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}      \PYG{l+m+mf}{0.3181818}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{aaaaaaaand} \PYG{n}{have} \PYG{n}{t}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.11818182}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{can} \PYG{n}{please} \PYG{n}{have} \PYG{n}{t}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.13636364}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Words frequency

\end{itemize}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{sen_word_freq}.png}
\end{figure}
\begin{itemize}
\item {} 
Sentiment Classification

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{condition}\PYG{p}{(}\PYG{n}{r}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{p}{(}\PYG{n}{r} \PYG{o}{\PYGZgt{}}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{positive}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{elif}\PYG{p}{(}\PYG{n}{r} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.1}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{negative}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{neutral}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{return} \PYG{n}{label}

\PYG{n}{sentiment\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{condition}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Output

\end{enumerate}
\begin{itemize}
\item {} 
Sentiment Class

\end{itemize}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{sen_class}.png}
\end{figure}
\begin{itemize}
\item {} 
Top tweets from each sentiment class

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}                \PYG{n}{text}\PYG{o}{\textbar{}}\PYG{n}{sentiment\PYGZus{}score}\PYG{o}{\textbar{}}\PYG{n}{sentiment}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{o+ow}{and} \PYG{n}{this} \PYG{c+c1}{\PYGZsh{}newtwit...\textbar{}            1.0\textbar{} positive\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{RT @SarahsJokes:...\textbar{}            1.0\textbar{} positive\textbar{}}
\PYG{o}{\textbar{}}\PYG{c+c1}{\PYGZsh{}newtwitter using...\textbar{}            1.0\textbar{} positive\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{The} \PYG{c+c1}{\PYGZsh{}NewTwitter h...\textbar{}            1.0\textbar{} positive\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{You} \PYG{n}{can} \PYG{n}{now} \PYG{n}{undo} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}} \PYG{n}{positive}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}                \PYG{n}{text}\PYG{o}{\textbar{}}\PYG{n}{sentiment\PYGZus{}score}\PYG{o}{\textbar{}}\PYG{n}{sentiment}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{Lists} \PYG{n}{on} \PYG{c+c1}{\PYGZsh{}NewTwit...\textbar{}           \PYGZhy{}0.1\textbar{}  neutral\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{Too} \PYG{n}{bad} \PYG{n}{most} \PYG{n}{of} \PYG{n}{m}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}           \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.1}\PYG{o}{\textbar{}}  \PYG{n}{neutral}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{the} \PYG{c+c1}{\PYGZsh{}newtwitter i...\textbar{}           \PYGZhy{}0.1\textbar{}  neutral\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{Looks} \PYG{n}{like} \PYG{n}{our} \PYG{n}{re}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}           \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.1}\PYG{o}{\textbar{}}  \PYG{n}{neutral}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{i} \PYG{n}{switched} \PYG{n}{to} \PYG{n}{the}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}           \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.1}\PYG{o}{\textbar{}}  \PYG{n}{neutral}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}                \PYG{n}{text}\PYG{o}{\textbar{}}\PYG{n}{sentiment\PYGZus{}score}\PYG{o}{\textbar{}}\PYG{n}{sentiment}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{oh}\PYG{o}{.} \PYG{c+c1}{\PYGZsh{}newtwitter i...\textbar{}           \PYGZhy{}1.0\textbar{} negative\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@chqwn}\PYG{p}{:} \PYG{c+c1}{\PYGZsh{}NewTw...\textbar{}           \PYGZhy{}1.0\textbar{} negative\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{Copy} \PYG{n}{that} \PYG{o}{\PYGZhy{}} \PYG{n}{its} \PYG{n}{W}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}           \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}} \PYG{n}{negative}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{RT} \PYG{n+nd}{@chqwn}\PYG{p}{:} \PYG{c+c1}{\PYGZsh{}NewTw...\textbar{}           \PYGZhy{}1.0\textbar{} negative\textbar{}}
\PYG{o}{\textbar{}}\PYG{c+c1}{\PYGZsh{}NewTwitter has t...\textbar{}           \PYGZhy{}1.0\textbar{} negative\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\end{quote}


\section{N-grams and Correlations}
\label{\detokenize{textmining:n-grams-and-correlations}}

\section{Topic Model: Latent Dirichlet Allocation}
\label{\detokenize{textmining:topic-model-latent-dirichlet-allocation}}\label{\detokenize{textmining:topicmodel}}
\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{topic_time}.png}
\end{figure}


\subsection{Introduction}
\label{\detokenize{textmining:id3}}
In text mining, a topic model is a unsupervised model for discovering the abstract “topics” that occur in a collection of documents.

Latent Dirichlet Allocation (LDA) is a mathematical method for estimating both of these at the same time: finding the mixture of words that is associated with each topic, while also determining the mixture of topics that describes each document.


\subsection{Demo}
\label{\detokenize{textmining:id4}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Load data

\end{enumerate}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rawdata} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{../data/airlines.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{format}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
\PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n+nb}{id}\PYG{o}{\textbar{}}        \PYG{n}{airline}\PYG{o}{\textbar{}}     \PYG{n}{date}\PYG{o}{\textbar{}}\PYG{n}{location}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}   \PYG{n}{cabin}\PYG{o}{\textbar{}}\PYG{n}{value}\PYG{o}{\textbar{}}\PYG{n}{recommended}\PYG{o}{\textbar{}}              \PYG{n}{review}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10001}\PYG{o}{\textbar{}}\PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{21}\PYG{o}{\PYGZhy{}}\PYG{n}{Jun}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{14}\PYG{o}{\textbar{}}\PYG{n}{Thailand}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{7}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{Flew} \PYG{n}{Mar} \PYG{l+m+mi}{30} \PYG{n}{NRT} \PYG{n}{t}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10002}\PYG{o}{\textbar{}}\PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{19}\PYG{o}{\PYGZhy{}}\PYG{n}{Jun}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{14}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{l+m+mi}{2463} \PYG{n}{leavi}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10003}\PYG{o}{\textbar{}}\PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{18}\PYG{o}{\PYGZhy{}}\PYG{n}{Jun}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{14}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Delta} \PYG{n}{Website} \PYG{n}{fro}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10004}\PYG{o}{\textbar{}}\PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{17}\PYG{o}{\PYGZhy{}}\PYG{n}{Jun}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{14}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{9}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{I just returned ...\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10005}\PYG{o}{\textbar{}}\PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{17}\PYG{o}{\PYGZhy{}}\PYG{n}{Jun}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{14}\PYG{o}{\textbar{}} \PYG{n}{Ecuador}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{7}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Round\PYGZhy{}trip fligh...\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Text preprocessing

\end{enumerate}

I will use the following raw column names to keep my table concise:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{raw\PYGZus{}cols} \PYG{o}{=}  \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{columns}
\PYG{n}{raw\PYGZus{}cols}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{airline}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{location}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rating}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cabin}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{value}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{recommended}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{review}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rawdata} \PYG{o}{=} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{dropDuplicates}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{review}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{udf}\PYG{p}{,} \PYG{n}{col}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StringType}\PYG{p}{,} \PYG{n}{DoubleType}\PYG{p}{,} \PYG{n}{DateType}

\PYG{k+kn}{from} \PYG{n+nn}{nltk.stem.wordnet} \PYG{k+kn}{import} \PYG{n}{WordNetLemmatizer}
\PYG{k+kn}{from} \PYG{n+nn}{nltk.corpus} \PYG{k+kn}{import} \PYG{n}{stopwords}
\PYG{k+kn}{from} \PYG{n+nn}{nltk} \PYG{k+kn}{import} \PYG{n}{pos\PYGZus{}tag}
\PYG{k+kn}{import} \PYG{n+nn}{langid}
\PYG{k+kn}{import} \PYG{n+nn}{string}
\PYG{k+kn}{import} \PYG{n+nn}{re}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
remove non ASCII characters

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} remove non ASCII characters}
\PYG{k}{def} \PYG{n+nf}{strip\PYGZus{}non\PYGZus{}ascii}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{} Returns the string without non ASCII characters\PYGZsq{}\PYGZsq{}\PYGZsq{}}
    \PYG{n}{stripped} \PYG{o}{=} \PYG{p}{(}\PYG{n}{c} \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{data\PYGZus{}str} \PYG{k}{if} \PYG{l+m+mi}{0} \PYG{o}{\PYGZlt{}} \PYG{n+nb}{ord}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mi}{127}\PYG{p}{)}
    \PYG{k}{return} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{stripped}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
check it blank line or not

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} check to see if a row only contains whitespace}
\PYG{k}{def} \PYG{n+nf}{check\PYGZus{}blanks}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{is\PYGZus{}blank} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{isspace}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{is\PYGZus{}blank}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
check the language (a little bit slow, I skited this step)

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} check the language (only apply to english)}
\PYG{k}{def} \PYG{n+nf}{check\PYGZus{}lang}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{k+kn}{from} \PYG{n+nn}{langid.langid} \PYG{k+kn}{import} \PYG{n}{LanguageIdentifier}\PYG{p}{,} \PYG{n}{model}
    \PYG{n}{identifier} \PYG{o}{=} \PYG{n}{LanguageIdentifier}\PYG{o}{.}\PYG{n}{from\PYGZus{}modelstring}\PYG{p}{(}\PYG{n}{model}\PYG{p}{,} \PYG{n}{norm\PYGZus{}probs}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
    \PYG{n}{predict\PYGZus{}lang} \PYG{o}{=} \PYG{n}{identifier}\PYG{o}{.}\PYG{n}{classify}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}

    \PYG{k}{if} \PYG{n}{predict\PYGZus{}lang}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{o}{.}\PYG{l+m+mi}{9}\PYG{p}{:}
        \PYG{n}{language} \PYG{o}{=} \PYG{n}{predict\PYGZus{}lang}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{language} \PYG{o}{=} \PYG{n}{predict\PYGZus{}lang}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
    \PYG{k}{return} \PYG{n}{language}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
fixed abbreviation

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} fixed abbreviation}
\PYG{k}{def} \PYG{n+nf}{fix\PYGZus{}abbreviation}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{lower}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bthats}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{that is}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bive}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{i have}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bim}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{i am}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bya}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{yeah}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bcant}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{can not}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bdont}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{do not}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bwont}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{will not}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bid}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{i would}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{wtf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{what the fuck}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bwth}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{what the hell}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{br}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{are}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bu}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{you}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bk}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{OK}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bsux}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sucks}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bno+}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{no}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{bcoo+}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cool}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+sa}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rt}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{strip}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{data\PYGZus{}str}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
remove irrelevant features

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} remove irrelevant features}
\PYG{k}{def} \PYG{n+nf}{remove\PYGZus{}features}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} compile regex}
    \PYG{n}{url\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https?://(www.)?}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{w+}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{.}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{w+(/}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{w+)*/?}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{punc\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{[}\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+s1}{]}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{re}\PYG{o}{.}\PYG{n}{escape}\PYG{p}{(}\PYG{n}{string}\PYG{o}{.}\PYG{n}{punctuation}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{num\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{(}\PYG{l+s+se}{\PYGZbs{}\PYGZbs{}}\PYG{l+s+s1}{d+)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{mention\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{@(}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{w+)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{alpha\PYGZus{}num\PYGZus{}re} \PYG{o}{=} \PYG{n}{re}\PYG{o}{.}\PYG{n}{compile}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZca{}[a\PYGZhy{}z0\PYGZhy{}9\PYGZus{}.]+\PYGZdl{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} convert to lowercase}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{lower}\PYG{p}{(}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove hyperlinks}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{url\PYGZus{}re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove @mentions}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{mention\PYGZus{}re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove puncuation}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{punc\PYGZus{}re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove numeric \PYGZsq{}words\PYGZsq{}}
    \PYG{n}{data\PYGZus{}str} \PYG{o}{=} \PYG{n}{num\PYGZus{}re}\PYG{o}{.}\PYG{n}{sub}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{data\PYGZus{}str}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} remove non a\PYGZhy{}z 0\PYGZhy{}9 characters and words shorter than 1 characters}
    \PYG{n}{list\PYGZus{}pos} \PYG{o}{=} \PYG{l+m+mi}{0}
    \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{k}{for} \PYG{n}{word} \PYG{o+ow}{in} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{list\PYGZus{}pos} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{alpha\PYGZus{}num\PYGZus{}re}\PYG{o}{.}\PYG{n}{match}\PYG{p}{(}\PYG{n}{word}\PYG{p}{)} \PYG{o+ow}{and} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{word}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{1}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{word}
            \PYG{k}{else}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{alpha\PYGZus{}num\PYGZus{}re}\PYG{o}{.}\PYG{n}{match}\PYG{p}{(}\PYG{n}{word}\PYG{p}{)} \PYG{o+ow}{and} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{word}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{1}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{word}
            \PYG{k}{else}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{+}\PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}
        \PYG{n}{list\PYGZus{}pos} \PYG{o}{+}\PYG{o}{=} \PYG{l+m+mi}{1}
    \PYG{c+c1}{\PYGZsh{} remove unwanted space, *.split() will automatically split on}
    \PYG{c+c1}{\PYGZsh{} whitespace and discard duplicates, the \PYGZdq{} \PYGZdq{}.join() joins the}
    \PYG{c+c1}{\PYGZsh{} resulting list into one string.}
    \PYG{k}{return} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ }\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{cleaned\PYGZus{}str}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
removes stop words

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} removes stop words}
\PYG{k}{def} \PYG{n+nf}{remove\PYGZus{}stops}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} expects a string}
    \PYG{n}{stops} \PYG{o}{=} \PYG{n+nb}{set}\PYG{p}{(}\PYG{n}{stopwords}\PYG{o}{.}\PYG{n}{words}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{english}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{list\PYGZus{}pos} \PYG{o}{=} \PYG{l+m+mi}{0}
    \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{text} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{word} \PYG{o+ow}{in} \PYG{n}{text}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{word} \PYG{o+ow}{not} \PYG{o+ow}{in} \PYG{n}{stops}\PYG{p}{:}
            \PYG{c+c1}{\PYGZsh{} rebuild cleaned\PYGZus{}str}
            \PYG{k}{if} \PYG{n}{list\PYGZus{}pos} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{word}
            \PYG{k}{else}\PYG{p}{:}
                \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{word}
            \PYG{n}{list\PYGZus{}pos} \PYG{o}{+}\PYG{o}{=} \PYG{l+m+mi}{1}
    \PYG{k}{return} \PYG{n}{cleaned\PYGZus{}str}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
Part-of-Speech Tagging

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Part\PYGZhy{}of\PYGZhy{}Speech Tagging}
\PYG{k}{def} \PYG{n+nf}{tag\PYGZus{}and\PYGZus{}remove}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{c+c1}{\PYGZsh{} noun tags}
    \PYG{n}{nn\PYGZus{}tags} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NN}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NNP}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NNP}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NNPS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NNS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
    \PYG{c+c1}{\PYGZsh{} adjectives}
    \PYG{n}{jj\PYGZus{}tags} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{JJ}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{JJR}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{JJS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
    \PYG{c+c1}{\PYGZsh{} verbs}
    \PYG{n}{vb\PYGZus{}tags} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VB}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VBD}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VBG}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VBN}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VBP}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{VBZ}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
    \PYG{n}{nltk\PYGZus{}tags} \PYG{o}{=} \PYG{n}{nn\PYGZus{}tags} \PYG{o}{+} \PYG{n}{jj\PYGZus{}tags} \PYG{o}{+} \PYG{n}{vb\PYGZus{}tags}

    \PYG{c+c1}{\PYGZsh{} break string into \PYGZsq{}words\PYGZsq{}}
    \PYG{n}{text} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} tag the text and keep only those with the right tags}
    \PYG{n}{tagged\PYGZus{}text} \PYG{o}{=} \PYG{n}{pos\PYGZus{}tag}\PYG{p}{(}\PYG{n}{text}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{tagged\PYGZus{}word} \PYG{o+ow}{in} \PYG{n}{tagged\PYGZus{}text}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{tagged\PYGZus{}word}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o+ow}{in} \PYG{n}{nltk\PYGZus{}tags}\PYG{p}{:}
            \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{+}\PYG{o}{=} \PYG{n}{tagged\PYGZus{}word}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}

    \PYG{k}{return} \PYG{n}{cleaned\PYGZus{}str}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
lemmatization

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} lemmatization}
\PYG{k}{def} \PYG{n+nf}{lemmatize}\PYG{p}{(}\PYG{n}{data\PYGZus{}str}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} expects a string}
    \PYG{n}{list\PYGZus{}pos} \PYG{o}{=} \PYG{l+m+mi}{0}
    \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{lmtzr} \PYG{o}{=} \PYG{n}{WordNetLemmatizer}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{text} \PYG{o}{=} \PYG{n}{data\PYGZus{}str}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{tagged\PYGZus{}words} \PYG{o}{=} \PYG{n}{pos\PYGZus{}tag}\PYG{p}{(}\PYG{n}{text}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{word} \PYG{o+ow}{in} \PYG{n}{tagged\PYGZus{}words}\PYG{p}{:}
        \PYG{k}{if} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{v}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o+ow}{in} \PYG{n}{word}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{lower}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{lemma} \PYG{o}{=} \PYG{n}{lmtzr}\PYG{o}{.}\PYG{n}{lemmatize}\PYG{p}{(}\PYG{n}{word}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{pos}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{v}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{n}{lemma} \PYG{o}{=} \PYG{n}{lmtzr}\PYG{o}{.}\PYG{n}{lemmatize}\PYG{p}{(}\PYG{n}{word}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{pos}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{n}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{if} \PYG{n}{list\PYGZus{}pos} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
            \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{lemma}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{=} \PYG{n}{cleaned\PYGZus{}str} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{lemma}
        \PYG{n}{list\PYGZus{}pos} \PYG{o}{+}\PYG{o}{=} \PYG{l+m+mi}{1}
    \PYG{k}{return} \PYG{n}{cleaned\PYGZus{}str}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
setup pyspark udf function

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} setup pyspark udf function}
\PYG{n}{strip\PYGZus{}non\PYGZus{}ascii\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{strip\PYGZus{}non\PYGZus{}ascii}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{check\PYGZus{}blanks\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{check\PYGZus{}blanks}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{check\PYGZus{}lang\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{check\PYGZus{}lang}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{fix\PYGZus{}abbreviation\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{fix\PYGZus{}abbreviation}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{remove\PYGZus{}stops\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{remove\PYGZus{}stops}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{remove\PYGZus{}features\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{remove\PYGZus{}features}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{tag\PYGZus{}and\PYGZus{}remove\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{tag\PYGZus{}and\PYGZus{}remove}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{lemmatize\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{lemmatize}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Text processing

\end{enumerate}
\begin{itemize}
\item {} 
correct the data schema

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rawdata} \PYG{o}{=} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rating}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{rating}\PYG{o}{.}\PYG{n}{cast}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{float}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}
\PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n+nb}{id}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{airline}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{date}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{location}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{rating}\PYG{p}{:} \PYG{n+nb}{float} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{cabin}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{value}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{recommended}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{review}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{datetime} \PYG{k+kn}{import} \PYG{n}{datetime}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{col}

\PYG{c+c1}{\PYGZsh{} https://docs.python.org/2/library/datetime.html\PYGZsh{}strftime\PYGZhy{}and\PYGZhy{}strptime\PYGZhy{}behavior}
\PYG{c+c1}{\PYGZsh{} 21\PYGZhy{}Jun\PYGZhy{}14 \PYGZlt{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZgt{} \PYGZpc{}d\PYGZhy{}\PYGZpc{}b\PYGZhy{}\PYGZpc{}y}
\PYG{n}{to\PYGZus{}date} \PYG{o}{=}  \PYG{n}{udf} \PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{datetime}\PYG{o}{.}\PYG{n}{strptime}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{b\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{y}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{DateType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{rawdata} \PYG{o}{=} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{to\PYGZus{}date}\PYG{p}{(}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n+nb}{id}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{airline}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{date}\PYG{p}{:} \PYG{n}{date} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{location}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{rating}\PYG{p}{:} \PYG{n+nb}{float} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{cabin}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{value}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{recommended}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{review}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n+nb}{id}\PYG{o}{\textbar{}}           \PYG{n}{airline}\PYG{o}{\textbar{}}      \PYG{n}{date}\PYG{o}{\textbar{}}\PYG{n}{location}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}   \PYG{n}{cabin}\PYG{o}{\textbar{}}\PYG{n}{value}\PYG{o}{\textbar{}}\PYG{n}{recommended}\PYG{o}{\textbar{}}              \PYG{n}{review}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10551}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10298}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{03}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{31}\PYG{o}{\textbar{}}      \PYG{n}{UK}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{k+kn}{from} \PYG{n+nn}{Manch...}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10564}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{09}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{I}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m Executive Pla...\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10134}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{MSP}\PYG{o}{\PYGZhy{}}\PYG{n}{JFK}\PYG{o}{\PYGZhy{}}\PYG{n}{MXP} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10912}\PYG{o}{\textbar{}}   \PYG{n}{United} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{04}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Worst} \PYG{n}{airline} \PYG{n}{I} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rawdata} \PYG{o}{=} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{non\PYGZus{}asci}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{strip\PYGZus{}non\PYGZus{}ascii\PYGZus{}udf}\PYG{p}{(}\PYG{n}{rawdata}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{review}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}


\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n+nb}{id}\PYG{o}{\textbar{}}           \PYG{n}{airline}\PYG{o}{\textbar{}}      \PYG{n}{date}\PYG{o}{\textbar{}}\PYG{n}{location}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}   \PYG{n}{cabin}\PYG{o}{\textbar{}}\PYG{n}{value}\PYG{o}{\textbar{}}\PYG{n}{recommended}\PYG{o}{\textbar{}}              \PYG{n}{review}\PYG{o}{\textbar{}}            \PYG{n}{non\PYGZus{}asci}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10551}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10298}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{03}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{31}\PYG{o}{\textbar{}}      \PYG{n}{UK}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{k+kn}{from} \PYG{n+nn}{Manch...}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{k+kn}{from} \PYG{n+nn}{Manch...}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10564}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{09}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{I}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m Executive Pla...\textbar{}I}\PYG{l+s+s1}{\PYGZsq{}}\PYG{n}{m} \PYG{n}{Executive} \PYG{n}{Pla}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10134}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{MSP}\PYG{o}{\PYGZhy{}}\PYG{n}{JFK}\PYG{o}{\PYGZhy{}}\PYG{n}{MXP} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{MSP}\PYG{o}{\PYGZhy{}}\PYG{n}{JFK}\PYG{o}{\PYGZhy{}}\PYG{n}{MXP} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10912}\PYG{o}{\textbar{}}   \PYG{n}{United} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{04}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Worst} \PYG{n}{airline} \PYG{n}{I} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{Worst} \PYG{n}{airline} \PYG{n}{I} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rawdata} \PYG{o}{=} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{raw\PYGZus{}cols}\PYG{o}{+}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{non\PYGZus{}asci}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYGZbs{}
                 \PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fixed\PYGZus{}abbrev}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{fix\PYGZus{}abbreviation\PYGZus{}udf}\PYG{p}{(}\PYG{n}{rawdata}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{non\PYGZus{}asci}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n+nb}{id}\PYG{o}{\textbar{}}           \PYG{n}{airline}\PYG{o}{\textbar{}}      \PYG{n}{date}\PYG{o}{\textbar{}}\PYG{n}{location}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}   \PYG{n}{cabin}\PYG{o}{\textbar{}}\PYG{n}{value}\PYG{o}{\textbar{}}\PYG{n}{recommended}\PYG{o}{\textbar{}}              \PYG{n}{review}\PYG{o}{\textbar{}}            \PYG{n}{non\PYGZus{}asci}\PYG{o}{\textbar{}}        \PYG{n}{fixed\PYGZus{}abbrev}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10551}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10298}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{03}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{31}\PYG{o}{\textbar{}}      \PYG{n}{UK}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{k+kn}{from} \PYG{n+nn}{Manch...}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{k+kn}{from} \PYG{n+nn}{Manch...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{k+kn}{from} \PYG{n+nn}{manch...}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10564}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{09}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{I}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m Executive Pla...\textbar{}I}\PYG{l+s+s1}{\PYGZsq{}}\PYG{n}{m} \PYG{n}{Executive} \PYG{n}{Pla}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{i}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m executive pla...\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10134}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{MSP}\PYG{o}{\PYGZhy{}}\PYG{n}{JFK}\PYG{o}{\PYGZhy{}}\PYG{n}{MXP} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{MSP}\PYG{o}{\PYGZhy{}}\PYG{n}{JFK}\PYG{o}{\PYGZhy{}}\PYG{n}{MXP} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{msp}\PYG{o}{\PYGZhy{}}\PYG{n}{jfk}\PYG{o}{\PYGZhy{}}\PYG{n}{mxp} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10912}\PYG{o}{\textbar{}}   \PYG{n}{United} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{04}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Worst} \PYG{n}{airline} \PYG{n}{I} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{Worst} \PYG{n}{airline} \PYG{n}{I} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{worst} \PYG{n}{airline} \PYG{n}{i} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
 \PYG{n}{rawdata} \PYG{o}{=} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{raw\PYGZus{}cols}\PYG{o}{+}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fixed\PYGZus{}abbrev}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYGZbs{}
                  \PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{stop\PYGZus{}text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{remove\PYGZus{}stops\PYGZus{}udf}\PYG{p}{(}\PYG{n}{rawdata}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fixed\PYGZus{}abbrev}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n+nb}{id}\PYG{o}{\textbar{}}           \PYG{n}{airline}\PYG{o}{\textbar{}}      \PYG{n}{date}\PYG{o}{\textbar{}}\PYG{n}{location}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}   \PYG{n}{cabin}\PYG{o}{\textbar{}}\PYG{n}{value}\PYG{o}{\textbar{}}\PYG{n}{recommended}\PYG{o}{\textbar{}}              \PYG{n}{review}\PYG{o}{\textbar{}}        \PYG{n}{fixed\PYGZus{}abbrev}\PYG{o}{\textbar{}}           \PYG{n}{stop\PYGZus{}text}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10551}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{l+m+mi}{3246} \PYG{n}{chica}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10298}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{03}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{31}\PYG{o}{\textbar{}}      \PYG{n}{UK}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{k+kn}{from} \PYG{n+nn}{Manch...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{k+kn}{from} \PYG{n+nn}{manch...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{n}{manchester}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10564}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{09}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{I}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m Executive Pla...\textbar{}i}\PYG{l+s+s1}{\PYGZsq{}}\PYG{n}{m} \PYG{n}{executive} \PYG{n}{pla}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{i}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m executive pla...\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10134}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{MSP}\PYG{o}{\PYGZhy{}}\PYG{n}{JFK}\PYG{o}{\PYGZhy{}}\PYG{n}{MXP} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{msp}\PYG{o}{\PYGZhy{}}\PYG{n}{jfk}\PYG{o}{\PYGZhy{}}\PYG{n}{mxp} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{msp}\PYG{o}{\PYGZhy{}}\PYG{n}{jfk}\PYG{o}{\PYGZhy{}}\PYG{n}{mxp} \PYG{n}{retur}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10912}\PYG{o}{\textbar{}}   \PYG{n}{United} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{04}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Worst} \PYG{n}{airline} \PYG{n}{I} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{worst} \PYG{n}{airline} \PYG{n}{i} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{worst} \PYG{n}{airline} \PYG{n}{eve}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rawdata} \PYG{o}{=} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{raw\PYGZus{}cols}\PYG{o}{+}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{stop\PYGZus{}text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYGZbs{}
                 \PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{feat\PYGZus{}text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{remove\PYGZus{}features\PYGZus{}udf}\PYG{p}{(}\PYG{n}{rawdata}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{stop\PYGZus{}text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n+nb}{id}\PYG{o}{\textbar{}}           \PYG{n}{airline}\PYG{o}{\textbar{}}      \PYG{n}{date}\PYG{o}{\textbar{}}\PYG{n}{location}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}   \PYG{n}{cabin}\PYG{o}{\textbar{}}\PYG{n}{value}\PYG{o}{\textbar{}}\PYG{n}{recommended}\PYG{o}{\textbar{}}              \PYG{n}{review}\PYG{o}{\textbar{}}           \PYG{n}{stop\PYGZus{}text}\PYG{o}{\textbar{}}           \PYG{n}{feat\PYGZus{}text}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10551}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{l+m+mi}{3246} \PYG{n}{chica}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{n}{chicago} \PYG{n}{mi}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10298}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{03}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{31}\PYG{o}{\textbar{}}      \PYG{n}{UK}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{k+kn}{from} \PYG{n+nn}{Manch...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{n}{manchester}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{n}{manchester}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10564}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{09}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{I}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m Executive Pla...\textbar{}i}\PYG{l+s+s1}{\PYGZsq{}}\PYG{n}{m} \PYG{n}{executive} \PYG{n}{pla}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{executive} \PYG{n}{platinu}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10134}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{MSP}\PYG{o}{\PYGZhy{}}\PYG{n}{JFK}\PYG{o}{\PYGZhy{}}\PYG{n}{MXP} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{msp}\PYG{o}{\PYGZhy{}}\PYG{n}{jfk}\PYG{o}{\PYGZhy{}}\PYG{n}{mxp} \PYG{n}{retur}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{msp} \PYG{n}{jfk} \PYG{n}{mxp} \PYG{n}{retur}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10912}\PYG{o}{\textbar{}}   \PYG{n}{United} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{04}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Worst} \PYG{n}{airline} \PYG{n}{I} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{worst} \PYG{n}{airline} \PYG{n}{eve}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{worst} \PYG{n}{airline} \PYG{n}{eve}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
 \PYG{n}{rawdata} \PYG{o}{=} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{raw\PYGZus{}cols}\PYG{o}{+}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{feat\PYGZus{}text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYGZbs{}
                  \PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tagged\PYGZus{}text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{tag\PYGZus{}and\PYGZus{}remove\PYGZus{}udf}\PYG{p}{(}\PYG{n}{rawdata}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{feat\PYGZus{}text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n+nb}{id}\PYG{o}{\textbar{}}           \PYG{n}{airline}\PYG{o}{\textbar{}}      \PYG{n}{date}\PYG{o}{\textbar{}}\PYG{n}{location}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}   \PYG{n}{cabin}\PYG{o}{\textbar{}}\PYG{n}{value}\PYG{o}{\textbar{}}\PYG{n}{recommended}\PYG{o}{\textbar{}}              \PYG{n}{review}\PYG{o}{\textbar{}}           \PYG{n}{feat\PYGZus{}text}\PYG{o}{\textbar{}}         \PYG{n}{tagged\PYGZus{}text}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10551}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{n}{chicago} \PYG{n}{mi}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}} \PYG{n}{flight} \PYG{n}{chicago} \PYG{n}{m}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10298}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{03}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{31}\PYG{o}{\textbar{}}      \PYG{n}{UK}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{k+kn}{from} \PYG{n+nn}{Manch...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{n}{manchester}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}} \PYG{n}{flight} \PYG{n}{mancheste}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10564}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{09}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{I}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m Executive Pla...\textbar{}executive platinu...\textbar{} executive platin...\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10134}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{MSP}\PYG{o}{\PYGZhy{}}\PYG{n}{JFK}\PYG{o}{\PYGZhy{}}\PYG{n}{MXP} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{msp} \PYG{n}{jfk} \PYG{n}{mxp} \PYG{n}{retur}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}} \PYG{n}{msp} \PYG{n}{jfk} \PYG{n}{mxp} \PYG{n}{retu}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10912}\PYG{o}{\textbar{}}   \PYG{n}{United} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{04}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Worst} \PYG{n}{airline} \PYG{n}{I} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{worst} \PYG{n}{airline} \PYG{n}{eve}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}} \PYG{n}{worst} \PYG{n}{airline} \PYG{n}{ua}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
 \PYG{n}{rawdata} \PYG{o}{=} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{raw\PYGZus{}cols}\PYG{o}{+}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tagged\PYGZus{}text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)} \PYGZbs{}
                  \PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lemm\PYGZus{}text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{lemmatize\PYGZus{}udf}\PYG{p}{(}\PYG{n}{rawdata}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tagged\PYGZus{}text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}


\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n+nb}{id}\PYG{o}{\textbar{}}           \PYG{n}{airline}\PYG{o}{\textbar{}}      \PYG{n}{date}\PYG{o}{\textbar{}}\PYG{n}{location}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}   \PYG{n}{cabin}\PYG{o}{\textbar{}}\PYG{n}{value}\PYG{o}{\textbar{}}\PYG{n}{recommended}\PYG{o}{\textbar{}}              \PYG{n}{review}\PYG{o}{\textbar{}}         \PYG{n}{tagged\PYGZus{}text}\PYG{o}{\textbar{}}           \PYG{n}{lemm\PYGZus{}text}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10551}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}} \PYG{n}{flight} \PYG{n}{chicago} \PYG{n}{m}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{n}{chicago} \PYG{n}{mi}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10298}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{03}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{31}\PYG{o}{\textbar{}}      \PYG{n}{UK}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{k+kn}{from} \PYG{n+nn}{Manch...}\PYG{o}{\textbar{}} \PYG{n}{flight} \PYG{n}{mancheste}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{n}{manchester}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10564}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{09}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{I}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m Executive Pla...\textbar{} executive platin...\textbar{}executive platinu...\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10134}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{MSP}\PYG{o}{\PYGZhy{}}\PYG{n}{JFK}\PYG{o}{\PYGZhy{}}\PYG{n}{MXP} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}} \PYG{n}{msp} \PYG{n}{jfk} \PYG{n}{mxp} \PYG{n}{retu}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{msp} \PYG{n}{jfk} \PYG{n}{mxp} \PYG{n}{retur}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10912}\PYG{o}{\textbar{}}   \PYG{n}{United} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{04}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Worst} \PYG{n}{airline} \PYG{n}{I} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}} \PYG{n}{worst} \PYG{n}{airline} \PYG{n}{ua}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{worst} \PYG{n}{airline} \PYG{n}{ual}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
 \PYG{n}{rawdata} \PYG{o}{=} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{raw\PYGZus{}cols}\PYG{o}{+}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lemm\PYGZus{}text}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)} \PYGZbs{}
                  \PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{is\PYGZus{}blank}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{check\PYGZus{}blanks\PYGZus{}udf}\PYG{p}{(}\PYG{n}{rawdata}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{lemm\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}


\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n+nb}{id}\PYG{o}{\textbar{}}           \PYG{n}{airline}\PYG{o}{\textbar{}}      \PYG{n}{date}\PYG{o}{\textbar{}}\PYG{n}{location}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}   \PYG{n}{cabin}\PYG{o}{\textbar{}}\PYG{n}{value}\PYG{o}{\textbar{}}\PYG{n}{recommended}\PYG{o}{\textbar{}}              \PYG{n}{review}\PYG{o}{\textbar{}}           \PYG{n}{lemm\PYGZus{}text}\PYG{o}{\textbar{}}\PYG{n}{is\PYGZus{}blank}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10551}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{n}{chicago} \PYG{n}{mi}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n+nb+bp}{False}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10298}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{03}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{31}\PYG{o}{\textbar{}}      \PYG{n}{UK}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{k+kn}{from} \PYG{n+nn}{Manch...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{n}{manchester}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n+nb+bp}{False}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10564}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{09}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{I}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m Executive Pla...\textbar{}executive platinu...\textbar{}   False\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10134}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{MSP}\PYG{o}{\PYGZhy{}}\PYG{n}{JFK}\PYG{o}{\PYGZhy{}}\PYG{n}{MXP} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{msp} \PYG{n}{jfk} \PYG{n}{mxp} \PYG{n}{retur}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n+nb+bp}{False}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10912}\PYG{o}{\textbar{}}   \PYG{n}{United} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{04}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Worst} \PYG{n}{airline} \PYG{n}{I} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{worst} \PYG{n}{airline} \PYG{n}{ual}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n+nb+bp}{False}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{monotonically\PYGZus{}increasing\PYGZus{}id}
\PYG{c+c1}{\PYGZsh{} Create Unique ID}
\PYG{n}{rawdata} \PYG{o}{=} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{uid}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{monotonically\PYGZus{}increasing\PYGZus{}id}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{data} \PYG{o}{=} \PYG{n}{rawdata}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{n}{rawdata}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{is\PYGZus{}blank}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{False}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n+nb}{id}\PYG{o}{\textbar{}}           \PYG{n}{airline}\PYG{o}{\textbar{}}      \PYG{n}{date}\PYG{o}{\textbar{}}\PYG{n}{location}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}   \PYG{n}{cabin}\PYG{o}{\textbar{}}\PYG{n}{value}\PYG{o}{\textbar{}}\PYG{n}{recommended}\PYG{o}{\textbar{}}              \PYG{n}{review}\PYG{o}{\textbar{}}           \PYG{n}{lemm\PYGZus{}text}\PYG{o}{\textbar{}}\PYG{n}{is\PYGZus{}blank}\PYG{o}{\textbar{}}\PYG{n}{uid}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10551}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{l+m+mi}{3246} \PYG{k+kn}{from} \PYG{n+nn}{...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{n}{chicago} \PYG{n}{mi}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n+nb+bp}{False}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10298}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{03}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{31}\PYG{o}{\textbar{}}      \PYG{n}{UK}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{n}{Business}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Flight} \PYG{k+kn}{from} \PYG{n+nn}{Manch...}\PYG{o}{\textbar{}}\PYG{n}{flight} \PYG{n}{manchester}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n+nb+bp}{False}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10564}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{09}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{I}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m Executive Pla...\textbar{}executive platinu...\textbar{}   False\textbar{}  2\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10134}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}        \PYG{n}{YES}\PYG{o}{\textbar{}}\PYG{n}{MSP}\PYG{o}{\PYGZhy{}}\PYG{n}{JFK}\PYG{o}{\PYGZhy{}}\PYG{n}{MXP} \PYG{o+ow}{and} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{msp} \PYG{n}{jfk} \PYG{n}{mxp} \PYG{n}{retur}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n+nb+bp}{False}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10912}\PYG{o}{\textbar{}}   \PYG{n}{United} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{04}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\textbar{}}     \PYG{n}{USA}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}} \PYG{n}{Economy}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}         \PYG{n}{NO}\PYG{o}{\textbar{}}\PYG{n}{Worst} \PYG{n}{airline} \PYG{n}{I} \PYG{n}{h}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{n}{worst} \PYG{n}{airline} \PYG{n}{ual}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}   \PYG{n+nb+bp}{False}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\end{quote}

\# Pipeline for LDA model
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{HashingTF}\PYG{p}{,} \PYG{n}{IDF}\PYG{p}{,} \PYG{n}{Tokenizer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.classification} \PYG{k+kn}{import} \PYG{n}{NaiveBayes}\PYG{p}{,} \PYG{n}{RandomForestClassifier}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.clustering} \PYG{k+kn}{import} \PYG{n}{LDA}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.classification} \PYG{k+kn}{import} \PYG{n}{DecisionTreeClassifier}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{MulticlassClassificationEvaluator}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.tuning} \PYG{k+kn}{import} \PYG{n}{ParamGridBuilder}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.tuning} \PYG{k+kn}{import} \PYG{n}{CrossValidator}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{IndexToString}\PYG{p}{,} \PYG{n}{StringIndexer}\PYG{p}{,} \PYG{n}{VectorIndexer}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{CountVectorizer}

\PYG{c+c1}{\PYGZsh{} Configure an ML pipeline, which consists of tree stages: tokenizer, hashingTF, and nb.}
\PYG{n}{tokenizer} \PYG{o}{=} \PYG{n}{Tokenizer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{lemm\PYGZus{}text}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{words}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}data = tokenizer.transform(data)}
\PYG{n}{vectorizer} \PYG{o}{=} \PYG{n}{CountVectorizer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{words}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rawFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{idf} \PYG{o}{=} \PYG{n}{IDF}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rawFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}idfModel = idf.fit(data)}

\PYG{n}{lda} \PYG{o}{=} \PYG{n}{LDA}\PYG{p}{(}\PYG{n}{k}\PYG{o}{=}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{optimizer}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{em}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{tokenizer}\PYG{p}{,} \PYG{n}{vectorizer}\PYG{p}{,}\PYG{n}{idf}\PYG{p}{,} \PYG{n}{lda}\PYG{p}{]}\PYG{p}{)}


\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Results presentation

\end{enumerate}
\begin{itemize}
\item {} 
Topics

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{topic}\PYG{o}{\textbar{}}         \PYG{n}{termIndices}\PYG{o}{\textbar{}}         \PYG{n}{termWeights}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{60}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{483}\PYG{p}{,} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01349507958269}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{1}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{363}\PYG{p}{,} \PYG{l+m+mi}{29}\PYG{p}{,} \PYG{l+m+mi}{187}\PYG{p}{,} \PYG{l+m+mf}{55.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01247250144447}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{2}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{46}\PYG{p}{,} \PYG{l+m+mi}{107}\PYG{p}{,} \PYG{l+m+mi}{672}\PYG{p}{,} \PYG{l+m+mf}{27.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01188684264641}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{3}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{76}\PYG{p}{,} \PYG{l+m+mi}{43}\PYG{p}{,} \PYG{l+m+mi}{285}\PYG{p}{,} \PYG{l+m+mf}{152.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01132638300115}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{4}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{201}\PYG{p}{,} \PYG{l+m+mi}{13}\PYG{p}{,} \PYG{l+m+mi}{372}\PYG{p}{,} \PYG{l+m+mf}{69.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01337529863256}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{122}\PYG{p}{,} \PYG{l+m+mi}{103}\PYG{p}{,} \PYG{l+m+mi}{181}\PYG{p}{,} \PYG{l+m+mf}{4.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.00930415977117}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mi}{270}\PYG{p}{,} \PYG{l+m+mi}{18}\PYG{p}{,} \PYG{l+m+mi}{74}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01253817708163}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{7}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{111}\PYG{p}{,} \PYG{l+m+mi}{36}\PYG{p}{,} \PYG{l+m+mi}{341}\PYG{p}{,} \PYG{l+m+mf}{10.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01269584954257}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{477}\PYG{p}{,} \PYG{l+m+mi}{266}\PYG{p}{,} \PYG{l+m+mi}{297}\PYG{p}{,} \PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01017486869509}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{9}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{73}\PYG{p}{,} \PYG{l+m+mi}{46}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01050875237546}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{10}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{57}\PYG{p}{,} \PYG{l+m+mi}{29}\PYG{p}{,} \PYG{l+m+mi}{411}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01777350667863}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{11}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{293}\PYG{p}{,} \PYG{l+m+mi}{119}\PYG{p}{,} \PYG{l+m+mi}{385}\PYG{p}{,} \PYG{l+m+mf}{4.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01280305149305}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{12}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{116}\PYG{p}{,} \PYG{l+m+mi}{218}\PYG{p}{,} \PYG{l+m+mi}{256}\PYG{p}{,} \PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01570714218509}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{13}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{433}\PYG{p}{,} \PYG{l+m+mi}{171}\PYG{p}{,} \PYG{l+m+mi}{176}\PYG{p}{,} \PYG{l+m+mf}{3.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.00819684813575}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{14}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{74}\PYG{p}{,} \PYG{l+m+mi}{84}\PYG{p}{,} \PYG{l+m+mi}{45}\PYG{p}{,} \PYG{l+m+mi}{108}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01700630002172}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{15}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{669}\PYG{p}{,} \PYG{l+m+mi}{215}\PYG{p}{,} \PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mf}{58.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.00779310974971}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{16}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{198}\PYG{p}{,} \PYG{l+m+mi}{21}\PYG{p}{,} \PYG{l+m+mi}{98}\PYG{p}{,} \PYG{l+m+mf}{164.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01030577084202}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{17}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{96}\PYG{p}{,} \PYG{l+m+mi}{29}\PYG{p}{,} \PYG{l+m+mi}{569}\PYG{p}{,} \PYG{l+m+mf}{444.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01297142577633}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{18}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{18}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{,} \PYG{l+m+mi}{140}\PYG{p}{,} \PYG{l+m+mi}{64}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01306356985169}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{19}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{33}\PYG{p}{,} \PYG{l+m+mi}{178}\PYG{p}{,} \PYG{l+m+mi}{95}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.00907425683229}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
Topic terms

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{ArrayType}\PYG{p}{,} \PYG{n}{StringType}

\PYG{k}{def} \PYG{n+nf}{termsIdx2Term}\PYG{p}{(}\PYG{n}{vocabulary}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{def} \PYG{n+nf}{termsIdx2Term}\PYG{p}{(}\PYG{n}{termIndices}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{return} \PYG{p}{[}\PYG{n}{vocabulary}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{index}\PYG{p}{)}\PYG{p}{]} \PYG{k}{for} \PYG{n}{index} \PYG{o+ow}{in} \PYG{n}{termIndices}\PYG{p}{]}
    \PYG{k}{return} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{termsIdx2Term}\PYG{p}{,} \PYG{n}{ArrayType}\PYG{p}{(}\PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{vectorizerModel} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{stages}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}
\PYG{n}{vocabList} \PYG{o}{=} \PYG{n}{vectorizerModel}\PYG{o}{.}\PYG{n}{vocabulary}
\PYG{n}{final} \PYG{o}{=} \PYG{n}{ldatopics}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Terms}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{termsIdx2Term}\PYG{p}{(}\PYG{n}{vocabList}\PYG{p}{)}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{termIndices}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{topic}\PYG{o}{\textbar{}}\PYG{n}{termIndices}                                     \PYG{o}{\textbar{}}\PYG{n}{Terms}                                                                                \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{0}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{60}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{483}\PYG{p}{,} \PYG{l+m+mi}{292}\PYG{p}{,} \PYG{l+m+mi}{326}\PYG{p}{,} \PYG{l+m+mi}{88}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{808}\PYG{p}{,} \PYG{l+m+mi}{32}\PYG{p}{]}      \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{pm}\PYG{p}{,} \PYG{n}{plane}\PYG{p}{,} \PYG{n}{board}\PYG{p}{,} \PYG{n}{kid}\PYG{p}{,} \PYG{n}{online}\PYG{p}{,} \PYG{n}{lga}\PYG{p}{,} \PYG{n}{schedule}\PYG{p}{,} \PYG{n}{get}\PYG{p}{,} \PYG{n}{memphis}\PYG{p}{,} \PYG{n}{arrive}\PYG{p}{]}                 \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{1}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{363}\PYG{p}{,} \PYG{l+m+mi}{29}\PYG{p}{,} \PYG{l+m+mi}{187}\PYG{p}{,} \PYG{l+m+mi}{55}\PYG{p}{,} \PYG{l+m+mi}{48}\PYG{p}{,} \PYG{l+m+mi}{647}\PYG{p}{,} \PYG{l+m+mi}{30}\PYG{p}{,} \PYG{l+m+mi}{9}\PYG{p}{,} \PYG{l+m+mi}{204}\PYG{p}{,} \PYG{l+m+mi}{457}\PYG{p}{]}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{dublin}\PYG{p}{,} \PYG{n}{class}\PYG{p}{,} \PYG{n}{th}\PYG{p}{,} \PYG{n}{sit}\PYG{p}{,} \PYG{n}{entertainment}\PYG{p}{,} \PYG{n}{express}\PYG{p}{,} \PYG{n}{say}\PYG{p}{,} \PYG{n}{delay}\PYG{p}{,} \PYG{n}{dl}\PYG{p}{,} \PYG{n}{son}\PYG{p}{]}                \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{2}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{46}\PYG{p}{,} \PYG{l+m+mi}{107}\PYG{p}{,} \PYG{l+m+mi}{672}\PYG{p}{,} \PYG{l+m+mi}{274}\PYG{p}{,} \PYG{l+m+mi}{92}\PYG{p}{,} \PYG{l+m+mi}{539}\PYG{p}{,} \PYG{l+m+mi}{23}\PYG{p}{,} \PYG{l+m+mi}{27}\PYG{p}{,} \PYG{l+m+mi}{279}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{]}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{economy}\PYG{p}{,} \PYG{n}{sfo}\PYG{p}{,} \PYG{n}{milwaukee}\PYG{p}{,} \PYG{n}{decent}\PYG{p}{,} \PYG{n}{comfortable}\PYG{p}{,} \PYG{n}{iad}\PYG{p}{,} \PYG{k}{return}\PYG{p}{,} \PYG{n}{united}\PYG{p}{,} \PYG{n}{average}\PYG{p}{,} \PYG{n}{airline}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{3}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{76}\PYG{p}{,} \PYG{l+m+mi}{43}\PYG{p}{,} \PYG{l+m+mi}{285}\PYG{p}{,} \PYG{l+m+mi}{152}\PYG{p}{,} \PYG{l+m+mi}{102}\PYG{p}{,} \PYG{l+m+mi}{34}\PYG{p}{,} \PYG{l+m+mi}{300}\PYG{p}{,} \PYG{l+m+mi}{113}\PYG{p}{,} \PYG{l+m+mi}{24}\PYG{p}{,} \PYG{l+m+mi}{31}\PYG{p}{]}   \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{didn}\PYG{p}{,} \PYG{n}{pay}\PYG{p}{,} \PYG{n}{lose}\PYG{p}{,} \PYG{n}{different}\PYG{p}{,} \PYG{n}{extra}\PYG{p}{,} \PYG{n}{bag}\PYG{p}{,} \PYG{n}{mile}\PYG{p}{,} \PYG{n}{baggage}\PYG{p}{,} \PYG{n}{leave}\PYG{p}{,} \PYG{n}{day}\PYG{p}{]}                  \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{4}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{201}\PYG{p}{,} \PYG{l+m+mi}{13}\PYG{p}{,} \PYG{l+m+mi}{372}\PYG{p}{,} \PYG{l+m+mi}{692}\PYG{p}{,} \PYG{l+m+mi}{248}\PYG{p}{,} \PYG{l+m+mi}{62}\PYG{p}{,} \PYG{l+m+mi}{211}\PYG{p}{,} \PYG{l+m+mi}{187}\PYG{p}{,} \PYG{l+m+mi}{105}\PYG{p}{,} \PYG{l+m+mi}{110}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{houston}\PYG{p}{,} \PYG{n}{crew}\PYG{p}{,} \PYG{n}{heathrow}\PYG{p}{,} \PYG{n}{louisville}\PYG{p}{,} \PYG{n}{london}\PYG{p}{,} \PYG{n}{great}\PYG{p}{,} \PYG{n}{denver}\PYG{p}{,} \PYG{n}{th}\PYG{p}{,} \PYG{n}{land}\PYG{p}{,} \PYG{n}{jfk}\PYG{p}{]}          \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{5}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{122}\PYG{p}{,} \PYG{l+m+mi}{103}\PYG{p}{,} \PYG{l+m+mi}{181}\PYG{p}{,} \PYG{l+m+mi}{48}\PYG{p}{,} \PYG{l+m+mi}{434}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{121}\PYG{p}{,} \PYG{l+m+mi}{147}\PYG{p}{,} \PYG{l+m+mi}{934}\PYG{p}{,} \PYG{l+m+mi}{169}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{lhr}\PYG{p}{,} \PYG{n}{serve}\PYG{p}{,} \PYG{n}{screen}\PYG{p}{,} \PYG{n}{entertainment}\PYG{p}{,} \PYG{n}{ny}\PYG{p}{,} \PYG{n}{delta}\PYG{p}{,} \PYG{n}{excellent}\PYG{p}{,} \PYG{n}{atl}\PYG{p}{,} \PYG{n}{sin}\PYG{p}{,} \PYG{n}{newark}\PYG{p}{]}          \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{6}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mi}{270}\PYG{p}{,} \PYG{l+m+mi}{18}\PYG{p}{,} \PYG{l+m+mi}{74}\PYG{p}{,} \PYG{l+m+mi}{70}\PYG{p}{,} \PYG{l+m+mi}{37}\PYG{p}{,} \PYG{l+m+mi}{16}\PYG{p}{,} \PYG{l+m+mi}{450}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{]}       \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{check}\PYG{p}{,} \PYG{n}{employee}\PYG{p}{,} \PYG{n}{gate}\PYG{p}{,} \PYG{n}{line}\PYG{p}{,} \PYG{n}{change}\PYG{p}{,} \PYG{n}{wait}\PYG{p}{,} \PYG{n}{take}\PYG{p}{,} \PYG{n}{fll}\PYG{p}{,} \PYG{n}{time}\PYG{p}{,} \PYG{n}{tell}\PYG{p}{]}                   \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{7}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{111}\PYG{p}{,} \PYG{l+m+mi}{36}\PYG{p}{,} \PYG{l+m+mi}{341}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{320}\PYG{p}{,} \PYG{l+m+mi}{528}\PYG{p}{,} \PYG{l+m+mi}{844}\PYG{p}{,} \PYG{l+m+mi}{19}\PYG{p}{,} \PYG{l+m+mi}{195}\PYG{p}{,} \PYG{l+m+mi}{524}\PYG{p}{]} \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{atlanta}\PYG{p}{,} \PYG{n}{first}\PYG{p}{,} \PYG{n}{toilet}\PYG{p}{,} \PYG{n}{delta}\PYG{p}{,} \PYG{n}{washington}\PYG{p}{,} \PYG{n}{card}\PYG{p}{,} \PYG{k}{global}\PYG{p}{,} \PYG{n}{staff}\PYG{p}{,} \PYG{n}{route}\PYG{p}{,} \PYG{n}{amsterdam}\PYG{p}{]}   \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{8}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{477}\PYG{p}{,} \PYG{l+m+mi}{266}\PYG{p}{,} \PYG{l+m+mi}{297}\PYG{p}{,} \PYG{l+m+mi}{185}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{33}\PYG{p}{,} \PYG{l+m+mi}{22}\PYG{p}{,} \PYG{l+m+mi}{783}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{908}\PYG{p}{]}   \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{fuel}\PYG{p}{,} \PYG{n}{group}\PYG{p}{,} \PYG{n}{pas}\PYG{p}{,} \PYG{n}{boarding}\PYG{p}{,} \PYG{n}{seat}\PYG{p}{,} \PYG{n}{trip}\PYG{p}{,} \PYG{n}{minute}\PYG{p}{,} \PYG{n}{orleans}\PYG{p}{,} \PYG{n}{make}\PYG{p}{,} \PYG{n}{select}\PYG{p}{]}              \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{9}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{73}\PYG{p}{,} \PYG{l+m+mi}{46}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{248}\PYG{p}{,} \PYG{l+m+mi}{302}\PYG{p}{,} \PYG{l+m+mi}{213}\PYG{p}{,} \PYG{l+m+mi}{659}\PYG{p}{,} \PYG{l+m+mi}{48}\PYG{p}{,} \PYG{l+m+mi}{228}\PYG{p}{]}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{delta}\PYG{p}{,} \PYG{n}{lax}\PYG{p}{,} \PYG{n}{economy}\PYG{p}{,} \PYG{n}{seat}\PYG{p}{,} \PYG{n}{london}\PYG{p}{,} \PYG{n}{detroit}\PYG{p}{,} \PYG{n}{comfo}\PYG{p}{,} \PYG{n}{weren}\PYG{p}{,} \PYG{n}{entertainment}\PYG{p}{,} \PYG{n}{wife}\PYG{p}{]}      \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10}   \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{57}\PYG{p}{,} \PYG{l+m+mi}{29}\PYG{p}{,} \PYG{l+m+mi}{411}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{221}\PYG{p}{,} \PYG{l+m+mi}{121}\PYG{p}{,} \PYG{l+m+mi}{661}\PYG{p}{,} \PYG{l+m+mi}{19}\PYG{p}{,} \PYG{l+m+mi}{805}\PYG{p}{,} \PYG{l+m+mi}{733}\PYG{p}{]}  \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{business}\PYG{p}{,} \PYG{n}{class}\PYG{p}{,} \PYG{n}{fra}\PYG{p}{,} \PYG{n}{delta}\PYG{p}{,} \PYG{n}{lounge}\PYG{p}{,} \PYG{n}{excellent}\PYG{p}{,} \PYG{n}{syd}\PYG{p}{,} \PYG{n}{staff}\PYG{p}{,} \PYG{n}{nov}\PYG{p}{,} \PYG{n}{mexico}\PYG{p}{]}            \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{11}   \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{293}\PYG{p}{,} \PYG{l+m+mi}{119}\PYG{p}{,} \PYG{l+m+mi}{385}\PYG{p}{,} \PYG{l+m+mi}{481}\PYG{p}{,} \PYG{l+m+mi}{503}\PYG{p}{,} \PYG{l+m+mi}{69}\PYG{p}{,} \PYG{l+m+mi}{13}\PYG{p}{,} \PYG{l+m+mi}{87}\PYG{p}{,} \PYG{l+m+mi}{176}\PYG{p}{,} \PYG{l+m+mi}{545}\PYG{p}{]} \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{march}\PYG{p}{,} \PYG{n}{ua}\PYG{p}{,} \PYG{n}{manchester}\PYG{p}{,} \PYG{n}{phx}\PYG{p}{,} \PYG{n}{envoy}\PYG{p}{,} \PYG{n}{drink}\PYG{p}{,} \PYG{n}{crew}\PYG{p}{,} \PYG{n}{american}\PYG{p}{,} \PYG{n}{aa}\PYG{p}{,} \PYG{n}{canada}\PYG{p}{]}               \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}   \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{116}\PYG{p}{,} \PYG{l+m+mi}{218}\PYG{p}{,} \PYG{l+m+mi}{256}\PYG{p}{,} \PYG{l+m+mi}{156}\PYG{p}{,} \PYG{l+m+mi}{639}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{365}\PYG{p}{,} \PYG{l+m+mi}{18}\PYG{p}{,} \PYG{l+m+mi}{22}\PYG{p}{,} \PYG{l+m+mi}{136}\PYG{p}{]} \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{san}\PYG{p}{,} \PYG{n}{clt}\PYG{p}{,} \PYG{n}{francisco}\PYG{p}{,} \PYG{n}{second}\PYG{p}{,} \PYG{n}{text}\PYG{p}{,} \PYG{n}{tell}\PYG{p}{,} \PYG{n}{captain}\PYG{p}{,} \PYG{n}{gate}\PYG{p}{,} \PYG{n}{minute}\PYG{p}{,} \PYG{n}{available}\PYG{p}{]}          \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{13}   \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{433}\PYG{p}{,} \PYG{l+m+mi}{171}\PYG{p}{,} \PYG{l+m+mi}{176}\PYG{p}{,} \PYG{l+m+mi}{339}\PYG{p}{,} \PYG{l+m+mi}{429}\PYG{p}{,} \PYG{l+m+mi}{575}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{26}\PYG{p}{,} \PYG{l+m+mi}{474}\PYG{p}{,} \PYG{l+m+mi}{796}\PYG{p}{]}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{daughter}\PYG{p}{,} \PYG{n}{small}\PYG{p}{,} \PYG{n}{aa}\PYG{p}{,} \PYG{n}{ba}\PYG{p}{,} \PYG{n}{segment}\PYG{p}{,} \PYG{n}{proceed}\PYG{p}{,} \PYG{n}{delta}\PYG{p}{,} \PYG{n}{passenger}\PYG{p}{,} \PYG{n}{size}\PYG{p}{,} \PYG{n}{similar}\PYG{p}{]}         \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{14}   \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{74}\PYG{p}{,} \PYG{l+m+mi}{84}\PYG{p}{,} \PYG{l+m+mi}{45}\PYG{p}{,} \PYG{l+m+mi}{108}\PYG{p}{,} \PYG{l+m+mi}{342}\PYG{p}{,} \PYG{l+m+mi}{111}\PYG{p}{,} \PYG{l+m+mi}{315}\PYG{p}{,} \PYG{l+m+mi}{87}\PYG{p}{,} \PYG{l+m+mi}{52}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}     \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{line}\PYG{p}{,} \PYG{n}{agent}\PYG{p}{,} \PYG{n+nb}{next}\PYG{p}{,} \PYG{n}{hotel}\PYG{p}{,} \PYG{n}{standby}\PYG{p}{,} \PYG{n}{atlanta}\PYG{p}{,} \PYG{n}{dallas}\PYG{p}{,} \PYG{n}{american}\PYG{p}{,} \PYG{n}{book}\PYG{p}{,} \PYG{n}{get}\PYG{p}{]}            \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{15}   \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{669}\PYG{p}{,} \PYG{l+m+mi}{215}\PYG{p}{,} \PYG{l+m+mi}{14}\PYG{p}{,} \PYG{l+m+mi}{58}\PYG{p}{,} \PYG{l+m+mi}{561}\PYG{p}{,} \PYG{l+m+mi}{59}\PYG{p}{,} \PYG{l+m+mi}{125}\PYG{p}{,} \PYG{l+m+mi}{179}\PYG{p}{,} \PYG{l+m+mi}{93}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{]}    \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{fit}\PYG{p}{,} \PYG{n}{carry}\PYG{p}{,} \PYG{n}{check}\PYG{p}{,} \PYG{n}{people}\PYG{p}{,} \PYG{n}{bathroom}\PYG{p}{,} \PYG{n}{ask}\PYG{p}{,} \PYG{n}{thing}\PYG{p}{,} \PYG{n}{row}\PYG{p}{,} \PYG{n}{don}\PYG{p}{,} \PYG{n}{fly}\PYG{p}{]}                     \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{16}   \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{198}\PYG{p}{,} \PYG{l+m+mi}{21}\PYG{p}{,} \PYG{l+m+mi}{98}\PYG{p}{,} \PYG{l+m+mi}{164}\PYG{p}{,} \PYG{l+m+mi}{57}\PYG{p}{,} \PYG{l+m+mi}{141}\PYG{p}{,} \PYG{l+m+mi}{345}\PYG{p}{,} \PYG{l+m+mi}{62}\PYG{p}{,} \PYG{l+m+mi}{121}\PYG{p}{,} \PYG{l+m+mi}{174}\PYG{p}{]}  \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{ife}\PYG{p}{,} \PYG{n}{good}\PYG{p}{,} \PYG{n}{nice}\PYG{p}{,} \PYG{n}{much}\PYG{p}{,} \PYG{n}{business}\PYG{p}{,} \PYG{n}{lot}\PYG{p}{,} \PYG{n}{dfw}\PYG{p}{,} \PYG{n}{great}\PYG{p}{,} \PYG{n}{excellent}\PYG{p}{,} \PYG{n}{carrier}\PYG{p}{]}               \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{17}   \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{96}\PYG{p}{,} \PYG{l+m+mi}{29}\PYG{p}{,} \PYG{l+m+mi}{569}\PYG{p}{,} \PYG{l+m+mi}{444}\PYG{p}{,} \PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{568}\PYG{p}{,} \PYG{l+m+mi}{21}\PYG{p}{,} \PYG{l+m+mi}{103}\PYG{p}{,} \PYG{l+m+mi}{657}\PYG{p}{,} \PYG{l+m+mi}{505}\PYG{p}{]}  \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{phl}\PYG{p}{,} \PYG{n}{class}\PYG{p}{,} \PYG{n}{diego}\PYG{p}{,} \PYG{n}{lady}\PYG{p}{,} \PYG{n}{food}\PYG{p}{,} \PYG{n}{wheelchair}\PYG{p}{,} \PYG{n}{good}\PYG{p}{,} \PYG{n}{serve}\PYG{p}{,} \PYG{n}{miami}\PYG{p}{,} \PYG{n}{mia}\PYG{p}{]}                 \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{18}   \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{18}\PYG{p}{,} \PYG{l+m+mi}{60}\PYG{p}{,} \PYG{l+m+mi}{140}\PYG{p}{,} \PYG{l+m+mi}{64}\PYG{p}{,} \PYG{l+m+mi}{47}\PYG{p}{,} \PYG{l+m+mi}{40}\PYG{p}{,} \PYG{l+m+mi}{31}\PYG{p}{,} \PYG{l+m+mi}{35}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{123}\PYG{p}{]}       \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{gate}\PYG{p}{,} \PYG{n}{pm}\PYG{p}{,} \PYG{n}{phoenix}\PYG{p}{,} \PYG{n}{connection}\PYG{p}{,} \PYG{n}{cancel}\PYG{p}{,} \PYG{n}{connect}\PYG{p}{,} \PYG{n}{day}\PYG{p}{,} \PYG{n}{airpo}\PYG{p}{,} \PYG{n}{hour}\PYG{p}{,} \PYG{n}{charlotte}\PYG{p}{]}        \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{19}   \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mi}{33}\PYG{p}{,} \PYG{l+m+mi}{178}\PYG{p}{,} \PYG{l+m+mi}{95}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{9}\PYG{p}{,} \PYG{l+m+mi}{284}\PYG{p}{,} \PYG{l+m+mi}{42}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{89}\PYG{p}{,} \PYG{l+m+mi}{31}\PYG{p}{]}         \PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{trip}\PYG{p}{,} \PYG{n}{counter}\PYG{p}{,} \PYG{n}{philadelphia}\PYG{p}{,} \PYG{n}{hour}\PYG{p}{,} \PYG{n}{delay}\PYG{p}{,} \PYG{n}{stay}\PYG{p}{,} \PYG{n}{way}\PYG{p}{,} \PYG{n}{get}\PYG{p}{,} \PYG{n}{southwest}\PYG{p}{,} \PYG{n}{day}\PYG{p}{]}           \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
LDA results

\end{itemize}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{n+nb}{id}\PYG{o}{\textbar{}}           \PYG{n}{airline}\PYG{o}{\textbar{}}      \PYG{n}{date}\PYG{o}{\textbar{}}      \PYG{n}{cabin}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}               \PYG{n}{words}\PYG{o}{\textbar{}}            \PYG{n}{features}\PYG{o}{\textbar{}}   \PYG{n}{topicDistribution}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10551}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}   \PYG{n}{Business}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{flight}\PYG{p}{,} \PYG{n}{chicago}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{,}\PYG{l+m+mf}{11.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.03640342580508}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10298}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{03}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{31}\PYG{o}{\textbar{}}   \PYG{n}{Business}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{flight}\PYG{p}{,} \PYG{n}{manchest}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01381306271470}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10564}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{09}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{executive}\PYG{p}{,} \PYG{n}{plati}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{l+m+mf}{11.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.05063554352934}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10134}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{msp}\PYG{p}{,} \PYG{n}{jfk}\PYG{p}{,} \PYG{n}{mxp}\PYG{p}{,} \PYG{n}{r}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01494708959842}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10912}\PYG{o}{\textbar{}}   \PYG{n}{United} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{04}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{worst}\PYG{p}{,} \PYG{n}{airline}\PYG{p}{,} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{,}\PYG{l+m+mf}{13.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.04421751181232}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10089}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{02}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{18}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{2.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{dl}\PYG{p}{,} \PYG{n}{mia}\PYG{p}{,} \PYG{n}{lax}\PYG{p}{,} \PYG{n}{im}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.02158861273876}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10385}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{21}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{flew}\PYG{p}{,} \PYG{n}{gla}\PYG{p}{,} \PYG{n}{phl}\PYG{p}{,} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{l+m+mf}{14.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.03343845991816}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10249}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{17}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{friend}\PYG{p}{,} \PYG{n}{book}\PYG{p}{,} \PYG{n}{fl}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.02362432562165}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10289}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{04}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{flew}\PYG{p}{,} \PYG{n}{air}\PYG{p}{,} \PYG{n}{rome}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{,}\PYG{l+m+mf}{13.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01664012816210}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10654}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2012}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{8.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{lhr}\PYG{p}{,} \PYG{n}{jfk}\PYG{p}{,} \PYG{n}{think}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01526072330297}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10754}\PYG{o}{\textbar{}} \PYG{n}{American} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{05}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{04}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{san}\PYG{p}{,} \PYG{n}{diego}\PYG{p}{,} \PYG{n}{moli}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{,}\PYG{l+m+mi}{15}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.03571177612496}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10646}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2012}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{17}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{7.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{toledo}\PYG{p}{,} \PYG{n}{co}\PYG{p}{,} \PYG{n}{stop}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.02394775146271}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10097}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{02}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{03}\PYG{o}{\textbar{}}\PYG{n}{First} \PYG{n}{Class}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{honolulu}\PYG{p}{,} \PYG{n}{la}\PYG{p}{,} \PYG{n}{fi}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{l+m+mf}{13.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.02008375619661}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10132}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{16}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{7.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{manchester}\PYG{p}{,} \PYG{n}{uk}\PYG{p}{,} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01463126146601}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10560}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{09}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{9.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{first}\PYG{p}{,} \PYG{n}{time}\PYG{p}{,} \PYG{n}{sou}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{,}\PYG{l+m+mi}{9}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.04934836409896}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10579}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{25}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{plane}\PYG{p}{,} \PYG{n}{land}\PYG{p}{,} \PYG{n}{pm}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.06106959241722}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10425}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{08}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{airway}\PYG{p}{,} \PYG{n}{bad}\PYG{p}{,} \PYG{n}{pro}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.01770471771322}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10650}\PYG{o}{\textbar{}}\PYG{n}{Southwest} \PYG{n}{Airlines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2012}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{27}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{9.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{flew}\PYG{p}{,} \PYG{n}{jfk}\PYG{p}{,} \PYG{n}{lhr}\PYG{p}{,} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{,}\PYG{l+m+mf}{1.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.02676226245086}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10260}\PYG{o}{\textbar{}}        \PYG{n}{US} \PYG{n}{Airways}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2014}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{06}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{03}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{february}\PYG{p}{,} \PYG{n}{air}\PYG{p}{,} \PYG{n}{u}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{17}\PYG{p}{,}\PYG{l+m+mf}{2.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.02887390875079}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{10202}\PYG{o}{\textbar{}}   \PYG{n}{Delta} \PYG{n}{Air} \PYG{n}{Lines}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2013}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{09}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{14}\PYG{o}{\textbar{}}    \PYG{n}{Economy}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{10.0}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{aug}\PYG{p}{,} \PYG{n}{lhr}\PYG{p}{,} \PYG{n}{jfk}\PYG{p}{,} \PYG{n}{b}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{4695}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{l+m+mf}{10.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{l+m+mf}{0.02377704988307}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{20} \PYG{n}{rows}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
Average rating and airlines for each day

\end{itemize}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{avg_rating_airlines}.png}
\end{figure}
\begin{itemize}
\item {} 
Average rating and airlines for each month

\end{itemize}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{avg_rating_mon}.png}
\end{figure}
\begin{itemize}
\item {} 
Topic 1 corresponding to time line

\end{itemize}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{topic_time}.png}
\end{figure}
\begin{itemize}
\item {} 
reviews (documents) relate to topic 1

\end{itemize}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{review2topic}.png}
\end{figure}


\chapter{Social Network Analysis}
\label{\detokenize{socialnetwork:social-network-analysis}}\label{\detokenize{socialnetwork:socialnetwork}}\label{\detokenize{socialnetwork::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

\sphinxstylestrong{A Touch of Cloth,linked in countless ways.} \textendash{} old Chinese proverb
\end{sphinxadmonition}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{net_work}.png}
\end{figure}


\section{Introduction}
\label{\detokenize{socialnetwork:introduction}}



\section{Co-occurrence Network}
\label{\detokenize{socialnetwork:co-occurrence-network}}
\sphinxhref{https://en.wikipedia.org/wiki/Co-occurrence\_networks}{Co-occurrence networks} are generally used to provide a graphic visualization of potential relationships between people, organizations, concepts or other entities represented within written material. The generation and visualization of co-occurrence networks has become practical with the advent of electronically stored text amenable to text mining.


\subsection{Methodology}
\label{\detokenize{socialnetwork:methodology}}\begin{itemize}
\item {} 
Build Corpus C

\item {} 
Build Document-Term matrix D based on Corpus C

\item {} 
Compute Term-Document matrix \(D^T\)

\item {} 
Adjacency Matrix \(A =D^T\cdot D\)

\end{itemize}

There are four main components in this algorithm in the algorithm: Corpus C, Document-Term
matrix D, Term-Document matrix \(D^T\) and Adjacency Matrix A. In this demo part, I will show how
to build those four main components.

Given that we have three groups of friends, they are
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{words}                                \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{p}{[}\PYG{n}{george}\PYG{p}{]} \PYG{p}{[}\PYG{n}{jimmy}\PYG{p}{]} \PYG{p}{[}\PYG{n}{john}\PYG{p}{]} \PYG{p}{[}\PYG{n}{peter}\PYG{p}{]}\PYG{p}{]}    \PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{p}{[}\PYG{n}{vincent}\PYG{p}{]} \PYG{p}{[}\PYG{n}{george}\PYG{p}{]} \PYG{p}{[}\PYG{n}{stefan}\PYG{p}{]} \PYG{p}{[}\PYG{n}{james}\PYG{p}{]}\PYG{p}{]}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{p}{[}\PYG{n}{emma}\PYG{p}{]} \PYG{p}{[}\PYG{n}{james}\PYG{p}{]} \PYG{p}{[}\PYG{n}{olivia}\PYG{p}{]} \PYG{p}{[}\PYG{n}{george}\PYG{p}{]}\PYG{p}{]}   \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Corpus C

\end{enumerate}

Then we can build the following corpus based on the unique elements in the given group data:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}\PYG{l+s+sa}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{george}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+sa}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{james}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+sa}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{jimmy}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+sa}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{peter}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+sa}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{stefan}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+sa}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vincent}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+sa}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{olivia}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+sa}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{john}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+sa}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{emma}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\end{sphinxVerbatim}
\end{quote}

The corresponding elements frequency:
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{demo_freq}.png}
\end{figure}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Document-Term matrix D based on Corpus C (CountVectorizer)

\end{enumerate}
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{CountVectorizer}
\PYG{n}{count\PYGZus{}vectorizer\PYGZus{}wo} \PYG{o}{=} \PYG{n}{CountVectorizer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{term}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} with total unique vocabulary}
\PYG{n}{countVectorizer\PYGZus{}mod\PYGZus{}wo} \PYG{o}{=} \PYG{n}{count\PYGZus{}vectorizer\PYGZus{}wo}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{countVectorizer\PYGZus{}twitter\PYGZus{}wo} \PYG{o}{=} \PYG{n}{countVectorizer\PYGZus{}mod\PYGZus{}wo}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} with truncated unique vocabulary (99\PYGZpc{})}
\PYG{n}{count\PYGZus{}vectorizer} \PYG{o}{=} \PYG{n}{CountVectorizer}\PYG{p}{(}\PYG{n}{vocabSize}\PYG{o}{=}\PYG{l+m+mi}{48}\PYG{p}{,}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{term}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{countVectorizer\PYGZus{}mod} \PYG{o}{=} \PYG{n}{count\PYGZus{}vectorizer}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{countVectorizer\PYGZus{}twitter} \PYG{o}{=} \PYG{n}{countVectorizer\PYGZus{}mod}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{features}                       \PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{9}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{7}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{9}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{(}\PYG{l+m+mi}{9}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{,}\PYG{l+m+mi}{8}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{,}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\end{quote}
\begin{itemize}
\item {} 
Term-Document matrix \(D^T\)

\end{itemize}
\begin{quote}

RDD:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
 \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
 \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}
\end{sphinxVerbatim}

Matrix:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Adjacency Matrix \(A =D^T\cdot D\)

\end{enumerate}
\begin{quote}

RDD:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
 \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
 \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{array}\PYG{p}{(}\PYG{p}{[} \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}
\end{sphinxVerbatim}

Matrix:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{p}{[} \PYG{l+m+mf}{3.}\PYG{p}{,}  \PYG{l+m+mf}{2.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{2.}\PYG{p}{,}  \PYG{l+m+mf}{2.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{,}  \PYG{l+m+mf}{0.}\PYG{p}{,}  \PYG{l+m+mf}{1.}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}
\end{quote}


\subsection{Coding Puzzle from my interview}
\label{\detokenize{socialnetwork:coding-puzzle-from-my-interview}}\begin{itemize}
\item {} 
Problem

\end{itemize}

The attached utf-8 encoded text file contains the tags associated with an online biomedical scientific
article formatted as follows (size: 100000). Each Scientific article is represented by a line in the
file delimited by carriage return.
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}               \PYG{n}{words}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{ACTH} \PYG{n}{Syndrome}\PYG{p}{,} \PYG{n}{E}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{Antibody} \PYG{n}{Formati}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{Adaptation}\PYG{p}{,} \PYG{n}{Phys}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{p}{[}\PYG{n}{Aerosol} \PYG{n}{Propella}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}
\end{quote}

Write a program that, using this file as input, produces a list of pairs of
tags which appear TOGETHER in any order and position in at least fifty different Scientific articles. For
example, in the above sample, {[}Female{]} and {[}Humans{]} appear together
twice, but every other pair appears only once. Your program should output
the pair list to stdout in the same form as the input (eg tag 1,
tag 2n).
\begin{itemize}
\item {} 
My solution

\end{itemize}
\begin{quote}

The corresponding words frequency:
\begin{quote}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{freq_word_ze}.png}
\caption{Word frequency}\label{\detokenize{socialnetwork:id1}}\label{\detokenize{socialnetwork:fig-wordfreq-ze}}\end{figure}
\end{quote}

Output:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}    \PYG{n}{term}\PYG{o}{.}\PYG{n}{x}\PYG{o}{\textbar{}}\PYG{n}{term}\PYG{o}{.}\PYG{n}{y}\PYG{o}{\textbar{}}   \PYG{n}{freq}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}    \PYG{n}{Female}\PYG{o}{\textbar{}}\PYG{n}{Humans}\PYG{o}{\textbar{}}\PYG{l+m+mf}{16741.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}      \PYG{n}{Male}\PYG{o}{\textbar{}}\PYG{n}{Humans}\PYG{o}{\textbar{}}\PYG{l+m+mf}{13883.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{n}{Adult}\PYG{o}{\textbar{}}\PYG{n}{Humans}\PYG{o}{\textbar{}}\PYG{l+m+mf}{10391.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}      \PYG{n}{Male}\PYG{o}{\textbar{}}\PYG{n}{Female}\PYG{o}{\textbar{}} \PYG{l+m+mf}{9806.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{MiddleAged}\PYG{o}{\textbar{}}\PYG{n}{Humans}\PYG{o}{\textbar{}} \PYG{l+m+mf}{8181.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{n}{Adult}\PYG{o}{\textbar{}}\PYG{n}{Female}\PYG{o}{\textbar{}} \PYG{l+m+mf}{7411.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{n}{Adult}\PYG{o}{\textbar{}}  \PYG{n}{Male}\PYG{o}{\textbar{}} \PYG{l+m+mf}{7240.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{MiddleAged}\PYG{o}{\textbar{}}  \PYG{n}{Male}\PYG{o}{\textbar{}} \PYG{l+m+mf}{6328.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{MiddleAged}\PYG{o}{\textbar{}}\PYG{n}{Female}\PYG{o}{\textbar{}} \PYG{l+m+mf}{6002.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{n}{MiddleAged}\PYG{o}{\textbar{}} \PYG{n}{Adult}\PYG{o}{\textbar{}} \PYG{l+m+mf}{5944.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{10} \PYG{n}{rows}
\end{sphinxVerbatim}
\end{quote}

The corresponding Co-occurrence network:
\begin{quote}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{netfreq}.png}
\caption{Co-occurrence network}\label{\detokenize{socialnetwork:id2}}\label{\detokenize{socialnetwork:fig-netfreq}}\end{figure}
\end{quote}

Then you will get Figure {\hyperref[\detokenize{socialnetwork:fig-netfreq}]{\sphinxcrossref{\DUrole{std,std-ref}{Co-occurrence network}}}}


\section{Appendix: matrix multiplication in PySpark}
\label{\detokenize{socialnetwork:appendix-matrix-multiplication-in-pyspark}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
load test matrix

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{csv}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{matrix1.txt}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{sep}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{inferSchema}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{\PYGZus{}c0}\PYG{o}{\textbar{}}\PYG{n}{\PYGZus{}c1}\PYG{o}{\textbar{}}\PYG{n}{\PYGZus{}c2}\PYG{o}{\textbar{}}\PYG{n}{\PYGZus{}c3}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.2}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.4}\PYG{o}{\textbar{}}\PYG{l+m+mf}{2.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.1}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{2.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{2.2}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.8}\PYG{o}{\textbar{}}\PYG{l+m+mf}{4.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{5.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{2.2}\PYG{o}{\textbar{}}\PYG{l+m+mf}{4.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{4.4}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{9.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{8.1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{5.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{4.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{4.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{2.1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{6.6}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
main function for matrix multiplication in PySpark

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{functions} \PYG{k}{as} \PYG{n}{F}
\PYG{k+kn}{from} \PYG{n+nn}{functools} \PYG{k+kn}{import} \PYG{n+nb}{reduce}
\PYG{c+c1}{\PYGZsh{} reference: https://stackoverflow.com/questions/44348527/matrix\PYGZhy{}multiplication\PYGZhy{}at\PYGZhy{}a\PYGZhy{}in\PYGZhy{}pyspark}
\PYG{c+c1}{\PYGZsh{} do the sum of the multiplication that we want, and get}
\PYG{c+c1}{\PYGZsh{} one data frame for each column}
\PYG{n}{colDFs} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{c2} \PYG{o+ow}{in} \PYG{n}{df}\PYG{o}{.}\PYG{n}{columns}\PYG{p}{:}
    \PYG{n}{colDFs}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(} \PYG{n}{df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(} \PYG{p}{[} \PYG{n}{F}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{df}\PYG{p}{[}\PYG{n}{c1}\PYG{p}{]}\PYG{o}{*}\PYG{n}{df}\PYG{p}{[}\PYG{n}{c2}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{op\PYGZus{}\PYGZob{}0\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{)} \PYG{k}{for} \PYG{n}{i}\PYG{p}{,}\PYG{n}{c1} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{df}\PYG{o}{.}\PYG{n}{columns}\PYG{p}{)} \PYG{p}{]} \PYG{p}{)} \PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} now union those separate data frames to build the \PYGZdq{}matrix\PYGZdq{}}
\PYG{n}{mtxDF} \PYG{o}{=} \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{a}\PYG{p}{,}\PYG{n}{b}\PYG{p}{:} \PYG{n}{a}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{a}\PYG{o}{.}\PYG{n}{columns}\PYG{p}{)}\PYG{o}{.}\PYG{n}{union}\PYG{p}{(}\PYG{n}{b}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{a}\PYG{o}{.}\PYG{n}{columns}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,} \PYG{n}{colDFs} \PYG{p}{)}
\PYG{n}{mtxDF}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}              \PYG{n}{op\PYGZus{}0}\PYG{o}{\textbar{}}              \PYG{n}{op\PYGZus{}1}\PYG{o}{\textbar{}}              \PYG{n}{op\PYGZus{}2}\PYG{o}{\textbar{}}              \PYG{n}{op\PYGZus{}3}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}            \PYG{l+m+mf}{152.45}\PYG{o}{\textbar{}}\PYG{l+m+mf}{118.88999999999999}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{57.15}\PYG{o}{\textbar{}}\PYG{l+m+mf}{121.44000000000001}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{118.88999999999999}\PYG{o}{\textbar{}}\PYG{l+m+mf}{104.94999999999999}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{38.93}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{94.71}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}             \PYG{l+m+mf}{57.15}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{38.93}\PYG{o}{\textbar{}}\PYG{l+m+mf}{52.540000000000006}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{55.99}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{121.44000000000001}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{94.71}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{55.99}\PYG{o}{\textbar{}}\PYG{l+m+mf}{110.10999999999999}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Validation with python version

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
\PYG{n}{a} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{genfromtxt}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{matrix1.txt}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{delimiter}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{dot}\PYG{p}{(}\PYG{n}{a}\PYG{o}{.}\PYG{n}{T}\PYG{p}{,} \PYG{n}{a}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mf}{152.45}\PYG{p}{,} \PYG{l+m+mf}{118.89}\PYG{p}{,}  \PYG{l+m+mf}{57.15}\PYG{p}{,} \PYG{l+m+mf}{121.44}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[}\PYG{l+m+mf}{118.89}\PYG{p}{,} \PYG{l+m+mf}{104.95}\PYG{p}{,}  \PYG{l+m+mf}{38.93}\PYG{p}{,}  \PYG{l+m+mf}{94.71}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[} \PYG{l+m+mf}{57.15}\PYG{p}{,}  \PYG{l+m+mf}{38.93}\PYG{p}{,}  \PYG{l+m+mf}{52.54}\PYG{p}{,}  \PYG{l+m+mf}{55.99}\PYG{p}{]}\PYG{p}{,}
       \PYG{p}{[}\PYG{l+m+mf}{121.44}\PYG{p}{,}  \PYG{l+m+mf}{94.71}\PYG{p}{,}  \PYG{l+m+mf}{55.99}\PYG{p}{,} \PYG{l+m+mf}{110.11}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Correlation Network}
\label{\detokenize{socialnetwork:correlation-network}}
TODO ..


\chapter{ALS: Stock Portfolio Recommendations}
\label{\detokenize{als:als-stock-portfolio-recommendations}}\label{\detokenize{als:als}}\label{\detokenize{als::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

\sphinxstylestrong{Don’t put all your eggs in one basket.}
\end{sphinxadmonition}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{stock_portfolio}.png}
\end{figure}

Code for the above figure:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.pyplot} \PYG{k+kn}{as} \PYG{n+nn}{plt}

\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{,} \PYG{n}{subplot\PYGZus{}kw}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{aspect}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{equal}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{recipe} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{375 k U.S. Large Cap Blend}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
          \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{300 k U.S. Large Cap Value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
          \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{75 k U.S. Short\PYGZhy{}Term Bonds}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
          \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{50 k U.S. Small Cap Blend}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
          \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{55 k U.S. Small Cap Value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
          \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{95 k U.S. Real Estate}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
          \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{250 k Intermediate\PYGZhy{}Term Bonds}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}

\PYG{n}{data} \PYG{o}{=} \PYG{p}{[}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{x}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)} \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n}{recipe}\PYG{p}{]}
\PYG{n}{ingredients} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{x}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{:}\PYG{p}{]}\PYG{p}{)} \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n}{recipe}\PYG{p}{]}

\PYG{k}{print}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{n}{ingredients}\PYG{p}{)}
\PYG{k}{def} \PYG{n+nf}{func}\PYG{p}{(}\PYG{n}{pct}\PYG{p}{,} \PYG{n}{allvals}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{absolute} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{pct}\PYG{o}{/}\PYG{l+m+mf}{100.}\PYG{o}{*}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{allvals}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{return} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}:.1f\PYGZcb{}}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{(\PYGZob{}:d\PYGZcb{} k)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{pct}\PYG{p}{,} \PYG{n}{absolute}\PYG{p}{)}

\PYG{n}{explode} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{empty}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{)}\PYG{c+c1}{\PYGZsh{}(0.1, 0.1, 0.1,  0.1, 0.1, 0.1)  \PYGZsh{} explode 1st slice}
\PYG{n}{explode}\PYG{o}{.}\PYG{n}{fill}\PYG{p}{(}\PYG{l+m+mf}{0.1}\PYG{p}{)}

\PYG{n}{wedges}\PYG{p}{,} \PYG{n}{texts}\PYG{p}{,} \PYG{n}{autotexts} \PYG{o}{=} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{pie}\PYG{p}{(}\PYG{n}{data}\PYG{p}{,} \PYG{n}{explode}\PYG{o}{=}\PYG{n}{explode}\PYG{p}{,} \PYG{n}{autopct}\PYG{o}{=}\PYG{k}{lambda} \PYG{n}{pct}\PYG{p}{:} \PYG{n}{func}\PYG{p}{(}\PYG{n}{pct}\PYG{p}{,} \PYG{n}{data}\PYG{p}{)}\PYG{p}{,}
                                  \PYG{n}{textprops}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{color}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{w}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{wedges}\PYG{p}{,} \PYG{n}{ingredients}\PYG{p}{,}
          \PYG{c+c1}{\PYGZsh{}title=\PYGZdq{}Stock portfolio\PYGZdq{},}
          \PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{center left}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
          \PYG{n}{bbox\PYGZus{}to\PYGZus{}anchor}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{setp}\PYG{p}{(}\PYG{n}{autotexts}\PYG{p}{,} \PYG{n}{size}\PYG{o}{=}\PYG{l+m+mi}{8}\PYG{p}{,} \PYG{n}{weight}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{bold}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}ax.set\PYGZus{}title(\PYGZdq{}Stock portfolio\PYGZdq{})}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Recommender systems}
\label{\detokenize{als:recommender-systems}}
Recommender systems or recommendation systems (sometimes replacing “system” with a synonym such as platform or engine) are a subclass of information filtering system that seek to predict the “rating” or “preference” that a user would give to an item.”

The main idea is to build a matrix users \sphinxcode{\sphinxupquote{R}} items rating values and try to factorize it, to recommend main products rated by other users. A popular approach for this is matrix factorization is Alternating Least Squares (ALS)


\section{Alternating Least Squares}
\label{\detokenize{als:alternating-least-squares}}
Apache Spark ML implements ALS for collaborative filtering, a very popular algorithm for making recommendations.

ALS recommender is a matrix factorization algorithm that uses Alternating Least Squares with Weighted-Lamda-Regularization (ALS-WR). It factors the user to item matrix \sphinxcode{\sphinxupquote{A}} into the user-to-feature matrix \sphinxcode{\sphinxupquote{U}} and the item-to-feature matrix \sphinxcode{\sphinxupquote{M}}: It runs the ALS algorithm in a parallel fashion.  The ALS algorithm should uncover the latent factors that explain the observed user to item ratings and tries to find optimal factor weights to minimize the least squares between predicted and actual ratings.

\sphinxurl{https://www.elenacuoco.com/2016/12/22/alternating-least-squares-als-spark-ml/}


\section{Demo}
\label{\detokenize{als:demo}}\begin{itemize}
\item {} 
The Jupyter notebook can be download from \sphinxhref{\_static/ALS.ipynb}{ALS Recommender systems}.

\item {} 
The data can be downloaf from \sphinxhref{\_static/OnlineRetail.csv}{German Credit}.

\end{itemize}


\subsection{Load and clean data}
\label{\detokenize{als:load-and-clean-data}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark RFM example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df\PYGZus{}raw} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{com.databricks.spark.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
                       \PYG{n}{options}\PYG{p}{(}\PYG{n}{header}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYGZbs{}
                       \PYG{n}{inferschema}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{true}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
            \PYG{n}{load}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Online Retail.csv}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

check the data set

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df\PYGZus{}raw}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{df\PYGZus{}raw}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

Then you will get

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{InvoiceNo}\PYG{o}{\textbar{}}\PYG{n}{StockCode}\PYG{o}{\textbar{}}         \PYG{n}{Description}\PYG{o}{\textbar{}}\PYG{n}{Quantity}\PYG{o}{\textbar{}} \PYG{n}{InvoiceDate}\PYG{o}{\textbar{}}\PYG{n}{UnitPrice}\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}       \PYG{n}{Country}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{85123}\PYG{n}{A}\PYG{o}{\textbar{}}\PYG{n}{WHITE} \PYG{n}{HANGING} \PYG{n}{HEA}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{2.55}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}    \PYG{l+m+mi}{71053}\PYG{o}{\textbar{}} \PYG{n}{WHITE} \PYG{n}{METAL} \PYG{n}{LANTERN}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{3.39}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{84406}\PYG{n}{B}\PYG{o}{\textbar{}}\PYG{n}{CREAM} \PYG{n}{CUPID} \PYG{n}{HEART}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{2.75}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{84029}\PYG{n}{G}\PYG{o}{\textbar{}}\PYG{n}{KNITTED} \PYG{n}{UNION} \PYG{n}{FLA}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{3.39}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{l+m+mi}{536365}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{84029}\PYG{n}{E}\PYG{o}{\textbar{}}\PYG{n}{RED} \PYG{n}{WOOLLY} \PYG{n}{HOTTIE}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}\PYG{l+m+mi}{12}\PYG{o}{/}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{l+m+mi}{8}\PYG{p}{:}\PYG{l+m+mi}{26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{3.39}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{n}{United} \PYG{n}{Kingdom}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{InvoiceNo}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{StockCode}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Description}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Quantity}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{InvoiceDate}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{UnitPrice}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{CustomerID}\PYG{p}{:} \PYG{n}{integer} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Country}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Data clean and data manipulation

\end{enumerate}
\begin{itemize}
\item {} 
check and remove the \sphinxcode{\sphinxupquote{null}} values

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{count}

\PYG{k}{def} \PYG{n+nf}{my\PYGZus{}count}\PYG{p}{(}\PYG{n}{df\PYGZus{}in}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{df\PYGZus{}in}\PYG{o}{.}\PYG{n}{agg}\PYG{p}{(} \PYG{o}{*}\PYG{p}{[} \PYG{n}{count}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)} \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{df\PYGZus{}in}\PYG{o}{.}\PYG{n}{columns} \PYG{p}{]} \PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{as} \PYG{n+nn}{F}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n+nb}{round}
\PYG{n}{df\PYGZus{}raw} \PYG{o}{=} \PYG{n}{df\PYGZus{}raw}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Asset}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n+nb}{round}\PYG{p}{(} \PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Quantity}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{*} \PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{UnitPrice}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{2} \PYG{p}{)}\PYG{p}{)}
\PYG{n}{df} \PYG{o}{=} \PYG{n}{df\PYGZus{}raw}\PYG{o}{.}\PYG{n}{withColumnRenamed}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{StockCode}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cusip}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYGZbs{}
           \PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cusip}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Quantity}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{UnitPrice}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Asset}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{my\PYGZus{}count}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}} \PYG{n}{Cusip}\PYG{o}{\textbar{}}\PYG{n}{Quantity}\PYG{o}{\textbar{}}\PYG{n}{UnitPrice}\PYG{o}{\textbar{}} \PYG{n}{Asset}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{406829}\PYG{o}{\textbar{}}\PYG{l+m+mi}{541909}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{541909}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{541909}\PYG{o}{\textbar{}}\PYG{l+m+mi}{541909}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

Since the count results are not the same, we have some null value in the \sphinxcode{\sphinxupquote{CustomerID}} column. We can drop these records from the dataset.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=}  \PYG{n}{df}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Asset}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{\PYGZgt{}}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{n}{df} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{dropna}\PYG{p}{(}\PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{any}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{my\PYGZus{}count}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}} \PYG{n}{Cusip}\PYG{o}{\textbar{}}\PYG{n}{Quantity}\PYG{o}{\textbar{}}\PYG{n}{UnitPrice}\PYG{o}{\textbar{}} \PYG{n}{Asset}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{397924}\PYG{o}{\textbar{}}\PYG{l+m+mi}{397924}\PYG{o}{\textbar{}}  \PYG{l+m+mi}{397924}\PYG{o}{\textbar{}}   \PYG{l+m+mi}{397924}\PYG{o}{\textbar{}}\PYG{l+m+mi}{397924}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}} \PYG{n}{Cusip}\PYG{o}{\textbar{}}\PYG{n}{Quantity}\PYG{o}{\textbar{}}\PYG{n}{UnitPrice}\PYG{o}{\textbar{}}\PYG{n}{Asset}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{l+m+mi}{85123}\PYG{n}{A}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{2.55}\PYG{o}{\textbar{}} \PYG{l+m+mf}{15.3}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}} \PYG{l+m+mi}{71053}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{3.39}\PYG{o}{\textbar{}}\PYG{l+m+mf}{20.34}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{17850}\PYG{o}{\textbar{}}\PYG{l+m+mi}{84406}\PYG{n}{B}\PYG{o}{\textbar{}}       \PYG{l+m+mi}{8}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{2.75}\PYG{o}{\textbar{}} \PYG{l+m+mf}{22.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{3} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Convert the \sphinxcode{\sphinxupquote{Cusip}} to consistent format

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{udf}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StringType}\PYG{p}{,} \PYG{n}{DoubleType}

\PYG{k}{def} \PYG{n+nf}{toUpper}\PYG{p}{(}\PYG{n}{s}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{s}\PYG{o}{.}\PYG{n}{upper}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{upper\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{toUpper}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Find the most top \sphinxcode{\sphinxupquote{n}} stockes

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pop} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cusip}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYGZbs{}
  \PYG{o}{.}\PYG{n}{agg}\PYG{p}{(}\PYG{n}{F}\PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Customers}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}\PYG{n}{F}\PYG{o}{.}\PYG{n}{round}\PYG{p}{(}\PYG{n}{F}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Asset}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TotalAsset}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYGZbs{}
  \PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{p}{[}\PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Customers}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}\PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{TotalAsset}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}\PYG{n}{ascending}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{pop}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}} \PYG{n}{Cusip}\PYG{o}{\textbar{}}\PYG{n}{Customers}\PYG{o}{\textbar{}}\PYG{n}{TotalAsset}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{85123}\PYG{n}{A}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{2035}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{100603.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mi}{22423}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{1724}\PYG{o}{\textbar{}} \PYG{l+m+mf}{142592.95}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{85099}\PYG{n}{B}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{1618}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{85220.78}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mi}{84879}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{1408}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{56580.34}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mi}{47566}\PYG{o}{\textbar{}}     \PYG{l+m+mi}{1397}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{68844.33}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

Build feature matrix
——————-+
\begin{itemize}
\item {} 
Fetch the top \sphinxcode{\sphinxupquote{n}} cusip list

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{top} \PYG{o}{=} \PYG{l+m+mi}{10}
\PYG{n}{cusip\PYGZus{}lst} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{n}{pop}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cusip}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{str}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{tolist}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{cusip\PYGZus{}lst}\PYG{o}{.}\PYG{n}{insert}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]

\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Create the portfolio table for each customer

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pivot\PYGZus{}tab} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{groupBy}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{pivot}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cusip}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Asset}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{pivot\PYGZus{}tab} \PYG{o}{=} \PYG{n}{pivot\PYGZus{}tab}\PYG{o}{.}\PYG{n}{fillna}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Fetch the most \sphinxcode{\sphinxupquote{n}} stock’s portfolio table for each customer

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{selected\PYGZus{}tab}  \PYG{o}{=} \PYG{n}{pivot\PYGZus{}tab}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{cusip\PYGZus{}lst}\PYG{p}{)}
\PYG{n}{selected\PYGZus{}tab}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{l+m+mi}{85123}\PYG{n}{A}\PYG{o}{\textbar{}}\PYG{l+m+mi}{22423}\PYG{o}{\textbar{}}\PYG{l+m+mi}{85099}\PYG{n}{B}\PYG{o}{\textbar{}}\PYG{l+m+mi}{84879}\PYG{o}{\textbar{}}\PYG{l+m+mi}{47566}\PYG{o}{\textbar{}}\PYG{l+m+mi}{20725}\PYG{o}{\textbar{}}\PYG{l+m+mi}{22720}\PYG{o}{\textbar{}}\PYG{l+m+mi}{20727}\PYG{o}{\textbar{}}\PYG{n}{POST}\PYG{o}{\textbar{}}\PYG{l+m+mi}{23203}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{33.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15727}\PYG{o}{\textbar{}} \PYG{l+m+mf}{123.9}\PYG{o}{\textbar{}} \PYG{l+m+mf}{25.5}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{33.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{99.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{14570}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{14450}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{8.32}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{49.5}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{4} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Build the \sphinxcode{\sphinxupquote{rating}} matrix

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{elemwiseDiv}\PYG{p}{(}\PYG{n}{df\PYGZus{}in}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{num} \PYG{o}{=} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{df\PYGZus{}in}\PYG{o}{.}\PYG{n}{columns}\PYG{p}{)}
    \PYG{n}{temp} \PYG{o}{=} \PYG{n}{df\PYGZus{}in}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n}{flatten}\PYG{p}{(}\PYG{p}{[}\PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}\PYG{p}{[}\PYG{n}{x}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{o}{/}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n+nb}{sum}\PYG{p}{(}\PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
                                                       \PYG{k}{if} \PYG{n+nb}{sum}\PYG{p}{(}\PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{p}{]}\PYG{p}{)}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{0} \PYG{k}{else} \PYG{n}{x}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}
                                                       \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{num}\PYG{p}{)}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{temp}\PYG{p}{,}\PYG{n}{df\PYGZus{}in}\PYG{o}{.}\PYG{n}{columns}\PYG{p}{)}

\PYG{n}{ratings} \PYG{o}{=} \PYG{n}{elemwiseDiv}\PYG{p}{(}\PYG{n}{selected\PYGZus{}tab}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{ratings}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{l+m+mi}{85123}\PYG{n}{A}\PYG{o}{\textbar{}}\PYG{l+m+mi}{22423}\PYG{o}{\textbar{}}\PYG{l+m+mi}{85099}\PYG{n}{B}\PYG{o}{\textbar{}}\PYG{l+m+mi}{84879}\PYG{o}{\textbar{}}\PYG{l+m+mi}{47566}\PYG{o}{\textbar{}}\PYG{l+m+mi}{20725}\PYG{o}{\textbar{}}\PYG{l+m+mi}{22720}\PYG{o}{\textbar{}}\PYG{l+m+mi}{20727}\PYG{o}{\textbar{}}\PYG{n}{POST}\PYG{o}{\textbar{}}\PYG{l+m+mi}{23203}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{15727}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.44}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.09}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.12}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.35}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{14570}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{14450}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.14}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.86}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Convert \sphinxcode{\sphinxupquote{rating}} matrix to long table

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{array}\PYG{p}{,} \PYG{n}{col}\PYG{p}{,} \PYG{n}{explode}\PYG{p}{,} \PYG{n}{struct}\PYG{p}{,} \PYG{n}{lit}

\PYG{k}{def} \PYG{n+nf}{to\PYGZus{}long}\PYG{p}{(}\PYG{n}{df}\PYG{p}{,} \PYG{n}{by}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        reference: https://stackoverflow.com/questions/37864222/transpose\PYGZhy{}column\PYGZhy{}to\PYGZhy{}row\PYGZhy{}with\PYGZhy{}spark}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}

    \PYG{c+c1}{\PYGZsh{} Filter dtypes and split into column names and type description}
    \PYG{n}{cols}\PYG{p}{,} \PYG{n}{dtypes} \PYG{o}{=} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{o}{*}\PYG{p}{(}\PYG{p}{(}\PYG{n}{c}\PYG{p}{,} \PYG{n}{t}\PYG{p}{)} \PYG{k}{for} \PYG{p}{(}\PYG{n}{c}\PYG{p}{,} \PYG{n}{t}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n}{df}\PYG{o}{.}\PYG{n}{dtypes} \PYG{k}{if} \PYG{n}{c} \PYG{o+ow}{not} \PYG{o+ow}{in} \PYG{n}{by}\PYG{p}{)}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} Spark SQL supports only homogeneous columns}
    \PYG{k}{assert} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n+nb}{set}\PYG{p}{(}\PYG{n}{dtypes}\PYG{p}{)}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{All columns have to be of the same type}\PYG{l+s+s2}{\PYGZdq{}}

    \PYG{c+c1}{\PYGZsh{} Create and explode an array of (column\PYGZus{}name, column\PYGZus{}value) structs}
    \PYG{n}{kvs} \PYG{o}{=} \PYG{n}{explode}\PYG{p}{(}\PYG{n}{array}\PYG{p}{(}\PYG{p}{[}
      \PYG{n}{struct}\PYG{p}{(}\PYG{n}{lit}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Cusip}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{col}\PYG{p}{(}\PYG{n}{c}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rating}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)} \PYG{k}{for} \PYG{n}{c} \PYG{o+ow}{in} \PYG{n}{cols}
    \PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{alias}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{kvs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df\PYGZus{}all} \PYG{o}{=} \PYG{n}{to\PYGZus{}long}\PYG{p}{(}\PYG{n}{ratings}\PYG{p}{,}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{df\PYGZus{}all}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}} \PYG{n}{Cusip}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}}\PYG{l+m+mi}{85123}\PYG{n}{A}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}} \PYG{l+m+mi}{22423}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}}\PYG{l+m+mi}{85099}\PYG{n}{B}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}} \PYG{l+m+mi}{84879}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}} \PYG{l+m+mi}{47566}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
Convert the string \sphinxcode{\sphinxupquote{Cusip}} to numerical index

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.feature} \PYG{k+kn}{import} \PYG{n}{StringIndexer}
\PYG{c+c1}{\PYGZsh{} Index labels, adding metadata to the label column}
\PYG{n}{labelIndexer} \PYG{o}{=} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cusip}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indexedCusip}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df\PYGZus{}all}\PYG{p}{)}
\PYG{n}{df\PYGZus{}all} \PYG{o}{=} \PYG{n}{labelIndexer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df\PYGZus{}all}\PYG{p}{)}

\PYG{n}{df\PYGZus{}all}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n+nb+bp}{True}\PYG{p}{)}
\PYG{n}{df\PYGZus{}all}\PYG{o}{.}\PYG{n}{printSchema}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}} \PYG{n}{Cusip}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}\PYG{n}{indexedCusip}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}}\PYG{l+m+mi}{85123}\PYG{n}{A}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{6.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}} \PYG{l+m+mi}{22423}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{9.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}}\PYG{l+m+mi}{85099}\PYG{n}{B}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{5.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}} \PYG{l+m+mi}{84879}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{16503}\PYG{o}{\textbar{}} \PYG{l+m+mi}{47566}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{n}{root}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{CustomerID}\PYG{p}{:} \PYG{n+nb}{long} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{Cusip}\PYG{p}{:} \PYG{n}{string} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{false}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{rating}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
 \PYG{o}{\textbar{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}} \PYG{n}{indexedCusip}\PYG{p}{:} \PYG{n}{double} \PYG{p}{(}\PYG{n}{nullable} \PYG{o}{=} \PYG{n}{true}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{Train model}
\label{\detokenize{als:train-model}}\begin{itemize}
\item {} 
build \sphinxcode{\sphinxupquote{train}} and \sphinxcode{\sphinxupquote{test}} dataset

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{train}\PYG{p}{,} \PYG{n}{test} \PYG{o}{=} \PYG{n}{df\PYGZus{}all}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.8}\PYG{p}{,}\PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{train}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{test}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{n}{Cusip}\PYG{o}{\textbar{}}\PYG{n}{indexedCusip}\PYG{o}{\textbar{}}             \PYG{n}{rating}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{12940}\PYG{o}{\textbar{}}\PYG{l+m+mi}{20725}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{2.0}\PYG{o}{\textbar{}}                \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{12940}\PYG{o}{\textbar{}}\PYG{l+m+mi}{20727}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{4.0}\PYG{o}{\textbar{}}                \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{12940}\PYG{o}{\textbar{}}\PYG{l+m+mi}{22423}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{9.0}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.49990198000392083}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{12940}\PYG{o}{\textbar{}}\PYG{l+m+mi}{22720}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}}                \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{12940}\PYG{o}{\textbar{}}\PYG{l+m+mi}{23203}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{7.0}\PYG{o}{\textbar{}}                \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}}\PYG{n}{Cusip}\PYG{o}{\textbar{}}\PYG{n}{indexedCusip}\PYG{o}{\textbar{}}            \PYG{n}{rating}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{12940}\PYG{o}{\textbar{}}\PYG{l+m+mi}{84879}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.1325230346990786}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{13285}\PYG{o}{\textbar{}}\PYG{l+m+mi}{20725}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{2.0}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.2054154995331466}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{13285}\PYG{o}{\textbar{}}\PYG{l+m+mi}{20727}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{4.0}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.2054154995331466}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{13285}\PYG{o}{\textbar{}}\PYG{l+m+mi}{47566}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{13623}\PYG{o}{\textbar{}}\PYG{l+m+mi}{23203}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{7.0}\PYG{o}{\textbar{}}               \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
train model

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{itertools}
\PYG{k+kn}{from} \PYG{n+nn}{math} \PYG{k+kn}{import} \PYG{n}{sqrt}
\PYG{k+kn}{from} \PYG{n+nn}{operator} \PYG{k+kn}{import} \PYG{n}{add}
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.recommendation} \PYG{k+kn}{import} \PYG{n}{ALS}

\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.evaluation} \PYG{k+kn}{import} \PYG{n}{RegressionEvaluator}

\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{RegressionEvaluator}\PYG{p}{(}\PYG{n}{metricName}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rmse}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rating}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                                \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{def} \PYG{n+nf}{computeRmse}\PYG{p}{(}\PYG{n}{model}\PYG{p}{,} \PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Compute RMSE (Root mean Squared Error).}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}
    \PYG{n}{rmse} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
    \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Root\PYGZhy{}mean\PYGZhy{}square error = }\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rmse}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{rmse}

\PYG{c+c1}{\PYGZsh{}train models and evaluate them on the validation set}

\PYG{n}{ranks} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{]}
\PYG{n}{lambdas} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mf}{0.05}\PYG{p}{]}
\PYG{n}{numIters} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{30}\PYG{p}{]}
\PYG{n}{bestModel} \PYG{o}{=} \PYG{n+nb+bp}{None}
\PYG{n}{bestValidationRmse} \PYG{o}{=} \PYG{n+nb}{float}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{inf}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{bestRank} \PYG{o}{=} \PYG{l+m+mi}{0}
\PYG{n}{bestLambda} \PYG{o}{=} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}
\PYG{n}{bestNumIter} \PYG{o}{=} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}

\PYG{n}{val} \PYG{o}{=} \PYG{n}{test}\PYG{o}{.}\PYG{n}{na}\PYG{o}{.}\PYG{n}{drop}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{rank}\PYG{p}{,} \PYG{n}{lmbda}\PYG{p}{,} \PYG{n}{numIter} \PYG{o+ow}{in} \PYG{n}{itertools}\PYG{o}{.}\PYG{n}{product}\PYG{p}{(}\PYG{n}{ranks}\PYG{p}{,} \PYG{n}{lambdas}\PYG{p}{,} \PYG{n}{numIters}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{als} \PYG{o}{=} \PYG{n}{ALS}\PYG{p}{(}\PYG{n}{rank}\PYG{o}{=}\PYG{n}{rank}\PYG{p}{,} \PYG{n}{maxIter}\PYG{o}{=}\PYG{n}{numIter}\PYG{p}{,} \PYG{n}{regParam}\PYG{o}{=}\PYG{n}{lmbda}\PYG{p}{,} \PYG{n}{numUserBlocks}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{numItemBlocks}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{implicitPrefs}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,}
              \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{1.0}\PYG{p}{,}
              \PYG{n}{userCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{CustomerID}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{itemCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedCusip}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{ratingCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rating}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{nonnegative}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
    \PYG{n}{model}\PYG{o}{=}\PYG{n}{als}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{train}\PYG{p}{)}

    \PYG{n}{validationRmse} \PYG{o}{=} \PYG{n}{computeRmse}\PYG{p}{(}\PYG{n}{model}\PYG{p}{,} \PYG{n}{val}\PYG{p}{)}
    \PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{RMSE (validation) = }\PYG{l+s+si}{\PYGZpc{}f}\PYG{l+s+s2}{ for the model trained with }\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{validationRmse} \PYG{o}{+} \PYGZbs{}
            \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rank = }\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s2}{, lambda = }\PYG{l+s+si}{\PYGZpc{}.1f}\PYG{l+s+s2}{, and numIter = }\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s2}{.}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{n}{rank}\PYG{p}{,} \PYG{n}{lmbda}\PYG{p}{,} \PYG{n}{numIter}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{if} \PYG{p}{(}\PYG{n}{validationRmse}\PYG{p}{,} \PYG{n}{bestValidationRmse}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{bestModel} \PYG{o}{=} \PYG{n}{model}
        \PYG{n}{bestValidationRmse} \PYG{o}{=} \PYG{n}{validationRmse}
        \PYG{n}{bestRank} \PYG{o}{=} \PYG{n}{rank}
        \PYG{n}{bestLambda} \PYG{o}{=} \PYG{n}{lmbda}
        \PYG{n}{bestNumIter} \PYG{o}{=} \PYG{n}{numIter}

\PYG{n}{model} \PYG{o}{=} \PYG{n}{bestModel}
\end{sphinxVerbatim}


\subsection{Make prediction}
\label{\detokenize{als:make-prediction}}\begin{itemize}
\item {} 
make prediction

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{topredict}\PYG{o}{=}\PYG{n}{test}\PYG{p}{[}\PYG{n}{test}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rating}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{==}\PYG{l+m+mi}{0}\PYG{p}{]}

\PYG{n}{predictions}\PYG{o}{=}\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{topredict}\PYG{p}{)}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{prediction}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{0}\PYG{p}{)}\PYGZbs{}
           \PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{p}{[}\PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CustomerID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}\PYG{n}{F}\PYG{o}{.}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cusip}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}\PYG{n}{ascending}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{CustomerID}\PYG{o}{\textbar{}} \PYG{n}{Cusip}\PYG{o}{\textbar{}}\PYG{n}{indexedCusip}\PYG{o}{\textbar{}}\PYG{n}{rating}\PYG{o}{\textbar{}}  \PYG{n}{prediction}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{18283}\PYG{o}{\textbar{}} \PYG{l+m+mi}{47566}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.01625076}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{18282}\PYG{o}{\textbar{}}\PYG{l+m+mi}{85123}\PYG{n}{A}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{6.0}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.057172246}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{18282}\PYG{o}{\textbar{}} \PYG{l+m+mi}{84879}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{1.0}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.059531752}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{18282}\PYG{o}{\textbar{}} \PYG{l+m+mi}{23203}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{7.0}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.010502596}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}     \PYG{l+m+mi}{18282}\PYG{o}{\textbar{}} \PYG{l+m+mi}{22720}\PYG{o}{\textbar{}}         \PYG{l+m+mf}{3.0}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.053893942}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}


\chapter{Monte Carlo Simulation}
\label{\detokenize{mc:monte-carlo-simulation}}\label{\detokenize{mc:mc}}\label{\detokenize{mc::doc}}
\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{baba_sim_price}.png}
\end{figure}

Monte Carlo simulations are just a way of estimating a fixed parameter by repeatedly generating random numbers. More details can be found at \sphinxhref{https://towardsdatascience.com/a-zero-math-introduction-to-markov-chain-monte-carlo-methods-dcba889e0c50}{A Zero Math Introduction to Markov Chain Monte Carlo Methods}.

Monte Carlo simulation is a technique used to understand the impact of risk and uncertainty in financial, project management, cost, and other forecasting models. A Monte Carlo simulator helps one visualize most or all of the potential outcomes to have a better idea regarding the risk of a decision. More details can be found at \sphinxhref{https://towardsdatascience.com/the-house-always-wins-monte-carlo-simulation-eb82787da2a3}{The house always wins}.


\section{Simulating Casino Win}
\label{\detokenize{mc:simulating-casino-win}}
We assume that the player John has the 49\% chance to win the game and the wager will be \$5 per game.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k+kn}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.pyplot} \PYG{k+kn}{as} \PYG{n+nn}{plt}

\PYG{n}{start\PYGZus{}m} \PYG{o}{=}\PYG{l+m+mi}{100}
\PYG{n}{wager} \PYG{o}{=} \PYG{l+m+mi}{5}
\PYG{n}{bets} \PYG{o}{=} \PYG{l+m+mi}{100}
\PYG{n}{trials} \PYG{o}{=} \PYG{l+m+mi}{1000}

\PYG{n}{trans} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{vectorize}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{t}\PYG{p}{:} \PYG{o}{\PYGZhy{}}\PYG{n}{wager} \PYG{k}{if} \PYG{n}{t} \PYG{o}{\PYGZlt{}}\PYG{o}{=}\PYG{l+m+mf}{0.51} \PYG{k}{else} \PYG{n}{wager}\PYG{p}{)}

\PYG{n}{fig} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}subplot}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{n}{end\PYGZus{}m} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{trials}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{money} \PYG{o}{=} \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{c}\PYG{p}{,} \PYG{n}{x}\PYG{p}{:} \PYG{n}{c} \PYG{o}{+} \PYG{p}{[}\PYG{n}{c}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{+} \PYG{n}{x}\PYG{p}{]}\PYG{p}{,} \PYG{n}{trans}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{random}\PYG{p}{(}\PYG{n}{bets}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,} \PYG{p}{[}\PYG{n}{start\PYGZus{}m}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{end\PYGZus{}m}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{money}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{money}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Player Money in \PYGZdl{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Number of bets}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{John starts the game with \PYGZdl{} }\PYG{l+s+si}{\PYGZpc{}.2f}\PYG{l+s+s2}{ and ends with \PYGZdl{} }\PYG{l+s+si}{\PYGZpc{}.2f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{\PYGZpc{}}\PYG{p}{(}\PYG{n}{start\PYGZus{}m}\PYG{p}{,}\PYG{n+nb}{sum}\PYG{p}{(}\PYG{n}{end\PYGZus{}m}\PYG{p}{)}\PYG{o}{/}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{end\PYGZus{}m}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{casino_5_100}.png}
\end{figure}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{casino_100_1000}.png}
\end{figure}


\section{Simulating a Random Walk}
\label{\detokenize{mc:simulating-a-random-walk}}

\subsection{Fetch the histrical stock price}
\label{\detokenize{mc:fetch-the-histrical-stock-price}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Fecth the data. If you need the code for this piece, you can contact with me.

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{stock}\PYG{o}{.}\PYG{n}{tail}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}      \PYG{n}{Date}\PYG{o}{\textbar{}}      \PYG{n}{Open}\PYG{o}{\textbar{}}      \PYG{n}{High}\PYG{o}{\textbar{}}       \PYG{n}{Low}\PYG{o}{\textbar{}}     \PYG{n}{Close}\PYG{o}{\textbar{}} \PYG{n}{Adj} \PYG{n}{Close}\PYG{o}{\textbar{}}  \PYG{n}{Volume}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{2018}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mo}{07}\PYG{o}{\textbar{}}\PYG{l+m+mf}{155.399994}\PYG{o}{\textbar{}}\PYG{l+m+mf}{158.050003}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.729996}\PYG{o}{\textbar{}}\PYG{l+m+mf}{153.059998}\PYG{o}{\textbar{}}\PYG{l+m+mf}{153.059998}\PYG{o}{\textbar{}}\PYG{l+m+mi}{17447900}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{2018}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{o}{\textbar{}}\PYG{l+m+mf}{150.389999}\PYG{o}{\textbar{}}\PYG{l+m+mf}{152.809998}\PYG{o}{\textbar{}}\PYG{l+m+mf}{147.479996}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.429993}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.429993}\PYG{o}{\textbar{}}\PYG{l+m+mi}{15525500}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{2018}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{o}{\textbar{}}\PYG{l+m+mf}{155.259995}\PYG{o}{\textbar{}}\PYG{l+m+mf}{156.240005}\PYG{o}{\textbar{}}\PYG{l+m+mf}{150.899994}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.830002}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.830002}\PYG{o}{\textbar{}}\PYG{l+m+mi}{13651900}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mi}{2018}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\textbar{}}\PYG{l+m+mf}{155.240005}\PYG{o}{\textbar{}}\PYG{l+m+mf}{156.169998}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.429993}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mi}{16597900}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Convert the \sphinxcode{\sphinxupquote{str}} type date to date type

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{stock}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{stock}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Data visualization

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Plot everything by leveraging the very powerful matplotlib package}
\PYG{n}{width} \PYG{o}{=} \PYG{l+m+mi}{10}
\PYG{n}{height} \PYG{o}{=} \PYG{l+m+mi}{6}
\PYG{n}{data} \PYG{o}{=} \PYG{n}{stock}
\PYG{n}{fig} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{n}{width}\PYG{p}{,} \PYG{n}{height}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}subplot}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{Date}\PYG{p}{,} \PYG{n}{data}\PYG{o}{.}\PYG{n}{Close}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Close}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{Date}\PYG{p}{,} \PYG{n}{data}\PYG{o}{.}\PYG{n}{High}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{High}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} ax.plot(data.Date, data.Low, label=\PYGZsq{}Low\PYGZsq{})}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{price (\PYGZdl{})}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Stock price: }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{ticker}\PYG{p}{,} \PYG{n}{y}\PYG{o}{=}\PYG{l+m+mf}{1.01}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}plt.xticks(rotation=70)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Plot everything by leveraging the very powerful matplotlib package}
\PYG{n}{fig} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{n}{width}\PYG{p}{,} \PYG{n}{height}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}subplot}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{Date}\PYG{p}{,} \PYG{n}{data}\PYG{o}{.}\PYG{n}{Volume}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Volume}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}ax.plot(data.Date, data.High, label=\PYGZsq{}High\PYGZsq{})}
\PYG{c+c1}{\PYGZsh{} ax.plot(data.Date, data.Low, label=\PYGZsq{}Low\PYGZsq{})}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Volume}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Stock volume: }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{ticker}\PYG{p}{,} \PYG{n}{y}\PYG{o}{=}\PYG{l+m+mf}{1.01}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}plt.xticks(rotation=70)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{baba_history}.png}
\caption{Historical Stock Price}\label{\detokenize{mc:id2}}\label{\detokenize{mc:fig-mc-stock-his-price}}\end{figure}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{baba_history_vol}.png}
\caption{Historical Stock Volume}\label{\detokenize{mc:id3}}\label{\detokenize{mc:fig-mc-stock-his-vol}}\end{figure}


\subsection{Calulate the Compound Annual Growth Rate}
\label{\detokenize{mc:calulate-the-compound-annual-growth-rate}}
The formula for Compound Annual Growth Rate (CAGR) is very useful for investment analysis. It may also be referred to as the annualized rate of return or annual percent yield or effective annual rate, depending on the algebraic form of the equation. Many investments such as stocks have returns that can vary wildly. The CAGR formula allows you to calculate a “smoothed” rate of return that you can use to compare to other investments. The formula is defined as (more details can be found at \sphinxhref{https://www.vertex42.com/Calculators/cagr-calculator.html}{CAGR Calculator and Formula})
\begin{equation*}
\begin{split}\text{CAGR}=\left(\frac{\text{End Value}}{\text{Start Value}}\right)^{\frac{365}{\text{Days}}} -1\end{split}
\end{equation*}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{days} \PYG{o}{=}  \PYG{p}{(}\PYG{n}{stock}\PYG{o}{.}\PYG{n}{Date}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{stock}\PYG{o}{.}\PYG{n}{Date}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{days}
\PYG{n}{cagr} \PYG{o}{=} \PYG{p}{(}\PYG{p}{(}\PYG{p}{(}\PYG{p}{(}\PYG{n}{stock}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Adj Close}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)} \PYG{o}{/} \PYG{n}{stock}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Adj Close}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)} \PYG{o}{*}\PYG{o}{*} \PYG{p}{(}\PYG{l+m+mf}{365.0}\PYG{o}{/}\PYG{n}{days}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{l+m+mi}{1}
\PYG{k}{print} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CAGR =}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n+nb}{round}\PYG{p}{(}\PYG{n}{cagr}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{o}{*}\PYG{l+m+mi}{100}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZpc{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{mu} \PYG{o}{=} \PYG{n}{cagr}
\end{sphinxVerbatim}


\subsection{Calulate the annual volatility}
\label{\detokenize{mc:calulate-the-annual-volatility}}
A stock’s volatility is the variation in its price over a period of time. For example, one stock may have a tendency to swing wildly higher and lower, while another stock may move in much steadier, less turbulent way. Both stocks may end up at the same price at the end of day, but their path to that point can vary wildly. First, we create a series of percentage returns and calculate the annual volatility of returns Annualizing volatility. To present this volatility in annualized terms,
we simply need to multiply our daily standard deviation
by the square root of 252. This assumes there are 252
trading days in a given year.  More details can be found at \sphinxhref{https://www.fool.com/knowledge-center/how-to-calculate-annualized-volatility.aspx}{How to Calculate Annualized Volatility}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{stock}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Returns}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{stock}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Adj Close}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{pct\PYGZus{}change}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{vol} \PYG{o}{=} \PYG{n}{stock}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Returns}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{std}\PYG{p}{(}\PYG{p}{)}\PYG{o}{*}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{l+m+mi}{252}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{Create matrix of daily returns}
\label{\detokenize{mc:create-matrix-of-daily-returns}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Create matrix of daily returns using random normal distribution Generates an RDD matrix comprised of i.i.d. samples from the uniform distribution U(0.0, 1.0).

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{S} \PYG{o}{=} \PYG{n}{stock}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Adj Close}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{c+c1}{\PYGZsh{}starting stock price (i.e. last available real stock price)}
\PYG{n}{T} \PYG{o}{=} \PYG{l+m+mi}{5} \PYG{c+c1}{\PYGZsh{}Number of trading days}
\PYG{n}{mu} \PYG{o}{=} \PYG{n}{cagr} \PYG{c+c1}{\PYGZsh{}Return}
\PYG{n}{vol} \PYG{o}{=} \PYG{n}{vol} \PYG{c+c1}{\PYGZsh{}Volatility}
\PYG{n}{trials} \PYG{o}{=} \PYG{l+m+mi}{10000}

\PYG{n}{mat} \PYG{o}{=} \PYG{n}{RandomRDDs}\PYG{o}{.}\PYG{n}{normalVectorRDD}\PYG{p}{(}\PYG{n}{sc}\PYG{p}{,} \PYG{n}{trials}\PYG{p}{,} \PYG{n}{T}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Transform the distribution in the generated RDD from U(0.0, 1.0) to U(a, b), use RandomRDDs.uniformRDD(sc, n, p, seed) .map(lambda v: a + (b - a) * v)

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{a} \PYG{o}{=} \PYG{n}{mu}\PYG{o}{/}\PYG{n}{T}
\PYG{n}{b} \PYG{o}{=} \PYG{n}{vol}\PYG{o}{/}\PYG{n}{math}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{T}\PYG{p}{)}
\PYG{n}{v} \PYG{o}{=} \PYG{n}{mat}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{a} \PYG{o}{+}  \PYG{p}{(}\PYG{n}{b} \PYG{o}{\PYGZhy{}} \PYG{n}{a}\PYG{p}{)}\PYG{o}{*} \PYG{n}{x}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
Convert Rdd mstrix to dataframe

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{df} \PYG{o}{=} \PYG{n}{v}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{p}{[}\PYG{n+nb}{round}\PYG{p}{(}\PYG{n}{i}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{)}\PYG{o}{+}\PYG{l+m+mi}{1} \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n}{x}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}1}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}2}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}3}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}4}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}5}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.935234}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.162894}\PYG{o}{\textbar{}} \PYG{l+m+mf}{1.07972}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.238257}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.066136}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.878456}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.045922}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.990071}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.045552}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.854516}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.186472}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.944777}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.742247}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.940023}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.220934}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.872928}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.030882}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.248644}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.114262}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.063762}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{1.09742}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.188537}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.137283}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.162548}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.024612}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{lit}
\PYG{n}{S} \PYG{o}{=} \PYG{n}{stock}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Adj Close}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}
\PYG{n}{price} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{init\PYGZus{}price}\PYG{l+s+s1}{\PYGZsq{}} \PYG{p}{,}\PYG{n}{lit}\PYG{p}{(}\PYG{n}{S}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{price}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}1}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}2}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}3}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}4}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}5}\PYG{o}{\textbar{}}\PYG{n}{init\PYGZus{}price}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.935234}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.162894}\PYG{o}{\textbar{}} \PYG{l+m+mf}{1.07972}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.238257}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.066136}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.878456}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.045922}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.990071}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.045552}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.854516}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.186472}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.944777}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.742247}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.940023}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.220934}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.872928}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.030882}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.248644}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.114262}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.063762}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{1.09742}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.188537}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.137283}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.162548}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.024612}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{price} \PYG{o}{=} \PYG{n}{price}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{init\PYGZus{}price}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{price}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}1}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}2}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}3}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}4}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}5}\PYG{o}{\textbar{}}\PYG{n}{init\PYGZus{}price}\PYG{o}{\textbar{}}\PYG{n}{day\PYGZus{}0}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.935234}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.162894}\PYG{o}{\textbar{}} \PYG{l+m+mf}{1.07972}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.238257}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.066136}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.878456}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.045922}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.990071}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.045552}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.854516}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.186472}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.944777}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.742247}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.940023}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.220934}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.872928}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.030882}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.248644}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.114262}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.063762}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{1.09742}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.188537}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.137283}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.162548}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.024612}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{Monte Carlo Simulation}
\label{\detokenize{mc:id1}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n+nb}{round}
\PYG{k}{for} \PYG{n}{name} \PYG{o+ow}{in} \PYG{n}{price}\PYG{o}{.}\PYG{n}{columns}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{:}
    \PYG{n}{price} \PYG{o}{=} \PYG{n}{price}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n}{name}\PYG{p}{,} \PYG{n+nb}{round}\PYG{p}{(}\PYG{n}{col}\PYG{p}{(}\PYG{n}{name}\PYG{p}{)}\PYG{o}{*}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{init\PYGZus{}price}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{price} \PYG{o}{=} \PYG{n}{price}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{init\PYGZus{}price}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{col}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n}{name}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{price}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}

\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}1}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}2}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}3}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}4}\PYG{o}{\textbar{}}      \PYG{n}{\PYGZus{}5}\PYG{o}{\textbar{}}\PYG{n}{init\PYGZus{}price}\PYG{o}{\textbar{}}\PYG{n}{day\PYGZus{}0}\PYG{o}{\textbar{}} \PYG{n}{day\PYGZus{}1}\PYG{o}{\textbar{}} \PYG{n}{day\PYGZus{}2}\PYG{o}{\textbar{}} \PYG{n}{day\PYGZus{}3}\PYG{o}{\textbar{}} \PYG{n}{day\PYGZus{}4}\PYG{o}{\textbar{}} \PYG{n}{day\PYGZus{}5}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.935234}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.162894}\PYG{o}{\textbar{}} \PYG{l+m+mf}{1.07972}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.238257}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.066136}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{234.87}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{141.69}\PYG{o}{\textbar{}}\PYG{l+m+mf}{164.77}\PYG{o}{\textbar{}}\PYG{l+m+mf}{177.91}\PYG{o}{\textbar{}} \PYG{l+m+mf}{220.3}\PYG{o}{\textbar{}}\PYG{l+m+mf}{234.87}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.878456}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.045922}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.990071}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.045552}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.854516}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{123.14}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{133.09}\PYG{o}{\textbar{}} \PYG{l+m+mf}{139.2}\PYG{o}{\textbar{}}\PYG{l+m+mf}{137.82}\PYG{o}{\textbar{}} \PYG{l+m+mf}{144.1}\PYG{o}{\textbar{}}\PYG{l+m+mf}{123.14}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.186472}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.944777}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.742247}\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.940023}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.220934}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{144.67}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{179.75}\PYG{o}{\textbar{}}\PYG{l+m+mf}{169.82}\PYG{o}{\textbar{}}\PYG{l+m+mf}{126.05}\PYG{o}{\textbar{}}\PYG{l+m+mf}{118.49}\PYG{o}{\textbar{}}\PYG{l+m+mf}{144.67}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}\PYG{l+m+mf}{0.872928}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.030882}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.248644}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.114262}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.063762}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{201.77}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{132.25}\PYG{o}{\textbar{}}\PYG{l+m+mf}{136.33}\PYG{o}{\textbar{}}\PYG{l+m+mf}{170.23}\PYG{o}{\textbar{}}\PYG{l+m+mf}{189.68}\PYG{o}{\textbar{}}\PYG{l+m+mf}{201.77}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{1.09742}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.188537}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.137283}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.162548}\PYG{o}{\textbar{}}\PYG{l+m+mf}{1.024612}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{267.7}\PYG{o}{\textbar{}}\PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{166.26}\PYG{o}{\textbar{}}\PYG{l+m+mf}{197.61}\PYG{o}{\textbar{}}\PYG{l+m+mf}{224.74}\PYG{o}{\textbar{}}\PYG{l+m+mf}{261.27}\PYG{o}{\textbar{}} \PYG{l+m+mf}{267.7}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}


\subsection{Summary}
\label{\detokenize{mc:summary}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{selected\PYGZus{}col} \PYG{o}{=} \PYG{p}{[}\PYG{n}{name} \PYG{k}{for} \PYG{n}{name} \PYG{o+ow}{in} \PYG{n}{price}\PYG{o}{.}\PYG{n}{columns} \PYG{k}{if} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o+ow}{in} \PYG{n}{name}\PYG{p}{]}

\PYG{n}{simulated} \PYG{o}{=} \PYG{n}{price}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{selected\PYGZus{}col}\PYG{p}{)}
\PYG{n}{simulated}\PYG{o}{.}\PYG{n}{describe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{summary}\PYG{o}{\textbar{}}\PYG{l+m+mi}{2018}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{2018}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{13}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{2018}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{14}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{2018}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{17}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{2018}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{18}\PYG{o}{\textbar{}}        \PYG{l+m+mi}{2018}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{12}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{19}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{n}{count}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{10000.0}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{10000.0}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{10000.0}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{10000.0}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{10000.0}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{10000.0}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}   \PYG{n}{mean}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}\PYG{l+m+mf}{155.11643700000002}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{158.489058}\PYG{o}{\textbar{}}\PYG{l+m+mf}{162.23713200000003}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{166.049375}\PYG{o}{\textbar{}}        \PYG{l+m+mf}{170.006525}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n}{std}\PYG{o}{\textbar{}}       \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}\PYG{l+m+mf}{18.313783237787845}\PYG{o}{\textbar{}}\PYG{l+m+mf}{26.460919262517276}\PYG{o}{\textbar{}} \PYG{l+m+mf}{33.37780495150803}\PYG{o}{\textbar{}}\PYG{l+m+mf}{39.369101074463416}\PYG{o}{\textbar{}}\PYG{l+m+mf}{45.148120695490846}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{min}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}              \PYG{l+m+mf}{88.2}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{74.54}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{65.87}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{68.21}\PYG{o}{\textbar{}}             \PYG{l+m+mf}{58.25}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{25}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{142.485}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{140.15}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{138.72}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{138.365}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{137.33}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{50}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{154.97}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{157.175}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{159.82}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{162.59}\PYG{o}{\textbar{}}\PYG{l+m+mf}{165.04500000000002}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{l+m+mi}{75}\PYG{o}{\PYGZpc{}}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{167.445}\PYG{o}{\textbar{}}\PYG{l+m+mf}{175.48499999999999}\PYG{o}{\textbar{}}          \PYG{l+m+mf}{182.8625}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{189.725}\PYG{o}{\textbar{}}           \PYG{l+m+mf}{196.975}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}    \PYG{n+nb}{max}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{151.5}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{227.48}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{275.94}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{319.17}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{353.59}\PYG{o}{\textbar{}}            \PYG{l+m+mf}{403.68}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data\PYGZus{}plt} \PYG{o}{=} \PYG{n}{simulated}\PYG{o}{.}\PYG{n}{toPandas}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{days} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{date\PYGZus{}range}\PYG{p}{(}\PYG{n}{stock}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{periods}\PYG{o}{=} \PYG{n}{T}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{freq}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{date}

\PYG{n}{width} \PYG{o}{=} \PYG{l+m+mi}{10}
\PYG{n}{height} \PYG{o}{=} \PYG{l+m+mi}{6}
\PYG{n}{fig} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{n}{width}\PYG{p}{,} \PYG{n}{height}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}subplot}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{n}{days} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{date\PYGZus{}range}\PYG{p}{(}\PYG{n}{stock}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{periods}\PYG{o}{=} \PYG{n}{T}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{freq}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{B}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{date}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{trials}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{plt}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{days}\PYG{p}{,} \PYG{n}{data\PYGZus{}plt}\PYG{o}{.}\PYG{n}{iloc}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{price (\PYGZdl{})}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Simulated Stock price: }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{ticker}\PYG{p}{,} \PYG{n}{y}\PYG{o}{=}\PYG{l+m+mf}{1.01}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{baba_sim_price_demo}.png}
\end{figure}


\subsection{One-year Stock price simulation}
\label{\detokenize{mc:one-year-stock-price-simulation}}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{baba_sim_price}.png}
\caption{Simulated Stock Price}\label{\detokenize{mc:id4}}\label{\detokenize{mc:fig-mc-stock-price}}\end{figure}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{baba_sim_dis1}.png}
\caption{Simulated Stock Price distribution}\label{\detokenize{mc:id5}}\label{\detokenize{mc:fig-mc-stock-dis}}\end{figure}


\chapter{Markov Chain Monte Carlo}
\label{\detokenize{mcmc:markov-chain-monte-carlo}}\label{\detokenize{mcmc:mcmc}}\label{\detokenize{mcmc::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

\sphinxstylestrong{A book is known in time of need.}
\end{sphinxadmonition}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{mcmc_py}.png}
\end{figure}

Monte Carlo simulations are just a way of estimating a fixed parameter by repeatedly generating random numbers. More details can be found at \sphinxhref{https://towardsdatascience.com/a-zero-math-introduction-to-markov-chain-monte-carlo-methods-dcba889e0c50}{A Zero Math Introduction to Markov Chain Monte Carlo Methods}.

Markov Chain Monte Carlo (MCMC) methods are used to approximate the posterior distribution of a parameter of interest by random sampling in a probabilistic space. More details can be found at \sphinxhref{https://towardsdatascience.com/a-zero-math-introduction-to-markov-chain-monte-carlo-methods-dcba889e0c50}{A Zero Math Introduction to Markov Chain Monte Carlo Methods}.

The following theory and demo are from Dr. Rebecca C. Steorts’s \sphinxhref{http://www2.stat.duke.edu/~rcs46/lecturesModernBayes/601-module6-markov/markov-chain-monte-carlo.pdf}{Intro to Markov Chain Monte Carlo}. More details can be found at Dr. Rebecca C. Steorts’s STA 360/601: \sphinxhref{http://www2.stat.duke.edu/~rcs46/bayes.html}{Bayesian Methods and Modern Statistics} class at Duke.


\section{Metropolis algorithm}
\label{\detokenize{mcmc:metropolis-algorithm}}\label{\detokenize{mcmc:metroalg}}
The Metropolis algorithm takes three main steps:
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Sample  \(\theta^* \sim J(\theta | \theta ^{(s)})\)

\item {} 
Compute the acceptance ratio \((r)\)
\begin{quote}
\begin{equation*}
\begin{split}r = \frac{p(\theta^*|y)}{p(\theta^{(s)}|y)} = \frac{p(y|\theta^*)p(\theta^*)}{p(y|\theta^{(s)})p(\theta^{(s)})}\end{split}
\end{equation*}\end{quote}

\item {} 
Let
\begin{quote}
\begin{equation}\label{equation:mcmc:eq_step3}
\begin{split}             \theta^{(s+1)}
             =
             \left\{
     \begin{array}{ll}
             \theta^* &\text{ with prob min}{(r,1)} \\
             \theta^{(s)} &\text{ otherwise }
     \end{array}
     \right.\end{split}
\end{equation}\end{quote}

\end{enumerate}

\begin{sphinxadmonition}{note}{Note:}
Actually, the \eqref{equation:mcmc:eq_step3} in Step 3 can be replaced by sampling \(u \sim \text{Uniform}(0,1)\) and setting \(\theta^{(s+1)}=\theta^*\) if \(u<r\) and setting \(\theta^{(s+1)}=\theta^{(s)}\) otherwise.
\end{sphinxadmonition}


\section{A Toy Example of Metropolis}
\label{\detokenize{mcmc:a-toy-example-of-metropolis}}
The following example is going to test out the Metropolis algorithm for the conjugate Normal-Normal model with a known variance situation.


\subsection{Conjugate Normal-Normal model}
\label{\detokenize{mcmc:conjugate-normal-normal-model}}\begin{quote}
\begin{equation*}
\begin{split}\begin{array}{ll}
    X_1, \cdots, X_n & \theta \stackrel{iid}{\sim}\text{Normal}(\theta,\sigma^2)\\
                      & \theta \sim\text{Normal}(\mu,\tau^2)
\end{array}\end{split}
\end{equation*}\end{quote}

Recall that the posterior of \(\theta\) is \(\text{Normal}(\mu_n,\tau^2_n)\), where
\begin{quote}
\begin{equation*}
\begin{split}\mu_n = \bar{x}\frac{n/\sigma^2}{n/\sigma^2+1/\tau^2} + \mu\frac{1/\tau^2}{n/\sigma^2+1/\tau^2}\end{split}
\end{equation*}\end{quote}

and
\begin{quote}
\begin{equation*}
\begin{split}\tau_n^2 = \frac{1}{n/\sigma^2+1/\tau^2}\end{split}
\end{equation*}\end{quote}


\subsection{Example setup}
\label{\detokenize{mcmc:example-setup}}
The rest of the parameters are \(\sigma^2=1\), \(\tau^2=10\), \(\mu=5\), \(n=5\) and
\begin{quote}
\begin{equation*}
\begin{split}y = [9.37, 10.18, 9.16, 11.60, 10.33]\end{split}
\end{equation*}\end{quote}

For this setup, we get that \(\mu_n=10.02745\) and \(\tau_n^2=0.1960784\).


\subsection{Essential mathematical derivation}
\label{\detokenize{mcmc:essential-mathematical-derivation}}
In the {\hyperref[\detokenize{mcmc:metroalg}]{\sphinxcrossref{\DUrole{std,std-ref}{Metropolis algorithm}}}}, we need to compute the acceptance ratio \(r\), i.e.
\begin{quote}
\begin{equation*}
\begin{split}r  &=  \frac{p(\theta^*|x)}{p(\theta^{(s)}|x)} \\
   &=  \frac{p(x|\theta^*)p(\theta^*)}{p(x|\theta^{(s)})p(\theta^{(s)})}\\
   &=  \left(\frac{\prod_i\text{dnorm}(x_i,\theta^*,\sigma)}{\prod_i\text{dnorm}(x_i,\theta^{(s)},\sigma)}\right)
        \left(\frac{\text{dnorm}(\theta^*,\mu,\tau)}{\text{dnorm}(\theta^{(s)},\mu,\tau)}\right)\end{split}
\end{equation*}\end{quote}

In many cases, computing the ratio \(r\) directly can be numerically unstable, however, this can be modified by taking \(log r\). i.e.
\begin{quote}
\begin{equation*}
\begin{split}logr  &=  \sum_i \left(log[\text{dnorm}(x_i,\theta^*,\sigma)] - log[\text{dnorm}(x_i, \theta^{(s)}, \sigma)]\right)\\
      &+  \sum_i \left(log[\text{dnorm}(\theta^*,\mu,\tau)] - log[\text{dnorm}(\theta^{(s)}, \mu,\tau)]\right)\end{split}
\end{equation*}\end{quote}

Then the criteria of the acceptance becomes: if \(log u< log r\), where \(u\) is sample form the \(\text{Uniform}(0,1)\).


\section{Demos}
\label{\detokenize{mcmc:demos}}
Now, We generate \(S\) iterations of the Metropolis algorithm starting at \(\theta^{(0)}=0\) and using a normal proposal distribution, where
\begin{quote}
\begin{equation*}
\begin{split}\theta^{(s+1)} \sim \text{Normal}(\theta^{(s)},2).\end{split}
\end{equation*}\end{quote}


\subsection{R results}
\label{\detokenize{mcmc:r-results}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} setting values}
\PYG{n+nf}{set.seed}\PYG{p}{(}\PYG{l+m}{1}\PYG{p}{)}
\PYG{n}{s2}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{l+m}{1}
\PYG{n}{t2}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{l+m}{10}
\PYG{n}{mu}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{l+m}{5}\PYG{p}{;} \PYG{n}{n}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{l+m}{5}


\PYG{c+c1}{\PYGZsh{} rounding the rnorm to 2 decimal places}
\PYG{n}{y}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{n+nf}{round}\PYG{p}{(}\PYG{n+nf}{rnorm}\PYG{p}{(}\PYG{n}{n}\PYG{p}{,}\PYG{l+m}{10}\PYG{p}{,}\PYG{l+m}{1}\PYG{p}{)}\PYG{p}{,}\PYG{l+m}{2}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} mean of the normal posterior}
\PYG{n}{mu.n}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{p}{(} \PYG{n+nf}{mean}\PYG{p}{(}\PYG{n}{y}\PYG{p}{)}\PYG{o}{*}\PYG{n}{n}\PYG{o}{/}\PYG{n}{s2} \PYG{o}{+} \PYG{n}{mu}\PYG{o}{/}\PYG{n}{t2} \PYG{p}{)}\PYG{o}{/}\PYG{p}{(} \PYG{n}{n}\PYG{o}{/}\PYG{n}{s2}\PYG{l+m}{+1}\PYG{o}{/}\PYG{n}{t2}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} variance of the normal posterior}
\PYG{n}{t2.n}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{l+m}{1}\PYG{o}{/}\PYG{p}{(}\PYG{n}{n}\PYG{o}{/}\PYG{n}{s2}\PYG{l+m}{+1}\PYG{o}{/}\PYG{n}{t2}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} defining the data}
\PYG{n}{y}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{n+nf}{c}\PYG{p}{(}\PYG{l+m}{9.37}\PYG{p}{,} \PYG{l+m}{10.18}\PYG{p}{,} \PYG{l+m}{9.16}\PYG{p}{,} \PYG{l+m}{11.60}\PYG{p}{,} \PYG{l+m}{10.33}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}metropolis part\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}}
\PYG{c+c1}{\PYGZsh{}\PYGZsh{}S = total num of simulations}
\PYG{n}{theta}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{l+m}{0} \PYG{p}{;} \PYG{n}{delta}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{l+m}{2} \PYG{p}{;} \PYG{n}{S}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{l+m}{10000} \PYG{p}{;} \PYG{n}{THETA}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{k+kc}{NULL} \PYG{p}{;} \PYG{n+nf}{set.seed}\PYG{p}{(}\PYG{l+m}{1}\PYG{p}{)}
\PYG{n+nf}{for}\PYG{p}{(}\PYG{n}{s} \PYG{n}{in} \PYG{l+m}{1}\PYG{o}{:}\PYG{n}{S}\PYG{p}{)}\PYG{p}{\PYGZob{}}
  \PYG{c+c1}{\PYGZsh{}\PYGZsh{} simulating our proposal}
  \PYG{c+c1}{\PYGZsh{}the new value of theta}
  \PYG{c+c1}{\PYGZsh{}print(theta)}
  \PYG{n}{theta.star}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{n+nf}{rnorm}\PYG{p}{(}\PYG{l+m}{1}\PYG{p}{,}\PYG{n}{theta}\PYG{p}{,}\PYG{n+nf}{sqrt}\PYG{p}{(}\PYG{n}{delta}\PYG{p}{)}\PYG{p}{)}
  \PYG{c+c1}{\PYGZsh{}\PYGZsh{}taking the log of the ratio r}
  \PYG{n}{log.r}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{p}{(} \PYG{n+nf}{sum}\PYG{p}{(}\PYG{n+nf}{dnorm}\PYG{p}{(}\PYG{n}{y}\PYG{p}{,}\PYG{n}{theta.star}\PYG{p}{,}\PYG{n+nf}{sqrt}\PYG{p}{(}\PYG{n}{s2}\PYG{p}{)}\PYG{p}{,}\PYG{n}{log}\PYG{o}{=}\PYG{k+kc}{TRUE}\PYG{p}{)}\PYG{p}{)}\PYG{o}{+} 
                 \PYG{n+nf}{dnorm}\PYG{p}{(}\PYG{n}{theta.star}\PYG{p}{,}\PYG{n}{mu}\PYG{p}{,}\PYG{n+nf}{sqrt}\PYG{p}{(}\PYG{n}{t2}\PYG{p}{)}\PYG{p}{,}\PYG{n}{log}\PYG{o}{=}\PYG{k+kc}{TRUE}\PYG{p}{)}\PYG{p}{)}\PYG{o}{\PYGZhy{}} 
          \PYG{p}{(} \PYG{n+nf}{sum}\PYG{p}{(}\PYG{n+nf}{dnorm}\PYG{p}{(}\PYG{n}{y}\PYG{p}{,}\PYG{n}{theta}\PYG{p}{,}\PYG{n+nf}{sqrt}\PYG{p}{(}\PYG{n}{s2}\PYG{p}{)}\PYG{p}{,}\PYG{n}{log}\PYG{o}{=}\PYG{k+kc}{TRUE}\PYG{p}{)}\PYG{p}{)}\PYG{o}{+}  
                  \PYG{n+nf}{dnorm}\PYG{p}{(}\PYG{n}{theta}\PYG{p}{,}\PYG{n}{mu}\PYG{p}{,}\PYG{n+nf}{sqrt}\PYG{p}{(}\PYG{n}{t2}\PYG{p}{)}\PYG{p}{,}\PYG{n}{log}\PYG{o}{=}\PYG{k+kc}{TRUE}\PYG{p}{)}\PYG{p}{)}
  \PYG{c+c1}{\PYGZsh{}print(log.r)}
  \PYG{n+nf}{if}\PYG{p}{(}\PYG{n+nf}{log}\PYG{p}{(}\PYG{n+nf}{runif}\PYG{p}{(}\PYG{l+m}{1}\PYG{p}{)}\PYG{p}{)}\PYG{o}{\PYGZlt{}}\PYG{n}{log.r}\PYG{p}{)} \PYG{p}{\PYGZob{}} \PYG{n}{theta}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{n}{theta.star} \PYG{p}{\PYGZcb{}}
  \PYG{c+c1}{\PYGZsh{}\PYGZsh{}updating THETA}
  \PYG{c+c1}{\PYGZsh{}print(log(runif(1)))}
  \PYG{n}{THETA}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{n+nf}{c}\PYG{p}{(}\PYG{n}{THETA}\PYG{p}{,}\PYG{n}{theta}\PYG{p}{)}
\PYG{p}{\PYGZcb{}}

\PYG{c+c1}{\PYGZsh{}\PYGZsh{}two plots: trace of theta and comparing the empirical distribution}
\PYG{c+c1}{\PYGZsh{}\PYGZsh{}of simulated values to the true posterior}
\PYG{n+nf}{par}\PYG{p}{(}\PYG{n}{mar}\PYG{o}{=}\PYG{n+nf}{c}\PYG{p}{(}\PYG{l+m}{3}\PYG{p}{,}\PYG{l+m}{3}\PYG{p}{,}\PYG{l+m}{1}\PYG{p}{,}\PYG{l+m}{1}\PYG{p}{)}\PYG{p}{,}\PYG{n}{mgp}\PYG{o}{=}\PYG{n+nf}{c}\PYG{p}{(}\PYG{l+m}{1.75}\PYG{p}{,}\PYG{l+m}{.75}\PYG{p}{,}\PYG{l+m}{0}\PYG{p}{)}\PYG{p}{)}
\PYG{n+nf}{par}\PYG{p}{(}\PYG{n}{mfrow}\PYG{o}{=}\PYG{n+nf}{c}\PYG{p}{(}\PYG{l+m}{1}\PYG{p}{,}\PYG{l+m}{2}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} creating a sequence}
\PYG{n}{skeep}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{n+nf}{seq}\PYG{p}{(}\PYG{l+m}{10}\PYG{p}{,}\PYG{n}{S}\PYG{p}{,}\PYG{n}{by}\PYG{o}{=}\PYG{l+m}{10}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} making a trace place}
\PYG{n+nf}{plot}\PYG{p}{(}\PYG{n}{skeep}\PYG{p}{,}\PYG{n}{THETA}\PYG{n}{[skeep}\PYG{n}{]}\PYG{p}{,}\PYG{n}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{l\PYGZdq{}}\PYG{p}{,}
     \PYG{n}{xlab}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{iteration\PYGZdq{}}\PYG{p}{,}\PYG{n}{ylab}\PYG{o}{=}\PYG{n+nf}{expression}\PYG{p}{(}\PYG{n}{theta}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} making a histogram}
\PYG{n+nf}{hist}\PYG{p}{(}\PYG{n}{THETA}\PYG{n}{[}\PYG{o}{\PYGZhy{}}\PYG{p}{(}\PYG{l+m}{1}\PYG{o}{:}\PYG{l+m}{50}\PYG{p}{)}\PYG{n}{]}\PYG{p}{,}\PYG{n}{prob}\PYG{o}{=}\PYG{k+kc}{TRUE}\PYG{p}{,}\PYG{n}{main}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{\PYGZdq{}}\PYG{p}{,}
     \PYG{n}{xlab}\PYG{o}{=}\PYG{n+nf}{expression}\PYG{p}{(}\PYG{n}{theta}\PYG{p}{)}\PYG{p}{,}\PYG{n}{ylab}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{density\PYGZdq{}}\PYG{p}{)}
\PYG{n}{th}\PYG{o}{\PYGZlt{}\PYGZhy{}}\PYG{n+nf}{seq}\PYG{p}{(}\PYG{n+nf}{min}\PYG{p}{(}\PYG{n}{THETA}\PYG{p}{)}\PYG{p}{,}\PYG{n+nf}{max}\PYG{p}{(}\PYG{n}{THETA}\PYG{p}{)}\PYG{p}{,}\PYG{n}{length}\PYG{o}{=}\PYG{l+m}{100}\PYG{p}{)}
\PYG{n+nf}{lines}\PYG{p}{(}\PYG{n}{th}\PYG{p}{,}\PYG{n+nf}{dnorm}\PYG{p}{(}\PYG{n}{th}\PYG{p}{,}\PYG{n}{mu.n}\PYG{p}{,}\PYG{n+nf}{sqrt}\PYG{p}{(}\PYG{n}{t2.n}\PYG{p}{)}\PYG{p}{)} \PYG{p}{)}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{mcmc_r}.png}
\caption{Histogram for the Metropolis algorithm with r}\label{\detokenize{mcmc:id1}}\label{\detokenize{mcmc:fig-mcmc-r}}\end{figure}

Figure. {\hyperref[\detokenize{mcmc:fig-mcmc-r}]{\sphinxcrossref{\DUrole{std,std-ref}{Histogram for the Metropolis algorithm with r}}}} shows a trace plot for this run as well as a histogram for
the Metropolis algorithm compared with a draw from the true normal density.


\subsection{Python results}
\label{\detokenize{mcmc:python-results}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]

\PYG{c+c1}{\PYGZsh{} coding: utf\PYGZhy{}8}

\PYG{c+c1}{\PYGZsh{} In[1]:}

\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k+kn}{as} \PYG{n+nn}{np}


\PYG{c+c1}{\PYGZsh{} In[2]:}

\PYG{k+kn}{from} \PYG{n+nn}{scipy.stats} \PYG{k+kn}{import} \PYG{n}{norm}

\PYG{k}{def} \PYG{n+nf}{rnorm}\PYG{p}{(}\PYG{n}{n}\PYG{p}{,}\PYG{n}{mean}\PYG{p}{,}\PYG{n}{sd}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    same functions as rnorm in r}
\PYG{l+s+sd}{    r: rnorm(n, mean=0, sd=1)}
\PYG{l+s+sd}{    py: rvs(loc=0, scale=1, size=1, random\PYGZus{}state=None)}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{k}{return} \PYG{n}{norm}\PYG{o}{.}\PYG{n}{rvs}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{n}{mean}\PYG{p}{,}\PYG{n}{scale}\PYG{o}{=}\PYG{n}{sd}\PYG{p}{,}\PYG{n}{size}\PYG{o}{=}\PYG{n}{n}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{dnorm}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,}\PYG{n}{mean}\PYG{p}{,}\PYG{n}{sd}\PYG{p}{,} \PYG{n}{log}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    same functions as dnorm in r}
\PYG{l+s+sd}{    dnorm(x, mean=0, sd=1, log=FALSE)}
\PYG{l+s+sd}{    pdf(x, loc=0, scale=1)}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{k}{if} \PYG{n}{log}\PYG{p}{:}
        \PYG{k}{return} \PYG{n}{np}\PYG{o}{.}\PYG{n}{log}\PYG{p}{(}\PYG{n}{norm}\PYG{o}{.}\PYG{n}{pdf}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{n}{x}\PYG{p}{,}\PYG{n}{loc}\PYG{o}{=}\PYG{n}{mean}\PYG{p}{,}\PYG{n}{scale}\PYG{o}{=}\PYG{n}{sd}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{return} \PYG{n}{norm}\PYG{o}{.}\PYG{n}{pdf}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{n}{x}\PYG{p}{,}\PYG{n}{loc}\PYG{o}{=}\PYG{n}{mean}\PYG{p}{,}\PYG{n}{scale}\PYG{o}{=}\PYG{n}{sd}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{runif}\PYG{p}{(}\PYG{n}{n}\PYG{p}{,}\PYG{n+nb}{min}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n+nb}{max}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    r: runif(n, min = 0, max = 1)}
\PYG{l+s+sd}{    py: random.uniform(low=0.0, high=1.0, size=None)}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{k}{return} \PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{uniform}\PYG{p}{(}\PYG{n+nb}{min}\PYG{p}{,}\PYG{n+nb}{max}\PYG{p}{,}\PYG{n}{size}\PYG{o}{=}\PYG{n}{n}\PYG{p}{)}
    


\PYG{c+c1}{\PYGZsh{} In[3]:}

\PYG{n}{s2} \PYG{o}{=} \PYG{l+m+mi}{1}
\PYG{n}{t2} \PYG{o}{=} \PYG{l+m+mi}{10}
\PYG{n}{mu} \PYG{o}{=} \PYG{l+m+mi}{5}
\PYG{n}{n} \PYG{o}{=} \PYG{l+m+mi}{5} 


\PYG{c+c1}{\PYGZsh{} In[4]:}

\PYG{n}{y} \PYG{o}{=} \PYG{n}{rnorm}\PYG{p}{(}\PYG{n}{n}\PYG{p}{,}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{y}


\PYG{c+c1}{\PYGZsh{} In[5]:}

\PYG{c+c1}{\PYGZsh{} mean of the normal posterior}
\PYG{n}{mu\PYGZus{}n} \PYG{o}{=} \PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{y}\PYG{p}{)}\PYG{o}{*}\PYG{n}{n}\PYG{o}{/}\PYG{n}{s2} \PYG{o}{+} \PYG{n}{mu}\PYG{o}{/}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{t2}\PYG{p}{)}\PYG{p}{)}\PYG{o}{/}\PYG{p}{(}\PYG{n}{n}\PYG{o}{/}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{s2}\PYG{p}{)}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{t2}\PYG{p}{)}\PYG{p}{)} 
\PYG{n}{mu\PYGZus{}n}


\PYG{c+c1}{\PYGZsh{} In[6]:}

\PYG{c+c1}{\PYGZsh{} variance of the normal posterior}
\PYG{c+c1}{\PYGZsh{} t2.n\PYGZlt{}\PYGZhy{}1/(n/s2+1/t2)}

\PYG{n}{t2\PYGZus{}n} \PYG{o}{=} \PYG{l+m+mf}{1.0}\PYG{o}{/}\PYG{p}{(}\PYG{n}{n}\PYG{o}{/}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{s2}\PYG{p}{)}\PYG{o}{+}\PYG{l+m+mf}{1.0}\PYG{o}{/}\PYG{n}{t2}\PYG{p}{)}
\PYG{n}{t2\PYGZus{}n}


\PYG{c+c1}{\PYGZsh{} In[7]:}

\PYG{c+c1}{\PYGZsh{} defining the data}
\PYG{c+c1}{\PYGZsh{} y\PYGZlt{}\PYGZhy{}c(9.37, 10.18, 9.16, 11.60, 10.33)}

\PYG{n}{y} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mf}{9.37}\PYG{p}{,} \PYG{l+m+mf}{10.18}\PYG{p}{,} \PYG{l+m+mf}{9.16}\PYG{p}{,} \PYG{l+m+mf}{11.60}\PYG{p}{,} \PYG{l+m+mf}{10.33}\PYG{p}{]}


\PYG{c+c1}{\PYGZsh{} In[8]:}

\PYG{n}{mu\PYGZus{}n} \PYG{o}{=} \PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{y}\PYG{p}{)}\PYG{o}{*}\PYG{n}{n}\PYG{o}{/}\PYG{n}{s2} \PYG{o}{+} \PYG{n}{mu}\PYG{o}{/}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{t2}\PYG{p}{)}\PYG{p}{)}\PYG{o}{/}\PYG{p}{(}\PYG{n}{n}\PYG{o}{/}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{s2}\PYG{p}{)}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{o}{/}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{t2}\PYG{p}{)}\PYG{p}{)} 
\PYG{n}{mu\PYGZus{}n}


\PYG{c+c1}{\PYGZsh{} In[9]:}

\PYG{c+c1}{\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}metropolis part\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}}
\PYG{c+c1}{\PYGZsh{}\PYGZsh{}S = total num of simulations}
\PYG{c+c1}{\PYGZsh{} theta\PYGZlt{}\PYGZhy{}0 ; delta\PYGZlt{}\PYGZhy{}2 ; S\PYGZlt{}\PYGZhy{}10000 ; THETA\PYGZlt{}\PYGZhy{}NULL ; set.seed(1)}

\PYG{n}{theta} \PYG{o}{=} \PYG{l+m+mi}{0} 
\PYG{n}{delta} \PYG{o}{=} \PYG{l+m+mi}{2}

\PYG{n}{S} \PYG{o}{=} \PYG{l+m+mi}{10000}

\PYG{n}{theta\PYGZus{}v} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}


\PYG{c+c1}{\PYGZsh{} In[ ]:}

\PYG{k}{for} \PYG{n}{s} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{theta\PYGZus{}star} \PYG{o}{=} \PYG{n}{norm}\PYG{o}{.}\PYG{n}{rvs}\PYG{p}{(}\PYG{n}{theta}\PYG{p}{,}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{delta}\PYG{p}{)}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{logr} \PYG{o}{=} \PYG{p}{(}\PYG{n+nb}{sum}\PYG{p}{(}\PYG{n}{dnorm}\PYG{p}{(}\PYG{n}{y}\PYG{p}{,}\PYG{n}{theta\PYGZus{}star}\PYG{p}{,}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{s2}\PYG{p}{)}\PYG{p}{,}\PYG{n}{log}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{)} \PYG{o}{+}            
            \PYG{n+nb}{sum}\PYG{p}{(}\PYG{n}{dnorm}\PYG{p}{(}\PYG{n}{theta\PYGZus{}star}\PYG{p}{,}\PYG{n}{mu}\PYG{p}{,}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{t2}\PYG{p}{)}\PYG{p}{,}\PYG{n}{log}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}\PYG{o}{\PYGZhy{}}            
            \PYG{p}{(}\PYG{n+nb}{sum}\PYG{p}{(}\PYG{n}{dnorm}\PYG{p}{(}\PYG{n}{y}\PYG{p}{,}\PYG{n}{theta}\PYG{p}{,}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{s2}\PYG{p}{)}\PYG{p}{,}\PYG{n}{log}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{)} \PYG{o}{+}             
             \PYG{n+nb}{sum}\PYG{p}{(}\PYG{n}{dnorm}\PYG{p}{(}\PYG{p}{[}\PYG{n}{theta}\PYG{p}{]}\PYG{p}{,}\PYG{n}{mu}\PYG{p}{,}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{t2}\PYG{p}{)}\PYG{p}{,}\PYG{n}{log}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{}print(logr)}
    \PYG{k}{if} \PYG{n}{np}\PYG{o}{.}\PYG{n}{log}\PYG{p}{(}\PYG{n}{runif}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}\PYG{o}{\PYGZlt{}}\PYG{n}{logr}\PYG{p}{:}
        \PYG{n}{theta} \PYG{o}{=} \PYG{n}{theta\PYGZus{}star}
    \PYG{c+c1}{\PYGZsh{}print(theta)    }
    \PYG{n}{theta\PYGZus{}v}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{theta}\PYG{p}{)}  


\PYG{c+c1}{\PYGZsh{} In[ ]:}

\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.mlab} \PYG{k+kn}{as} \PYG{n+nn}{mlab}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib.pyplot} \PYG{k+kn}{as} \PYG{n+nn}{plt}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{figure}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplot}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{theta\PYGZus{}v}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{b\PYGZhy{}.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplot}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}bins = np.arange(0, S, 10) }
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{hist}\PYG{p}{(}\PYG{n}{theta\PYGZus{}v}\PYG{p}{,} \PYG{n}{density}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,}\PYG{n}{bins}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{auto}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{x} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{theta\PYGZus{}v}\PYG{p}{)}\PYG{p}{,}\PYG{n+nb}{max}\PYG{p}{(}\PYG{n}{theta\PYGZus{}v}\PYG{p}{)}\PYG{p}{,}\PYG{l+m+mi}{100}\PYG{p}{)} 
\PYG{n}{y} \PYG{o}{=} \PYG{n}{norm}\PYG{o}{.}\PYG{n}{pdf}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,}\PYG{n}{mu\PYGZus{}n}\PYG{p}{,}\PYG{n}{np}\PYG{o}{.}\PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{t2\PYGZus{}n}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,}\PYG{n}{y}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{y\PYGZhy{}.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlim}\PYG{p}{(}\PYG{n}{right}\PYG{o}{=}\PYG{l+m+mi}{12}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} adjust the right leaving left unchanged}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlim}\PYG{p}{(}\PYG{n}{left}\PYG{o}{=}\PYG{l+m+mi}{8}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} adjust the left leaving right unchanged}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} In[ ]:}



\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{mcmc_py}.png}
\caption{Histogram for the Metropolis algorithm with python}\label{\detokenize{mcmc:id2}}\label{\detokenize{mcmc:fig-mcmc-py}}\end{figure}

Figure. {\hyperref[\detokenize{mcmc:fig-mcmc-py}]{\sphinxcrossref{\DUrole{std,std-ref}{Histogram for the Metropolis algorithm with python}}}} shows a trace plot for this run as well as a histogram for
the Metropolis algorithm compared with a draw from the true normal density.


\subsection{PySpark results}
\label{\detokenize{mcmc:pyspark-results}}
TODO…

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{mcmc_py}.png}
\caption{Histogram for the Metropolis algorithm with PySpark}\label{\detokenize{mcmc:id3}}\label{\detokenize{mcmc:fig-mcmc-pyspark}}\end{figure}

Figure. {\hyperref[\detokenize{mcmc:fig-mcmc-pyspark}]{\sphinxcrossref{\DUrole{std,std-ref}{Histogram for the Metropolis algorithm with PySpark}}}} shows a trace plot for this run as well as a histogram for
the Metropolis algorithm compared with a draw from the true normal density.


\chapter{Neural Network}
\label{\detokenize{fnn:neural-network}}\label{\detokenize{fnn:fnn}}\label{\detokenize{fnn::doc}}
\begin{sphinxadmonition}{note}{Chinese proverb}

Sharpening the knife longer can make it easier to hack the firewood \textendash{} old Chinese proverb
\end{sphinxadmonition}


\section{Feedforward Neural Network}
\label{\detokenize{fnn:feedforward-neural-network}}

\subsection{Introduction}
\label{\detokenize{fnn:introduction}}
A feedforward neural network is an artificial neural network wherein connections between the units do not form a cycle. As such, it is different from recurrent neural networks.

The feedforward neural network was the first and simplest type of artificial neural network devised. In this network, the information moves in only one direction, forward (see Fig. {\hyperref[\detokenize{fnn:fig-fnn}]{\sphinxcrossref{\DUrole{std,std-ref}{MultiLayer Neural Network}}}}), from the input nodes, through the hidden nodes (if any) and to the output nodes. There are no cycles or loops in the network.
\begin{quote}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{fnn}.png}
\caption{MultiLayer Neural Network}\label{\detokenize{fnn:id1}}\label{\detokenize{fnn:fig-fnn}}\end{figure}
\end{quote}


\subsection{Demo}
\label{\detokenize{fnn:demo}}\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\item {} 
Set up spark context and SparkSession

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{SparkSession}

\PYG{n}{spark} \PYG{o}{=} \PYG{n}{SparkSession} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{builder} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{appName}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Python Spark Feedforward neural network example}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{config}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{spark.some.config.option}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{some\PYGZhy{}value}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYGZbs{}
    \PYG{o}{.}\PYG{n}{getOrCreate}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{1}
\item {} 
Load dataset

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}\PYG{n}{fixed}\PYG{o}{\textbar{}}\PYG{n}{volatile}\PYG{o}{\textbar{}}\PYG{n}{citric}\PYG{o}{\textbar{}}\PYG{n}{sugar}\PYG{o}{\textbar{}}\PYG{n}{chlorides}\PYG{o}{\textbar{}}\PYG{n}{free}\PYG{o}{\textbar{}}\PYG{n}{total}\PYG{o}{\textbar{}}\PYG{n}{density}\PYG{o}{\textbar{}}  \PYG{n}{pH}\PYG{o}{\textbar{}}\PYG{n}{sulphates}\PYG{o}{\textbar{}}\PYG{n}{alcohol}\PYG{o}{\textbar{}}\PYG{n}{quality}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.88}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.6}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.098}\PYG{o}{\textbar{}}\PYG{l+m+mf}{25.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{67.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9968}\PYG{o}{\textbar{}} \PYG{l+m+mf}{3.2}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.68}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.8}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.76}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.04}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{2.3}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.092}\PYG{o}{\textbar{}}\PYG{l+m+mf}{15.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{54.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.997}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.26}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.65}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}} \PYG{l+m+mf}{11.2}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.28}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.075}\PYG{o}{\textbar{}}\PYG{l+m+mf}{17.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{60.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{0.998}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.16}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.58}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.8}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{6}\PYG{o}{\textbar{}}
\PYG{o}{\textbar{}}  \PYG{l+m+mf}{7.4}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.7}\PYG{o}{\textbar{}}   \PYG{l+m+mf}{0.0}\PYG{o}{\textbar{}}  \PYG{l+m+mf}{1.9}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{0.076}\PYG{o}{\textbar{}}\PYG{l+m+mf}{11.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{34.0}\PYG{o}{\textbar{}} \PYG{l+m+mf}{0.9978}\PYG{o}{\textbar{}}\PYG{l+m+mf}{3.51}\PYG{o}{\textbar{}}     \PYG{l+m+mf}{0.56}\PYG{o}{\textbar{}}    \PYG{l+m+mf}{9.4}\PYG{o}{\textbar{}}      \PYG{l+m+mi}{5}\PYG{o}{\textbar{}}
\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{o}{+}
\PYG{n}{only} \PYG{n}{showing} \PYG{n}{top} \PYG{l+m+mi}{5} \PYG{n}{rows}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{2}
\item {} 
change categorical variable size

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Convert to float format}
\PYG{k}{def} \PYG{n+nf}{string\PYGZus{}to\PYGZus{}float}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}}
\PYG{k}{def} \PYG{n+nf}{condition}\PYG{p}{(}\PYG{n}{r}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{p}{(}\PYG{l+m+mi}{0}\PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{r} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{low}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{elif}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{o}{\PYGZlt{}} \PYG{n}{r} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{medium}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{label} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{high}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{return} \PYG{n}{label}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.functions} \PYG{k+kn}{import} \PYG{n}{udf}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql.types} \PYG{k+kn}{import} \PYG{n}{StringType}\PYG{p}{,} \PYG{n}{DoubleType}
\PYG{n}{string\PYGZus{}to\PYGZus{}float\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{n}{string\PYGZus{}to\PYGZus{}float}\PYG{p}{,} \PYG{n}{DoubleType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{quality\PYGZus{}udf} \PYG{o}{=} \PYG{n}{udf}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{condition}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{p}{,} \PYG{n}{StringType}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{df}\PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{withColumn}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{quality}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{quality\PYGZus{}udf}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{quality}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{3}
\item {} 
Convert the data to dense vector

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} convert the data to dense vector}
\PYG{k}{def} \PYG{n+nf}{transData}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{return} \PYG{n}{data}\PYG{o}{.}\PYG{n}{rdd}\PYG{o}{.}\PYG{n}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{p}{[}\PYG{n}{r}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{r}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYGZbs{}
           \PYG{n}{toDF}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{k+kn}{from} \PYG{n+nn}{pyspark.sql} \PYG{k+kn}{import} \PYG{n}{Row}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml.linalg} \PYG{k+kn}{import} \PYG{n}{Vectors}

\PYG{n}{data}\PYG{o}{=} \PYG{n}{transData}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{n}{data}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{4}
\item {} 
Split the data into training and test sets (40\% held out for testing)

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Split the data into train and test}
\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{,} \PYG{n}{testData}\PYG{p}{)} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{randomSplit}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{5}
\item {} 
Train neural network

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} specify layers for the neural network:}
\PYG{c+c1}{\PYGZsh{} input layer of size 11 (features), two intermediate of size 5 and 4}
\PYG{c+c1}{\PYGZsh{} and output of size 7 (classes)}
\PYG{n}{layers} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{3} \PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{} create the trainer and set its parameters}
\PYG{n}{FNN} \PYG{o}{=} \PYG{n}{MultilayerPerceptronClassifier}\PYG{p}{(}\PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYGZbs{}
                                     \PYG{n}{featuresCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedFeatures}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYGZbs{}
                                     \PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{n}{layers}\PYG{o}{=}\PYG{n}{layers}\PYG{p}{,} \PYGZbs{}
                                     \PYG{n}{blockSize}\PYG{o}{=}\PYG{l+m+mi}{128}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{1234}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Convert indexed labels back to original labels.}
\PYG{n}{labelConverter} \PYG{o}{=} \PYG{n}{IndexToString}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
                               \PYG{n}{labels}\PYG{o}{=}\PYG{n}{labelIndexer}\PYG{o}{.}\PYG{n}{labels}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Chain indexers and forest in a Pipeline}
\PYG{k+kn}{from} \PYG{n+nn}{pyspark.ml} \PYG{k+kn}{import} \PYG{n}{Pipeline}
\PYG{n}{pipeline} \PYG{o}{=} \PYG{n}{Pipeline}\PYG{p}{(}\PYG{n}{stages}\PYG{o}{=}\PYG{p}{[}\PYG{n}{labelIndexer}\PYG{p}{,} \PYG{n}{featureIndexer}\PYG{p}{,} \PYG{n}{FNN}\PYG{p}{,} \PYG{n}{labelConverter}\PYG{p}{]}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} train the model}
\PYG{c+c1}{\PYGZsh{} Train model.  This also runs the indexers.}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{pipeline}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{trainingData}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{6}
\item {} 
Make predictions

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Make predictions.}
\PYG{n}{predictions} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testData}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Select example rows to display.}
\PYG{n}{predictions}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{predictedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\def\theenumi{\arabic{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
Evaluation

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Select (prediction, true label) and compute test error}
\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{MulticlassClassificationEvaluator}\PYG{p}{(}
    \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexedLabel}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{metricName}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{accuracy}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{accuracy} \PYG{o}{=} \PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{predictions}\PYG{p}{)}
\PYG{k}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Predictions accuracy = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{, Test Error = }\PYG{l+s+si}{\PYGZpc{}g}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{n}{accuracy}\PYG{p}{,}\PYG{p}{(}\PYG{l+m+mf}{1.0} \PYG{o}{\PYGZhy{}} \PYG{n}{accuracy}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}


\chapter{My PySpark Package}
\label{\detokenize{pack:my-pyspark-package}}\label{\detokenize{pack:pack}}\label{\detokenize{pack::doc}}
It’s super easy to wrap your own package in Python. I packed some functions which I frequently
used in my daily work. You can download and install it from \sphinxhref{https://github.com/runawayhorse001/PySparkTools}{My PySpark Package}. The hierarchical
structure and the directory structure of this package are as follows.


\section{Hierarchical Structure}
\label{\detokenize{pack:hierarchical-structure}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} build
\PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} bdist.linux\PYGZhy{}x86\PYGZus{}64
\PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} lib.linux\PYGZhy{}x86\PYGZus{}64\PYGZhy{}2.7
\PYG{p}{\textbar{}}       \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} PySparkTools
\PYG{p}{\textbar{}}           \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} \PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}.py
\PYG{p}{\textbar{}}           \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} Manipulation
\PYG{p}{\textbar{}}           \PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} DataManipulation.py
\PYG{p}{\textbar{}}           \PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} \PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}.py
\PYG{p}{\textbar{}}           \PYG{p}{\textbar{}}── Visualization
\PYG{p}{\textbar{}}               \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} \PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}.py
│               \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} PyPlots.py
\PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} dist
│   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} PySParkTools\PYGZhy{}1.0\PYGZhy{}py2.7.egg
\PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} \PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}.py
\PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} PySparkTools
\PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} \PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}.py
\PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} Manipulation
\PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} DataManipulation.py
\PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} \PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}.py
\PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} Visualization
\PYG{p}{\textbar{}}       \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} \PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}.py
\PYG{p}{\textbar{}}       \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} PyPlots.py
│       \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} PyPlots.pyc
\PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} PySParkTools.egg\PYGZhy{}info
\PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} dependency\PYGZus{}links.txt
\PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} PKG\PYGZhy{}INFO
\PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} requires.txt
\PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} SOURCES.txt
\PYG{p}{\textbar{}}   \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} top\PYGZus{}level.txt
\PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} README.md
\PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} requirements.txt
\PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} setup.py
\PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} \PYG{n+nb}{test}
    \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} spark\PYGZhy{}warehouse
    \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} test1.py
    \PYG{p}{\textbar{}}\PYGZhy{}\PYGZhy{} test2.py
\end{sphinxVerbatim}

From the above hierarchical structure, you will find that you have to have \sphinxcode{\sphinxupquote{\_\_init\_\_.py}} in each directory. I will explain the \sphinxcode{\sphinxupquote{\_\_init\_\_.py}} file with the example below:


\section{Set Up}
\label{\detokenize{pack:set-up}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{setuptools} \PYG{k+kn}{import} \PYG{n}{setup}\PYG{p}{,} \PYG{n}{find\PYGZus{}packages}

\PYG{k}{try}\PYG{p}{:}
    \PYG{k}{with} \PYG{n+nb}{open}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{README.md}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{k}{as} \PYG{n}{f}\PYG{p}{:}
        \PYG{n}{long\PYGZus{}description} \PYG{o}{=} \PYG{n}{f}\PYG{o}{.}\PYG{n}{read}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{except} \PYG{n+ne}{IOError}\PYG{p}{:}
    \PYG{n}{long\PYGZus{}description} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdq{}}

\PYG{k}{try}\PYG{p}{:}
    \PYG{k}{with} \PYG{n+nb}{open}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{requirements.txt}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{k}{as} \PYG{n}{f}\PYG{p}{:}
        \PYG{n}{requirements} \PYG{o}{=} \PYG{p}{[}\PYG{n}{x}\PYG{o}{.}\PYG{n}{strip}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n}{f}\PYG{o}{.}\PYG{n}{read}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{splitlines}\PYG{p}{(}\PYG{p}{)} \PYG{k}{if} \PYG{n}{x}\PYG{o}{.}\PYG{n}{strip}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}
\PYG{k}{except} \PYG{n+ne}{IOError}\PYG{p}{:}
    \PYG{n}{requirements} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{n}{setup}\PYG{p}{(}\PYG{n}{name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{PySParkTools}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
          \PYG{n}{install\PYGZus{}requires}\PYG{o}{=}\PYG{n}{requirements}\PYG{p}{,}
      \PYG{n}{version}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1.0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
      \PYG{n}{description}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Python Spark Tools}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
      \PYG{n}{author}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Wenqiang Feng}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
      \PYG{n}{author\PYGZus{}email}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{von198@gmail.com}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
      \PYG{n}{url}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https://github.com/runawayhorse001/PySparkTools}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
      \PYG{n}{packages}\PYG{o}{=}\PYG{n}{find\PYGZus{}packages}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
      \PYG{n}{long\PYGZus{}description}\PYG{o}{=}\PYG{n}{long\PYGZus{}description}
     \PYG{p}{)}
\end{sphinxVerbatim}


\section{ReadMe}
\label{\detokenize{pack:readme}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} PySparkTools}

This is my PySpark Tools. If you want to colne and install it, you can use

\PYGZhy{} clone

\PYG{l+s+sb}{{}`}\PYG{l+s+sb}{{}`}\PYG{l+s+sb}{{}`}\PYG{o}{\PYGZob{}}bash\PYG{o}{\PYGZcb{}}
git clone git@github.com:runawayhorse001/PySparkTools.git
\PYG{l+s+sb}{{}`}\PYG{l+s+sb}{{}`}\PYG{l+s+sb}{{}`}
\PYGZhy{} install

\PYG{l+s+sb}{{}`}\PYG{l+s+sb}{{}`}\PYG{l+s+sb}{{}`}\PYG{o}{\PYGZob{}}bash\PYG{o}{\PYGZcb{}}
\PYG{n+nb}{cd} PySparkTools
pip install \PYGZhy{}r requirements.txt
python setup.py install
\PYG{l+s+sb}{{}`}\PYG{l+s+sb}{{}`}\PYG{l+s+sb}{{}`}

\PYGZhy{} \PYG{n+nb}{test}

\PYG{l+s+sb}{{}`}\PYG{l+s+sb}{{}`}\PYG{l+s+sb}{{}`}\PYG{o}{\PYGZob{}}bash\PYG{o}{\PYGZcb{}}
\PYG{n+nb}{cd} PySparkTools/test
python test1.py
\PYG{l+s+sb}{{}`}\PYG{l+s+sb}{{}`}\PYG{l+s+sb}{{}`}
\end{sphinxVerbatim}


\chapter{My Cheat Sheet}
\label{\detokenize{cheat:my-cheat-sheet}}\label{\detokenize{cheat:cheat}}\label{\detokenize{cheat::doc}}
You can download the PDF version: \sphinxhref{https://github.com/runawayhorse001/CheatSheet/blob/master/cheatSheet\_pyspark.pdf}{PySpark Cheat Sheet}  and \sphinxhref{https://github.com/runawayhorse001/CheatSheet/blob/master/cheatSheet\_pdrdd.pdf}{pdDataFrame vs rddDataFrame}.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{cheatSheet_pyspark1}.jpg}
\end{figure}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{cheatSheet_pyspark2}.jpg}
\end{figure}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{cheatSheet_pdrdd}.jpg}
\end{figure}


\chapter{PySpark API}
\label{\detokenize{api:pyspark-api}}\label{\detokenize{api:api}}\label{\detokenize{api::doc}}
Those APIs are automatically generated from \sphinxcode{\sphinxupquote{PySpark}} package, so all the CopyRights belong to Spark.


\section{Stat API}
\label{\detokenize{api:module-pyspark.ml.stat}}\label{\detokenize{api:stat-api}}\index{pyspark.ml.stat (module)@\spxentry{pyspark.ml.stat}\spxextra{module}}\index{ChiSquareTest (class in pyspark.ml.stat)@\spxentry{ChiSquareTest}\spxextra{class in pyspark.ml.stat}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.ChiSquareTest}}\pysigline{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.stat.}}\sphinxbfcode{\sphinxupquote{ChiSquareTest}}}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Conduct Pearson’s independence test for every feature against the label. For each feature,
the (feature, label) pairs are converted into a contingency matrix for which the Chi-squared
statistic is computed. All label and feature values must be categorical.

The null hypothesis is that the occurrence of the outcomes is statistically independent.

\DUrole{versionmodified}{New in version 2.2.0.}
\index{test() (pyspark.ml.stat.ChiSquareTest static method)@\spxentry{test()}\spxextra{pyspark.ml.stat.ChiSquareTest static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.ChiSquareTest.test}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{test}}}{\emph{dataset}, \emph{featuresCol}, \emph{labelCol}}{}
Perform a Pearson’s independence test using dataset.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode\begin{itemize}
\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{dataset}} \textendash{} DataFrame of categorical labels and categorical features.
Real-valued features will be treated as categorical for each distinct value.

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{featuresCol}} \textendash{} Name of features column in dataset, of type \(Vector\) (\(VectorUDT\)).

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{labelCol}} \textendash{} Name of label column in dataset, of any numerical type.

\end{itemize}

\item[{Returns}] \leavevmode
DataFrame containing the test result for every feature against the label.
This DataFrame will contain a single Row with the following fields:
- \(pValues: Vector\)
- \(degreesOfFreedom: Array[Int]\)
- \(statistics: Vector\)
Each of these fields has one value per feature.

\end{description}\end{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{stat} \PYG{k}{import} \PYG{n}{ChiSquareTest}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
\PYG{g+gp}{... }           \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
\PYG{g+gp}{... }           \PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
\PYG{g+gp}{... }           \PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{chiSqResult} \PYG{o}{=} \PYG{n}{ChiSquareTest}\PYG{o}{.}\PYG{n}{test}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{chiSqResult}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{degreesOfFreedom}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{g+go}{Row(degreesOfFreedom=[3, 1, 0])}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{Correlation (class in pyspark.ml.stat)@\spxentry{Correlation}\spxextra{class in pyspark.ml.stat}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.Correlation}}\pysigline{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.stat.}}\sphinxbfcode{\sphinxupquote{Correlation}}}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Compute the correlation matrix for the input dataset of Vectors using the specified method.
Methods currently supported: \(pearson\) (default), \(spearman\).

\begin{sphinxadmonition}{note}{Note:}
For Spearman, a rank correlation, we need to create an RDD{[}Double{]} for each column
and sort it in order to retrieve the ranks and then join the columns back into an RDD{[}Vector{]},
which is fairly costly. Cache the input Dataset before calling corr with \(method = 'spearman'\)
to avoid recomputing the common lineage.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.2.0.}
\index{corr() (pyspark.ml.stat.Correlation static method)@\spxentry{corr()}\spxextra{pyspark.ml.stat.Correlation static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.Correlation.corr}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{corr}}}{\emph{dataset}, \emph{column}, \emph{method='pearson'}}{}
Compute the correlation matrix with specified method using dataset.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode\begin{itemize}
\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{dataset}} \textendash{} A Dataset or a DataFrame.

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{column}} \textendash{} The name of the column of vectors for which the correlation coefficient needs
to be computed. This must be a column of the dataset, and it must contain
Vector objects.

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{method}} \textendash{} String specifying the method to use for computing correlation.
Supported: \(pearson\) (default), \(spearman\).

\end{itemize}

\item[{Returns}] \leavevmode
A DataFrame that contains the correlation matrix of the column of vectors. This
DataFrame contains a single row and a single column of name
‘\$METHODNAME(\$COLUMN)’.

\end{description}\end{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{stat} \PYG{k}{import} \PYG{n}{Correlation}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{p}{[}\PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
\PYG{g+gp}{... }           \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
\PYG{g+gp}{... }           \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{6}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
\PYG{g+gp}{... }           \PYG{p}{[}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{9}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{pearsonCorr} \PYG{o}{=} \PYG{n}{Correlation}\PYG{o}{.}\PYG{n}{corr}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{pearson}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{print}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{pearsonCorr}\PYG{p}{)}\PYG{o}{.}\PYG{n}{replace}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nan}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NaN}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{DenseMatrix([[ 1.        ,  0.0556...,         NaN,  0.4004...],}
\PYG{g+go}{             [ 0.0556...,  1.        ,         NaN,  0.9135...],}
\PYG{g+go}{             [        NaN,         NaN,  1.        ,         NaN],}
\PYG{g+go}{             [ 0.4004...,  0.9135...,         NaN,  1.        ]])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{spearmanCorr} \PYG{o}{=} \PYG{n}{Correlation}\PYG{o}{.}\PYG{n}{corr}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{features}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{spearman}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{print}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{spearmanCorr}\PYG{p}{)}\PYG{o}{.}\PYG{n}{replace}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nan}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{NaN}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{DenseMatrix([[ 1.        ,  0.1054...,         NaN,  0.4       ],}
\PYG{g+go}{             [ 0.1054...,  1.        ,         NaN,  0.9486... ],}
\PYG{g+go}{             [        NaN,         NaN,  1.        ,         NaN],}
\PYG{g+go}{             [ 0.4       ,  0.9486... ,         NaN,  1.        ]])}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{KolmogorovSmirnovTest (class in pyspark.ml.stat)@\spxentry{KolmogorovSmirnovTest}\spxextra{class in pyspark.ml.stat}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.KolmogorovSmirnovTest}}\pysigline{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.stat.}}\sphinxbfcode{\sphinxupquote{KolmogorovSmirnovTest}}}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Conduct the two-sided Kolmogorov Smirnov (KS) test for data sampled from a continuous
distribution.

By comparing the largest difference between the empirical cumulative
distribution of the sample data and the theoretical distribution we can provide a test for the
the null hypothesis that the sample data comes from that theoretical distribution.

\DUrole{versionmodified}{New in version 2.4.0.}
\index{test() (pyspark.ml.stat.KolmogorovSmirnovTest static method)@\spxentry{test()}\spxextra{pyspark.ml.stat.KolmogorovSmirnovTest static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.KolmogorovSmirnovTest.test}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{test}}}{\emph{dataset}, \emph{sampleCol}, \emph{distName}, \emph{*params}}{}
Conduct a one-sample, two-sided Kolmogorov-Smirnov test for probability distribution
equality. Currently supports the normal distribution, taking as parameters the mean and
standard deviation.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode\begin{itemize}
\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{dataset}} \textendash{} a Dataset or a DataFrame containing the sample of data to test.

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{sampleCol}} \textendash{} Name of sample column in dataset, of any numerical type.

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{distName}} \textendash{} a \(string\) name for a theoretical distribution, currently only support “norm”.

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{params}} \textendash{} a list of \(Double\) values specifying the parameters to be used for the theoretical
distribution. For “norm” distribution, the parameters includes mean and variance.

\end{itemize}

\item[{Returns}] \leavevmode
A DataFrame that contains the Kolmogorov-Smirnov test result for the input sampled data.
This DataFrame will contain a single Row with the following fields:
- \(pValue: Double\)
- \(statistic: Double\)

\end{description}\end{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{stat} \PYG{k}{import} \PYG{n}{KolmogorovSmirnovTest}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{p}{[}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sample}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ksResult} \PYG{o}{=} \PYG{n}{KolmogorovSmirnovTest}\PYG{o}{.}\PYG{n}{test}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sample}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{norm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{first}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{round}\PYG{p}{(}\PYG{n}{ksResult}\PYG{o}{.}\PYG{n}{pValue}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{round}\PYG{p}{(}\PYG{n}{ksResult}\PYG{o}{.}\PYG{n}{statistic}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{g+go}{0.175}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{p}{[}\PYG{p}{[}\PYG{l+m+mf}{2.0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{3.0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{4.0}\PYG{p}{]}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sample}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ksResult} \PYG{o}{=} \PYG{n}{KolmogorovSmirnovTest}\PYG{o}{.}\PYG{n}{test}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sample}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{norm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+m+mf}{3.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{first}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{round}\PYG{p}{(}\PYG{n}{ksResult}\PYG{o}{.}\PYG{n}{pValue}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{round}\PYG{p}{(}\PYG{n}{ksResult}\PYG{o}{.}\PYG{n}{statistic}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{g+go}{0.175}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{Summarizer (class in pyspark.ml.stat)@\spxentry{Summarizer}\spxextra{class in pyspark.ml.stat}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.Summarizer}}\pysigline{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.stat.}}\sphinxbfcode{\sphinxupquote{Summarizer}}}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Tools for vectorized statistics on MLlib Vectors.
The methods in this package provide various statistics for Vectors contained inside DataFrames.
This class lets users pick the statistics they would like to extract for a given column.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{stat} \PYG{k}{import} \PYG{n}{Summarizer}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{sql} \PYG{k}{import} \PYG{n}{Row}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{summarizer} \PYG{o}{=} \PYG{n}{Summarizer}\PYG{o}{.}\PYG{n}{metrics}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{mean}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{count}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}\PYG{n}{Row}\PYG{p}{(}\PYG{n}{weight}\PYG{o}{=}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }                     \PYG{n}{Row}\PYG{p}{(}\PYG{n}{weight}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{l+m+mf}{3.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{summarizer}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{n}{df}\PYG{o}{.}\PYG{n}{features}\PYG{p}{,} \PYG{n}{df}\PYG{o}{.}\PYG{n}{weight}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{n}{truncate}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}aggregate\PYGZus{}metrics(features, weight)\textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}[[1.0,1.0,1.0], 1]                 \textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\PYGZlt{}BLANKLINE\PYGZgt{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{summarizer}\PYG{o}{.}\PYG{n}{summary}\PYG{p}{(}\PYG{n}{df}\PYG{o}{.}\PYG{n}{features}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{n}{truncate}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}aggregate\PYGZus{}metrics(features, 1.0)\textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}[[1.0,1.5,2.0], 2]              \textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\PYGZlt{}BLANKLINE\PYGZgt{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{Summarizer}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{df}\PYG{o}{.}\PYG{n}{features}\PYG{p}{,} \PYG{n}{df}\PYG{o}{.}\PYG{n}{weight}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{n}{truncate}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}mean(features)\textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}[1.0,1.0,1.0] \textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\PYGZlt{}BLANKLINE\PYGZgt{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{n}{Summarizer}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{df}\PYG{o}{.}\PYG{n}{features}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{n}{truncate}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}mean(features)\textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}[1.0,1.5,2.0] \textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\PYGZlt{}BLANKLINE\PYGZgt{}}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.4.0.}
\index{count() (pyspark.ml.stat.Summarizer static method)@\spxentry{count()}\spxextra{pyspark.ml.stat.Summarizer static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.Summarizer.count}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{count}}}{\emph{col}, \emph{weightCol=None}}{}
return a column of count summary

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{max() (pyspark.ml.stat.Summarizer static method)@\spxentry{max()}\spxextra{pyspark.ml.stat.Summarizer static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.Summarizer.max}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{max}}}{\emph{col}, \emph{weightCol=None}}{}
return a column of max summary

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{mean() (pyspark.ml.stat.Summarizer static method)@\spxentry{mean()}\spxextra{pyspark.ml.stat.Summarizer static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.Summarizer.mean}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{mean}}}{\emph{col}, \emph{weightCol=None}}{}
return a column of mean summary

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{metrics() (pyspark.ml.stat.Summarizer static method)@\spxentry{metrics()}\spxextra{pyspark.ml.stat.Summarizer static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.Summarizer.metrics}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{metrics}}}{\emph{*metrics}}{}
Given a list of metrics, provides a builder that it turns computes metrics from a column.

See the documentation of {[}{[}Summarizer{]}{]} for an example.
\begin{description}
\item[{The following metrics are accepted (case sensitive):}] \leavevmode\begin{itemize}
\item {} 
mean: a vector that contains the coefficient-wise mean.

\item {} 
variance: a vector tha contains the coefficient-wise variance.

\item {} 
count: the count of all vectors seen.

\item {} 
numNonzeros: a vector with the number of non-zeros for each coefficients

\item {} 
max: the maximum for each coefficient.

\item {} 
min: the minimum for each coefficient.

\item {} 
normL2: the Euclidian norm for each coefficient.

\item {} 
normL1: the L1 norm of each coefficient (sum of the absolute values).

\end{itemize}

\end{description}
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{metrics}} \textendash{} metrics that can be provided.

\item[{Returns}] \leavevmode
an object of {\hyperref[\detokenize{api:pyspark.ml.stat.SummaryBuilder}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{pyspark.ml.stat.SummaryBuilder}}}}}

\end{description}\end{quote}

Note: Currently, the performance of this interface is about 2x\textasciitilde{}3x slower then using the RDD
interface.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{min() (pyspark.ml.stat.Summarizer static method)@\spxentry{min()}\spxextra{pyspark.ml.stat.Summarizer static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.Summarizer.min}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{min}}}{\emph{col}, \emph{weightCol=None}}{}
return a column of min summary

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{normL1() (pyspark.ml.stat.Summarizer static method)@\spxentry{normL1()}\spxextra{pyspark.ml.stat.Summarizer static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.Summarizer.normL1}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{normL1}}}{\emph{col}, \emph{weightCol=None}}{}
return a column of normL1 summary

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{normL2() (pyspark.ml.stat.Summarizer static method)@\spxentry{normL2()}\spxextra{pyspark.ml.stat.Summarizer static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.Summarizer.normL2}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{normL2}}}{\emph{col}, \emph{weightCol=None}}{}
return a column of normL2 summary

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{numNonZeros() (pyspark.ml.stat.Summarizer static method)@\spxentry{numNonZeros()}\spxextra{pyspark.ml.stat.Summarizer static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.Summarizer.numNonZeros}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{numNonZeros}}}{\emph{col}, \emph{weightCol=None}}{}
return a column of numNonZero summary

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{variance() (pyspark.ml.stat.Summarizer static method)@\spxentry{variance()}\spxextra{pyspark.ml.stat.Summarizer static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.Summarizer.variance}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{variance}}}{\emph{col}, \emph{weightCol=None}}{}
return a column of variance summary

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{SummaryBuilder (class in pyspark.ml.stat)@\spxentry{SummaryBuilder}\spxextra{class in pyspark.ml.stat}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.SummaryBuilder}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.stat.}}\sphinxbfcode{\sphinxupquote{SummaryBuilder}}}{\emph{jSummaryBuilder}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

A builder object that provides summary statistics about a given column.

Users should not directly create such builders, but instead use one of the methods in
{\hyperref[\detokenize{api:pyspark.ml.stat.Summarizer}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{pyspark.ml.stat.Summarizer}}}}}

\DUrole{versionmodified}{New in version 2.4.0.}
\index{summary() (pyspark.ml.stat.SummaryBuilder method)@\spxentry{summary()}\spxextra{pyspark.ml.stat.SummaryBuilder method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.stat.SummaryBuilder.summary}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{summary}}}{\emph{featuresCol}, \emph{weightCol=None}}{}
Returns an aggregate object that contains the summary of the column with the requested
metrics.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode\begin{itemize}
\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{featuresCol}} \textendash{} a column that contains features Vector object.

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{weightCol}} \textendash{} a column that contains weight value. Default weight is 1.0.

\end{itemize}

\item[{Returns}] \leavevmode
an aggregate column that contains the statistics. The exact content of this
structure is determined during the creation of the builder.

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}


\end{fulllineitems}



\section{Regression API}
\label{\detokenize{api:module-pyspark.ml.regression}}\label{\detokenize{api:regression-api}}\index{pyspark.ml.regression (module)@\spxentry{pyspark.ml.regression}\spxextra{module}}\index{AFTSurvivalRegression (class in pyspark.ml.regression)@\spxentry{AFTSurvivalRegression}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegression}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{AFTSurvivalRegression}}}{\emph{featuresCol='features', labelCol='label', predictionCol='prediction', fitIntercept=True, maxIter=100, tol=1e-06, censorCol='censor', quantileProbabilities={[}0.01, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.99{]}, quantilesCol=None, aggregationDepth=2}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Accelerated Failure Time (AFT) Model Survival Regression

Fit a parametric AFT survival regression model based on the Weibull distribution
of the survival time.


\sphinxstrong{See also:}


\sphinxhref{https://en.wikipedia.org/wiki/Accelerated\_failure\_time\_model}{AFT Model}



\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1e\PYGZhy{}40}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{censor}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{aftsr} \PYG{o}{=} \PYG{n}{AFTSurvivalRegression}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{aftsr}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{predict}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{6.3}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{predictQuantiles}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{6.3}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{DenseVector([0.0101, 0.0513, 0.1054, 0.2877, 0.6931, 1.3863, 2.3026, 2.9957, 4.6052])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}  label\textbar{} features\textbar{}censor\textbar{}prediction\textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}    1.0\textbar{}    [1.0]\textbar{}   1.0\textbar{}       1.0\textbar{}}
\PYG{g+go}{\textbar{}1.0E\PYGZhy{}40\textbar{}(1,[],[])\textbar{}   0.0\textbar{}       1.0\textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+gp}{...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{aftsr\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/aftsr}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{aftsr}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{aftsr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{aftsr2} \PYG{o}{=} \PYG{n}{AFTSurvivalRegression}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{aftsr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{aftsr2}\PYG{o}{.}\PYG{n}{getMaxIter}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{100}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/aftsr\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{AFTSurvivalRegressionModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{coefficients} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{coefficients}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{intercept} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{intercept}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{scale} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{scale}
\PYG{g+go}{True}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.6.0.}
\index{getCensorCol() (pyspark.ml.regression.AFTSurvivalRegression method)@\spxentry{getCensorCol()}\spxextra{pyspark.ml.regression.AFTSurvivalRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegression.getCensorCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getCensorCol}}}{}{}
Gets the value of censorCol or its default value.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{getQuantileProbabilities() (pyspark.ml.regression.AFTSurvivalRegression method)@\spxentry{getQuantileProbabilities()}\spxextra{pyspark.ml.regression.AFTSurvivalRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegression.getQuantileProbabilities}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getQuantileProbabilities}}}{}{}
Gets the value of quantileProbabilities or its default value.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{getQuantilesCol() (pyspark.ml.regression.AFTSurvivalRegression method)@\spxentry{getQuantilesCol()}\spxextra{pyspark.ml.regression.AFTSurvivalRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegression.getQuantilesCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getQuantilesCol}}}{}{}
Gets the value of quantilesCol or its default value.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{setCensorCol() (pyspark.ml.regression.AFTSurvivalRegression method)@\spxentry{setCensorCol()}\spxextra{pyspark.ml.regression.AFTSurvivalRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegression.setCensorCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setCensorCol}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{censorCol}}.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.regression.AFTSurvivalRegression method)@\spxentry{setParams()}\spxextra{pyspark.ml.regression.AFTSurvivalRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegression.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{featuresCol='features', labelCol='label', predictionCol='prediction', fitIntercept=True, maxIter=100, tol=1e-06, censorCol='censor', quantileProbabilities={[}0.01, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.99{]}, quantilesCol=None, aggregationDepth=2}}{}
setParams(self, featuresCol=”features”, labelCol=”label”, predictionCol=”prediction”,                   fitIntercept=True, maxIter=100, tol=1E-6, censorCol=”censor”,                   quantileProbabilities={[}0.01, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.99{]},                   quantilesCol=None, aggregationDepth=2):

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{setQuantileProbabilities() (pyspark.ml.regression.AFTSurvivalRegression method)@\spxentry{setQuantileProbabilities()}\spxextra{pyspark.ml.regression.AFTSurvivalRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegression.setQuantileProbabilities}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setQuantileProbabilities}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{quantileProbabilities}}.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{setQuantilesCol() (pyspark.ml.regression.AFTSurvivalRegression method)@\spxentry{setQuantilesCol()}\spxextra{pyspark.ml.regression.AFTSurvivalRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegression.setQuantilesCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setQuantilesCol}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{quantilesCol}}.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{AFTSurvivalRegressionModel (class in pyspark.ml.regression)@\spxentry{AFTSurvivalRegressionModel}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegressionModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{AFTSurvivalRegressionModel}}}{\emph{java\_model=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Model fitted by {\hyperref[\detokenize{api:pyspark.ml.regression.AFTSurvivalRegression}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{AFTSurvivalRegression}}}}}.

\DUrole{versionmodified}{New in version 1.6.0.}
\index{coefficients (pyspark.ml.regression.AFTSurvivalRegressionModel attribute)@\spxentry{coefficients}\spxextra{pyspark.ml.regression.AFTSurvivalRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegressionModel.coefficients}}\pysigline{\sphinxbfcode{\sphinxupquote{coefficients}}}
Model coefficients.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{intercept (pyspark.ml.regression.AFTSurvivalRegressionModel attribute)@\spxentry{intercept}\spxextra{pyspark.ml.regression.AFTSurvivalRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegressionModel.intercept}}\pysigline{\sphinxbfcode{\sphinxupquote{intercept}}}
Model intercept.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{predict() (pyspark.ml.regression.AFTSurvivalRegressionModel method)@\spxentry{predict()}\spxextra{pyspark.ml.regression.AFTSurvivalRegressionModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegressionModel.predict}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{predict}}}{\emph{features}}{}
Predicted value

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{predictQuantiles() (pyspark.ml.regression.AFTSurvivalRegressionModel method)@\spxentry{predictQuantiles()}\spxextra{pyspark.ml.regression.AFTSurvivalRegressionModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegressionModel.predictQuantiles}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{predictQuantiles}}}{\emph{features}}{}
Predicted Quantiles

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{scale (pyspark.ml.regression.AFTSurvivalRegressionModel attribute)@\spxentry{scale}\spxextra{pyspark.ml.regression.AFTSurvivalRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.AFTSurvivalRegressionModel.scale}}\pysigline{\sphinxbfcode{\sphinxupquote{scale}}}
Model scale parameter.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{DecisionTreeRegressor (class in pyspark.ml.regression)@\spxentry{DecisionTreeRegressor}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.DecisionTreeRegressor}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{DecisionTreeRegressor}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{maxDepth=5}, \emph{maxBins=32}, \emph{minInstancesPerNode=1}, \emph{minInfoGain=0.0}, \emph{maxMemoryInMB=256}, \emph{cacheNodeIds=False}, \emph{checkpointInterval=10}, \emph{impurity='variance'}, \emph{seed=None}, \emph{varianceCol=None}}{}
\sphinxhref{http://en.wikipedia.org/wiki/Decision\_tree\_learning}{Decision tree}
learning algorithm for regression.
It supports both continuous and categorical features.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dt} \PYG{o}{=} \PYG{n}{DecisionTreeRegressor}\PYG{p}{(}\PYG{n}{maxDepth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{varianceCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{variance}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{dt}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{depth}
\PYG{g+go}{1}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numNodes}
\PYG{g+go}{3}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{featureImportances}
\PYG{g+go}{SparseVector(1, \PYGZob{}0: 1.0\PYGZcb{})}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numFeatures}
\PYG{g+go}{1}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test0} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{0.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test1} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dtr\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/dtr}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dt}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{dtr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dt2} \PYG{o}{=} \PYG{n}{DecisionTreeRegressor}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{dtr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dt2}\PYG{o}{.}\PYG{n}{getMaxDepth}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/dtr\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{DecisionTreeRegressionModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numNodes} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{numNodes}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{depth} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{depth}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{variance}
\PYG{g+go}{0.0}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.4.0.}
\index{setParams() (pyspark.ml.regression.DecisionTreeRegressor method)@\spxentry{setParams()}\spxextra{pyspark.ml.regression.DecisionTreeRegressor method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.DecisionTreeRegressor.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{featuresCol="features"}, \emph{labelCol="label"}, \emph{predictionCol="prediction"}, \emph{maxDepth=5}, \emph{maxBins=32}, \emph{minInstancesPerNode=1}, \emph{minInfoGain=0.0}, \emph{maxMemoryInMB=256}, \emph{cacheNodeIds=False}, \emph{checkpointInterval=10}, \emph{impurity="variance"}, \emph{seed=None}, \emph{varianceCol=None}}{}
Sets params for the DecisionTreeRegressor.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{DecisionTreeRegressionModel (class in pyspark.ml.regression)@\spxentry{DecisionTreeRegressionModel}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.DecisionTreeRegressionModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{DecisionTreeRegressionModel}}}{\emph{java\_model=None}}{}
Model fitted by {\hyperref[\detokenize{api:pyspark.ml.regression.DecisionTreeRegressor}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{DecisionTreeRegressor}}}}}.

\DUrole{versionmodified}{New in version 1.4.0.}
\index{featureImportances (pyspark.ml.regression.DecisionTreeRegressionModel attribute)@\spxentry{featureImportances}\spxextra{pyspark.ml.regression.DecisionTreeRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.DecisionTreeRegressionModel.featureImportances}}\pysigline{\sphinxbfcode{\sphinxupquote{featureImportances}}}
Estimate of the importance of each feature.

This generalizes the idea of “Gini” importance to other losses,
following the explanation of Gini importance from “Random Forests” documentation
by Leo Breiman and Adele Cutler, and following the implementation from scikit-learn.
\begin{description}
\item[{This feature importance is calculated as follows:}] \leavevmode\begin{itemize}
\item {} 
importance(feature j) = sum (over nodes which split on feature j) of the gain,
where gain is scaled by the number of instances passing through node

\item {} 
Normalize importances for tree to sum to 1.

\end{itemize}

\end{description}

\begin{sphinxadmonition}{note}{Note:}
Feature importance for single decision trees can have high variance due to
correlated predictor variables. Consider using a {\hyperref[\detokenize{api:pyspark.ml.regression.RandomForestRegressor}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{RandomForestRegressor}}}}}
to determine feature importance instead.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{GBTRegressor (class in pyspark.ml.regression)@\spxentry{GBTRegressor}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GBTRegressor}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{GBTRegressor}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{maxDepth=5}, \emph{maxBins=32}, \emph{minInstancesPerNode=1}, \emph{minInfoGain=0.0}, \emph{maxMemoryInMB=256}, \emph{cacheNodeIds=False}, \emph{subsamplingRate=1.0}, \emph{checkpointInterval=10}, \emph{lossType='squared'}, \emph{maxIter=20}, \emph{stepSize=0.1}, \emph{seed=None}, \emph{impurity='variance'}, \emph{featureSubsetStrategy='all'}}{}
\sphinxhref{http://en.wikipedia.org/wiki/Gradient\_boosting}{Gradient-Boosted Trees (GBTs)}
learning algorithm for regression.
It supports both continuous and categorical features.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{numpy} \PYG{k}{import} \PYG{n}{allclose}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gbt} \PYG{o}{=} \PYG{n}{GBTRegressor}\PYG{p}{(}\PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{maxDepth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{42}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{gbt}\PYG{o}{.}\PYG{n}{getImpurity}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{variance}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{gbt}\PYG{o}{.}\PYG{n}{getFeatureSubsetStrategy}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{all}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{gbt}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{featureImportances}
\PYG{g+go}{SparseVector(1, \PYGZob{}0: 1.0\PYGZcb{})}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numFeatures}
\PYG{g+go}{1}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{allclose}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{treeWeights}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{l+m+mf}{0.1}\PYG{p}{]}\PYG{p}{)}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test0} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{0.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test1} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gbtr\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{gbtr}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gbt}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{gbtr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gbt2} \PYG{o}{=} \PYG{n}{GBTRegressor}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{gbtr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gbt2}\PYG{o}{.}\PYG{n}{getMaxDepth}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{gbtr\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{GBTRegressionModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{featureImportances} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{featureImportances}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{treeWeights} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{treeWeights}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{trees}
\PYG{g+go}{[DecisionTreeRegressionModel (uid=...) of depth..., DecisionTreeRegressionModel...]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{validation} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
\PYG{g+gp}{... }             \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{evaluateEachIteration}\PYG{p}{(}\PYG{n}{validation}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{squared}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+go}{[0.0, 0.0, 0.0, 0.0, 0.0]}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.4.0.}
\index{getLossType() (pyspark.ml.regression.GBTRegressor method)@\spxentry{getLossType()}\spxextra{pyspark.ml.regression.GBTRegressor method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GBTRegressor.getLossType}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getLossType}}}{}{}
Gets the value of lossType or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setFeatureSubsetStrategy() (pyspark.ml.regression.GBTRegressor method)@\spxentry{setFeatureSubsetStrategy()}\spxextra{pyspark.ml.regression.GBTRegressor method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GBTRegressor.setFeatureSubsetStrategy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setFeatureSubsetStrategy}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{featureSubsetStrategy}}.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{setLossType() (pyspark.ml.regression.GBTRegressor method)@\spxentry{setLossType()}\spxextra{pyspark.ml.regression.GBTRegressor method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GBTRegressor.setLossType}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setLossType}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{lossType}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.regression.GBTRegressor method)@\spxentry{setParams()}\spxextra{pyspark.ml.regression.GBTRegressor method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GBTRegressor.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{featuresCol="features"}, \emph{labelCol="label"}, \emph{predictionCol="prediction"}, \emph{maxDepth=5}, \emph{maxBins=32}, \emph{minInstancesPerNode=1}, \emph{minInfoGain=0.0}, \emph{maxMemoryInMB=256}, \emph{cacheNodeIds=False}, \emph{subsamplingRate=1.0}, \emph{checkpointInterval=10}, \emph{lossType="squared"}, \emph{maxIter=20}, \emph{stepSize=0.1}, \emph{seed=None}, \emph{impurity="variance"}, \emph{featureSubsetStrategy="all"}}{}
Sets params for Gradient Boosted Tree Regression.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{GBTRegressionModel (class in pyspark.ml.regression)@\spxentry{GBTRegressionModel}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GBTRegressionModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{GBTRegressionModel}}}{\emph{java\_model=None}}{}
Model fitted by {\hyperref[\detokenize{api:pyspark.ml.regression.GBTRegressor}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{GBTRegressor}}}}}.

\DUrole{versionmodified}{New in version 1.4.0.}
\index{evaluateEachIteration() (pyspark.ml.regression.GBTRegressionModel method)@\spxentry{evaluateEachIteration()}\spxextra{pyspark.ml.regression.GBTRegressionModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GBTRegressionModel.evaluateEachIteration}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{evaluateEachIteration}}}{\emph{dataset}, \emph{loss}}{}
Method to compute error or loss for every iteration of gradient boosting.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode\begin{itemize}
\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{dataset}} \textendash{} Test dataset to evaluate model on, where dataset is an
instance of \sphinxcode{\sphinxupquote{pyspark.sql.DataFrame}}

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{loss}} \textendash{} The loss function used to compute error.
Supported options: squared, absolute

\end{itemize}

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{featureImportances (pyspark.ml.regression.GBTRegressionModel attribute)@\spxentry{featureImportances}\spxextra{pyspark.ml.regression.GBTRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GBTRegressionModel.featureImportances}}\pysigline{\sphinxbfcode{\sphinxupquote{featureImportances}}}
Estimate of the importance of each feature.

Each feature’s importance is the average of its importance across all trees in the ensemble
The importance vector is normalized to sum to 1. This method is suggested by Hastie et al.
(Hastie, Tibshirani, Friedman. “The Elements of Statistical Learning, 2nd Edition.” 2001.)
and follows the implementation from scikit-learn.


\sphinxstrong{See also:}


{\hyperref[\detokenize{api:pyspark.ml.regression.DecisionTreeRegressionModel.featureImportances}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{DecisionTreeRegressionModel.featureImportances}}}}}



\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{trees (pyspark.ml.regression.GBTRegressionModel attribute)@\spxentry{trees}\spxextra{pyspark.ml.regression.GBTRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GBTRegressionModel.trees}}\pysigline{\sphinxbfcode{\sphinxupquote{trees}}}
These have null parent Estimators.

\DUrole{versionmodified}{New in version 2.0.0.}
\begin{quote}\begin{description}
\item[{Type}] \leavevmode
Trees in this ensemble. Warning

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}

\index{GeneralizedLinearRegression (class in pyspark.ml.regression)@\spxentry{GeneralizedLinearRegression}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{GeneralizedLinearRegression}}}{\emph{labelCol='label'}, \emph{featuresCol='features'}, \emph{predictionCol='prediction'}, \emph{family='gaussian'}, \emph{link=None}, \emph{fitIntercept=True}, \emph{maxIter=25}, \emph{tol=1e-06}, \emph{regParam=0.0}, \emph{weightCol=None}, \emph{solver='irls'}, \emph{linkPredictionCol=None}, \emph{variancePower=0.0}, \emph{linkPower=None}, \emph{offsetCol=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Generalized Linear Regression.

Fit a Generalized Linear Model specified by giving a symbolic description of the linear
predictor (link function) and a description of the error distribution (family). It supports
“gaussian”, “binomial”, “poisson”, “gamma” and “tweedie” as family. Valid link functions for
each family is listed below. The first link function of each family is the default one.
\begin{itemize}
\item {} 
“gaussian” -\textgreater{} “identity”, “log”, “inverse”

\item {} 
“binomial” -\textgreater{} “logit”, “probit”, “cloglog”

\item {} 
“poisson”  -\textgreater{} “log”, “identity”, “sqrt”

\item {} 
“gamma”    -\textgreater{} “inverse”, “identity”, “log”

\item {} 
“tweedie”  -\textgreater{} power link function specified through “linkPower”.                     The default link power in the tweedie family is 1 - variancePower.

\end{itemize}


\sphinxstrong{See also:}


\sphinxhref{https://en.wikipedia.org/wiki/Generalized\_linear\_model}{GLM}



\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{2.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{glr} \PYG{o}{=} \PYG{n}{GeneralizedLinearRegression}\PYG{p}{(}\PYG{n}{family}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{gaussian}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{link}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{identity}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{linkPredictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{p}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{glr}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{transformed} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction} \PYG{o}{\PYGZhy{}} \PYG{l+m+mf}{1.5}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mf}{0.001}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{transformed}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{p} \PYG{o}{\PYGZhy{}} \PYG{l+m+mf}{1.5}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mf}{0.001}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{coefficients}
\PYG{g+go}{DenseVector([1.5..., \PYGZhy{}1.0...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numFeatures}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{intercept} \PYG{o}{\PYGZhy{}} \PYG{l+m+mf}{1.5}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mf}{0.001}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{glr\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/glr}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{glr}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{glr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{glr2} \PYG{o}{=} \PYG{n}{GeneralizedLinearRegression}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{glr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{glr}\PYG{o}{.}\PYG{n}{getFamily}\PYG{p}{(}\PYG{p}{)} \PYG{o}{==} \PYG{n}{glr2}\PYG{o}{.}\PYG{n}{getFamily}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/glr\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{GeneralizedLinearRegressionModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{intercept} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{intercept}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{coefficients}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{coefficients}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{g+go}{True}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}
\index{getFamily() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{getFamily()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.getFamily}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getFamily}}}{}{}
Gets the value of family or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getLink() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{getLink()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.getLink}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getLink}}}{}{}
Gets the value of link or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getLinkPower() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{getLinkPower()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.getLinkPower}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getLinkPower}}}{}{}
Gets the value of linkPower or its default value.

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}

\index{getLinkPredictionCol() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{getLinkPredictionCol()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.getLinkPredictionCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getLinkPredictionCol}}}{}{}
Gets the value of linkPredictionCol or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getOffsetCol() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{getOffsetCol()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.getOffsetCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getOffsetCol}}}{}{}
Gets the value of offsetCol or its default value.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{getVariancePower() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{getVariancePower()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.getVariancePower}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getVariancePower}}}{}{}
Gets the value of variancePower or its default value.

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}

\index{setFamily() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{setFamily()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.setFamily}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setFamily}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{family}}.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setLink() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{setLink()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.setLink}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setLink}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{link}}.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setLinkPower() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{setLinkPower()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.setLinkPower}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setLinkPower}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{linkPower}}.

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}

\index{setLinkPredictionCol() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{setLinkPredictionCol()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.setLinkPredictionCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setLinkPredictionCol}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{linkPredictionCol}}.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setOffsetCol() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{setOffsetCol()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.setOffsetCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setOffsetCol}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{offsetCol}}.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{setParams()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{labelCol="label"}, \emph{featuresCol="features"}, \emph{predictionCol="prediction"}, \emph{family="gaussian"}, \emph{link=None}, \emph{fitIntercept=True}, \emph{maxIter=25}, \emph{tol=1e-6}, \emph{regParam=0.0}, \emph{weightCol=None}, \emph{solver="irls"}, \emph{linkPredictionCol=None}, \emph{variancePower=0.0}, \emph{linkPower=None}, \emph{offsetCol=None}}{}
Sets params for generalized linear regression.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setVariancePower() (pyspark.ml.regression.GeneralizedLinearRegression method)@\spxentry{setVariancePower()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression.setVariancePower}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setVariancePower}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{variancePower}}.

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{GeneralizedLinearRegressionModel (class in pyspark.ml.regression)@\spxentry{GeneralizedLinearRegressionModel}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{GeneralizedLinearRegressionModel}}}{\emph{java\_model=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Model fitted by {\hyperref[\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegression}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{GeneralizedLinearRegression}}}}}.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{coefficients (pyspark.ml.regression.GeneralizedLinearRegressionModel attribute)@\spxentry{coefficients}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionModel.coefficients}}\pysigline{\sphinxbfcode{\sphinxupquote{coefficients}}}
Model coefficients.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{evaluate() (pyspark.ml.regression.GeneralizedLinearRegressionModel method)@\spxentry{evaluate()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionModel.evaluate}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{evaluate}}}{\emph{dataset}}{}
Evaluates the model on a test dataset.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{dataset}} \textendash{} Test dataset to evaluate model on, where dataset is an
instance of \sphinxcode{\sphinxupquote{pyspark.sql.DataFrame}}

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{hasSummary (pyspark.ml.regression.GeneralizedLinearRegressionModel attribute)@\spxentry{hasSummary}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionModel.hasSummary}}\pysigline{\sphinxbfcode{\sphinxupquote{hasSummary}}}
Indicates whether a training summary exists for this model
instance.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{intercept (pyspark.ml.regression.GeneralizedLinearRegressionModel attribute)@\spxentry{intercept}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionModel.intercept}}\pysigline{\sphinxbfcode{\sphinxupquote{intercept}}}
Model intercept.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{summary (pyspark.ml.regression.GeneralizedLinearRegressionModel attribute)@\spxentry{summary}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionModel.summary}}\pysigline{\sphinxbfcode{\sphinxupquote{summary}}}
Gets summary (e.g. residuals, deviance, pValues) of model on
training set. An exception is thrown if
\(trainingSummary is None\).

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{GeneralizedLinearRegressionSummary (class in pyspark.ml.regression)@\spxentry{GeneralizedLinearRegressionSummary}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{GeneralizedLinearRegressionSummary}}}{\emph{java\_obj=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Generalized linear regression results evaluated on a dataset.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{aic (pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute)@\spxentry{aic}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.aic}}\pysigline{\sphinxbfcode{\sphinxupquote{aic}}}
Akaike’s “An Information Criterion”(AIC) for the fitted model.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{degreesOfFreedom (pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute)@\spxentry{degreesOfFreedom}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.degreesOfFreedom}}\pysigline{\sphinxbfcode{\sphinxupquote{degreesOfFreedom}}}
Degrees of freedom.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{deviance (pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute)@\spxentry{deviance}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.deviance}}\pysigline{\sphinxbfcode{\sphinxupquote{deviance}}}
The deviance for the fitted model.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{dispersion (pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute)@\spxentry{dispersion}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.dispersion}}\pysigline{\sphinxbfcode{\sphinxupquote{dispersion}}}
The dispersion of the fitted model.
It is taken as 1.0 for the “binomial” and “poisson” families, and otherwise
estimated by the residual Pearson’s Chi-Squared statistic (which is defined as
sum of the squares of the Pearson residuals) divided by the residual degrees of freedom.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{nullDeviance (pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute)@\spxentry{nullDeviance}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.nullDeviance}}\pysigline{\sphinxbfcode{\sphinxupquote{nullDeviance}}}
The deviance for the null model.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{numInstances (pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute)@\spxentry{numInstances}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.numInstances}}\pysigline{\sphinxbfcode{\sphinxupquote{numInstances}}}
Number of instances in DataFrame predictions.

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}

\index{predictionCol (pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute)@\spxentry{predictionCol}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.predictionCol}}\pysigline{\sphinxbfcode{\sphinxupquote{predictionCol}}}
Field in {\hyperref[\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.predictions}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{predictions}}}}} which gives the predicted value of each instance.
This is set to a new column name if the original model’s \(predictionCol\) is not set.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{predictions (pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute)@\spxentry{predictions}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.predictions}}\pysigline{\sphinxbfcode{\sphinxupquote{predictions}}}
Predictions output by the model’s \(transform\) method.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{rank (pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute)@\spxentry{rank}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.rank}}\pysigline{\sphinxbfcode{\sphinxupquote{rank}}}
The numeric rank of the fitted linear model.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{residualDegreeOfFreedom (pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute)@\spxentry{residualDegreeOfFreedom}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.residualDegreeOfFreedom}}\pysigline{\sphinxbfcode{\sphinxupquote{residualDegreeOfFreedom}}}
The residual degrees of freedom.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{residualDegreeOfFreedomNull (pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute)@\spxentry{residualDegreeOfFreedomNull}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.residualDegreeOfFreedomNull}}\pysigline{\sphinxbfcode{\sphinxupquote{residualDegreeOfFreedomNull}}}
The residual degrees of freedom for the null model.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{residuals() (pyspark.ml.regression.GeneralizedLinearRegressionSummary method)@\spxentry{residuals()}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionSummary method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionSummary.residuals}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{residuals}}}{\emph{residualsType='deviance'}}{}
Get the residuals of the fitted model by type.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{residualsType}} \textendash{} The type of residuals which should be returned.
Supported options: deviance (default), pearson, working, and response.

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{GeneralizedLinearRegressionTrainingSummary (class in pyspark.ml.regression)@\spxentry{GeneralizedLinearRegressionTrainingSummary}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{GeneralizedLinearRegressionTrainingSummary}}}{\emph{java\_obj=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Generalized linear regression training results.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{coefficientStandardErrors (pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary attribute)@\spxentry{coefficientStandardErrors}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary.coefficientStandardErrors}}\pysigline{\sphinxbfcode{\sphinxupquote{coefficientStandardErrors}}}
Standard error of estimated coefficients and intercept.

If \sphinxcode{\sphinxupquote{GeneralizedLinearRegression.fitIntercept}} is set to True,
then the last element returned corresponds to the intercept.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{numIterations (pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary attribute)@\spxentry{numIterations}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary.numIterations}}\pysigline{\sphinxbfcode{\sphinxupquote{numIterations}}}
Number of training iterations.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{pValues (pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary attribute)@\spxentry{pValues}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary.pValues}}\pysigline{\sphinxbfcode{\sphinxupquote{pValues}}}
Two-sided p-value of estimated coefficients and intercept.

If \sphinxcode{\sphinxupquote{GeneralizedLinearRegression.fitIntercept}} is set to True,
then the last element returned corresponds to the intercept.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{solver (pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary attribute)@\spxentry{solver}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary.solver}}\pysigline{\sphinxbfcode{\sphinxupquote{solver}}}
The numeric solver used for training.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{tValues (pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary attribute)@\spxentry{tValues}\spxextra{pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.GeneralizedLinearRegressionTrainingSummary.tValues}}\pysigline{\sphinxbfcode{\sphinxupquote{tValues}}}
T-statistic of estimated coefficients and intercept.

If \sphinxcode{\sphinxupquote{GeneralizedLinearRegression.fitIntercept}} is set to True,
then the last element returned corresponds to the intercept.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{IsotonicRegression (class in pyspark.ml.regression)@\spxentry{IsotonicRegression}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.IsotonicRegression}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{IsotonicRegression}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{weightCol=None}, \emph{isotonic=True}, \emph{featureIndex=0}}{}
Currently implemented using parallelized pool adjacent violators algorithm.
Only univariate (single feature) algorithm supported.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ir} \PYG{o}{=} \PYG{n}{IsotonicRegression}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{ir}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test0} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{0.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{boundaries}
\PYG{g+go}{DenseVector([0.0, 1.0])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ir\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/ir}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ir}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{ir\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ir2} \PYG{o}{=} \PYG{n}{IsotonicRegression}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{ir\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ir2}\PYG{o}{.}\PYG{n}{getIsotonic}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/ir\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{IsotonicRegressionModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{boundaries} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{boundaries}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{predictions} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{predictions}
\PYG{g+go}{True}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.6.0.}
\index{getFeatureIndex() (pyspark.ml.regression.IsotonicRegression method)@\spxentry{getFeatureIndex()}\spxextra{pyspark.ml.regression.IsotonicRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.IsotonicRegression.getFeatureIndex}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getFeatureIndex}}}{}{}
Gets the value of featureIndex or its default value.

\end{fulllineitems}

\index{getIsotonic() (pyspark.ml.regression.IsotonicRegression method)@\spxentry{getIsotonic()}\spxextra{pyspark.ml.regression.IsotonicRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.IsotonicRegression.getIsotonic}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getIsotonic}}}{}{}
Gets the value of isotonic or its default value.

\end{fulllineitems}

\index{setFeatureIndex() (pyspark.ml.regression.IsotonicRegression method)@\spxentry{setFeatureIndex()}\spxextra{pyspark.ml.regression.IsotonicRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.IsotonicRegression.setFeatureIndex}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setFeatureIndex}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{featureIndex}}.

\end{fulllineitems}

\index{setIsotonic() (pyspark.ml.regression.IsotonicRegression method)@\spxentry{setIsotonic()}\spxextra{pyspark.ml.regression.IsotonicRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.IsotonicRegression.setIsotonic}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setIsotonic}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{isotonic}}.

\end{fulllineitems}

\index{setParams() (pyspark.ml.regression.IsotonicRegression method)@\spxentry{setParams()}\spxextra{pyspark.ml.regression.IsotonicRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.IsotonicRegression.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{weightCol=None}, \emph{isotonic=True}, \emph{featureIndex=0}}{}
setParams(self, featuresCol=”features”, labelCol=”label”, predictionCol=”prediction”,                  weightCol=None, isotonic=True, featureIndex=0):
Set the params for IsotonicRegression.

\end{fulllineitems}


\end{fulllineitems}

\index{IsotonicRegressionModel (class in pyspark.ml.regression)@\spxentry{IsotonicRegressionModel}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.IsotonicRegressionModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{IsotonicRegressionModel}}}{\emph{java\_model=None}}{}
Model fitted by {\hyperref[\detokenize{api:pyspark.ml.regression.IsotonicRegression}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{IsotonicRegression}}}}}.

\DUrole{versionmodified}{New in version 1.6.0.}
\index{boundaries (pyspark.ml.regression.IsotonicRegressionModel attribute)@\spxentry{boundaries}\spxextra{pyspark.ml.regression.IsotonicRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.IsotonicRegressionModel.boundaries}}\pysigline{\sphinxbfcode{\sphinxupquote{boundaries}}}
Boundaries in increasing order for which predictions are known.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{predictions (pyspark.ml.regression.IsotonicRegressionModel attribute)@\spxentry{predictions}\spxextra{pyspark.ml.regression.IsotonicRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.IsotonicRegressionModel.predictions}}\pysigline{\sphinxbfcode{\sphinxupquote{predictions}}}
Predictions associated with the boundaries at the same index, monotone because of isotonic
regression.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{LinearRegression (class in pyspark.ml.regression)@\spxentry{LinearRegression}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegression}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{LinearRegression}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{maxIter=100}, \emph{regParam=0.0}, \emph{elasticNetParam=0.0}, \emph{tol=1e-06}, \emph{fitIntercept=True}, \emph{standardization=True}, \emph{solver='auto'}, \emph{weightCol=None}, \emph{aggregationDepth=2}, \emph{loss='squaredError'}, \emph{epsilon=1.35}}{}
Linear regression.

The learning objective is to minimize the specified loss function, with regularization.
This supports two kinds of loss:
\begin{itemize}
\item {} 
squaredError (a.k.a squared loss)

\item {} 
huber (a hybrid of squared error for relatively small errors and absolute error for     relatively large ones, and we estimate the scale parameter from training data)

\end{itemize}

This supports multiple types of regularization:
\begin{itemize}
\item {} 
none (a.k.a. ordinary least squares)

\item {} 
L2 (ridge regression)

\item {} 
L1 (Lasso)

\item {} 
L2 + L1 (elastic net)

\end{itemize}

Note: Fitting with huber loss only supports none and L2 regularization.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{weight}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr} \PYG{o}{=} \PYG{n}{LinearRegression}\PYG{p}{(}\PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{regParam}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{solver}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{normal}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{weightCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{weight}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test0} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction} \PYG{o}{\PYGZhy{}} \PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mf}{0.001}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{coefficients}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{l+m+mf}{1.0}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mf}{0.001}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{intercept} \PYG{o}{\PYGZhy{}} \PYG{l+m+mf}{0.0}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mf}{0.001}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test1} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction} \PYG{o}{\PYGZhy{}} \PYG{l+m+mf}{1.0}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mf}{0.001}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr}\PYG{o}{.}\PYG{n}{setParams}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{vector}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gt}{Traceback (most recent call last):}
    \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}
\PYG{g+gr}{TypeError}: \PYG{n}{Method setParams forces keyword arguments.}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/lr}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{lr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr2} \PYG{o}{=} \PYG{n}{LinearRegression}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{lr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr2}\PYG{o}{.}\PYG{n}{getMaxIter}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{5}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/lr\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{LinearRegressionModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{coefficients}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{coefficients}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{intercept} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{intercept}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numFeatures}
\PYG{g+go}{1}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{pmml}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.4.0.}
\index{getEpsilon() (pyspark.ml.regression.LinearRegression method)@\spxentry{getEpsilon()}\spxextra{pyspark.ml.regression.LinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegression.getEpsilon}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getEpsilon}}}{}{}
Gets the value of epsilon or its default value.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{setEpsilon() (pyspark.ml.regression.LinearRegression method)@\spxentry{setEpsilon()}\spxextra{pyspark.ml.regression.LinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegression.setEpsilon}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setEpsilon}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{epsilon}}.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.regression.LinearRegression method)@\spxentry{setParams()}\spxextra{pyspark.ml.regression.LinearRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegression.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{featuresCol="features"}, \emph{labelCol="label"}, \emph{predictionCol="prediction"}, \emph{maxIter=100}, \emph{regParam=0.0}, \emph{elasticNetParam=0.0}, \emph{tol=1e-6}, \emph{fitIntercept=True}, \emph{standardization=True}, \emph{solver="auto"}, \emph{weightCol=None}, \emph{aggregationDepth=2}, \emph{loss="squaredError"}, \emph{epsilon=1.35}}{}
Sets params for linear regression.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{LinearRegressionModel (class in pyspark.ml.regression)@\spxentry{LinearRegressionModel}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{LinearRegressionModel}}}{\emph{java\_model=None}}{}
Model fitted by {\hyperref[\detokenize{api:pyspark.ml.regression.LinearRegression}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{LinearRegression}}}}}.

\DUrole{versionmodified}{New in version 1.4.0.}
\index{coefficients (pyspark.ml.regression.LinearRegressionModel attribute)@\spxentry{coefficients}\spxextra{pyspark.ml.regression.LinearRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionModel.coefficients}}\pysigline{\sphinxbfcode{\sphinxupquote{coefficients}}}
Model coefficients.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{evaluate() (pyspark.ml.regression.LinearRegressionModel method)@\spxentry{evaluate()}\spxextra{pyspark.ml.regression.LinearRegressionModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionModel.evaluate}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{evaluate}}}{\emph{dataset}}{}
Evaluates the model on a test dataset.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{dataset}} \textendash{} Test dataset to evaluate model on, where dataset is an
instance of \sphinxcode{\sphinxupquote{pyspark.sql.DataFrame}}

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{hasSummary (pyspark.ml.regression.LinearRegressionModel attribute)@\spxentry{hasSummary}\spxextra{pyspark.ml.regression.LinearRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionModel.hasSummary}}\pysigline{\sphinxbfcode{\sphinxupquote{hasSummary}}}
Indicates whether a training summary exists for this model
instance.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{intercept (pyspark.ml.regression.LinearRegressionModel attribute)@\spxentry{intercept}\spxextra{pyspark.ml.regression.LinearRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionModel.intercept}}\pysigline{\sphinxbfcode{\sphinxupquote{intercept}}}
Model intercept.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{scale (pyspark.ml.regression.LinearRegressionModel attribute)@\spxentry{scale}\spxextra{pyspark.ml.regression.LinearRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionModel.scale}}\pysigline{\sphinxbfcode{\sphinxupquote{scale}}}
The value by which \(\|y - X'w\|\) is scaled down when loss is “huber”, otherwise 1.0.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{summary (pyspark.ml.regression.LinearRegressionModel attribute)@\spxentry{summary}\spxextra{pyspark.ml.regression.LinearRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionModel.summary}}\pysigline{\sphinxbfcode{\sphinxupquote{summary}}}
Gets summary (e.g. residuals, mse, r-squared ) of model on
training set. An exception is thrown if
\(trainingSummary is None\).

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{LinearRegressionSummary (class in pyspark.ml.regression)@\spxentry{LinearRegressionSummary}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{LinearRegressionSummary}}}{\emph{java\_obj=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Linear regression results evaluated on a dataset.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{coefficientStandardErrors (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{coefficientStandardErrors}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.coefficientStandardErrors}}\pysigline{\sphinxbfcode{\sphinxupquote{coefficientStandardErrors}}}
Standard error of estimated coefficients and intercept.
This value is only available when using the “normal” solver.

If \sphinxcode{\sphinxupquote{LinearRegression.fitIntercept}} is set to True,
then the last element returned corresponds to the intercept.


\sphinxstrong{See also:}


\sphinxcode{\sphinxupquote{LinearRegression.solver}}



\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{degreesOfFreedom (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{degreesOfFreedom}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.degreesOfFreedom}}\pysigline{\sphinxbfcode{\sphinxupquote{degreesOfFreedom}}}
Degrees of freedom.

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}

\index{devianceResiduals (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{devianceResiduals}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.devianceResiduals}}\pysigline{\sphinxbfcode{\sphinxupquote{devianceResiduals}}}
The weighted residuals, the usual residuals rescaled by the
square root of the instance weights.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{explainedVariance (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{explainedVariance}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.explainedVariance}}\pysigline{\sphinxbfcode{\sphinxupquote{explainedVariance}}}
Returns the explained variance regression score.
explainedVariance = \(1 - \frac{variance(y - \hat{y})}{variance(y)}\)


\sphinxstrong{See also:}


\sphinxhref{http://en.wikipedia.org/wiki/Explained\_variation}{Wikipedia explain variation}



\begin{sphinxadmonition}{note}{Note:}
This ignores instance weights (setting all to 1.0) from
\(LinearRegression.weightCol\). This will change in later Spark
versions.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{featuresCol (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{featuresCol}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.featuresCol}}\pysigline{\sphinxbfcode{\sphinxupquote{featuresCol}}}
Field in “predictions” which gives the features of each instance
as a vector.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{labelCol (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{labelCol}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.labelCol}}\pysigline{\sphinxbfcode{\sphinxupquote{labelCol}}}
Field in “predictions” which gives the true label of each
instance.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{meanAbsoluteError (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{meanAbsoluteError}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.meanAbsoluteError}}\pysigline{\sphinxbfcode{\sphinxupquote{meanAbsoluteError}}}
Returns the mean absolute error, which is a risk function
corresponding to the expected value of the absolute error
loss or l1-norm loss.

\begin{sphinxadmonition}{note}{Note:}
This ignores instance weights (setting all to 1.0) from
\(LinearRegression.weightCol\). This will change in later Spark
versions.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{meanSquaredError (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{meanSquaredError}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.meanSquaredError}}\pysigline{\sphinxbfcode{\sphinxupquote{meanSquaredError}}}
Returns the mean squared error, which is a risk function
corresponding to the expected value of the squared error
loss or quadratic loss.

\begin{sphinxadmonition}{note}{Note:}
This ignores instance weights (setting all to 1.0) from
\(LinearRegression.weightCol\). This will change in later Spark
versions.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{numInstances (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{numInstances}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.numInstances}}\pysigline{\sphinxbfcode{\sphinxupquote{numInstances}}}
Number of instances in DataFrame predictions

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{pValues (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{pValues}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.pValues}}\pysigline{\sphinxbfcode{\sphinxupquote{pValues}}}
Two-sided p-value of estimated coefficients and intercept.
This value is only available when using the “normal” solver.

If \sphinxcode{\sphinxupquote{LinearRegression.fitIntercept}} is set to True,
then the last element returned corresponds to the intercept.


\sphinxstrong{See also:}


\sphinxcode{\sphinxupquote{LinearRegression.solver}}



\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{predictionCol (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{predictionCol}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.predictionCol}}\pysigline{\sphinxbfcode{\sphinxupquote{predictionCol}}}
Field in “predictions” which gives the predicted value of
the label at each instance.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{predictions (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{predictions}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.predictions}}\pysigline{\sphinxbfcode{\sphinxupquote{predictions}}}
Dataframe outputted by the model’s \(transform\) method.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{r2 (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{r2}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.r2}}\pysigline{\sphinxbfcode{\sphinxupquote{r2}}}
Returns R\textasciicircum{}2, the coefficient of determination.


\sphinxstrong{See also:}


\sphinxhref{http://en.wikipedia.org/wiki/Coefficient\_of\_determination}{Wikipedia coefficient of determination}



\begin{sphinxadmonition}{note}{Note:}
This ignores instance weights (setting all to 1.0) from
\(LinearRegression.weightCol\). This will change in later Spark
versions.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{r2adj (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{r2adj}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.r2adj}}\pysigline{\sphinxbfcode{\sphinxupquote{r2adj}}}
Returns Adjusted R\textasciicircum{}2, the adjusted coefficient of determination.


\sphinxstrong{See also:}


\sphinxhref{https://en.wikipedia.org/wiki/Coefficient\_of\_determination\#Adjusted\_R2}{Wikipedia coefficient of determination, Adjusted R\textasciicircum{}2}



\begin{sphinxadmonition}{note}{Note:}
This ignores instance weights (setting all to 1.0) from
\(LinearRegression.weightCol\). This will change in later Spark versions.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{residuals (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{residuals}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.residuals}}\pysigline{\sphinxbfcode{\sphinxupquote{residuals}}}
Residuals (label - predicted value)

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{rootMeanSquaredError (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{rootMeanSquaredError}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.rootMeanSquaredError}}\pysigline{\sphinxbfcode{\sphinxupquote{rootMeanSquaredError}}}
Returns the root mean squared error, which is defined as the
square root of the mean squared error.

\begin{sphinxadmonition}{note}{Note:}
This ignores instance weights (setting all to 1.0) from
\(LinearRegression.weightCol\). This will change in later Spark
versions.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{tValues (pyspark.ml.regression.LinearRegressionSummary attribute)@\spxentry{tValues}\spxextra{pyspark.ml.regression.LinearRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionSummary.tValues}}\pysigline{\sphinxbfcode{\sphinxupquote{tValues}}}
T-statistic of estimated coefficients and intercept.
This value is only available when using the “normal” solver.

If \sphinxcode{\sphinxupquote{LinearRegression.fitIntercept}} is set to True,
then the last element returned corresponds to the intercept.


\sphinxstrong{See also:}


\sphinxcode{\sphinxupquote{LinearRegression.solver}}



\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{LinearRegressionTrainingSummary (class in pyspark.ml.regression)@\spxentry{LinearRegressionTrainingSummary}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionTrainingSummary}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{LinearRegressionTrainingSummary}}}{\emph{java\_obj=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Linear regression training results. Currently, the training summary ignores the
training weights except for the objective trace.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{objectiveHistory (pyspark.ml.regression.LinearRegressionTrainingSummary attribute)@\spxentry{objectiveHistory}\spxextra{pyspark.ml.regression.LinearRegressionTrainingSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionTrainingSummary.objectiveHistory}}\pysigline{\sphinxbfcode{\sphinxupquote{objectiveHistory}}}
Objective function (scaled loss + regularization) at each
iteration.
This value is only available when using the “l-bfgs” solver.


\sphinxstrong{See also:}


\sphinxcode{\sphinxupquote{LinearRegression.solver}}



\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{totalIterations (pyspark.ml.regression.LinearRegressionTrainingSummary attribute)@\spxentry{totalIterations}\spxextra{pyspark.ml.regression.LinearRegressionTrainingSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.LinearRegressionTrainingSummary.totalIterations}}\pysigline{\sphinxbfcode{\sphinxupquote{totalIterations}}}
Number of training iterations until termination.
This value is only available when using the “l-bfgs” solver.


\sphinxstrong{See also:}


\sphinxcode{\sphinxupquote{LinearRegression.solver}}



\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{RandomForestRegressor (class in pyspark.ml.regression)@\spxentry{RandomForestRegressor}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.RandomForestRegressor}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{RandomForestRegressor}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{maxDepth=5}, \emph{maxBins=32}, \emph{minInstancesPerNode=1}, \emph{minInfoGain=0.0}, \emph{maxMemoryInMB=256}, \emph{cacheNodeIds=False}, \emph{checkpointInterval=10}, \emph{impurity='variance'}, \emph{subsamplingRate=1.0}, \emph{seed=None}, \emph{numTrees=20}, \emph{featureSubsetStrategy='auto'}}{}
\sphinxhref{http://en.wikipedia.org/wiki/Random\_forest}{Random Forest}
learning algorithm for regression.
It supports both continuous and categorical features.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{numpy} \PYG{k}{import} \PYG{n}{allclose}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rf} \PYG{o}{=} \PYG{n}{RandomForestRegressor}\PYG{p}{(}\PYG{n}{numTrees}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{maxDepth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{42}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{rf}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{featureImportances}
\PYG{g+go}{SparseVector(1, \PYGZob{}0: 1.0\PYGZcb{})}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{allclose}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{treeWeights}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test0} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{0.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numFeatures}
\PYG{g+go}{1}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{trees}
\PYG{g+go}{[DecisionTreeRegressionModel (uid=...) of depth..., DecisionTreeRegressionModel...]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{getNumTrees}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test1} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{0.5}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rfr\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/rfr}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rf}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{rfr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rf2} \PYG{o}{=} \PYG{n}{RandomForestRegressor}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{rfr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rf2}\PYG{o}{.}\PYG{n}{getNumTrees}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/rfr\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{RandomForestRegressionModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{featureImportances} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{featureImportances}
\PYG{g+go}{True}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.4.0.}
\index{setFeatureSubsetStrategy() (pyspark.ml.regression.RandomForestRegressor method)@\spxentry{setFeatureSubsetStrategy()}\spxextra{pyspark.ml.regression.RandomForestRegressor method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.RandomForestRegressor.setFeatureSubsetStrategy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setFeatureSubsetStrategy}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{featureSubsetStrategy}}.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.regression.RandomForestRegressor method)@\spxentry{setParams()}\spxextra{pyspark.ml.regression.RandomForestRegressor method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.RandomForestRegressor.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{featuresCol="features"}, \emph{labelCol="label"}, \emph{predictionCol="prediction"}, \emph{maxDepth=5}, \emph{maxBins=32}, \emph{minInstancesPerNode=1}, \emph{minInfoGain=0.0}, \emph{maxMemoryInMB=256}, \emph{cacheNodeIds=False}, \emph{checkpointInterval=10}, \emph{impurity="variance"}, \emph{subsamplingRate=1.0}, \emph{seed=None}, \emph{numTrees=20}, \emph{featureSubsetStrategy="auto"}}{}
Sets params for linear regression.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{RandomForestRegressionModel (class in pyspark.ml.regression)@\spxentry{RandomForestRegressionModel}\spxextra{class in pyspark.ml.regression}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.RandomForestRegressionModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.regression.}}\sphinxbfcode{\sphinxupquote{RandomForestRegressionModel}}}{\emph{java\_model=None}}{}
Model fitted by {\hyperref[\detokenize{api:pyspark.ml.regression.RandomForestRegressor}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{RandomForestRegressor}}}}}.

\DUrole{versionmodified}{New in version 1.4.0.}
\index{featureImportances (pyspark.ml.regression.RandomForestRegressionModel attribute)@\spxentry{featureImportances}\spxextra{pyspark.ml.regression.RandomForestRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.RandomForestRegressionModel.featureImportances}}\pysigline{\sphinxbfcode{\sphinxupquote{featureImportances}}}
Estimate of the importance of each feature.

Each feature’s importance is the average of its importance across all trees in the ensemble
The importance vector is normalized to sum to 1. This method is suggested by Hastie et al.
(Hastie, Tibshirani, Friedman. “The Elements of Statistical Learning, 2nd Edition.” 2001.)
and follows the implementation from scikit-learn.


\sphinxstrong{See also:}


{\hyperref[\detokenize{api:pyspark.ml.regression.DecisionTreeRegressionModel.featureImportances}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{DecisionTreeRegressionModel.featureImportances}}}}}



\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{trees (pyspark.ml.regression.RandomForestRegressionModel attribute)@\spxentry{trees}\spxextra{pyspark.ml.regression.RandomForestRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.regression.RandomForestRegressionModel.trees}}\pysigline{\sphinxbfcode{\sphinxupquote{trees}}}
These have null parent Estimators.

\DUrole{versionmodified}{New in version 2.0.0.}
\begin{quote}\begin{description}
\item[{Type}] \leavevmode
Trees in this ensemble. Warning

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}



\section{Classification API}
\label{\detokenize{api:module-pyspark.ml.classification}}\label{\detokenize{api:classification-api}}\index{pyspark.ml.classification (module)@\spxentry{pyspark.ml.classification}\spxextra{module}}\index{LinearSVC (class in pyspark.ml.classification)@\spxentry{LinearSVC}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LinearSVC}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{LinearSVC}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{maxIter=100}, \emph{regParam=0.0}, \emph{tol=1e-06}, \emph{rawPredictionCol='rawPrediction'}, \emph{fitIntercept=True}, \emph{standardization=True}, \emph{threshold=0.0}, \emph{weightCol=None}, \emph{aggregationDepth=2}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

\sphinxhref{https://en.wikipedia.org/wiki/Support\_vector\_machine\#Linear\_SVM}{Linear SVM Classifier}

This binary classifier optimizes the Hinge Loss using the OWLQN optimizer.
Only supports L2 regularization currently.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{sql} \PYG{k}{import} \PYG{n}{Row}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{n}{Row}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{n}{Row}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{l+m+mf}{3.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{svm} \PYG{o}{=} \PYG{n}{LinearSVC}\PYG{p}{(}\PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{regParam}\PYG{o}{=}\PYG{l+m+mf}{0.01}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{svm}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{coefficients}
\PYG{g+go}{DenseVector([0.0, \PYGZhy{}0.2792, \PYGZhy{}0.1833])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{intercept}
\PYG{g+go}{1.0206118982229047}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numClasses}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numFeatures}
\PYG{g+go}{3}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test0} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}\PYG{n}{Row}\PYG{p}{(}\PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{rawPrediction}
\PYG{g+go}{DenseVector([\PYGZhy{}1.4831, 1.4831])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{svm\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/svm}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{svm}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{svm\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{svm2} \PYG{o}{=} \PYG{n}{LinearSVC}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{svm\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{svm2}\PYG{o}{.}\PYG{n}{getMaxIter}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{5}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/svm\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{LinearSVCModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{coefficients}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{coefficients}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{intercept} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{intercept}
\PYG{g+go}{True}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.2.0.}
\index{setParams() (pyspark.ml.classification.LinearSVC method)@\spxentry{setParams()}\spxextra{pyspark.ml.classification.LinearSVC method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LinearSVC.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{maxIter=100}, \emph{regParam=0.0}, \emph{tol=1e-06}, \emph{rawPredictionCol='rawPrediction'}, \emph{fitIntercept=True}, \emph{standardization=True}, \emph{threshold=0.0}, \emph{weightCol=None}, \emph{aggregationDepth=2}}{}
setParams(self, featuresCol=”features”, labelCol=”label”, predictionCol=”prediction”,                   maxIter=100, regParam=0.0, tol=1e-6, rawPredictionCol=”rawPrediction”,                   fitIntercept=True, standardization=True, threshold=0.0, weightCol=None,                   aggregationDepth=2):
Sets params for Linear SVM Classifier.

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{LinearSVCModel (class in pyspark.ml.classification)@\spxentry{LinearSVCModel}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LinearSVCModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{LinearSVCModel}}}{\emph{java\_model=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Model fitted by LinearSVC.

\DUrole{versionmodified}{New in version 2.2.0.}
\index{coefficients (pyspark.ml.classification.LinearSVCModel attribute)@\spxentry{coefficients}\spxextra{pyspark.ml.classification.LinearSVCModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LinearSVCModel.coefficients}}\pysigline{\sphinxbfcode{\sphinxupquote{coefficients}}}
Model coefficients of Linear SVM Classifier.

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}

\index{intercept (pyspark.ml.classification.LinearSVCModel attribute)@\spxentry{intercept}\spxextra{pyspark.ml.classification.LinearSVCModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LinearSVCModel.intercept}}\pysigline{\sphinxbfcode{\sphinxupquote{intercept}}}
Model intercept of Linear SVM Classifier.

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{LogisticRegression (class in pyspark.ml.classification)@\spxentry{LogisticRegression}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{LogisticRegression}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{maxIter=100}, \emph{regParam=0.0}, \emph{elasticNetParam=0.0}, \emph{tol=1e-06}, \emph{fitIntercept=True}, \emph{threshold=0.5}, \emph{thresholds=None}, \emph{probabilityCol='probability'}, \emph{rawPredictionCol='rawPrediction'}, \emph{standardization=True}, \emph{weightCol=None}, \emph{aggregationDepth=2}, \emph{family='auto'}, \emph{lowerBoundsOnCoefficients=None}, \emph{upperBoundsOnCoefficients=None}, \emph{lowerBoundsOnIntercepts=None}, \emph{upperBoundsOnIntercepts=None}}{}
Logistic regression.
This class supports multinomial logistic (softmax) and binomial logistic regression.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{sql} \PYG{k}{import} \PYG{n}{Row}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{bdf} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{n}{Row}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{weight}\PYG{o}{=}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{5.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{n}{Row}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{weight}\PYG{o}{=}\PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{2.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{n}{Row}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{weight}\PYG{o}{=}\PYG{l+m+mf}{3.0}\PYG{p}{,} \PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{n}{Row}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{weight}\PYG{o}{=}\PYG{l+m+mf}{4.0}\PYG{p}{,} \PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{3.0}\PYG{p}{,} \PYG{l+m+mf}{3.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{blor} \PYG{o}{=} \PYG{n}{LogisticRegression}\PYG{p}{(}\PYG{n}{regParam}\PYG{o}{=}\PYG{l+m+mf}{0.01}\PYG{p}{,} \PYG{n}{weightCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{weight}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{blorModel} \PYG{o}{=} \PYG{n}{blor}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{bdf}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{blorModel}\PYG{o}{.}\PYG{n}{coefficients}
\PYG{g+go}{DenseVector([\PYGZhy{}1.080..., \PYGZhy{}0.646...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{blorModel}\PYG{o}{.}\PYG{n}{intercept}
\PYG{g+go}{3.112...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{data\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{data/mllib/sample\PYGZus{}multiclass\PYGZus{}classification\PYGZus{}data.txt}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{mdf} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{libsvm}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{data\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{mlor} \PYG{o}{=} \PYG{n}{LogisticRegression}\PYG{p}{(}\PYG{n}{regParam}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{n}{elasticNetParam}\PYG{o}{=}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{family}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{multinomial}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{mlorModel} \PYG{o}{=} \PYG{n}{mlor}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{mdf}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{mlorModel}\PYG{o}{.}\PYG{n}{coefficientMatrix}
\PYG{g+go}{SparseMatrix(3, 4, [0, 1, 2, 3], [3, 2, 1], [1.87..., \PYGZhy{}2.75..., \PYGZhy{}0.50...], 1)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{mlorModel}\PYG{o}{.}\PYG{n}{interceptVector}
\PYG{g+go}{DenseVector([0.04..., \PYGZhy{}0.42..., 0.37...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test0} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}\PYG{n}{Row}\PYG{p}{(}\PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result} \PYG{o}{=} \PYG{n}{blorModel}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{probability}
\PYG{g+go}{DenseVector([0.02..., 0.97...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{rawPrediction}
\PYG{g+go}{DenseVector([\PYGZhy{}3.54..., 3.54...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test1} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}\PYG{n}{Row}\PYG{p}{(}\PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{blorModel}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{blor}\PYG{o}{.}\PYG{n}{setParams}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{vector}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gt}{Traceback (most recent call last):}
    \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}
\PYG{g+gr}{TypeError}: \PYG{n}{Method setParams forces keyword arguments.}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/lr}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{blor}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{lr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr2} \PYG{o}{=} \PYG{n}{LogisticRegression}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{lr\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr2}\PYG{o}{.}\PYG{n}{getRegParam}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{0.01}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/lr\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{blorModel}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{LogisticRegressionModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{blorModel}\PYG{o}{.}\PYG{n}{coefficients}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{coefficients}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{blorModel}\PYG{o}{.}\PYG{n}{intercept} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{intercept}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2}
\PYG{g+go}{LogisticRegressionModel: uid = ..., numClasses = 2, numFeatures = 2}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.3.0.}
\index{getFamily() (pyspark.ml.classification.LogisticRegression method)@\spxentry{getFamily()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.getFamily}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getFamily}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{family}} or its default value.

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}

\index{getLowerBoundsOnCoefficients() (pyspark.ml.classification.LogisticRegression method)@\spxentry{getLowerBoundsOnCoefficients()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.getLowerBoundsOnCoefficients}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getLowerBoundsOnCoefficients}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{lowerBoundsOnCoefficients}}

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{getLowerBoundsOnIntercepts() (pyspark.ml.classification.LogisticRegression method)@\spxentry{getLowerBoundsOnIntercepts()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.getLowerBoundsOnIntercepts}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getLowerBoundsOnIntercepts}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{lowerBoundsOnIntercepts}}

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{getThreshold() (pyspark.ml.classification.LogisticRegression method)@\spxentry{getThreshold()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.getThreshold}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getThreshold}}}{}{}
Get threshold for binary classification.

If \sphinxcode{\sphinxupquote{thresholds}} is set with length 2 (i.e., binary classification),
this returns the equivalent threshold:
\(\frac{1}{1 + \frac{thresholds(0)}{thresholds(1)}}\).
Otherwise, returns \sphinxcode{\sphinxupquote{threshold}} if set or its default value if unset.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{getThresholds() (pyspark.ml.classification.LogisticRegression method)@\spxentry{getThresholds()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.getThresholds}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getThresholds}}}{}{}
If \sphinxcode{\sphinxupquote{thresholds}} is set, return its value.
Otherwise, if \sphinxcode{\sphinxupquote{threshold}} is set, return the equivalent thresholds for binary
classification: (1-threshold, threshold).
If neither are set, throw an error.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{getUpperBoundsOnCoefficients() (pyspark.ml.classification.LogisticRegression method)@\spxentry{getUpperBoundsOnCoefficients()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.getUpperBoundsOnCoefficients}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getUpperBoundsOnCoefficients}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{upperBoundsOnCoefficients}}

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{getUpperBoundsOnIntercepts() (pyspark.ml.classification.LogisticRegression method)@\spxentry{getUpperBoundsOnIntercepts()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.getUpperBoundsOnIntercepts}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getUpperBoundsOnIntercepts}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{upperBoundsOnIntercepts}}

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{setFamily() (pyspark.ml.classification.LogisticRegression method)@\spxentry{setFamily()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.setFamily}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setFamily}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{family}}.

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}

\index{setLowerBoundsOnCoefficients() (pyspark.ml.classification.LogisticRegression method)@\spxentry{setLowerBoundsOnCoefficients()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.setLowerBoundsOnCoefficients}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setLowerBoundsOnCoefficients}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{lowerBoundsOnCoefficients}}

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{setLowerBoundsOnIntercepts() (pyspark.ml.classification.LogisticRegression method)@\spxentry{setLowerBoundsOnIntercepts()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.setLowerBoundsOnIntercepts}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setLowerBoundsOnIntercepts}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{lowerBoundsOnIntercepts}}

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.classification.LogisticRegression method)@\spxentry{setParams()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{maxIter=100}, \emph{regParam=0.0}, \emph{elasticNetParam=0.0}, \emph{tol=1e-06}, \emph{fitIntercept=True}, \emph{threshold=0.5}, \emph{thresholds=None}, \emph{probabilityCol='probability'}, \emph{rawPredictionCol='rawPrediction'}, \emph{standardization=True}, \emph{weightCol=None}, \emph{aggregationDepth=2}, \emph{family='auto'}, \emph{lowerBoundsOnCoefficients=None}, \emph{upperBoundsOnCoefficients=None}, \emph{lowerBoundsOnIntercepts=None}, \emph{upperBoundsOnIntercepts=None}}{}
setParams(self, featuresCol=”features”, labelCol=”label”, predictionCol=”prediction”,                   maxIter=100, regParam=0.0, elasticNetParam=0.0, tol=1e-6, fitIntercept=True,                   threshold=0.5, thresholds=None, probabilityCol=”probability”,                   rawPredictionCol=”rawPrediction”, standardization=True, weightCol=None,                   aggregationDepth=2, family=”auto”,                   lowerBoundsOnCoefficients=None, upperBoundsOnCoefficients=None,                   lowerBoundsOnIntercepts=None, upperBoundsOnIntercepts=None):
Sets params for logistic regression.
If the threshold and thresholds Params are both set, they must be equivalent.

\DUrole{versionmodified}{New in version 1.3.0.}

\end{fulllineitems}

\index{setThreshold() (pyspark.ml.classification.LogisticRegression method)@\spxentry{setThreshold()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.setThreshold}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setThreshold}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{threshold}}.
Clears value of \sphinxcode{\sphinxupquote{thresholds}} if it has been set.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setThresholds() (pyspark.ml.classification.LogisticRegression method)@\spxentry{setThresholds()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.setThresholds}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setThresholds}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{thresholds}}.
Clears value of \sphinxcode{\sphinxupquote{threshold}} if it has been set.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{setUpperBoundsOnCoefficients() (pyspark.ml.classification.LogisticRegression method)@\spxentry{setUpperBoundsOnCoefficients()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.setUpperBoundsOnCoefficients}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setUpperBoundsOnCoefficients}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{upperBoundsOnCoefficients}}

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{setUpperBoundsOnIntercepts() (pyspark.ml.classification.LogisticRegression method)@\spxentry{setUpperBoundsOnIntercepts()}\spxextra{pyspark.ml.classification.LogisticRegression method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegression.setUpperBoundsOnIntercepts}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setUpperBoundsOnIntercepts}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{upperBoundsOnIntercepts}}

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{LogisticRegressionModel (class in pyspark.ml.classification)@\spxentry{LogisticRegressionModel}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{LogisticRegressionModel}}}{\emph{java\_model=None}}{}
Model fitted by LogisticRegression.

\DUrole{versionmodified}{New in version 1.3.0.}
\index{coefficientMatrix (pyspark.ml.classification.LogisticRegressionModel attribute)@\spxentry{coefficientMatrix}\spxextra{pyspark.ml.classification.LogisticRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionModel.coefficientMatrix}}\pysigline{\sphinxbfcode{\sphinxupquote{coefficientMatrix}}}
Model coefficients.

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}

\index{coefficients (pyspark.ml.classification.LogisticRegressionModel attribute)@\spxentry{coefficients}\spxextra{pyspark.ml.classification.LogisticRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionModel.coefficients}}\pysigline{\sphinxbfcode{\sphinxupquote{coefficients}}}
Model coefficients of binomial logistic regression.
An exception is thrown in the case of multinomial logistic regression.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{evaluate() (pyspark.ml.classification.LogisticRegressionModel method)@\spxentry{evaluate()}\spxextra{pyspark.ml.classification.LogisticRegressionModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionModel.evaluate}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{evaluate}}}{\emph{dataset}}{}
Evaluates the model on a test dataset.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{dataset}} \textendash{} Test dataset to evaluate model on, where dataset is an
instance of \sphinxcode{\sphinxupquote{pyspark.sql.DataFrame}}

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{hasSummary (pyspark.ml.classification.LogisticRegressionModel attribute)@\spxentry{hasSummary}\spxextra{pyspark.ml.classification.LogisticRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionModel.hasSummary}}\pysigline{\sphinxbfcode{\sphinxupquote{hasSummary}}}
Indicates whether a training summary exists for this model
instance.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{intercept (pyspark.ml.classification.LogisticRegressionModel attribute)@\spxentry{intercept}\spxextra{pyspark.ml.classification.LogisticRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionModel.intercept}}\pysigline{\sphinxbfcode{\sphinxupquote{intercept}}}
Model intercept of binomial logistic regression.
An exception is thrown in the case of multinomial logistic regression.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{interceptVector (pyspark.ml.classification.LogisticRegressionModel attribute)@\spxentry{interceptVector}\spxextra{pyspark.ml.classification.LogisticRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionModel.interceptVector}}\pysigline{\sphinxbfcode{\sphinxupquote{interceptVector}}}
Model intercept.

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}

\index{summary (pyspark.ml.classification.LogisticRegressionModel attribute)@\spxentry{summary}\spxextra{pyspark.ml.classification.LogisticRegressionModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionModel.summary}}\pysigline{\sphinxbfcode{\sphinxupquote{summary}}}
Gets summary (e.g. accuracy/precision/recall, objective history, total iterations) of model
trained on the training set. An exception is thrown if \(trainingSummary is None\).

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{LogisticRegressionSummary (class in pyspark.ml.classification)@\spxentry{LogisticRegressionSummary}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{LogisticRegressionSummary}}}{\emph{java\_obj=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Abstraction for Logistic Regression Results for a given model.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{accuracy (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{accuracy}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.accuracy}}\pysigline{\sphinxbfcode{\sphinxupquote{accuracy}}}
Returns accuracy.
(equals to the total number of correctly classified instances
out of the total number of instances.)

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{fMeasureByLabel() (pyspark.ml.classification.LogisticRegressionSummary method)@\spxentry{fMeasureByLabel()}\spxextra{pyspark.ml.classification.LogisticRegressionSummary method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.fMeasureByLabel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{fMeasureByLabel}}}{\emph{beta=1.0}}{}
Returns f-measure for each label (category).

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{falsePositiveRateByLabel (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{falsePositiveRateByLabel}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.falsePositiveRateByLabel}}\pysigline{\sphinxbfcode{\sphinxupquote{falsePositiveRateByLabel}}}
Returns false positive rate for each label (category).

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{featuresCol (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{featuresCol}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.featuresCol}}\pysigline{\sphinxbfcode{\sphinxupquote{featuresCol}}}
Field in “predictions” which gives the features of each instance
as a vector.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{labelCol (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{labelCol}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.labelCol}}\pysigline{\sphinxbfcode{\sphinxupquote{labelCol}}}
Field in “predictions” which gives the true label of each
instance.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{labels (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{labels}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.labels}}\pysigline{\sphinxbfcode{\sphinxupquote{labels}}}
Returns the sequence of labels in ascending order. This order matches the order used
in metrics which are specified as arrays over labels, e.g., truePositiveRateByLabel.

Note: In most cases, it will be values \{0.0, 1.0, …, numClasses-1\}, However, if the
training set is missing a label, then all of the arrays over labels
(e.g., from truePositiveRateByLabel) will be of length numClasses-1 instead of the
expected numClasses.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{precisionByLabel (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{precisionByLabel}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.precisionByLabel}}\pysigline{\sphinxbfcode{\sphinxupquote{precisionByLabel}}}
Returns precision for each label (category).

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{predictionCol (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{predictionCol}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.predictionCol}}\pysigline{\sphinxbfcode{\sphinxupquote{predictionCol}}}
Field in “predictions” which gives the prediction of each class.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{predictions (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{predictions}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.predictions}}\pysigline{\sphinxbfcode{\sphinxupquote{predictions}}}
Dataframe outputted by the model’s \(transform\) method.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{probabilityCol (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{probabilityCol}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.probabilityCol}}\pysigline{\sphinxbfcode{\sphinxupquote{probabilityCol}}}
Field in “predictions” which gives the probability
of each class as a vector.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{recallByLabel (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{recallByLabel}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.recallByLabel}}\pysigline{\sphinxbfcode{\sphinxupquote{recallByLabel}}}
Returns recall for each label (category).

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{truePositiveRateByLabel (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{truePositiveRateByLabel}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.truePositiveRateByLabel}}\pysigline{\sphinxbfcode{\sphinxupquote{truePositiveRateByLabel}}}
Returns true positive rate for each label (category).

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{weightedFMeasure() (pyspark.ml.classification.LogisticRegressionSummary method)@\spxentry{weightedFMeasure()}\spxextra{pyspark.ml.classification.LogisticRegressionSummary method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.weightedFMeasure}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{weightedFMeasure}}}{\emph{beta=1.0}}{}
Returns weighted averaged f-measure.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{weightedFalsePositiveRate (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{weightedFalsePositiveRate}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.weightedFalsePositiveRate}}\pysigline{\sphinxbfcode{\sphinxupquote{weightedFalsePositiveRate}}}
Returns weighted false positive rate.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{weightedPrecision (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{weightedPrecision}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.weightedPrecision}}\pysigline{\sphinxbfcode{\sphinxupquote{weightedPrecision}}}
Returns weighted averaged precision.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{weightedRecall (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{weightedRecall}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.weightedRecall}}\pysigline{\sphinxbfcode{\sphinxupquote{weightedRecall}}}
Returns weighted averaged recall.
(equals to precision, recall and f-measure)

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{weightedTruePositiveRate (pyspark.ml.classification.LogisticRegressionSummary attribute)@\spxentry{weightedTruePositiveRate}\spxextra{pyspark.ml.classification.LogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionSummary.weightedTruePositiveRate}}\pysigline{\sphinxbfcode{\sphinxupquote{weightedTruePositiveRate}}}
Returns weighted true positive rate.
(equals to precision, recall and f-measure)

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{LogisticRegressionTrainingSummary (class in pyspark.ml.classification)@\spxentry{LogisticRegressionTrainingSummary}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionTrainingSummary}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{LogisticRegressionTrainingSummary}}}{\emph{java\_obj=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Abstraction for multinomial Logistic Regression Training results.
Currently, the training summary ignores the training weights except
for the objective trace.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{objectiveHistory (pyspark.ml.classification.LogisticRegressionTrainingSummary attribute)@\spxentry{objectiveHistory}\spxextra{pyspark.ml.classification.LogisticRegressionTrainingSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionTrainingSummary.objectiveHistory}}\pysigline{\sphinxbfcode{\sphinxupquote{objectiveHistory}}}
Objective function (scaled loss + regularization) at each
iteration.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{totalIterations (pyspark.ml.classification.LogisticRegressionTrainingSummary attribute)@\spxentry{totalIterations}\spxextra{pyspark.ml.classification.LogisticRegressionTrainingSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.LogisticRegressionTrainingSummary.totalIterations}}\pysigline{\sphinxbfcode{\sphinxupquote{totalIterations}}}
Number of training iterations until termination.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{BinaryLogisticRegressionSummary (class in pyspark.ml.classification)@\spxentry{BinaryLogisticRegressionSummary}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.BinaryLogisticRegressionSummary}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{BinaryLogisticRegressionSummary}}}{\emph{java\_obj=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Binary Logistic regression results for a given model.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{areaUnderROC (pyspark.ml.classification.BinaryLogisticRegressionSummary attribute)@\spxentry{areaUnderROC}\spxextra{pyspark.ml.classification.BinaryLogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.BinaryLogisticRegressionSummary.areaUnderROC}}\pysigline{\sphinxbfcode{\sphinxupquote{areaUnderROC}}}
Computes the area under the receiver operating characteristic
(ROC) curve.

\begin{sphinxadmonition}{note}{Note:}
This ignores instance weights (setting all to 1.0) from
\(LogisticRegression.weightCol\). This will change in later Spark
versions.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{fMeasureByThreshold (pyspark.ml.classification.BinaryLogisticRegressionSummary attribute)@\spxentry{fMeasureByThreshold}\spxextra{pyspark.ml.classification.BinaryLogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.BinaryLogisticRegressionSummary.fMeasureByThreshold}}\pysigline{\sphinxbfcode{\sphinxupquote{fMeasureByThreshold}}}
Returns a dataframe with two fields (threshold, F-Measure) curve
with beta = 1.0.

\begin{sphinxadmonition}{note}{Note:}
This ignores instance weights (setting all to 1.0) from
\(LogisticRegression.weightCol\). This will change in later Spark
versions.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{pr (pyspark.ml.classification.BinaryLogisticRegressionSummary attribute)@\spxentry{pr}\spxextra{pyspark.ml.classification.BinaryLogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.BinaryLogisticRegressionSummary.pr}}\pysigline{\sphinxbfcode{\sphinxupquote{pr}}}
Returns the precision-recall curve, which is a Dataframe
containing two fields recall, precision with (0.0, 1.0) prepended
to it.

\begin{sphinxadmonition}{note}{Note:}
This ignores instance weights (setting all to 1.0) from
\(LogisticRegression.weightCol\). This will change in later Spark
versions.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{precisionByThreshold (pyspark.ml.classification.BinaryLogisticRegressionSummary attribute)@\spxentry{precisionByThreshold}\spxextra{pyspark.ml.classification.BinaryLogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.BinaryLogisticRegressionSummary.precisionByThreshold}}\pysigline{\sphinxbfcode{\sphinxupquote{precisionByThreshold}}}
Returns a dataframe with two fields (threshold, precision) curve.
Every possible probability obtained in transforming the dataset
are used as thresholds used in calculating the precision.

\begin{sphinxadmonition}{note}{Note:}
This ignores instance weights (setting all to 1.0) from
\(LogisticRegression.weightCol\). This will change in later Spark
versions.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{recallByThreshold (pyspark.ml.classification.BinaryLogisticRegressionSummary attribute)@\spxentry{recallByThreshold}\spxextra{pyspark.ml.classification.BinaryLogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.BinaryLogisticRegressionSummary.recallByThreshold}}\pysigline{\sphinxbfcode{\sphinxupquote{recallByThreshold}}}
Returns a dataframe with two fields (threshold, recall) curve.
Every possible probability obtained in transforming the dataset
are used as thresholds used in calculating the recall.

\begin{sphinxadmonition}{note}{Note:}
This ignores instance weights (setting all to 1.0) from
\(LogisticRegression.weightCol\). This will change in later Spark
versions.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{roc (pyspark.ml.classification.BinaryLogisticRegressionSummary attribute)@\spxentry{roc}\spxextra{pyspark.ml.classification.BinaryLogisticRegressionSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.BinaryLogisticRegressionSummary.roc}}\pysigline{\sphinxbfcode{\sphinxupquote{roc}}}
Returns the receiver operating characteristic (ROC) curve,
which is a Dataframe having two fields (FPR, TPR) with
(0.0, 0.0) prepended and (1.0, 1.0) appended to it.


\sphinxstrong{See also:}


\sphinxhref{http://en.wikipedia.org/wiki/Receiver\_operating\_characteristic}{Wikipedia reference}



\begin{sphinxadmonition}{note}{Note:}
This ignores instance weights (setting all to 1.0) from
\(LogisticRegression.weightCol\). This will change in later Spark
versions.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{BinaryLogisticRegressionTrainingSummary (class in pyspark.ml.classification)@\spxentry{BinaryLogisticRegressionTrainingSummary}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.BinaryLogisticRegressionTrainingSummary}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{BinaryLogisticRegressionTrainingSummary}}}{\emph{java\_obj=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Binary Logistic regression training results for a given model.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{DecisionTreeClassifier (class in pyspark.ml.classification)@\spxentry{DecisionTreeClassifier}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.DecisionTreeClassifier}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{DecisionTreeClassifier}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{probabilityCol='probability'}, \emph{rawPredictionCol='rawPrediction'}, \emph{maxDepth=5}, \emph{maxBins=32}, \emph{minInstancesPerNode=1}, \emph{minInfoGain=0.0}, \emph{maxMemoryInMB=256}, \emph{cacheNodeIds=False}, \emph{checkpointInterval=10}, \emph{impurity='gini'}, \emph{seed=None}}{}
\sphinxhref{http://en.wikipedia.org/wiki/Decision\_tree\_learning}{Decision tree}
learning algorithm for classification.
It supports both binary and multiclass labels, as well as both continuous and categorical
features.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{feature} \PYG{k}{import} \PYG{n}{StringIndexer}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{stringIndexer} \PYG{o}{=} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{si\PYGZus{}model} \PYG{o}{=} \PYG{n}{stringIndexer}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{td} \PYG{o}{=} \PYG{n}{si\PYGZus{}model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dt} \PYG{o}{=} \PYG{n}{DecisionTreeClassifier}\PYG{p}{(}\PYG{n}{maxDepth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{dt}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{td}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numNodes}
\PYG{g+go}{3}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{depth}
\PYG{g+go}{1}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{featureImportances}
\PYG{g+go}{SparseVector(1, \PYGZob{}0: 1.0\PYGZcb{})}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numFeatures}
\PYG{g+go}{1}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numClasses}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{toDebugString}\PYG{p}{)}
\PYG{g+go}{DecisionTreeClassificationModel (uid=...) of depth 1 with 3 nodes...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test0} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{0.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{probability}
\PYG{g+go}{DenseVector([1.0, 0.0])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{rawPrediction}
\PYG{g+go}{DenseVector([1.0, 0.0])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test1} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{1.0}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dtc\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/dtc}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dt}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{dtc\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dt2} \PYG{o}{=} \PYG{n}{DecisionTreeClassifier}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{dtc\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dt2}\PYG{o}{.}\PYG{n}{getMaxDepth}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/dtc\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{DecisionTreeClassificationModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{featureImportances} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{featureImportances}
\PYG{g+go}{True}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.4.0.}
\index{setParams() (pyspark.ml.classification.DecisionTreeClassifier method)@\spxentry{setParams()}\spxextra{pyspark.ml.classification.DecisionTreeClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.DecisionTreeClassifier.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{featuresCol="features"}, \emph{labelCol="label"}, \emph{predictionCol="prediction"}, \emph{probabilityCol="probability"}, \emph{rawPredictionCol="rawPrediction"}, \emph{maxDepth=5}, \emph{maxBins=32}, \emph{minInstancesPerNode=1}, \emph{minInfoGain=0.0}, \emph{maxMemoryInMB=256}, \emph{cacheNodeIds=False}, \emph{checkpointInterval=10}, \emph{impurity="gini"}, \emph{seed=None}}{}
Sets params for the DecisionTreeClassifier.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{DecisionTreeClassificationModel (class in pyspark.ml.classification)@\spxentry{DecisionTreeClassificationModel}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.DecisionTreeClassificationModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{DecisionTreeClassificationModel}}}{\emph{java\_model=None}}{}
Model fitted by DecisionTreeClassifier.

\DUrole{versionmodified}{New in version 1.4.0.}
\index{featureImportances (pyspark.ml.classification.DecisionTreeClassificationModel attribute)@\spxentry{featureImportances}\spxextra{pyspark.ml.classification.DecisionTreeClassificationModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.DecisionTreeClassificationModel.featureImportances}}\pysigline{\sphinxbfcode{\sphinxupquote{featureImportances}}}
Estimate of the importance of each feature.

This generalizes the idea of “Gini” importance to other losses,
following the explanation of Gini importance from “Random Forests” documentation
by Leo Breiman and Adele Cutler, and following the implementation from scikit-learn.
\begin{description}
\item[{This feature importance is calculated as follows:}] \leavevmode\begin{itemize}
\item {} 
importance(feature j) = sum (over nodes which split on feature j) of the gain,
where gain is scaled by the number of instances passing through node

\item {} 
Normalize importances for tree to sum to 1.

\end{itemize}

\end{description}

\begin{sphinxadmonition}{note}{Note:}
Feature importance for single decision trees can have high variance due to
correlated predictor variables. Consider using a {\hyperref[\detokenize{api:pyspark.ml.classification.RandomForestClassifier}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{RandomForestClassifier}}}}}
to determine feature importance instead.
\end{sphinxadmonition}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{GBTClassifier (class in pyspark.ml.classification)@\spxentry{GBTClassifier}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.GBTClassifier}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{GBTClassifier}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{maxDepth=5}, \emph{maxBins=32}, \emph{minInstancesPerNode=1}, \emph{minInfoGain=0.0}, \emph{maxMemoryInMB=256}, \emph{cacheNodeIds=False}, \emph{checkpointInterval=10}, \emph{lossType='logistic'}, \emph{maxIter=20}, \emph{stepSize=0.1}, \emph{seed=None}, \emph{subsamplingRate=1.0}, \emph{featureSubsetStrategy='all'}}{}
\sphinxhref{http://en.wikipedia.org/wiki/Gradient\_boosting}{Gradient-Boosted Trees (GBTs)}
learning algorithm for classification.
It supports binary labels, as well as both continuous and categorical features.

The implementation is based upon: J.H. Friedman. “Stochastic Gradient Boosting.” 1999.

Notes on Gradient Boosting vs. TreeBoost:
- This implementation is for Stochastic Gradient Boosting, not for TreeBoost.
- Both algorithms learn tree ensembles by minimizing loss functions.
- TreeBoost (Friedman, 1999) additionally modifies the outputs at tree leaf nodes
based on the loss function, whereas the original gradient boosting method does not.
- We expect to implement TreeBoost in the future:
\sphinxhref{https://issues.apache.org/jira/browse/SPARK-4240}{SPARK-4240}

\begin{sphinxadmonition}{note}{Note:}
Multiclass labels are not currently supported.
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{numpy} \PYG{k}{import} \PYG{n}{allclose}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{feature} \PYG{k}{import} \PYG{n}{StringIndexer}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{stringIndexer} \PYG{o}{=} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{si\PYGZus{}model} \PYG{o}{=} \PYG{n}{stringIndexer}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{td} \PYG{o}{=} \PYG{n}{si\PYGZus{}model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gbt} \PYG{o}{=} \PYG{n}{GBTClassifier}\PYG{p}{(}\PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{maxDepth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{42}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gbt}\PYG{o}{.}\PYG{n}{getFeatureSubsetStrategy}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{\PYGZsq{}all\PYGZsq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{gbt}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{td}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{featureImportances}
\PYG{g+go}{SparseVector(1, \PYGZob{}0: 1.0\PYGZcb{})}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{allclose}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{treeWeights}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{l+m+mf}{0.1}\PYG{p}{]}\PYG{p}{)}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test0} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{0.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test1} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{totalNumNodes}
\PYG{g+go}{15}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{toDebugString}\PYG{p}{)}
\PYG{g+go}{GBTClassificationModel (uid=...)...with 5 trees...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gbtc\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{gbtc}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gbt}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{gbtc\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gbt2} \PYG{o}{=} \PYG{n}{GBTClassifier}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{gbtc\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gbt2}\PYG{o}{.}\PYG{n}{getMaxDepth}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{gbtc\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{GBTClassificationModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{featureImportances} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{featureImportances}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{treeWeights} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{treeWeights}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{trees}
\PYG{g+go}{[DecisionTreeRegressionModel (uid=...) of depth..., DecisionTreeRegressionModel...]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{validation} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
\PYG{g+gp}{... }             \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{evaluateEachIteration}\PYG{p}{(}\PYG{n}{validation}\PYG{p}{)}
\PYG{g+go}{[0.25..., 0.23..., 0.21..., 0.19..., 0.18...]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{numClasses}
\PYG{g+go}{2}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.4.0.}
\index{getLossType() (pyspark.ml.classification.GBTClassifier method)@\spxentry{getLossType()}\spxextra{pyspark.ml.classification.GBTClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.GBTClassifier.getLossType}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getLossType}}}{}{}
Gets the value of lossType or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setFeatureSubsetStrategy() (pyspark.ml.classification.GBTClassifier method)@\spxentry{setFeatureSubsetStrategy()}\spxextra{pyspark.ml.classification.GBTClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.GBTClassifier.setFeatureSubsetStrategy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setFeatureSubsetStrategy}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{featureSubsetStrategy}}.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{setLossType() (pyspark.ml.classification.GBTClassifier method)@\spxentry{setLossType()}\spxextra{pyspark.ml.classification.GBTClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.GBTClassifier.setLossType}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setLossType}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{lossType}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.classification.GBTClassifier method)@\spxentry{setParams()}\spxextra{pyspark.ml.classification.GBTClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.GBTClassifier.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{featuresCol="features"}, \emph{labelCol="label"}, \emph{predictionCol="prediction"}, \emph{maxDepth=5}, \emph{maxBins=32}, \emph{minInstancesPerNode=1}, \emph{minInfoGain=0.0}, \emph{maxMemoryInMB=256}, \emph{cacheNodeIds=False}, \emph{checkpointInterval=10}, \emph{lossType="logistic"}, \emph{maxIter=20}, \emph{stepSize=0.1}, \emph{seed=None}, \emph{subsamplingRate=1.0}, \emph{featureSubsetStrategy="all"}}{}
Sets params for Gradient Boosted Tree Classification.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{GBTClassificationModel (class in pyspark.ml.classification)@\spxentry{GBTClassificationModel}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.GBTClassificationModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{GBTClassificationModel}}}{\emph{java\_model=None}}{}
Model fitted by GBTClassifier.

\DUrole{versionmodified}{New in version 1.4.0.}
\index{evaluateEachIteration() (pyspark.ml.classification.GBTClassificationModel method)@\spxentry{evaluateEachIteration()}\spxextra{pyspark.ml.classification.GBTClassificationModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.GBTClassificationModel.evaluateEachIteration}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{evaluateEachIteration}}}{\emph{dataset}}{}
Method to compute error or loss for every iteration of gradient boosting.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{dataset}} \textendash{} Test dataset to evaluate model on, where dataset is an
instance of \sphinxcode{\sphinxupquote{pyspark.sql.DataFrame}}

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{featureImportances (pyspark.ml.classification.GBTClassificationModel attribute)@\spxentry{featureImportances}\spxextra{pyspark.ml.classification.GBTClassificationModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.GBTClassificationModel.featureImportances}}\pysigline{\sphinxbfcode{\sphinxupquote{featureImportances}}}
Estimate of the importance of each feature.

Each feature’s importance is the average of its importance across all trees in the ensemble
The importance vector is normalized to sum to 1. This method is suggested by Hastie et al.
(Hastie, Tibshirani, Friedman. “The Elements of Statistical Learning, 2nd Edition.” 2001.)
and follows the implementation from scikit-learn.


\sphinxstrong{See also:}


{\hyperref[\detokenize{api:pyspark.ml.classification.DecisionTreeClassificationModel.featureImportances}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{DecisionTreeClassificationModel.featureImportances}}}}}



\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{trees (pyspark.ml.classification.GBTClassificationModel attribute)@\spxentry{trees}\spxextra{pyspark.ml.classification.GBTClassificationModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.GBTClassificationModel.trees}}\pysigline{\sphinxbfcode{\sphinxupquote{trees}}}
These have null parent Estimators.

\DUrole{versionmodified}{New in version 2.0.0.}
\begin{quote}\begin{description}
\item[{Type}] \leavevmode
Trees in this ensemble. Warning

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}

\index{RandomForestClassifier (class in pyspark.ml.classification)@\spxentry{RandomForestClassifier}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.RandomForestClassifier}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{RandomForestClassifier}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{probabilityCol='probability'}, \emph{rawPredictionCol='rawPrediction'}, \emph{maxDepth=5}, \emph{maxBins=32}, \emph{minInstancesPerNode=1}, \emph{minInfoGain=0.0}, \emph{maxMemoryInMB=256}, \emph{cacheNodeIds=False}, \emph{checkpointInterval=10}, \emph{impurity='gini'}, \emph{numTrees=20}, \emph{featureSubsetStrategy='auto'}, \emph{seed=None}, \emph{subsamplingRate=1.0}}{}
\sphinxhref{http://en.wikipedia.org/wiki/Random\_forest}{Random Forest}
learning algorithm for classification.
It supports both binary and multiclass labels, as well as both continuous and categorical
features.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{import} \PYG{n+nn}{numpy}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{numpy} \PYG{k}{import} \PYG{n}{allclose}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{feature} \PYG{k}{import} \PYG{n}{StringIndexer}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{stringIndexer} \PYG{o}{=} \PYG{n}{StringIndexer}\PYG{p}{(}\PYG{n}{inputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{outputCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{si\PYGZus{}model} \PYG{o}{=} \PYG{n}{stringIndexer}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{td} \PYG{o}{=} \PYG{n}{si\PYGZus{}model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rf} \PYG{o}{=} \PYG{n}{RandomForestClassifier}\PYG{p}{(}\PYG{n}{numTrees}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{maxDepth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{labelCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{indexed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{42}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{rf}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{td}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{featureImportances}
\PYG{g+go}{SparseVector(1, \PYGZob{}0: 1.0\PYGZcb{})}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{allclose}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{treeWeights}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test0} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{0.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{numpy}\PYG{o}{.}\PYG{n}{argmax}\PYG{p}{(}\PYG{n}{result}\PYG{o}{.}\PYG{n}{probability}\PYG{p}{)}
\PYG{g+go}{0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{numpy}\PYG{o}{.}\PYG{n}{argmax}\PYG{p}{(}\PYG{n}{result}\PYG{o}{.}\PYG{n}{rawPrediction}\PYG{p}{)}
\PYG{g+go}{0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test1} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{trees}
\PYG{g+go}{[DecisionTreeClassificationModel (uid=...) of depth..., DecisionTreeClassificationModel...]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rfc\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/rfc}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rf}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{rfc\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rf2} \PYG{o}{=} \PYG{n}{RandomForestClassifier}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{rfc\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rf2}\PYG{o}{.}\PYG{n}{getNumTrees}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{3}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/rfc\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{RandomForestClassificationModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{featureImportances} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{featureImportances}
\PYG{g+go}{True}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.4.0.}
\index{setFeatureSubsetStrategy() (pyspark.ml.classification.RandomForestClassifier method)@\spxentry{setFeatureSubsetStrategy()}\spxextra{pyspark.ml.classification.RandomForestClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.RandomForestClassifier.setFeatureSubsetStrategy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setFeatureSubsetStrategy}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{featureSubsetStrategy}}.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.classification.RandomForestClassifier method)@\spxentry{setParams()}\spxextra{pyspark.ml.classification.RandomForestClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.RandomForestClassifier.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{featuresCol="features"}, \emph{labelCol="label"}, \emph{predictionCol="prediction"}, \emph{probabilityCol="probability"}, \emph{rawPredictionCol="rawPrediction"}, \emph{maxDepth=5}, \emph{maxBins=32}, \emph{minInstancesPerNode=1}, \emph{minInfoGain=0.0}, \emph{maxMemoryInMB=256}, \emph{cacheNodeIds=False}, \emph{checkpointInterval=10}, \emph{seed=None}, \emph{impurity="gini"}, \emph{numTrees=20}, \emph{featureSubsetStrategy="auto"}, \emph{subsamplingRate=1.0}}{}
Sets params for linear classification.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{RandomForestClassificationModel (class in pyspark.ml.classification)@\spxentry{RandomForestClassificationModel}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.RandomForestClassificationModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{RandomForestClassificationModel}}}{\emph{java\_model=None}}{}
Model fitted by RandomForestClassifier.

\DUrole{versionmodified}{New in version 1.4.0.}
\index{featureImportances (pyspark.ml.classification.RandomForestClassificationModel attribute)@\spxentry{featureImportances}\spxextra{pyspark.ml.classification.RandomForestClassificationModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.RandomForestClassificationModel.featureImportances}}\pysigline{\sphinxbfcode{\sphinxupquote{featureImportances}}}
Estimate of the importance of each feature.

Each feature’s importance is the average of its importance across all trees in the ensemble
The importance vector is normalized to sum to 1. This method is suggested by Hastie et al.
(Hastie, Tibshirani, Friedman. “The Elements of Statistical Learning, 2nd Edition.” 2001.)
and follows the implementation from scikit-learn.


\sphinxstrong{See also:}


{\hyperref[\detokenize{api:pyspark.ml.classification.DecisionTreeClassificationModel.featureImportances}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{DecisionTreeClassificationModel.featureImportances}}}}}



\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{trees (pyspark.ml.classification.RandomForestClassificationModel attribute)@\spxentry{trees}\spxextra{pyspark.ml.classification.RandomForestClassificationModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.RandomForestClassificationModel.trees}}\pysigline{\sphinxbfcode{\sphinxupquote{trees}}}
These have null parent Estimators.

\DUrole{versionmodified}{New in version 2.0.0.}
\begin{quote}\begin{description}
\item[{Type}] \leavevmode
Trees in this ensemble. Warning

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}

\index{NaiveBayes (class in pyspark.ml.classification)@\spxentry{NaiveBayes}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.NaiveBayes}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{NaiveBayes}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{probabilityCol='probability'}, \emph{rawPredictionCol='rawPrediction'}, \emph{smoothing=1.0}, \emph{modelType='multinomial'}, \emph{thresholds=None}, \emph{weightCol=None}}{}
Naive Bayes Classifiers.
It supports both Multinomial and Bernoulli NB. \sphinxhref{http://nlp.stanford.edu/IR-book/html/htmledition/naive-bayes-text-classification-1.html}{Multinomial NB}
can handle finitely supported discrete data. For example, by converting documents into
TF-IDF vectors, it can be used for document classification. By making every vector a
binary (0/1) data, it can also be used as \sphinxhref{http://nlp.stanford.edu/IR-book/html/htmledition/the-bernoulli-model-1.html}{Bernoulli NB}.
The input feature values must be nonnegative.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{sql} \PYG{k}{import} \PYG{n}{Row}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{n}{Row}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{weight}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{n}{Row}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{weight}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{n}{Row}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{weight}\PYG{o}{=}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{nb} \PYG{o}{=} \PYG{n}{NaiveBayes}\PYG{p}{(}\PYG{n}{smoothing}\PYG{o}{=}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{modelType}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{multinomial}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{weightCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{weight}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{nb}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{pi}
\PYG{g+go}{DenseVector([\PYGZhy{}0.81..., \PYGZhy{}0.58...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{theta}
\PYG{g+go}{DenseMatrix(2, 2, [\PYGZhy{}0.91..., \PYGZhy{}0.51..., \PYGZhy{}0.40..., \PYGZhy{}1.09...], 1)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test0} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}\PYG{n}{Row}\PYG{p}{(}\PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{probability}
\PYG{g+go}{DenseVector([0.32..., 0.67...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{rawPrediction}
\PYG{g+go}{DenseVector([\PYGZhy{}1.72..., \PYGZhy{}0.99...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test1} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}\PYG{n}{Row}\PYG{p}{(}\PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{nb\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/nb}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{nb}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{nb\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{nb2} \PYG{o}{=} \PYG{n}{NaiveBayes}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{nb\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{nb2}\PYG{o}{.}\PYG{n}{getSmoothing}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{1.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/nb\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{NaiveBayesModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{pi} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{pi}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{theta} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{theta}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{nb} \PYG{o}{=} \PYG{n}{nb}\PYG{o}{.}\PYG{n}{setThresholds}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.01}\PYG{p}{,} \PYG{l+m+mf}{10.00}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model3} \PYG{o}{=} \PYG{n}{nb}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result} \PYG{o}{=} \PYG{n}{model3}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{result}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{0.0}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.5.0.}
\index{getModelType() (pyspark.ml.classification.NaiveBayes method)@\spxentry{getModelType()}\spxextra{pyspark.ml.classification.NaiveBayes method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.NaiveBayes.getModelType}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getModelType}}}{}{}
Gets the value of modelType or its default value.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{getSmoothing() (pyspark.ml.classification.NaiveBayes method)@\spxentry{getSmoothing()}\spxextra{pyspark.ml.classification.NaiveBayes method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.NaiveBayes.getSmoothing}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getSmoothing}}}{}{}
Gets the value of smoothing or its default value.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{setModelType() (pyspark.ml.classification.NaiveBayes method)@\spxentry{setModelType()}\spxextra{pyspark.ml.classification.NaiveBayes method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.NaiveBayes.setModelType}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setModelType}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{modelType}}.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.classification.NaiveBayes method)@\spxentry{setParams()}\spxextra{pyspark.ml.classification.NaiveBayes method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.NaiveBayes.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{featuresCol="features"}, \emph{labelCol="label"}, \emph{predictionCol="prediction"}, \emph{probabilityCol="probability"}, \emph{rawPredictionCol="rawPrediction"}, \emph{smoothing=1.0}, \emph{modelType="multinomial"}, \emph{thresholds=None}, \emph{weightCol=None}}{}
Sets params for Naive Bayes.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{setSmoothing() (pyspark.ml.classification.NaiveBayes method)@\spxentry{setSmoothing()}\spxextra{pyspark.ml.classification.NaiveBayes method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.NaiveBayes.setSmoothing}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setSmoothing}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{smoothing}}.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{NaiveBayesModel (class in pyspark.ml.classification)@\spxentry{NaiveBayesModel}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.NaiveBayesModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{NaiveBayesModel}}}{\emph{java\_model=None}}{}
Model fitted by NaiveBayes.

\DUrole{versionmodified}{New in version 1.5.0.}
\index{pi (pyspark.ml.classification.NaiveBayesModel attribute)@\spxentry{pi}\spxextra{pyspark.ml.classification.NaiveBayesModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.NaiveBayesModel.pi}}\pysigline{\sphinxbfcode{\sphinxupquote{pi}}}
log of class priors.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{theta (pyspark.ml.classification.NaiveBayesModel attribute)@\spxentry{theta}\spxextra{pyspark.ml.classification.NaiveBayesModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.NaiveBayesModel.theta}}\pysigline{\sphinxbfcode{\sphinxupquote{theta}}}
log of class conditional probabilities.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{MultilayerPerceptronClassifier (class in pyspark.ml.classification)@\spxentry{MultilayerPerceptronClassifier}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassifier}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{MultilayerPerceptronClassifier}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{maxIter=100}, \emph{tol=1e-06}, \emph{seed=None}, \emph{layers=None}, \emph{blockSize=128}, \emph{stepSize=0.03}, \emph{solver='l-bfgs'}, \emph{initialWeights=None}, \emph{probabilityCol='probability'}, \emph{rawPredictionCol='rawPrediction'}}{}
Classifier trainer based on the Multilayer Perceptron.
Each layer has sigmoid activation function, output layer has softmax.
Number of inputs has to be equal to the size of feature vectors.
Number of outputs has to be equal to the total number of labels.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{mlp} \PYG{o}{=} \PYG{n}{MultilayerPerceptronClassifier}\PYG{p}{(}\PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{n}{layers}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,} \PYG{n}{blockSize}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{123}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{mlp}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{layers}
\PYG{g+go}{[2, 2, 2]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{weights}\PYG{o}{.}\PYG{n}{size}
\PYG{g+go}{12}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{testDF} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{testDF}\PYG{p}{)}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{} features\textbar{}prediction\textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}[1.0,0.0]\textbar{}       1.0\textbar{}}
\PYG{g+go}{\textbar{}[0.0,0.0]\textbar{}       0.0\textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+gp}{...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{mlp\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/mlp}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{mlp}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{mlp\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{mlp2} \PYG{o}{=} \PYG{n}{MultilayerPerceptronClassifier}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{mlp\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{mlp2}\PYG{o}{.}\PYG{n}{getBlockSize}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{1}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/mlp\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{MultilayerPerceptronClassificationModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{layers} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{layers}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{weights} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{weights}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{mlp2} \PYG{o}{=} \PYG{n}{mlp2}\PYG{o}{.}\PYG{n}{setInitialWeights}\PYG{p}{(}\PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{12}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model3} \PYG{o}{=} \PYG{n}{mlp2}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model3}\PYG{o}{.}\PYG{n}{weights} \PYG{o}{!=} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{weights}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model3}\PYG{o}{.}\PYG{n}{layers} \PYG{o}{==} \PYG{n}{model}\PYG{o}{.}\PYG{n}{layers}
\PYG{g+go}{True}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.6.0.}
\index{getBlockSize() (pyspark.ml.classification.MultilayerPerceptronClassifier method)@\spxentry{getBlockSize()}\spxextra{pyspark.ml.classification.MultilayerPerceptronClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassifier.getBlockSize}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getBlockSize}}}{}{}
Gets the value of blockSize or its default value.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{getInitialWeights() (pyspark.ml.classification.MultilayerPerceptronClassifier method)@\spxentry{getInitialWeights()}\spxextra{pyspark.ml.classification.MultilayerPerceptronClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassifier.getInitialWeights}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getInitialWeights}}}{}{}
Gets the value of initialWeights or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getLayers() (pyspark.ml.classification.MultilayerPerceptronClassifier method)@\spxentry{getLayers()}\spxextra{pyspark.ml.classification.MultilayerPerceptronClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassifier.getLayers}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getLayers}}}{}{}
Gets the value of layers or its default value.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{getStepSize() (pyspark.ml.classification.MultilayerPerceptronClassifier method)@\spxentry{getStepSize()}\spxextra{pyspark.ml.classification.MultilayerPerceptronClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassifier.getStepSize}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getStepSize}}}{}{}
Gets the value of stepSize or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setBlockSize() (pyspark.ml.classification.MultilayerPerceptronClassifier method)@\spxentry{setBlockSize()}\spxextra{pyspark.ml.classification.MultilayerPerceptronClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassifier.setBlockSize}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setBlockSize}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{blockSize}}.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{setInitialWeights() (pyspark.ml.classification.MultilayerPerceptronClassifier method)@\spxentry{setInitialWeights()}\spxextra{pyspark.ml.classification.MultilayerPerceptronClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassifier.setInitialWeights}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setInitialWeights}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{initialWeights}}.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setLayers() (pyspark.ml.classification.MultilayerPerceptronClassifier method)@\spxentry{setLayers()}\spxextra{pyspark.ml.classification.MultilayerPerceptronClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassifier.setLayers}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setLayers}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{layers}}.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.classification.MultilayerPerceptronClassifier method)@\spxentry{setParams()}\spxextra{pyspark.ml.classification.MultilayerPerceptronClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassifier.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{maxIter=100}, \emph{tol=1e-06}, \emph{seed=None}, \emph{layers=None}, \emph{blockSize=128}, \emph{stepSize=0.03}, \emph{solver='l-bfgs'}, \emph{initialWeights=None}, \emph{probabilityCol='probability'}, \emph{rawPredictionCol='rawPrediction'}}{}
setParams(self, featuresCol=”features”, labelCol=”label”, predictionCol=”prediction”,                   maxIter=100, tol=1e-6, seed=None, layers=None, blockSize=128, stepSize=0.03,                   solver=”l-bfgs”, initialWeights=None, probabilityCol=”probability”,                   rawPredictionCol=”rawPrediction”):
Sets params for MultilayerPerceptronClassifier.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{setStepSize() (pyspark.ml.classification.MultilayerPerceptronClassifier method)@\spxentry{setStepSize()}\spxextra{pyspark.ml.classification.MultilayerPerceptronClassifier method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassifier.setStepSize}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setStepSize}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{stepSize}}.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{MultilayerPerceptronClassificationModel (class in pyspark.ml.classification)@\spxentry{MultilayerPerceptronClassificationModel}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassificationModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{MultilayerPerceptronClassificationModel}}}{\emph{java\_model=None}}{}
Model fitted by MultilayerPerceptronClassifier.

\DUrole{versionmodified}{New in version 1.6.0.}
\index{layers (pyspark.ml.classification.MultilayerPerceptronClassificationModel attribute)@\spxentry{layers}\spxextra{pyspark.ml.classification.MultilayerPerceptronClassificationModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassificationModel.layers}}\pysigline{\sphinxbfcode{\sphinxupquote{layers}}}
array of layer sizes including input and output layers.

\DUrole{versionmodified}{New in version 1.6.0.}

\end{fulllineitems}

\index{weights (pyspark.ml.classification.MultilayerPerceptronClassificationModel attribute)@\spxentry{weights}\spxextra{pyspark.ml.classification.MultilayerPerceptronClassificationModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.MultilayerPerceptronClassificationModel.weights}}\pysigline{\sphinxbfcode{\sphinxupquote{weights}}}
the weights of layers.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{OneVsRest (class in pyspark.ml.classification)@\spxentry{OneVsRest}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.OneVsRest}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{OneVsRest}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{classifier=None}, \emph{weightCol=None}, \emph{parallelism=1}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Reduction of Multiclass Classification to Binary Classification.
Performs reduction using one against all strategy.
For a multiclass classification with k classes, train k models (one per class).
Each example is scored against all k models and the model with highest score
is picked to label the example.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{sql} \PYG{k}{import} \PYG{n}{Row}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{data\PYGZus{}path} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{data/mllib/sample\PYGZus{}multiclass\PYGZus{}classification\PYGZus{}data.txt}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{read}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{libsvm}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{data\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr} \PYG{o}{=} \PYG{n}{LogisticRegression}\PYG{p}{(}\PYG{n}{regParam}\PYG{o}{=}\PYG{l+m+mf}{0.01}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ovr} \PYG{o}{=} \PYG{n}{OneVsRest}\PYG{p}{(}\PYG{n}{classifier}\PYG{o}{=}\PYG{n}{lr}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{ovr}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{models}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{coefficients}
\PYG{g+go}{DenseVector([0.5..., \PYGZhy{}1.0..., 3.4..., 4.2...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{models}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{coefficients}
\PYG{g+go}{DenseVector([\PYGZhy{}2.1..., 3.1..., \PYGZhy{}2.6..., \PYGZhy{}2.3...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{models}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{coefficients}
\PYG{g+go}{DenseVector([0.3..., \PYGZhy{}3.4..., 1.0..., \PYGZhy{}1.1...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{p}{[}\PYG{n}{x}\PYG{o}{.}\PYG{n}{intercept} \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n}{model}\PYG{o}{.}\PYG{n}{models}\PYG{p}{]}
\PYG{g+go}{[\PYGZhy{}2.7..., \PYGZhy{}2.5..., \PYGZhy{}1.3...]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test0} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}\PYG{n}{Row}\PYG{p}{(}\PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{0.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test1} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}\PYG{n}{Row}\PYG{p}{(}\PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{sparse}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{2.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test2} \PYG{o}{=} \PYG{n}{sc}\PYG{o}{.}\PYG{n}{parallelize}\PYG{p}{(}\PYG{p}{[}\PYG{n}{Row}\PYG{p}{(}\PYG{n}{features}\PYG{o}{=}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mf}{0.4}\PYG{p}{,} \PYG{l+m+mf}{0.3}\PYG{p}{,} \PYG{l+m+mf}{0.2}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test2}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{0.0}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/ovr\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{OneVsRestModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{0.0}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}
\index{copy() (pyspark.ml.classification.OneVsRest method)@\spxentry{copy()}\spxextra{pyspark.ml.classification.OneVsRest method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.OneVsRest.copy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{copy}}}{\emph{extra=None}}{}
Creates a copy of this instance with a randomly generated uid
and some extra params. This creates a deep copy of the embedded paramMap,
and copies the embedded and extra parameters over.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{extra}} \textendash{} Extra parameters to copy to the new instance

\item[{Returns}] \leavevmode
Copy of this instance

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.classification.OneVsRest method)@\spxentry{setParams()}\spxextra{pyspark.ml.classification.OneVsRest method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.OneVsRest.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{featuresCol='features'}, \emph{labelCol='label'}, \emph{predictionCol='prediction'}, \emph{classifier=None}, \emph{weightCol=None}, \emph{parallelism=1}}{}
setParams(self, featuresCol=”features”, labelCol=”label”, predictionCol=”prediction”,                   classifier=None, weightCol=None, parallelism=1):
Sets params for OneVsRest.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{OneVsRestModel (class in pyspark.ml.classification)@\spxentry{OneVsRestModel}\spxextra{class in pyspark.ml.classification}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.OneVsRestModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.classification.}}\sphinxbfcode{\sphinxupquote{OneVsRestModel}}}{\emph{models}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Model fitted by OneVsRest.
This stores the models resulting from training k binary classifiers: one for each class.
Each example is scored against all k models, and the model with the highest score
is picked to label the example.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{copy() (pyspark.ml.classification.OneVsRestModel method)@\spxentry{copy()}\spxextra{pyspark.ml.classification.OneVsRestModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.classification.OneVsRestModel.copy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{copy}}}{\emph{extra=None}}{}
Creates a copy of this instance with a randomly generated uid
and some extra params. This creates a deep copy of the embedded paramMap,
and copies the embedded and extra parameters over.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{extra}} \textendash{} Extra parameters to copy to the new instance

\item[{Returns}] \leavevmode
Copy of this instance

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}



\section{Clustering API}
\label{\detokenize{api:module-pyspark.ml.clustering}}\label{\detokenize{api:clustering-api}}\index{pyspark.ml.clustering (module)@\spxentry{pyspark.ml.clustering}\spxextra{module}}\index{BisectingKMeans (class in pyspark.ml.clustering)@\spxentry{BisectingKMeans}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeans}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{BisectingKMeans}}}{\emph{featuresCol='features'}, \emph{predictionCol='prediction'}, \emph{maxIter=20}, \emph{seed=None}, \emph{k=4}, \emph{minDivisibleClusterSize=1.0}, \emph{distanceMeasure='euclidean'}}{}
A bisecting k-means algorithm based on the paper “A comparison of document clustering
techniques” by Steinbach, Karypis, and Kumar, with modification to fit Spark.
The algorithm starts from a single cluster that contains all points.
Iteratively it finds divisible clusters on the bottom level and bisects each of them using
k-means, until there are \(k\) leaf clusters in total or no leaf clusters are divisible.
The bisecting steps of clusters on the same level are grouped together to increase parallelism.
If bisecting all divisible clusters on the bottom level would result more than \(k\) leaf
clusters, larger clusters get higher priority.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{data} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }        \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{9.0}\PYG{p}{,} \PYG{l+m+mf}{8.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{8.0}\PYG{p}{,} \PYG{l+m+mf}{9.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{data}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{bkm} \PYG{o}{=} \PYG{n}{BisectingKMeans}\PYG{p}{(}\PYG{n}{k}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{minDivisibleClusterSize}\PYG{o}{=}\PYG{l+m+mf}{1.0}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{bkm}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{centers} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{clusterCenters}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{centers}\PYG{p}{)}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{computeCost}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+go}{2.000...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{hasSummary}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{summary} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{summary}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{summary}\PYG{o}{.}\PYG{n}{k}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{summary}\PYG{o}{.}\PYG{n}{clusterSizes}
\PYG{g+go}{[2, 2]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{transformed} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rows} \PYG{o}{=} \PYG{n}{transformed}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rows}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{prediction} \PYG{o}{==} \PYG{n}{rows}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rows}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{prediction} \PYG{o}{==} \PYG{n}{rows}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{bkm\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/bkm}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{bkm}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{bkm\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{bkm2} \PYG{o}{=} \PYG{n}{BisectingKMeans}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{bkm\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{bkm2}\PYG{o}{.}\PYG{n}{getK}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{bkm2}\PYG{o}{.}\PYG{n}{getDistanceMeasure}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{\PYGZsq{}euclidean\PYGZsq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/bkm\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{BisectingKMeansModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2}\PYG{o}{.}\PYG{n}{hasSummary}
\PYG{g+go}{False}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{clusterCenters}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{clusterCenters}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{g+go}{array([ True,  True], dtype=bool)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{clusterCenters}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{clusterCenters}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}
\PYG{g+go}{array([ True,  True], dtype=bool)}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}
\index{getDistanceMeasure() (pyspark.ml.clustering.BisectingKMeans method)@\spxentry{getDistanceMeasure()}\spxextra{pyspark.ml.clustering.BisectingKMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeans.getDistanceMeasure}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getDistanceMeasure}}}{}{}
Gets the value of \(distanceMeasure\) or its default value.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{getK() (pyspark.ml.clustering.BisectingKMeans method)@\spxentry{getK()}\spxextra{pyspark.ml.clustering.BisectingKMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeans.getK}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getK}}}{}{}
Gets the value of \(k\) or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getMinDivisibleClusterSize() (pyspark.ml.clustering.BisectingKMeans method)@\spxentry{getMinDivisibleClusterSize()}\spxextra{pyspark.ml.clustering.BisectingKMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeans.getMinDivisibleClusterSize}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getMinDivisibleClusterSize}}}{}{}
Gets the value of \(minDivisibleClusterSize\) or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setDistanceMeasure() (pyspark.ml.clustering.BisectingKMeans method)@\spxentry{setDistanceMeasure()}\spxextra{pyspark.ml.clustering.BisectingKMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeans.setDistanceMeasure}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setDistanceMeasure}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{distanceMeasure}}.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{setK() (pyspark.ml.clustering.BisectingKMeans method)@\spxentry{setK()}\spxextra{pyspark.ml.clustering.BisectingKMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeans.setK}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setK}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{k}}.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setMinDivisibleClusterSize() (pyspark.ml.clustering.BisectingKMeans method)@\spxentry{setMinDivisibleClusterSize()}\spxextra{pyspark.ml.clustering.BisectingKMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeans.setMinDivisibleClusterSize}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setMinDivisibleClusterSize}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{minDivisibleClusterSize}}.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.clustering.BisectingKMeans method)@\spxentry{setParams()}\spxextra{pyspark.ml.clustering.BisectingKMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeans.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{featuresCol="features"}, \emph{predictionCol="prediction"}, \emph{maxIter=20}, \emph{seed=None}, \emph{k=4}, \emph{minDivisibleClusterSize=1.0}, \emph{distanceMeasure="euclidean"}}{}
Sets params for BisectingKMeans.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{BisectingKMeansModel (class in pyspark.ml.clustering)@\spxentry{BisectingKMeansModel}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeansModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{BisectingKMeansModel}}}{\emph{java\_model=None}}{}
Model fitted by BisectingKMeans.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{clusterCenters() (pyspark.ml.clustering.BisectingKMeansModel method)@\spxentry{clusterCenters()}\spxextra{pyspark.ml.clustering.BisectingKMeansModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeansModel.clusterCenters}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{clusterCenters}}}{}{}
Get the cluster centers, represented as a list of NumPy arrays.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{computeCost() (pyspark.ml.clustering.BisectingKMeansModel method)@\spxentry{computeCost()}\spxextra{pyspark.ml.clustering.BisectingKMeansModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeansModel.computeCost}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{computeCost}}}{\emph{dataset}}{}
Computes the sum of squared distances between the input points
and their corresponding cluster centers.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{hasSummary (pyspark.ml.clustering.BisectingKMeansModel attribute)@\spxentry{hasSummary}\spxextra{pyspark.ml.clustering.BisectingKMeansModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeansModel.hasSummary}}\pysigline{\sphinxbfcode{\sphinxupquote{hasSummary}}}
Indicates whether a training summary exists for this model instance.

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}

\index{summary (pyspark.ml.clustering.BisectingKMeansModel attribute)@\spxentry{summary}\spxextra{pyspark.ml.clustering.BisectingKMeansModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeansModel.summary}}\pysigline{\sphinxbfcode{\sphinxupquote{summary}}}
Gets summary (e.g. cluster assignments, cluster sizes) of the model trained on the
training set. An exception is thrown if no summary exists.

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{BisectingKMeansSummary (class in pyspark.ml.clustering)@\spxentry{BisectingKMeansSummary}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.BisectingKMeansSummary}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{BisectingKMeansSummary}}}{\emph{java\_obj=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Bisecting KMeans clustering results for a given model.

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}

\index{KMeans (class in pyspark.ml.clustering)@\spxentry{KMeans}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeans}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{KMeans}}}{\emph{featuresCol='features'}, \emph{predictionCol='prediction'}, \emph{k=2}, \emph{initMode='k-means\textbar{}\textbar{}'}, \emph{initSteps=2}, \emph{tol=0.0001}, \emph{maxIter=20}, \emph{seed=None}, \emph{distanceMeasure='euclidean'}}{}
K-means clustering with a k-means++ like initialization mode
(the k-means\textbar{}\textbar{} algorithm by Bahmani et al).

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{data} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }        \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{9.0}\PYG{p}{,} \PYG{l+m+mf}{8.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{8.0}\PYG{p}{,} \PYG{l+m+mf}{9.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{data}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{kmeans} \PYG{o}{=} \PYG{n}{KMeans}\PYG{p}{(}\PYG{n}{k}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{kmeans}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{centers} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{clusterCenters}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{centers}\PYG{p}{)}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{computeCost}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+go}{2.000...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{transformed} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rows} \PYG{o}{=} \PYG{n}{transformed}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rows}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{prediction} \PYG{o}{==} \PYG{n}{rows}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rows}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{prediction} \PYG{o}{==} \PYG{n}{rows}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{hasSummary}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{summary} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{summary}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{summary}\PYG{o}{.}\PYG{n}{k}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{summary}\PYG{o}{.}\PYG{n}{clusterSizes}
\PYG{g+go}{[2, 2]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{summary}\PYG{o}{.}\PYG{n}{trainingCost}
\PYG{g+go}{2.000...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{kmeans\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/kmeans}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{kmeans}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{kmeans\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{kmeans2} \PYG{o}{=} \PYG{n}{KMeans}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{kmeans\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{kmeans2}\PYG{o}{.}\PYG{n}{getK}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/kmeans\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{KMeansModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2}\PYG{o}{.}\PYG{n}{hasSummary}
\PYG{g+go}{False}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{clusterCenters}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{clusterCenters}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{g+go}{array([ True,  True], dtype=bool)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{clusterCenters}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{clusterCenters}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}
\PYG{g+go}{array([ True,  True], dtype=bool)}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.5.0.}
\index{getDistanceMeasure() (pyspark.ml.clustering.KMeans method)@\spxentry{getDistanceMeasure()}\spxextra{pyspark.ml.clustering.KMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeans.getDistanceMeasure}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getDistanceMeasure}}}{}{}
Gets the value of \(distanceMeasure\)

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{getInitMode() (pyspark.ml.clustering.KMeans method)@\spxentry{getInitMode()}\spxextra{pyspark.ml.clustering.KMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeans.getInitMode}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getInitMode}}}{}{}
Gets the value of \(initMode\)

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{getInitSteps() (pyspark.ml.clustering.KMeans method)@\spxentry{getInitSteps()}\spxextra{pyspark.ml.clustering.KMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeans.getInitSteps}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getInitSteps}}}{}{}
Gets the value of \(initSteps\)

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{getK() (pyspark.ml.clustering.KMeans method)@\spxentry{getK()}\spxextra{pyspark.ml.clustering.KMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeans.getK}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getK}}}{}{}
Gets the value of \(k\)

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{setDistanceMeasure() (pyspark.ml.clustering.KMeans method)@\spxentry{setDistanceMeasure()}\spxextra{pyspark.ml.clustering.KMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeans.setDistanceMeasure}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setDistanceMeasure}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{distanceMeasure}}.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{setInitMode() (pyspark.ml.clustering.KMeans method)@\spxentry{setInitMode()}\spxextra{pyspark.ml.clustering.KMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeans.setInitMode}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setInitMode}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{initMode}}.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{setInitSteps() (pyspark.ml.clustering.KMeans method)@\spxentry{setInitSteps()}\spxextra{pyspark.ml.clustering.KMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeans.setInitSteps}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setInitSteps}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{initSteps}}.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{setK() (pyspark.ml.clustering.KMeans method)@\spxentry{setK()}\spxextra{pyspark.ml.clustering.KMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeans.setK}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setK}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{k}}.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.clustering.KMeans method)@\spxentry{setParams()}\spxextra{pyspark.ml.clustering.KMeans method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeans.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{featuresCol="features"}, \emph{predictionCol="prediction"}, \emph{k=2}, \emph{initMode="k-means\textbar{}\textbar{}"}, \emph{initSteps=2}, \emph{tol=1e-4}, \emph{maxIter=20}, \emph{seed=None}, \emph{distanceMeasure="euclidean"}}{}
Sets params for KMeans.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{KMeansModel (class in pyspark.ml.clustering)@\spxentry{KMeansModel}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeansModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{KMeansModel}}}{\emph{java\_model=None}}{}
Model fitted by KMeans.

\DUrole{versionmodified}{New in version 1.5.0.}
\index{clusterCenters() (pyspark.ml.clustering.KMeansModel method)@\spxentry{clusterCenters()}\spxextra{pyspark.ml.clustering.KMeansModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeansModel.clusterCenters}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{clusterCenters}}}{}{}
Get the cluster centers, represented as a list of NumPy arrays.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{computeCost() (pyspark.ml.clustering.KMeansModel method)@\spxentry{computeCost()}\spxextra{pyspark.ml.clustering.KMeansModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeansModel.computeCost}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{computeCost}}}{\emph{dataset}}{}
Return the K-means cost (sum of squared distances of points to their nearest center)
for this model on the given data.
\begin{description}
\item[{..note:: Deprecated in 2.4.0. It will be removed in 3.0.0. Use ClusteringEvaluator instead.}] \leavevmode
You can also get the cost on the training dataset in the summary.

\end{description}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{hasSummary (pyspark.ml.clustering.KMeansModel attribute)@\spxentry{hasSummary}\spxextra{pyspark.ml.clustering.KMeansModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeansModel.hasSummary}}\pysigline{\sphinxbfcode{\sphinxupquote{hasSummary}}}
Indicates whether a training summary exists for this model instance.

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}

\index{summary (pyspark.ml.clustering.KMeansModel attribute)@\spxentry{summary}\spxextra{pyspark.ml.clustering.KMeansModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.KMeansModel.summary}}\pysigline{\sphinxbfcode{\sphinxupquote{summary}}}
Gets summary (e.g. cluster assignments, cluster sizes) of the model trained on the
training set. An exception is thrown if no summary exists.

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{GaussianMixture (class in pyspark.ml.clustering)@\spxentry{GaussianMixture}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixture}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{GaussianMixture}}}{\emph{featuresCol='features'}, \emph{predictionCol='prediction'}, \emph{k=2}, \emph{probabilityCol='probability'}, \emph{tol=0.01}, \emph{maxIter=100}, \emph{seed=None}}{}
GaussianMixture clustering.
This class performs expectation maximization for multivariate Gaussian
Mixture Models (GMMs).  A GMM represents a composite distribution of
independent Gaussian distributions with associated “mixing” weights
specifying each’s contribution to the composite.

Given a set of sample points, this class will maximize the log-likelihood
for a mixture of k Gaussians, iterating until the log-likelihood changes by
less than convergenceTol, or until it has reached the max number of iterations.
While this process is generally guaranteed to converge, it is not guaranteed
to find a global optimum.

\begin{sphinxadmonition}{note}{Note:}
For high-dimensional data (with many features), this algorithm may perform poorly.
This is due to high-dimensional data (a) making it difficult to cluster at all
(based on statistical/theoretical arguments) and (b) numerical issues with
Gaussian distributions.
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{data} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.05} \PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }        \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.01}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }        \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.9}\PYG{p}{,} \PYG{l+m+mf}{0.8}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }        \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.75}\PYG{p}{,} \PYG{l+m+mf}{0.935}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }        \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.83}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.68}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }        \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.91}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.76}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{p}{)}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{data}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gm} \PYG{o}{=} \PYG{n}{GaussianMixture}\PYG{p}{(}\PYG{n}{k}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{tol}\PYG{o}{=}\PYG{l+m+mf}{0.0001}\PYG{p}{,}
\PYG{g+gp}{... }                     \PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{gm}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{hasSummary}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{summary} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{summary}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{summary}\PYG{o}{.}\PYG{n}{k}
\PYG{g+go}{3}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{summary}\PYG{o}{.}\PYG{n}{clusterSizes}
\PYG{g+go}{[2, 2, 2]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{summary}\PYG{o}{.}\PYG{n}{logLikelihood}
\PYG{g+go}{8.14636...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{weights} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{weights}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{weights}\PYG{p}{)}
\PYG{g+go}{3}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{gaussiansDF}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{mean}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{Row(mean=DenseVector([0.825, 0.8675]))}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{gaussiansDF}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cov}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{Row(cov=DenseMatrix(2, 2, [0.0056, \PYGZhy{}0.0051, \PYGZhy{}0.0051, 0.0046], False))}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{transformed} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rows} \PYG{o}{=} \PYG{n}{transformed}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rows}\PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{]}\PYG{o}{.}\PYG{n}{prediction} \PYG{o}{==} \PYG{n}{rows}\PYG{p}{[}\PYG{l+m+mi}{5}\PYG{p}{]}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{rows}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{prediction} \PYG{o}{==} \PYG{n}{rows}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{o}{.}\PYG{n}{prediction}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gmm\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/gmm}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gm}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{gmm\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gm2} \PYG{o}{=} \PYG{n}{GaussianMixture}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{gmm\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{gm2}\PYG{o}{.}\PYG{n}{getK}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{3}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/gmm\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{GaussianMixtureModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2}\PYG{o}{.}\PYG{n}{hasSummary}
\PYG{g+go}{False}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2}\PYG{o}{.}\PYG{n}{weights} \PYG{o}{==} \PYG{n}{model}\PYG{o}{.}\PYG{n}{weights}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2}\PYG{o}{.}\PYG{n}{gaussiansDF}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{mean}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{Row(mean=DenseVector([0.825, 0.8675]))}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2}\PYG{o}{.}\PYG{n}{gaussiansDF}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cov}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{Row(cov=DenseMatrix(2, 2, [0.0056, \PYGZhy{}0.0051, \PYGZhy{}0.0051, 0.0046], False))}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}
\index{getK() (pyspark.ml.clustering.GaussianMixture method)@\spxentry{getK()}\spxextra{pyspark.ml.clustering.GaussianMixture method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixture.getK}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getK}}}{}{}
Gets the value of \(k\)

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setK() (pyspark.ml.clustering.GaussianMixture method)@\spxentry{setK()}\spxextra{pyspark.ml.clustering.GaussianMixture method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixture.setK}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setK}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{k}}.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.clustering.GaussianMixture method)@\spxentry{setParams()}\spxextra{pyspark.ml.clustering.GaussianMixture method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixture.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{featuresCol="features"}, \emph{predictionCol="prediction"}, \emph{k=2}, \emph{probabilityCol="probability"}, \emph{tol=0.01}, \emph{maxIter=100}, \emph{seed=None}}{}
Sets params for GaussianMixture.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{GaussianMixtureModel (class in pyspark.ml.clustering)@\spxentry{GaussianMixtureModel}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixtureModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{GaussianMixtureModel}}}{\emph{java\_model=None}}{}
Model fitted by GaussianMixture.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{gaussiansDF (pyspark.ml.clustering.GaussianMixtureModel attribute)@\spxentry{gaussiansDF}\spxextra{pyspark.ml.clustering.GaussianMixtureModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixtureModel.gaussiansDF}}\pysigline{\sphinxbfcode{\sphinxupquote{gaussiansDF}}}
Retrieve Gaussian distributions as a DataFrame.
Each row represents a Gaussian Distribution.
The DataFrame has two columns: mean (Vector) and cov (Matrix).

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{hasSummary (pyspark.ml.clustering.GaussianMixtureModel attribute)@\spxentry{hasSummary}\spxextra{pyspark.ml.clustering.GaussianMixtureModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixtureModel.hasSummary}}\pysigline{\sphinxbfcode{\sphinxupquote{hasSummary}}}
Indicates whether a training summary exists for this model
instance.

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}

\index{summary (pyspark.ml.clustering.GaussianMixtureModel attribute)@\spxentry{summary}\spxextra{pyspark.ml.clustering.GaussianMixtureModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixtureModel.summary}}\pysigline{\sphinxbfcode{\sphinxupquote{summary}}}
Gets summary (e.g. cluster assignments, cluster sizes) of the model trained on the
training set. An exception is thrown if no summary exists.

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}

\index{weights (pyspark.ml.clustering.GaussianMixtureModel attribute)@\spxentry{weights}\spxextra{pyspark.ml.clustering.GaussianMixtureModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixtureModel.weights}}\pysigline{\sphinxbfcode{\sphinxupquote{weights}}}
Weight for each Gaussian distribution in the mixture.
This is a multinomial probability distribution over the k Gaussians,
where weights{[}i{]} is the weight for Gaussian i, and weights sum to 1.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{GaussianMixtureSummary (class in pyspark.ml.clustering)@\spxentry{GaussianMixtureSummary}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixtureSummary}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{GaussianMixtureSummary}}}{\emph{java\_obj=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Gaussian mixture clustering results for a given model.

\DUrole{versionmodified}{New in version 2.1.0.}
\index{logLikelihood (pyspark.ml.clustering.GaussianMixtureSummary attribute)@\spxentry{logLikelihood}\spxextra{pyspark.ml.clustering.GaussianMixtureSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixtureSummary.logLikelihood}}\pysigline{\sphinxbfcode{\sphinxupquote{logLikelihood}}}
Total log-likelihood for this model on the given data.

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}

\index{probability (pyspark.ml.clustering.GaussianMixtureSummary attribute)@\spxentry{probability}\spxextra{pyspark.ml.clustering.GaussianMixtureSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixtureSummary.probability}}\pysigline{\sphinxbfcode{\sphinxupquote{probability}}}
DataFrame of probabilities of each cluster for each training data point.

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}

\index{probabilityCol (pyspark.ml.clustering.GaussianMixtureSummary attribute)@\spxentry{probabilityCol}\spxextra{pyspark.ml.clustering.GaussianMixtureSummary attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.GaussianMixtureSummary.probabilityCol}}\pysigline{\sphinxbfcode{\sphinxupquote{probabilityCol}}}
Name for column of predicted probability of each cluster in \(predictions\).

\DUrole{versionmodified}{New in version 2.1.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{LDA (class in pyspark.ml.clustering)@\spxentry{LDA}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{LDA}}}{\emph{featuresCol='features'}, \emph{maxIter=20}, \emph{seed=None}, \emph{checkpointInterval=10}, \emph{k=10}, \emph{optimizer='online'}, \emph{learningOffset=1024.0}, \emph{learningDecay=0.51}, \emph{subsamplingRate=0.05}, \emph{optimizeDocConcentration=True}, \emph{docConcentration=None}, \emph{topicConcentration=None}, \emph{topicDistributionCol='topicDistribution'}, \emph{keepLastCheckpoint=True}}{}
Latent Dirichlet Allocation (LDA), a topic model designed for text documents.

Terminology:
\begin{itemize}
\item {} 
“term” = “word”: an element of the vocabulary

\item {} 
“token”: instance of a term appearing in a document

\item {} 
“topic”: multinomial distribution over terms representing some concept

\item {} 
“document”: one piece of text, corresponding to one row in the input data

\end{itemize}
\begin{description}
\item[{Original LDA paper (journal version):}] \leavevmode
Blei, Ng, and Jordan.  “Latent Dirichlet Allocation.”  JMLR, 2003.

\end{description}

Input data (featuresCol):
LDA is given a collection of documents as input data, via the featuresCol parameter.
Each document is specified as a \sphinxcode{\sphinxupquote{Vector}} of length vocabSize, where each entry is the
count for the corresponding term (word) in the document.  Feature transformers such as
\sphinxcode{\sphinxupquote{pyspark.ml.feature.Tokenizer}} and \sphinxcode{\sphinxupquote{pyspark.ml.feature.CountVectorizer}}
can be useful for converting text to word count vectors.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}\PYG{p}{,} \PYG{n}{SparseVector}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{clustering} \PYG{k}{import} \PYG{n}{LDA}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
\PYG{g+gp}{... }     \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{SparseVector}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{l+m+mi}{0}\PYG{p}{:} \PYG{l+m+mf}{1.0}\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{id}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lda} \PYG{o}{=} \PYG{n}{LDA}\PYG{p}{(}\PYG{n}{k}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{optimizer}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{em}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{lda}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{isDistributed}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{localModel} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{toLocal}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{localModel}\PYG{o}{.}\PYG{n}{isDistributed}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{False}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{vocabSize}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{describeTopics}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}topic\textbar{}termIndices\textbar{}         termWeights\textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}    0\textbar{}     [1, 0]\textbar{}[0.50401530077160...\textbar{}}
\PYG{g+go}{\textbar{}    1\textbar{}     [0, 1]\textbar{}[0.50401530077160...\textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+gp}{...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{topicsMatrix}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{DenseMatrix(2, 2, [0.496, 0.504, 0.504, 0.496], 0)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lda\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/lda}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lda}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{lda\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sameLDA} \PYG{o}{=} \PYG{n}{LDA}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{lda\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{distributed\PYGZus{}model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/lda\PYGZus{}distributed\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{distributed\PYGZus{}model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sameModel} \PYG{o}{=} \PYG{n}{DistributedLDAModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{distributed\PYGZus{}model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{local\PYGZus{}model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/lda\PYGZus{}local\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{localModel}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{local\PYGZus{}model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{sameLocalModel} \PYG{o}{=} \PYG{n}{LocalLDAModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{local\PYGZus{}model\PYGZus{}path}\PYG{p}{)}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}
\index{getDocConcentration() (pyspark.ml.clustering.LDA method)@\spxentry{getDocConcentration()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.getDocConcentration}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getDocConcentration}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{docConcentration}} or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getK() (pyspark.ml.clustering.LDA method)@\spxentry{getK()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.getK}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getK}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{k}} or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getKeepLastCheckpoint() (pyspark.ml.clustering.LDA method)@\spxentry{getKeepLastCheckpoint()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.getKeepLastCheckpoint}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getKeepLastCheckpoint}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{keepLastCheckpoint}} or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getLearningDecay() (pyspark.ml.clustering.LDA method)@\spxentry{getLearningDecay()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.getLearningDecay}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getLearningDecay}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{learningDecay}} or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getLearningOffset() (pyspark.ml.clustering.LDA method)@\spxentry{getLearningOffset()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.getLearningOffset}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getLearningOffset}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{learningOffset}} or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getOptimizeDocConcentration() (pyspark.ml.clustering.LDA method)@\spxentry{getOptimizeDocConcentration()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.getOptimizeDocConcentration}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getOptimizeDocConcentration}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{optimizeDocConcentration}} or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getOptimizer() (pyspark.ml.clustering.LDA method)@\spxentry{getOptimizer()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.getOptimizer}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getOptimizer}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{optimizer}} or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getSubsamplingRate() (pyspark.ml.clustering.LDA method)@\spxentry{getSubsamplingRate()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.getSubsamplingRate}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getSubsamplingRate}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{subsamplingRate}} or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getTopicConcentration() (pyspark.ml.clustering.LDA method)@\spxentry{getTopicConcentration()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.getTopicConcentration}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getTopicConcentration}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{topicConcentration}} or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getTopicDistributionCol() (pyspark.ml.clustering.LDA method)@\spxentry{getTopicDistributionCol()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.getTopicDistributionCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getTopicDistributionCol}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{topicDistributionCol}} or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setDocConcentration() (pyspark.ml.clustering.LDA method)@\spxentry{setDocConcentration()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.setDocConcentration}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setDocConcentration}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{docConcentration}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo} \PYG{o}{=} \PYG{n}{LDA}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{setDocConcentration}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{l+m+mf}{0.2}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo}\PYG{o}{.}\PYG{n}{getDocConcentration}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{[0.1..., 0.2...]}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setK() (pyspark.ml.clustering.LDA method)@\spxentry{setK()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.setK}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setK}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{k}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo} \PYG{o}{=} \PYG{n}{LDA}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{setK}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo}\PYG{o}{.}\PYG{n}{getK}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{10}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setKeepLastCheckpoint() (pyspark.ml.clustering.LDA method)@\spxentry{setKeepLastCheckpoint()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.setKeepLastCheckpoint}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setKeepLastCheckpoint}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{keepLastCheckpoint}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo} \PYG{o}{=} \PYG{n}{LDA}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{setKeepLastCheckpoint}\PYG{p}{(}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo}\PYG{o}{.}\PYG{n}{getKeepLastCheckpoint}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{False}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setLearningDecay() (pyspark.ml.clustering.LDA method)@\spxentry{setLearningDecay()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.setLearningDecay}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setLearningDecay}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{learningDecay}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo} \PYG{o}{=} \PYG{n}{LDA}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{setLearningDecay}\PYG{p}{(}\PYG{l+m+mf}{0.1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo}\PYG{o}{.}\PYG{n}{getLearningDecay}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{0.1...}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setLearningOffset() (pyspark.ml.clustering.LDA method)@\spxentry{setLearningOffset()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.setLearningOffset}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setLearningOffset}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{learningOffset}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo} \PYG{o}{=} \PYG{n}{LDA}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{setLearningOffset}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo}\PYG{o}{.}\PYG{n}{getLearningOffset}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{100.0}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setOptimizeDocConcentration() (pyspark.ml.clustering.LDA method)@\spxentry{setOptimizeDocConcentration()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.setOptimizeDocConcentration}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setOptimizeDocConcentration}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{optimizeDocConcentration}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo} \PYG{o}{=} \PYG{n}{LDA}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{setOptimizeDocConcentration}\PYG{p}{(}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo}\PYG{o}{.}\PYG{n}{getOptimizeDocConcentration}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{True}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setOptimizer() (pyspark.ml.clustering.LDA method)@\spxentry{setOptimizer()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.setOptimizer}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setOptimizer}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{optimizer}}.
Currently only support ‘em’ and ‘online’.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo} \PYG{o}{=} \PYG{n}{LDA}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{setOptimizer}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{em}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo}\PYG{o}{.}\PYG{n}{getOptimizer}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{\PYGZsq{}em\PYGZsq{}}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.clustering.LDA method)@\spxentry{setParams()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{featuresCol="features"}, \emph{maxIter=20}, \emph{seed=None}, \emph{checkpointInterval=10}, \emph{k=10}, \emph{optimizer="online"}, \emph{learningOffset=1024.0}, \emph{learningDecay=0.51}, \emph{subsamplingRate=0.05}, \emph{optimizeDocConcentration=True}, \emph{docConcentration=None}, \emph{topicConcentration=None}, \emph{topicDistributionCol="topicDistribution"}, \emph{keepLastCheckpoint=True}}{}
Sets params for LDA.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setSubsamplingRate() (pyspark.ml.clustering.LDA method)@\spxentry{setSubsamplingRate()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.setSubsamplingRate}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setSubsamplingRate}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{subsamplingRate}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo} \PYG{o}{=} \PYG{n}{LDA}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{setSubsamplingRate}\PYG{p}{(}\PYG{l+m+mf}{0.1}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo}\PYG{o}{.}\PYG{n}{getSubsamplingRate}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{0.1...}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setTopicConcentration() (pyspark.ml.clustering.LDA method)@\spxentry{setTopicConcentration()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.setTopicConcentration}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setTopicConcentration}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{topicConcentration}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo} \PYG{o}{=} \PYG{n}{LDA}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{setTopicConcentration}\PYG{p}{(}\PYG{l+m+mf}{0.5}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo}\PYG{o}{.}\PYG{n}{getTopicConcentration}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{0.5...}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setTopicDistributionCol() (pyspark.ml.clustering.LDA method)@\spxentry{setTopicDistributionCol()}\spxextra{pyspark.ml.clustering.LDA method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDA.setTopicDistributionCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setTopicDistributionCol}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{topicDistributionCol}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo} \PYG{o}{=} \PYG{n}{LDA}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{setTopicDistributionCol}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{topicDistributionCol}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{algo}\PYG{o}{.}\PYG{n}{getTopicDistributionCol}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{\PYGZsq{}topicDistributionCol\PYGZsq{}}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{LDAModel (class in pyspark.ml.clustering)@\spxentry{LDAModel}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDAModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{LDAModel}}}{\emph{java\_model=None}}{}
Latent Dirichlet Allocation (LDA) model.
This abstraction permits for different underlying representations,
including local and distributed data structures.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{describeTopics() (pyspark.ml.clustering.LDAModel method)@\spxentry{describeTopics()}\spxextra{pyspark.ml.clustering.LDAModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDAModel.describeTopics}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{describeTopics}}}{\emph{maxTermsPerTopic=10}}{}
Return the topics described by their top-weighted terms.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{estimatedDocConcentration() (pyspark.ml.clustering.LDAModel method)@\spxentry{estimatedDocConcentration()}\spxextra{pyspark.ml.clustering.LDAModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDAModel.estimatedDocConcentration}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{estimatedDocConcentration}}}{}{}
Value for \sphinxcode{\sphinxupquote{LDA.docConcentration}} estimated from data.
If Online LDA was used and \sphinxcode{\sphinxupquote{LDA.optimizeDocConcentration}} was set to false,
then this returns the fixed (given) value for the \sphinxcode{\sphinxupquote{LDA.docConcentration}} parameter.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{isDistributed() (pyspark.ml.clustering.LDAModel method)@\spxentry{isDistributed()}\spxextra{pyspark.ml.clustering.LDAModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDAModel.isDistributed}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{isDistributed}}}{}{}
Indicates whether this instance is of type DistributedLDAModel

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{logLikelihood() (pyspark.ml.clustering.LDAModel method)@\spxentry{logLikelihood()}\spxextra{pyspark.ml.clustering.LDAModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDAModel.logLikelihood}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{logLikelihood}}}{\emph{dataset}}{}
Calculates a lower bound on the log likelihood of the entire corpus.
See Equation (16) in the Online LDA paper (Hoffman et al., 2010).

WARNING: If this model is an instance of {\hyperref[\detokenize{api:pyspark.ml.clustering.DistributedLDAModel}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{DistributedLDAModel}}}}} (produced when
\sphinxcode{\sphinxupquote{optimizer}} is set to “em”), this involves collecting a large
{\hyperref[\detokenize{api:pyspark.ml.clustering.LDAModel.topicsMatrix}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{topicsMatrix()}}}}} to the driver. This implementation may be changed in the future.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{logPerplexity() (pyspark.ml.clustering.LDAModel method)@\spxentry{logPerplexity()}\spxextra{pyspark.ml.clustering.LDAModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDAModel.logPerplexity}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{logPerplexity}}}{\emph{dataset}}{}
Calculate an upper bound on perplexity.  (Lower is better.)
See Equation (16) in the Online LDA paper (Hoffman et al., 2010).

WARNING: If this model is an instance of {\hyperref[\detokenize{api:pyspark.ml.clustering.DistributedLDAModel}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{DistributedLDAModel}}}}} (produced when
\sphinxcode{\sphinxupquote{optimizer}} is set to “em”), this involves collecting a large
{\hyperref[\detokenize{api:pyspark.ml.clustering.LDAModel.topicsMatrix}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{topicsMatrix()}}}}} to the driver. This implementation may be changed in the future.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{topicsMatrix() (pyspark.ml.clustering.LDAModel method)@\spxentry{topicsMatrix()}\spxextra{pyspark.ml.clustering.LDAModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDAModel.topicsMatrix}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{topicsMatrix}}}{}{}
Inferred topics, where each topic is represented by a distribution over terms.
This is a matrix of size vocabSize x k, where each column is a topic.
No guarantees are given about the ordering of the topics.

WARNING: If this model is actually a {\hyperref[\detokenize{api:pyspark.ml.clustering.DistributedLDAModel}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{DistributedLDAModel}}}}} instance produced by
the Expectation-Maximization (“em”) \(optimizer\), then this method could involve
collecting a large amount of data to the driver (on the order of vocabSize x k).

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{vocabSize() (pyspark.ml.clustering.LDAModel method)@\spxentry{vocabSize()}\spxextra{pyspark.ml.clustering.LDAModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LDAModel.vocabSize}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{vocabSize}}}{}{}
Vocabulary size (number of terms or words in the vocabulary)

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{LocalLDAModel (class in pyspark.ml.clustering)@\spxentry{LocalLDAModel}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.LocalLDAModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{LocalLDAModel}}}{\emph{java\_model=None}}{}
Local (non-distributed) model fitted by {\hyperref[\detokenize{api:pyspark.ml.clustering.LDA}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{LDA}}}}}.
This model stores the inferred topics only; it does not store info about the training dataset.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{DistributedLDAModel (class in pyspark.ml.clustering)@\spxentry{DistributedLDAModel}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.DistributedLDAModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{DistributedLDAModel}}}{\emph{java\_model=None}}{}
Distributed model fitted by {\hyperref[\detokenize{api:pyspark.ml.clustering.LDA}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{LDA}}}}}.
This type of model is currently only produced by Expectation-Maximization (EM).

This model stores the inferred topics, the full training dataset, and the topic distribution
for each training document.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{getCheckpointFiles() (pyspark.ml.clustering.DistributedLDAModel method)@\spxentry{getCheckpointFiles()}\spxextra{pyspark.ml.clustering.DistributedLDAModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.DistributedLDAModel.getCheckpointFiles}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getCheckpointFiles}}}{}{}
If using checkpointing and \sphinxcode{\sphinxupquote{LDA.keepLastCheckpoint}} is set to true, then there may
be saved checkpoint files.  This method is provided so that users can manage those files.

\begin{sphinxadmonition}{note}{Note:}
Removing the checkpoints can cause failures if a partition is lost and is needed
by certain {\hyperref[\detokenize{api:pyspark.ml.clustering.DistributedLDAModel}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{DistributedLDAModel}}}}} methods.  Reference counting will clean up
the checkpoints when this model and derivative data go out of scope.
\end{sphinxadmonition}

:return  List of checkpoint files from training

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{logPrior() (pyspark.ml.clustering.DistributedLDAModel method)@\spxentry{logPrior()}\spxextra{pyspark.ml.clustering.DistributedLDAModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.DistributedLDAModel.logPrior}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{logPrior}}}{}{}
Log probability of the current parameter estimate:
log P(topics, topic distributions for docs \textbar{} alpha, eta)

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{toLocal() (pyspark.ml.clustering.DistributedLDAModel method)@\spxentry{toLocal()}\spxextra{pyspark.ml.clustering.DistributedLDAModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.DistributedLDAModel.toLocal}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{toLocal}}}{}{}
Convert this distributed model to a local representation.  This discards info about the
training dataset.

WARNING: This involves collecting a large \sphinxcode{\sphinxupquote{topicsMatrix()}} to the driver.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{trainingLogLikelihood() (pyspark.ml.clustering.DistributedLDAModel method)@\spxentry{trainingLogLikelihood()}\spxextra{pyspark.ml.clustering.DistributedLDAModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.DistributedLDAModel.trainingLogLikelihood}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{trainingLogLikelihood}}}{}{}
Log likelihood of the observed tokens in the training set,
given the current parameter estimates:
log P(docs \textbar{} topics, topic distributions for docs, Dirichlet hyperparameters)
\begin{description}
\item[{Notes:}] \leavevmode\begin{itemize}
\item {} 
This excludes the prior; for that, use {\hyperref[\detokenize{api:pyspark.ml.clustering.DistributedLDAModel.logPrior}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{logPrior()}}}}}.

\item {} 
Even with {\hyperref[\detokenize{api:pyspark.ml.clustering.DistributedLDAModel.logPrior}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{logPrior()}}}}}, this is NOT the same as the data log likelihood given
the hyperparameters.

\item {} 
This is computed from the topic distributions computed during training. If you call
\sphinxcode{\sphinxupquote{logLikelihood()}} on the same training dataset, the topic distributions
will be computed again, possibly giving different results.

\end{itemize}

\end{description}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{PowerIterationClustering (class in pyspark.ml.clustering)@\spxentry{PowerIterationClustering}\spxextra{class in pyspark.ml.clustering}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.PowerIterationClustering}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.clustering.}}\sphinxbfcode{\sphinxupquote{PowerIterationClustering}}}{\emph{k=2}, \emph{maxIter=20}, \emph{initMode='random'}, \emph{srcCol='src'}, \emph{dstCol='dst'}, \emph{weightCol=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Power Iteration Clustering (PIC), a scalable graph clustering algorithm developed by
\sphinxhref{http://www.icml2010.org/papers/387.pdf}{Lin and Cohen}. From the abstract:
PIC finds a very low-dimensional embedding of a dataset using truncated power
iteration on a normalized pair-wise similarity matrix of the data.

This class is not yet an Estimator/Transformer, use {\hyperref[\detokenize{api:pyspark.ml.clustering.PowerIterationClustering.assignClusters}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{assignClusters()}}}}} method
to run the PowerIterationClustering algorithm.


\sphinxstrong{See also:}


\sphinxhref{http://en.wikipedia.org/wiki/Spectral\_clustering}{Wikipedia on Spectral clustering}



\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{data} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }        \PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mf}{0.7}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }        \PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mf}{0.7}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mf}{0.9}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }        \PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mf}{0.7}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mf}{0.9}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mf}{1.1}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }        \PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mf}{0.7}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mf}{0.9}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mf}{1.1}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mf}{1.3}\PYG{p}{)}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{data}\PYG{p}{)}\PYG{o}{.}\PYG{n}{toDF}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{src}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{dst}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{weight}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{pic} \PYG{o}{=} \PYG{n}{PowerIterationClustering}\PYG{p}{(}\PYG{n}{k}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{40}\PYG{p}{,} \PYG{n}{weightCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{weight}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{assignments} \PYG{o}{=} \PYG{n}{pic}\PYG{o}{.}\PYG{n}{assignClusters}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{assignments}\PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{n}{assignments}\PYG{o}{.}\PYG{n}{id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{n}{truncate}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}id \textbar{}cluster\textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+go}{\textbar{}0  \textbar{}1      \textbar{}}
\PYG{g+go}{\textbar{}1  \textbar{}1      \textbar{}}
\PYG{g+go}{\textbar{}2  \textbar{}1      \textbar{}}
\PYG{g+go}{\textbar{}3  \textbar{}1      \textbar{}}
\PYG{g+go}{\textbar{}4  \textbar{}1      \textbar{}}
\PYG{g+go}{\textbar{}5  \textbar{}0      \textbar{}}
\PYG{g+go}{+\PYGZhy{}\PYGZhy{}\PYGZhy{}+\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}\PYGZhy{}+}
\PYG{g+gp}{...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{pic\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/pic}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{pic}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{pic\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{pic2} \PYG{o}{=} \PYG{n}{PowerIterationClustering}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{pic\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{pic2}\PYG{o}{.}\PYG{n}{getK}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{2}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{pic2}\PYG{o}{.}\PYG{n}{getMaxIter}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{40}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.4.0.}
\index{assignClusters() (pyspark.ml.clustering.PowerIterationClustering method)@\spxentry{assignClusters()}\spxextra{pyspark.ml.clustering.PowerIterationClustering method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.PowerIterationClustering.assignClusters}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{assignClusters}}}{\emph{dataset}}{}
Run the PIC algorithm and returns a cluster assignment for each input vertex.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{dataset}} \textendash{} A dataset with columns src, dst, weight representing the affinity matrix,
which is the matrix A in the PIC paper. Suppose the src column value is i,
the dst column value is j, the weight column value is similarity s,,ij,,
which must be nonnegative. This is a symmetric matrix and hence
s,,ij,, = s,,ji,,. For any (i, j) with nonzero similarity, there should be
either (i, j, s,,ij,,) or (j, i, s,,ji,,) in the input. Rows with i = j are
ignored, because we assume s,,ij,, = 0.0.

\item[{Returns}] \leavevmode
A dataset that contains columns of vertex id and the corresponding cluster for
the id. The schema of it will be:
- id: Long
- cluster: Int

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.4.0.}

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{getDstCol() (pyspark.ml.clustering.PowerIterationClustering method)@\spxentry{getDstCol()}\spxextra{pyspark.ml.clustering.PowerIterationClustering method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.PowerIterationClustering.getDstCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getDstCol}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{dstCol}} or its default value.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{getInitMode() (pyspark.ml.clustering.PowerIterationClustering method)@\spxentry{getInitMode()}\spxextra{pyspark.ml.clustering.PowerIterationClustering method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.PowerIterationClustering.getInitMode}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getInitMode}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{initMode}} or its default value.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{getK() (pyspark.ml.clustering.PowerIterationClustering method)@\spxentry{getK()}\spxextra{pyspark.ml.clustering.PowerIterationClustering method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.PowerIterationClustering.getK}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getK}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{k}} or its default value.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{getSrcCol() (pyspark.ml.clustering.PowerIterationClustering method)@\spxentry{getSrcCol()}\spxextra{pyspark.ml.clustering.PowerIterationClustering method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.PowerIterationClustering.getSrcCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getSrcCol}}}{}{}
Gets the value of \sphinxcode{\sphinxupquote{srcCol}} or its default value.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{setDstCol() (pyspark.ml.clustering.PowerIterationClustering method)@\spxentry{setDstCol()}\spxextra{pyspark.ml.clustering.PowerIterationClustering method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.PowerIterationClustering.setDstCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setDstCol}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{dstCol}}.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{setInitMode() (pyspark.ml.clustering.PowerIterationClustering method)@\spxentry{setInitMode()}\spxextra{pyspark.ml.clustering.PowerIterationClustering method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.PowerIterationClustering.setInitMode}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setInitMode}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{initMode}}.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{setK() (pyspark.ml.clustering.PowerIterationClustering method)@\spxentry{setK()}\spxextra{pyspark.ml.clustering.PowerIterationClustering method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.PowerIterationClustering.setK}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setK}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{k}}.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.clustering.PowerIterationClustering method)@\spxentry{setParams()}\spxextra{pyspark.ml.clustering.PowerIterationClustering method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.PowerIterationClustering.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{k=2}, \emph{maxIter=20}, \emph{initMode="random"}, \emph{srcCol="src"}, \emph{dstCol="dst"}, \emph{weightCol=None}}{}
Sets params for PowerIterationClustering.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{setSrcCol() (pyspark.ml.clustering.PowerIterationClustering method)@\spxentry{setSrcCol()}\spxextra{pyspark.ml.clustering.PowerIterationClustering method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.clustering.PowerIterationClustering.setSrcCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setSrcCol}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{srcCol}}.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}


\end{fulllineitems}



\section{Recommendation API}
\label{\detokenize{api:module-pyspark.ml.recommendation}}\label{\detokenize{api:recommendation-api}}\index{pyspark.ml.recommendation (module)@\spxentry{pyspark.ml.recommendation}\spxextra{module}}\index{ALS (class in pyspark.ml.recommendation)@\spxentry{ALS}\spxextra{class in pyspark.ml.recommendation}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.recommendation.}}\sphinxbfcode{\sphinxupquote{ALS}}}{\emph{rank=10}, \emph{maxIter=10}, \emph{regParam=0.1}, \emph{numUserBlocks=10}, \emph{numItemBlocks=10}, \emph{implicitPrefs=False}, \emph{alpha=1.0}, \emph{userCol='user'}, \emph{itemCol='item'}, \emph{seed=None}, \emph{ratingCol='rating'}, \emph{nonnegative=False}, \emph{checkpointInterval=10}, \emph{intermediateStorageLevel='MEMORY\_AND\_DISK'}, \emph{finalStorageLevel='MEMORY\_AND\_DISK'}, \emph{coldStartStrategy='nan'}}{}
Alternating Least Squares (ALS) matrix factorization.

ALS attempts to estimate the ratings matrix \(R\) as the product of
two lower-rank matrices, \(X\) and \(Y\), i.e. \(X * Yt = R\). Typically
these approximations are called ‘factor’ matrices. The general
approach is iterative. During each iteration, one of the factor
matrices is held constant, while the other is solved for using least
squares. The newly-solved factor matrix is then held constant while
solving for the other factor matrix.

This is a blocked implementation of the ALS factorization algorithm
that groups the two sets of factors (referred to as “users” and
“products”) into blocks and reduces communication by only sending
one copy of each user vector to each product block on each
iteration, and only for the product blocks that need that user’s
feature vector. This is achieved by pre-computing some information
about the ratings matrix to determine the “out-links” of each user
(which blocks of products it will contribute to) and “in-link”
information for each product (which of the feature vectors it
receives from each user block it will depend on). This allows us to
send only an array of feature vectors between each user block and
product block, and have the product block find the users’ ratings
and update the products based on these messages.

For implicit preference data, the algorithm used is based on
\sphinxhref{http://dx.doi.org/10.1109/ICDM.2008.22}{“Collaborative Filtering for Implicit Feedback Datasets”,}, adapted for the blocked
approach used here.

Essentially instead of finding the low-rank approximations to the
rating matrix \(R\), this finds the approximations for a preference
matrix \(P\) where the elements of \(P\) are 1 if r \textgreater{} 0 and 0 if r \textless{}= 0.
The ratings then act as ‘confidence’ values related to strength of
indicated user preferences rather than explicit ratings given to
items.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{df} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}
\PYG{g+gp}{... }    \PYG{p}{[}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mf}{4.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mf}{2.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mf}{3.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mf}{4.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mf}{5.0}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{user}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{item}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rating}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{als} \PYG{o}{=} \PYG{n}{ALS}\PYG{p}{(}\PYG{n}{rank}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{maxIter}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{seed}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model} \PYG{o}{=} \PYG{n}{als}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{df}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{rank}
\PYG{g+go}{10}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{userFactors}\PYG{o}{.}\PYG{n}{orderBy}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{id}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{[Row(id=0, features=[...]), Row(id=1, ...), Row(id=2, ...)]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{test} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{p}{[}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{user}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{item}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{predictions} \PYG{o}{=} \PYG{n+nb}{sorted}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{test}\PYG{p}{)}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{key}\PYG{o}{=}\PYG{k}{lambda} \PYG{n}{r}\PYG{p}{:} \PYG{n}{r}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{predictions}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{g+go}{Row(user=0, item=2, prediction=\PYGZhy{}0.13807615637779236)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{predictions}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}
\PYG{g+go}{Row(user=1, item=0, prediction=2.6258413791656494)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{predictions}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}
\PYG{g+go}{Row(user=2, item=0, prediction=\PYGZhy{}1.5018409490585327)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{user\PYGZus{}recs} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{recommendForAllUsers}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{user\PYGZus{}recs}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{user\PYGZus{}recs}\PYG{o}{.}\PYG{n}{user} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{)}        \PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{recommendations.item}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{recommendations.rating}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{[Row(item=[0, 1, 2], rating=[3.910..., 1.992..., \PYGZhy{}0.138...])]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{item\PYGZus{}recs} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{recommendForAllItems}\PYG{p}{(}\PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{item\PYGZus{}recs}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{item\PYGZus{}recs}\PYG{o}{.}\PYG{n}{item} \PYG{o}{==} \PYG{l+m+mi}{2}\PYG{p}{)}        \PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{recommendations.user}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{recommendations.rating}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{[Row(user=[2, 1, 0], rating=[4.901..., 3.981..., \PYGZhy{}0.138...])]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{user\PYGZus{}subset} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{df}\PYG{o}{.}\PYG{n}{user} \PYG{o}{==} \PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{user\PYGZus{}subset\PYGZus{}recs} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{recommendForUserSubset}\PYG{p}{(}\PYG{n}{user\PYGZus{}subset}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{user\PYGZus{}subset\PYGZus{}recs}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{recommendations.item}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{recommendations.rating}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{first}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{Row(item=[2, 1, 0], rating=[4.901..., 1.056..., \PYGZhy{}1.501...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{item\PYGZus{}subset} \PYG{o}{=} \PYG{n}{df}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{df}\PYG{o}{.}\PYG{n}{item} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{item\PYGZus{}subset\PYGZus{}recs} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{recommendForItemSubset}\PYG{p}{(}\PYG{n}{item\PYGZus{}subset}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{item\PYGZus{}subset\PYGZus{}recs}\PYG{o}{.}\PYG{n}{select}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{recommendations.user}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{recommendations.rating}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{first}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{Row(user=[0, 1, 2], rating=[3.910..., 2.625..., \PYGZhy{}1.501...])}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{als\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/als}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{als}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{als\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{als2} \PYG{o}{=} \PYG{n}{ALS}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{als\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{als}\PYG{o}{.}\PYG{n}{getMaxIter}\PYG{p}{(}\PYG{p}{)}
\PYG{g+go}{5}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/als\PYGZus{}model}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model2} \PYG{o}{=} \PYG{n}{ALSModel}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{model\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{model}\PYG{o}{.}\PYG{n}{rank} \PYG{o}{==} \PYG{n}{model2}\PYG{o}{.}\PYG{n}{rank}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{sorted}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{userFactors}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)} \PYG{o}{==} \PYG{n+nb}{sorted}\PYG{p}{(}\PYG{n}{model2}\PYG{o}{.}\PYG{n}{userFactors}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{sorted}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{itemFactors}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)} \PYG{o}{==} \PYG{n+nb}{sorted}\PYG{p}{(}\PYG{n}{model2}\PYG{o}{.}\PYG{n}{itemFactors}\PYG{o}{.}\PYG{n}{collect}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{True}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.4.0.}
\index{getAlpha() (pyspark.ml.recommendation.ALS method)@\spxentry{getAlpha()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.getAlpha}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getAlpha}}}{}{}
Gets the value of alpha or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{getColdStartStrategy() (pyspark.ml.recommendation.ALS method)@\spxentry{getColdStartStrategy()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.getColdStartStrategy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getColdStartStrategy}}}{}{}
Gets the value of coldStartStrategy or its default value.

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}

\index{getFinalStorageLevel() (pyspark.ml.recommendation.ALS method)@\spxentry{getFinalStorageLevel()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.getFinalStorageLevel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getFinalStorageLevel}}}{}{}
Gets the value of finalStorageLevel or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getImplicitPrefs() (pyspark.ml.recommendation.ALS method)@\spxentry{getImplicitPrefs()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.getImplicitPrefs}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getImplicitPrefs}}}{}{}
Gets the value of implicitPrefs or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{getIntermediateStorageLevel() (pyspark.ml.recommendation.ALS method)@\spxentry{getIntermediateStorageLevel()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.getIntermediateStorageLevel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getIntermediateStorageLevel}}}{}{}
Gets the value of intermediateStorageLevel or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getItemCol() (pyspark.ml.recommendation.ALS method)@\spxentry{getItemCol()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.getItemCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getItemCol}}}{}{}
Gets the value of itemCol or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{getNonnegative() (pyspark.ml.recommendation.ALS method)@\spxentry{getNonnegative()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.getNonnegative}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getNonnegative}}}{}{}
Gets the value of nonnegative or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{getNumItemBlocks() (pyspark.ml.recommendation.ALS method)@\spxentry{getNumItemBlocks()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.getNumItemBlocks}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getNumItemBlocks}}}{}{}
Gets the value of numItemBlocks or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{getNumUserBlocks() (pyspark.ml.recommendation.ALS method)@\spxentry{getNumUserBlocks()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.getNumUserBlocks}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getNumUserBlocks}}}{}{}
Gets the value of numUserBlocks or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{getRank() (pyspark.ml.recommendation.ALS method)@\spxentry{getRank()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.getRank}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getRank}}}{}{}
Gets the value of rank or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{getRatingCol() (pyspark.ml.recommendation.ALS method)@\spxentry{getRatingCol()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.getRatingCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getRatingCol}}}{}{}
Gets the value of ratingCol or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{getUserCol() (pyspark.ml.recommendation.ALS method)@\spxentry{getUserCol()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.getUserCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getUserCol}}}{}{}
Gets the value of userCol or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setAlpha() (pyspark.ml.recommendation.ALS method)@\spxentry{setAlpha()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setAlpha}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setAlpha}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{alpha}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setColdStartStrategy() (pyspark.ml.recommendation.ALS method)@\spxentry{setColdStartStrategy()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setColdStartStrategy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setColdStartStrategy}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{coldStartStrategy}}.

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}

\index{setFinalStorageLevel() (pyspark.ml.recommendation.ALS method)@\spxentry{setFinalStorageLevel()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setFinalStorageLevel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setFinalStorageLevel}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{finalStorageLevel}}.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setImplicitPrefs() (pyspark.ml.recommendation.ALS method)@\spxentry{setImplicitPrefs()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setImplicitPrefs}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setImplicitPrefs}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{implicitPrefs}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setIntermediateStorageLevel() (pyspark.ml.recommendation.ALS method)@\spxentry{setIntermediateStorageLevel()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setIntermediateStorageLevel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setIntermediateStorageLevel}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{intermediateStorageLevel}}.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setItemCol() (pyspark.ml.recommendation.ALS method)@\spxentry{setItemCol()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setItemCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setItemCol}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{itemCol}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setNonnegative() (pyspark.ml.recommendation.ALS method)@\spxentry{setNonnegative()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setNonnegative}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setNonnegative}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{nonnegative}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setNumBlocks() (pyspark.ml.recommendation.ALS method)@\spxentry{setNumBlocks()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setNumBlocks}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setNumBlocks}}}{\emph{value}}{}
Sets both \sphinxcode{\sphinxupquote{numUserBlocks}} and \sphinxcode{\sphinxupquote{numItemBlocks}} to the specific value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setNumItemBlocks() (pyspark.ml.recommendation.ALS method)@\spxentry{setNumItemBlocks()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setNumItemBlocks}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setNumItemBlocks}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{numItemBlocks}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setNumUserBlocks() (pyspark.ml.recommendation.ALS method)@\spxentry{setNumUserBlocks()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setNumUserBlocks}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setNumUserBlocks}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{numUserBlocks}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.recommendation.ALS method)@\spxentry{setParams()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{rank=10}, \emph{maxIter=10}, \emph{regParam=0.1}, \emph{numUserBlocks=10}, \emph{numItemBlocks=10}, \emph{implicitPrefs=False}, \emph{alpha=1.0}, \emph{userCol="user"}, \emph{itemCol="item"}, \emph{seed=None}, \emph{ratingCol="rating"}, \emph{nonnegative=False}, \emph{checkpointInterval=10}, \emph{intermediateStorageLevel="MEMORY\_AND\_DISK"}, \emph{finalStorageLevel="MEMORY\_AND\_DISK"}, \emph{coldStartStrategy="nan"}}{}
Sets params for ALS.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setRank() (pyspark.ml.recommendation.ALS method)@\spxentry{setRank()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setRank}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setRank}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{rank}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setRatingCol() (pyspark.ml.recommendation.ALS method)@\spxentry{setRatingCol()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setRatingCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setRatingCol}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{ratingCol}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setUserCol() (pyspark.ml.recommendation.ALS method)@\spxentry{setUserCol()}\spxextra{pyspark.ml.recommendation.ALS method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALS.setUserCol}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setUserCol}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{userCol}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{ALSModel (class in pyspark.ml.recommendation)@\spxentry{ALSModel}\spxextra{class in pyspark.ml.recommendation}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALSModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.recommendation.}}\sphinxbfcode{\sphinxupquote{ALSModel}}}{\emph{java\_model=None}}{}
Model fitted by ALS.

\DUrole{versionmodified}{New in version 1.4.0.}
\index{itemFactors (pyspark.ml.recommendation.ALSModel attribute)@\spxentry{itemFactors}\spxextra{pyspark.ml.recommendation.ALSModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALSModel.itemFactors}}\pysigline{\sphinxbfcode{\sphinxupquote{itemFactors}}}
\(id\) and
\(features\)

\DUrole{versionmodified}{New in version 1.4.0.}
\begin{quote}\begin{description}
\item[{Type}] \leavevmode
a DataFrame that stores item factors in two columns

\end{description}\end{quote}

\end{fulllineitems}

\index{rank (pyspark.ml.recommendation.ALSModel attribute)@\spxentry{rank}\spxextra{pyspark.ml.recommendation.ALSModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALSModel.rank}}\pysigline{\sphinxbfcode{\sphinxupquote{rank}}}
rank of the matrix factorization model

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{recommendForAllItems() (pyspark.ml.recommendation.ALSModel method)@\spxentry{recommendForAllItems()}\spxextra{pyspark.ml.recommendation.ALSModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALSModel.recommendForAllItems}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{recommendForAllItems}}}{\emph{numUsers}}{}
Returns top \(numUsers\) users recommended for each item, for all items.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{numUsers}} \textendash{} max number of recommendations for each item

\item[{Returns}] \leavevmode
a DataFrame of (itemCol, recommendations), where recommendations are
stored as an array of (userCol, rating) Rows.

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}

\index{recommendForAllUsers() (pyspark.ml.recommendation.ALSModel method)@\spxentry{recommendForAllUsers()}\spxextra{pyspark.ml.recommendation.ALSModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALSModel.recommendForAllUsers}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{recommendForAllUsers}}}{\emph{numItems}}{}
Returns top \(numItems\) items recommended for each user, for all users.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{numItems}} \textendash{} max number of recommendations for each user

\item[{Returns}] \leavevmode
a DataFrame of (userCol, recommendations), where recommendations are
stored as an array of (itemCol, rating) Rows.

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.2.0.}

\end{fulllineitems}

\index{recommendForItemSubset() (pyspark.ml.recommendation.ALSModel method)@\spxentry{recommendForItemSubset()}\spxextra{pyspark.ml.recommendation.ALSModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALSModel.recommendForItemSubset}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{recommendForItemSubset}}}{\emph{dataset}, \emph{numUsers}}{}
Returns top \(numUsers\) users recommended for each item id in the input data set. Note that
if there are duplicate ids in the input dataset, only one set of recommendations per unique
id will be returned.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode\begin{itemize}
\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{dataset}} \textendash{} a Dataset containing a column of item ids. The column name must match
\(itemCol\).

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{numUsers}} \textendash{} max number of recommendations for each item

\end{itemize}

\item[{Returns}] \leavevmode
a DataFrame of (itemCol, recommendations), where recommendations are
stored as an array of (userCol, rating) Rows.

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{recommendForUserSubset() (pyspark.ml.recommendation.ALSModel method)@\spxentry{recommendForUserSubset()}\spxextra{pyspark.ml.recommendation.ALSModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALSModel.recommendForUserSubset}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{recommendForUserSubset}}}{\emph{dataset}, \emph{numItems}}{}
Returns top \(numItems\) items recommended for each user id in the input data set. Note that
if there are duplicate ids in the input dataset, only one set of recommendations per unique
id will be returned.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode\begin{itemize}
\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{dataset}} \textendash{} a Dataset containing a column of user ids. The column name must match
\(userCol\).

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{numItems}} \textendash{} max number of recommendations for each user

\end{itemize}

\item[{Returns}] \leavevmode
a DataFrame of (userCol, recommendations), where recommendations are
stored as an array of (itemCol, rating) Rows.

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{userFactors (pyspark.ml.recommendation.ALSModel attribute)@\spxentry{userFactors}\spxextra{pyspark.ml.recommendation.ALSModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.recommendation.ALSModel.userFactors}}\pysigline{\sphinxbfcode{\sphinxupquote{userFactors}}}
\(id\) and
\(features\)

\DUrole{versionmodified}{New in version 1.4.0.}
\begin{quote}\begin{description}
\item[{Type}] \leavevmode
a DataFrame that stores user factors in two columns

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}



\section{Pipeline API}
\label{\detokenize{api:module-pyspark.ml.pipeline}}\label{\detokenize{api:pipeline-api}}\index{pyspark.ml.pipeline (module)@\spxentry{pyspark.ml.pipeline}\spxextra{module}}\index{Pipeline (class in pyspark.ml.pipeline)@\spxentry{Pipeline}\spxextra{class in pyspark.ml.pipeline}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.Pipeline}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.pipeline.}}\sphinxbfcode{\sphinxupquote{Pipeline}}}{\emph{stages=None}}{}
A simple pipeline, which acts as an estimator. A Pipeline consists
of a sequence of stages, each of which is either an
\sphinxcode{\sphinxupquote{Estimator}} or a \sphinxcode{\sphinxupquote{Transformer}}. When
\sphinxcode{\sphinxupquote{Pipeline.fit()}} is called, the stages are executed in
order. If a stage is an \sphinxcode{\sphinxupquote{Estimator}}, its
\sphinxcode{\sphinxupquote{Estimator.fit()}} method will be called on the input
dataset to fit a model. Then the model, which is a transformer,
will be used to transform the dataset as the input to the next
stage. If a stage is a \sphinxcode{\sphinxupquote{Transformer}}, its
\sphinxcode{\sphinxupquote{Transformer.transform()}} method will be called to produce
the dataset for the next stage. The fitted model from a
{\hyperref[\detokenize{api:pyspark.ml.pipeline.Pipeline}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{Pipeline}}}}} is a {\hyperref[\detokenize{api:pyspark.ml.pipeline.PipelineModel}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{PipelineModel}}}}}, which
consists of fitted models and transformers, corresponding to the
pipeline stages. If stages is an empty list, the pipeline acts as an
identity transformer.

\DUrole{versionmodified}{New in version 1.3.0.}
\index{copy() (pyspark.ml.pipeline.Pipeline method)@\spxentry{copy()}\spxextra{pyspark.ml.pipeline.Pipeline method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.Pipeline.copy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{copy}}}{\emph{extra=None}}{}
Creates a copy of this instance.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{extra}} \textendash{} extra parameters

\item[{Returns}] \leavevmode
new instance

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{getStages() (pyspark.ml.pipeline.Pipeline method)@\spxentry{getStages()}\spxextra{pyspark.ml.pipeline.Pipeline method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.Pipeline.getStages}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getStages}}}{}{}
Get pipeline stages.

\DUrole{versionmodified}{New in version 1.3.0.}

\end{fulllineitems}

\index{read() (pyspark.ml.pipeline.Pipeline class method)@\spxentry{read()}\spxextra{pyspark.ml.pipeline.Pipeline class method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.Pipeline.read}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{classmethod }}\sphinxbfcode{\sphinxupquote{read}}}{}{}
Returns an MLReader instance for this class.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.pipeline.Pipeline method)@\spxentry{setParams()}\spxextra{pyspark.ml.pipeline.Pipeline method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.Pipeline.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{stages=None}}{}
Sets params for Pipeline.

\DUrole{versionmodified}{New in version 1.3.0.}

\end{fulllineitems}

\index{setStages() (pyspark.ml.pipeline.Pipeline method)@\spxentry{setStages()}\spxextra{pyspark.ml.pipeline.Pipeline method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.Pipeline.setStages}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setStages}}}{\emph{value}}{}
Set pipeline stages.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{value}} \textendash{} a list of transformers or estimators

\item[{Returns}] \leavevmode
the pipeline instance

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 1.3.0.}

\end{fulllineitems}

\index{write() (pyspark.ml.pipeline.Pipeline method)@\spxentry{write()}\spxextra{pyspark.ml.pipeline.Pipeline method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.Pipeline.write}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{write}}}{}{}
Returns an MLWriter instance for this ML instance.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{PipelineModel (class in pyspark.ml.pipeline)@\spxentry{PipelineModel}\spxextra{class in pyspark.ml.pipeline}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.pipeline.}}\sphinxbfcode{\sphinxupquote{PipelineModel}}}{\emph{stages}}{}
Represents a compiled pipeline with transformers and fitted models.

\DUrole{versionmodified}{New in version 1.3.0.}
\index{copy() (pyspark.ml.pipeline.PipelineModel method)@\spxentry{copy()}\spxextra{pyspark.ml.pipeline.PipelineModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineModel.copy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{copy}}}{\emph{extra=None}}{}
Creates a copy of this instance.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{extra}} \textendash{} extra parameters

\item[{Returns}] \leavevmode
new instance

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{read() (pyspark.ml.pipeline.PipelineModel class method)@\spxentry{read()}\spxextra{pyspark.ml.pipeline.PipelineModel class method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineModel.read}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{classmethod }}\sphinxbfcode{\sphinxupquote{read}}}{}{}
Returns an MLReader instance for this class.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{write() (pyspark.ml.pipeline.PipelineModel method)@\spxentry{write()}\spxextra{pyspark.ml.pipeline.PipelineModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineModel.write}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{write}}}{}{}
Returns an MLWriter instance for this ML instance.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{PipelineModelReader (class in pyspark.ml.pipeline)@\spxentry{PipelineModelReader}\spxextra{class in pyspark.ml.pipeline}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineModelReader}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.pipeline.}}\sphinxbfcode{\sphinxupquote{PipelineModelReader}}}{\emph{cls}}{}
(Private) Specialization of \sphinxcode{\sphinxupquote{MLReader}} for {\hyperref[\detokenize{api:pyspark.ml.pipeline.PipelineModel}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{PipelineModel}}}}} types
\index{load() (pyspark.ml.pipeline.PipelineModelReader method)@\spxentry{load()}\spxextra{pyspark.ml.pipeline.PipelineModelReader method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineModelReader.load}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{load}}}{\emph{path}}{}
Load the ML instance from the input path.

\end{fulllineitems}


\end{fulllineitems}

\index{PipelineModelWriter (class in pyspark.ml.pipeline)@\spxentry{PipelineModelWriter}\spxextra{class in pyspark.ml.pipeline}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineModelWriter}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.pipeline.}}\sphinxbfcode{\sphinxupquote{PipelineModelWriter}}}{\emph{instance}}{}
(Private) Specialization of \sphinxcode{\sphinxupquote{MLWriter}} for {\hyperref[\detokenize{api:pyspark.ml.pipeline.PipelineModel}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{PipelineModel}}}}} types
\index{saveImpl() (pyspark.ml.pipeline.PipelineModelWriter method)@\spxentry{saveImpl()}\spxextra{pyspark.ml.pipeline.PipelineModelWriter method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineModelWriter.saveImpl}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{saveImpl}}}{\emph{path}}{}
save() handles overwriting and then calls this method.  Subclasses should override this
method to implement the actual saving of the instance.

\end{fulllineitems}


\end{fulllineitems}

\index{PipelineReader (class in pyspark.ml.pipeline)@\spxentry{PipelineReader}\spxextra{class in pyspark.ml.pipeline}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineReader}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.pipeline.}}\sphinxbfcode{\sphinxupquote{PipelineReader}}}{\emph{cls}}{}
(Private) Specialization of \sphinxcode{\sphinxupquote{MLReader}} for {\hyperref[\detokenize{api:pyspark.ml.pipeline.Pipeline}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{Pipeline}}}}} types
\index{load() (pyspark.ml.pipeline.PipelineReader method)@\spxentry{load()}\spxextra{pyspark.ml.pipeline.PipelineReader method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineReader.load}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{load}}}{\emph{path}}{}
Load the ML instance from the input path.

\end{fulllineitems}


\end{fulllineitems}

\index{PipelineSharedReadWrite (class in pyspark.ml.pipeline)@\spxentry{PipelineSharedReadWrite}\spxextra{class in pyspark.ml.pipeline}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineSharedReadWrite}}\pysigline{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.pipeline.}}\sphinxbfcode{\sphinxupquote{PipelineSharedReadWrite}}}~
\begin{sphinxadmonition}{note}{Note:}
DeveloperApi
\end{sphinxadmonition}

Functions for \sphinxcode{\sphinxupquote{MLReader}} and \sphinxcode{\sphinxupquote{MLWriter}} shared between
{\hyperref[\detokenize{api:pyspark.ml.pipeline.Pipeline}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{Pipeline}}}}} and {\hyperref[\detokenize{api:pyspark.ml.pipeline.PipelineModel}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{PipelineModel}}}}}

\DUrole{versionmodified}{New in version 2.3.0.}
\index{getStagePath() (pyspark.ml.pipeline.PipelineSharedReadWrite static method)@\spxentry{getStagePath()}\spxextra{pyspark.ml.pipeline.PipelineSharedReadWrite static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineSharedReadWrite.getStagePath}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{getStagePath}}}{\emph{stageUid}, \emph{stageIdx}, \emph{numStages}, \emph{stagesDir}}{}
Get path for saving the given stage.

\end{fulllineitems}

\index{load() (pyspark.ml.pipeline.PipelineSharedReadWrite static method)@\spxentry{load()}\spxextra{pyspark.ml.pipeline.PipelineSharedReadWrite static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineSharedReadWrite.load}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{load}}}{\emph{metadata}, \emph{sc}, \emph{path}}{}
Load metadata and stages for a {\hyperref[\detokenize{api:pyspark.ml.pipeline.Pipeline}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{Pipeline}}}}} or {\hyperref[\detokenize{api:pyspark.ml.pipeline.PipelineModel}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{PipelineModel}}}}}
\begin{quote}\begin{description}
\item[{Returns}] \leavevmode
(UID, list of stages)

\end{description}\end{quote}

\end{fulllineitems}

\index{saveImpl() (pyspark.ml.pipeline.PipelineSharedReadWrite static method)@\spxentry{saveImpl()}\spxextra{pyspark.ml.pipeline.PipelineSharedReadWrite static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineSharedReadWrite.saveImpl}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{saveImpl}}}{\emph{instance}, \emph{stages}, \emph{sc}, \emph{path}}{}
Save metadata and stages for a {\hyperref[\detokenize{api:pyspark.ml.pipeline.Pipeline}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{Pipeline}}}}} or {\hyperref[\detokenize{api:pyspark.ml.pipeline.PipelineModel}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{PipelineModel}}}}}
- save metadata to path/metadata
- save stages to stages/IDX\_UID

\end{fulllineitems}

\index{validateStages() (pyspark.ml.pipeline.PipelineSharedReadWrite static method)@\spxentry{validateStages()}\spxextra{pyspark.ml.pipeline.PipelineSharedReadWrite static method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineSharedReadWrite.validateStages}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{static }}\sphinxbfcode{\sphinxupquote{validateStages}}}{\emph{stages}}{}
Check that all stages are Writable

\end{fulllineitems}


\end{fulllineitems}

\index{PipelineWriter (class in pyspark.ml.pipeline)@\spxentry{PipelineWriter}\spxextra{class in pyspark.ml.pipeline}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineWriter}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.pipeline.}}\sphinxbfcode{\sphinxupquote{PipelineWriter}}}{\emph{instance}}{}
(Private) Specialization of \sphinxcode{\sphinxupquote{MLWriter}} for {\hyperref[\detokenize{api:pyspark.ml.pipeline.Pipeline}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{Pipeline}}}}} types
\index{saveImpl() (pyspark.ml.pipeline.PipelineWriter method)@\spxentry{saveImpl()}\spxextra{pyspark.ml.pipeline.PipelineWriter method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.pipeline.PipelineWriter.saveImpl}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{saveImpl}}}{\emph{path}}{}
save() handles overwriting and then calls this method.  Subclasses should override this
method to implement the actual saving of the instance.

\end{fulllineitems}


\end{fulllineitems}



\section{Tuning API}
\label{\detokenize{api:module-pyspark.ml.tuning}}\label{\detokenize{api:tuning-api}}\index{pyspark.ml.tuning (module)@\spxentry{pyspark.ml.tuning}\spxextra{module}}\index{ParamGridBuilder (class in pyspark.ml.tuning)@\spxentry{ParamGridBuilder}\spxextra{class in pyspark.ml.tuning}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.ParamGridBuilder}}\pysigline{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.tuning.}}\sphinxbfcode{\sphinxupquote{ParamGridBuilder}}}
Builder for a param grid used in grid search-based model selection.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{classification} \PYG{k}{import} \PYG{n}{LogisticRegression}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr} \PYG{o}{=} \PYG{n}{LogisticRegression}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{output} \PYG{o}{=} \PYG{n}{ParamGridBuilder}\PYG{p}{(}\PYG{p}{)} \PYGZbs{}
\PYG{g+gp}{... }    \PYG{o}{.}\PYG{n}{baseOn}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{n}{lr}\PYG{o}{.}\PYG{n}{labelCol}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{l}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)} \PYGZbs{}
\PYG{g+gp}{... }    \PYG{o}{.}\PYG{n}{baseOn}\PYG{p}{(}\PYG{p}{[}\PYG{n}{lr}\PYG{o}{.}\PYG{n}{predictionCol}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{p}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)} \PYGZbs{}
\PYG{g+gp}{... }    \PYG{o}{.}\PYG{n}{addGrid}\PYG{p}{(}\PYG{n}{lr}\PYG{o}{.}\PYG{n}{regParam}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{2.0}\PYG{p}{]}\PYG{p}{)} \PYGZbs{}
\PYG{g+gp}{... }    \PYG{o}{.}\PYG{n}{addGrid}\PYG{p}{(}\PYG{n}{lr}\PYG{o}{.}\PYG{n}{maxIter}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{)} \PYGZbs{}
\PYG{g+gp}{... }    \PYG{o}{.}\PYG{n}{build}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{expected} \PYG{o}{=} \PYG{p}{[}
\PYG{g+gp}{... }    \PYG{p}{\PYGZob{}}\PYG{n}{lr}\PYG{o}{.}\PYG{n}{regParam}\PYG{p}{:} \PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{maxIter}\PYG{p}{:} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{labelCol}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{l}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{predictionCol}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{p}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{\PYGZob{}}\PYG{n}{lr}\PYG{o}{.}\PYG{n}{regParam}\PYG{p}{:} \PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{maxIter}\PYG{p}{:} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{labelCol}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{l}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{predictionCol}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{p}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{\PYGZob{}}\PYG{n}{lr}\PYG{o}{.}\PYG{n}{regParam}\PYG{p}{:} \PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{maxIter}\PYG{p}{:} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{labelCol}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{l}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{predictionCol}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{p}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{\PYGZob{}}\PYG{n}{lr}\PYG{o}{.}\PYG{n}{regParam}\PYG{p}{:} \PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{maxIter}\PYG{p}{:} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{labelCol}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{l}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{lr}\PYG{o}{.}\PYG{n}{predictionCol}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{p}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{output}\PYG{p}{)} \PYG{o}{==} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{expected}\PYG{p}{)}
\PYG{g+go}{True}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{all}\PYG{p}{(}\PYG{p}{[}\PYG{n}{m} \PYG{o+ow}{in} \PYG{n}{expected} \PYG{k}{for} \PYG{n}{m} \PYG{o+ow}{in} \PYG{n}{output}\PYG{p}{]}\PYG{p}{)}
\PYG{g+go}{True}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.4.0.}
\index{addGrid() (pyspark.ml.tuning.ParamGridBuilder method)@\spxentry{addGrid()}\spxextra{pyspark.ml.tuning.ParamGridBuilder method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.ParamGridBuilder.addGrid}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{addGrid}}}{\emph{param}, \emph{values}}{}
Sets the given parameters in this grid to fixed values.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{baseOn() (pyspark.ml.tuning.ParamGridBuilder method)@\spxentry{baseOn()}\spxextra{pyspark.ml.tuning.ParamGridBuilder method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.ParamGridBuilder.baseOn}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{baseOn}}}{\emph{*args}}{}
Sets the given parameters in this grid to fixed values.
Accepts either a parameter dictionary or a list of (parameter, value) pairs.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{build() (pyspark.ml.tuning.ParamGridBuilder method)@\spxentry{build()}\spxextra{pyspark.ml.tuning.ParamGridBuilder method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.ParamGridBuilder.build}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{build}}}{}{}
Builds and returns all combinations of parameters specified
by the param grid.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{CrossValidator (class in pyspark.ml.tuning)@\spxentry{CrossValidator}\spxextra{class in pyspark.ml.tuning}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidator}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.tuning.}}\sphinxbfcode{\sphinxupquote{CrossValidator}}}{\emph{estimator=None}, \emph{estimatorParamMaps=None}, \emph{evaluator=None}, \emph{numFolds=3}, \emph{seed=None}, \emph{parallelism=1}, \emph{collectSubModels=False}}{}
K-fold cross validation performs model selection by splitting the dataset into a set of
non-overlapping randomly partitioned folds which are used as separate training and test datasets
e.g., with k=3 folds, K-fold cross validation will generate 3 (training, test) dataset pairs,
each of which uses 2/3 of the data for training and 1/3 for testing. Each fold is used as the
test set exactly once.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{classification} \PYG{k}{import} \PYG{n}{LogisticRegression}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{evaluation} \PYG{k}{import} \PYG{n}{BinaryClassificationEvaluator}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}
\PYG{g+gp}{... }    \PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }     \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }     \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.5}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }     \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }     \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{]} \PYG{o}{*} \PYG{l+m+mi}{10}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr} \PYG{o}{=} \PYG{n}{LogisticRegression}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{grid} \PYG{o}{=} \PYG{n}{ParamGridBuilder}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{addGrid}\PYG{p}{(}\PYG{n}{lr}\PYG{o}{.}\PYG{n}{maxIter}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{build}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{BinaryClassificationEvaluator}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{cv} \PYG{o}{=} \PYG{n}{CrossValidator}\PYG{p}{(}\PYG{n}{estimator}\PYG{o}{=}\PYG{n}{lr}\PYG{p}{,} \PYG{n}{estimatorParamMaps}\PYG{o}{=}\PYG{n}{grid}\PYG{p}{,} \PYG{n}{evaluator}\PYG{o}{=}\PYG{n}{evaluator}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{n}{parallelism}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{cvModel} \PYG{o}{=} \PYG{n}{cv}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{cvModel}\PYG{o}{.}\PYG{n}{avgMetrics}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\PYG{g+go}{0.5}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{cvModel}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{0.8333...}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.4.0.}
\index{copy() (pyspark.ml.tuning.CrossValidator method)@\spxentry{copy()}\spxextra{pyspark.ml.tuning.CrossValidator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidator.copy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{copy}}}{\emph{extra=None}}{}
Creates a copy of this instance with a randomly generated uid
and some extra params. This copies creates a deep copy of
the embedded paramMap, and copies the embedded and extra parameters over.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{extra}} \textendash{} Extra parameters to copy to the new instance

\item[{Returns}] \leavevmode
Copy of this instance

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{getNumFolds() (pyspark.ml.tuning.CrossValidator method)@\spxentry{getNumFolds()}\spxextra{pyspark.ml.tuning.CrossValidator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidator.getNumFolds}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getNumFolds}}}{}{}
Gets the value of numFolds or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{read() (pyspark.ml.tuning.CrossValidator class method)@\spxentry{read()}\spxextra{pyspark.ml.tuning.CrossValidator class method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidator.read}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{classmethod }}\sphinxbfcode{\sphinxupquote{read}}}{}{}
Returns an MLReader instance for this class.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{setNumFolds() (pyspark.ml.tuning.CrossValidator method)@\spxentry{setNumFolds()}\spxextra{pyspark.ml.tuning.CrossValidator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidator.setNumFolds}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setNumFolds}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{numFolds}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.tuning.CrossValidator method)@\spxentry{setParams()}\spxextra{pyspark.ml.tuning.CrossValidator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidator.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{estimator=None}, \emph{estimatorParamMaps=None}, \emph{evaluator=None}, \emph{numFolds=3}, \emph{seed=None}, \emph{parallelism=1}, \emph{collectSubModels=False}}{}
setParams(self, estimator=None, estimatorParamMaps=None, evaluator=None, numFolds=3,                  seed=None, parallelism=1, collectSubModels=False):
Sets params for cross validator.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{write() (pyspark.ml.tuning.CrossValidator method)@\spxentry{write()}\spxextra{pyspark.ml.tuning.CrossValidator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidator.write}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{write}}}{}{}
Returns an MLWriter instance for this ML instance.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{CrossValidatorModel (class in pyspark.ml.tuning)@\spxentry{CrossValidatorModel}\spxextra{class in pyspark.ml.tuning}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidatorModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.tuning.}}\sphinxbfcode{\sphinxupquote{CrossValidatorModel}}}{\emph{bestModel}, \emph{avgMetrics={[}{]}}, \emph{subModels=None}}{}
CrossValidatorModel contains the model with the highest average cross-validation
metric across folds and uses this model to transform input data. CrossValidatorModel
also tracks the metrics for each param map evaluated.

\DUrole{versionmodified}{New in version 1.4.0.}
\index{avgMetrics (pyspark.ml.tuning.CrossValidatorModel attribute)@\spxentry{avgMetrics}\spxextra{pyspark.ml.tuning.CrossValidatorModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidatorModel.avgMetrics}}\pysigline{\sphinxbfcode{\sphinxupquote{avgMetrics}}\sphinxbfcode{\sphinxupquote{ = None}}}
Average cross-validation metrics for each paramMap in
CrossValidator.estimatorParamMaps, in the corresponding order.

\end{fulllineitems}

\index{bestModel (pyspark.ml.tuning.CrossValidatorModel attribute)@\spxentry{bestModel}\spxextra{pyspark.ml.tuning.CrossValidatorModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidatorModel.bestModel}}\pysigline{\sphinxbfcode{\sphinxupquote{bestModel}}\sphinxbfcode{\sphinxupquote{ = None}}}
best model from cross validation

\end{fulllineitems}

\index{copy() (pyspark.ml.tuning.CrossValidatorModel method)@\spxentry{copy()}\spxextra{pyspark.ml.tuning.CrossValidatorModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidatorModel.copy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{copy}}}{\emph{extra=None}}{}
Creates a copy of this instance with a randomly generated uid
and some extra params. This copies the underlying bestModel,
creates a deep copy of the embedded paramMap, and
copies the embedded and extra parameters over.
It does not copy the extra Params into the subModels.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{extra}} \textendash{} Extra parameters to copy to the new instance

\item[{Returns}] \leavevmode
Copy of this instance

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{read() (pyspark.ml.tuning.CrossValidatorModel class method)@\spxentry{read()}\spxextra{pyspark.ml.tuning.CrossValidatorModel class method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidatorModel.read}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{classmethod }}\sphinxbfcode{\sphinxupquote{read}}}{}{}
Returns an MLReader instance for this class.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{subModels (pyspark.ml.tuning.CrossValidatorModel attribute)@\spxentry{subModels}\spxextra{pyspark.ml.tuning.CrossValidatorModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidatorModel.subModels}}\pysigline{\sphinxbfcode{\sphinxupquote{subModels}}\sphinxbfcode{\sphinxupquote{ = None}}}
sub model list from cross validation

\end{fulllineitems}

\index{write() (pyspark.ml.tuning.CrossValidatorModel method)@\spxentry{write()}\spxextra{pyspark.ml.tuning.CrossValidatorModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.CrossValidatorModel.write}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{write}}}{}{}
Returns an MLWriter instance for this ML instance.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{TrainValidationSplit (class in pyspark.ml.tuning)@\spxentry{TrainValidationSplit}\spxextra{class in pyspark.ml.tuning}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplit}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.tuning.}}\sphinxbfcode{\sphinxupquote{TrainValidationSplit}}}{\emph{estimator=None}, \emph{estimatorParamMaps=None}, \emph{evaluator=None}, \emph{trainRatio=0.75}, \emph{parallelism=1}, \emph{collectSubModels=False}, \emph{seed=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Validation for hyper-parameter tuning. Randomly splits the input dataset into train and
validation sets, and uses evaluation metric on the validation set to select the best model.
Similar to {\hyperref[\detokenize{api:pyspark.ml.tuning.CrossValidator}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{CrossValidator}}}}}, but only splits the set once.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{classification} \PYG{k}{import} \PYG{n}{LogisticRegression}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{evaluation} \PYG{k}{import} \PYG{n}{BinaryClassificationEvaluator}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}
\PYG{g+gp}{... }    \PYG{p}{[}\PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }     \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.4}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }     \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.5}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }     \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.6}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }     \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{]} \PYG{o}{*} \PYG{l+m+mi}{10}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{lr} \PYG{o}{=} \PYG{n}{LogisticRegression}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{grid} \PYG{o}{=} \PYG{n}{ParamGridBuilder}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{addGrid}\PYG{p}{(}\PYG{n}{lr}\PYG{o}{.}\PYG{n}{maxIter}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{build}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{BinaryClassificationEvaluator}\PYG{p}{(}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{tvs} \PYG{o}{=} \PYG{n}{TrainValidationSplit}\PYG{p}{(}\PYG{n}{estimator}\PYG{o}{=}\PYG{n}{lr}\PYG{p}{,} \PYG{n}{estimatorParamMaps}\PYG{o}{=}\PYG{n}{grid}\PYG{p}{,} \PYG{n}{evaluator}\PYG{o}{=}\PYG{n}{evaluator}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{n}{parallelism}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{tvsModel} \PYG{o}{=} \PYG{n}{tvs}\PYG{o}{.}\PYG{n}{fit}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{tvsModel}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{0.8333...}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.0.0.}
\index{copy() (pyspark.ml.tuning.TrainValidationSplit method)@\spxentry{copy()}\spxextra{pyspark.ml.tuning.TrainValidationSplit method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplit.copy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{copy}}}{\emph{extra=None}}{}
Creates a copy of this instance with a randomly generated uid
and some extra params. This copies creates a deep copy of
the embedded paramMap, and copies the embedded and extra parameters over.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{extra}} \textendash{} Extra parameters to copy to the new instance

\item[{Returns}] \leavevmode
Copy of this instance

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{getTrainRatio() (pyspark.ml.tuning.TrainValidationSplit method)@\spxentry{getTrainRatio()}\spxextra{pyspark.ml.tuning.TrainValidationSplit method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplit.getTrainRatio}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getTrainRatio}}}{}{}
Gets the value of trainRatio or its default value.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{read() (pyspark.ml.tuning.TrainValidationSplit class method)@\spxentry{read()}\spxextra{pyspark.ml.tuning.TrainValidationSplit class method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplit.read}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{classmethod }}\sphinxbfcode{\sphinxupquote{read}}}{}{}
Returns an MLReader instance for this class.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.tuning.TrainValidationSplit method)@\spxentry{setParams()}\spxextra{pyspark.ml.tuning.TrainValidationSplit method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplit.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{estimator=None}, \emph{estimatorParamMaps=None}, \emph{evaluator=None}, \emph{trainRatio=0.75}, \emph{parallelism=1}, \emph{collectSubModels=False}, \emph{seed=None}}{}
setParams(self, estimator=None, estimatorParamMaps=None, evaluator=None, trainRatio=0.75,                  parallelism=1, collectSubModels=False, seed=None):
Sets params for the train validation split.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{setTrainRatio() (pyspark.ml.tuning.TrainValidationSplit method)@\spxentry{setTrainRatio()}\spxextra{pyspark.ml.tuning.TrainValidationSplit method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplit.setTrainRatio}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setTrainRatio}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{trainRatio}}.

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{write() (pyspark.ml.tuning.TrainValidationSplit method)@\spxentry{write()}\spxextra{pyspark.ml.tuning.TrainValidationSplit method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplit.write}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{write}}}{}{}
Returns an MLWriter instance for this ML instance.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{TrainValidationSplitModel (class in pyspark.ml.tuning)@\spxentry{TrainValidationSplitModel}\spxextra{class in pyspark.ml.tuning}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplitModel}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.tuning.}}\sphinxbfcode{\sphinxupquote{TrainValidationSplitModel}}}{\emph{bestModel}, \emph{validationMetrics={[}{]}}, \emph{subModels=None}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Model from train validation split.

\DUrole{versionmodified}{New in version 2.0.0.}
\index{bestModel (pyspark.ml.tuning.TrainValidationSplitModel attribute)@\spxentry{bestModel}\spxextra{pyspark.ml.tuning.TrainValidationSplitModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplitModel.bestModel}}\pysigline{\sphinxbfcode{\sphinxupquote{bestModel}}\sphinxbfcode{\sphinxupquote{ = None}}}
best model from train validation split

\end{fulllineitems}

\index{copy() (pyspark.ml.tuning.TrainValidationSplitModel method)@\spxentry{copy()}\spxextra{pyspark.ml.tuning.TrainValidationSplitModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplitModel.copy}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{copy}}}{\emph{extra=None}}{}
Creates a copy of this instance with a randomly generated uid
and some extra params. This copies the underlying bestModel,
creates a deep copy of the embedded paramMap, and
copies the embedded and extra parameters over.
And, this creates a shallow copy of the validationMetrics.
It does not copy the extra Params into the subModels.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{extra}} \textendash{} Extra parameters to copy to the new instance

\item[{Returns}] \leavevmode
Copy of this instance

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 2.0.0.}

\end{fulllineitems}

\index{read() (pyspark.ml.tuning.TrainValidationSplitModel class method)@\spxentry{read()}\spxextra{pyspark.ml.tuning.TrainValidationSplitModel class method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplitModel.read}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{classmethod }}\sphinxbfcode{\sphinxupquote{read}}}{}{}
Returns an MLReader instance for this class.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{subModels (pyspark.ml.tuning.TrainValidationSplitModel attribute)@\spxentry{subModels}\spxextra{pyspark.ml.tuning.TrainValidationSplitModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplitModel.subModels}}\pysigline{\sphinxbfcode{\sphinxupquote{subModels}}\sphinxbfcode{\sphinxupquote{ = None}}}
sub models from train validation split

\end{fulllineitems}

\index{validationMetrics (pyspark.ml.tuning.TrainValidationSplitModel attribute)@\spxentry{validationMetrics}\spxextra{pyspark.ml.tuning.TrainValidationSplitModel attribute}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplitModel.validationMetrics}}\pysigline{\sphinxbfcode{\sphinxupquote{validationMetrics}}\sphinxbfcode{\sphinxupquote{ = None}}}
evaluated validation metrics

\end{fulllineitems}

\index{write() (pyspark.ml.tuning.TrainValidationSplitModel method)@\spxentry{write()}\spxextra{pyspark.ml.tuning.TrainValidationSplitModel method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.tuning.TrainValidationSplitModel.write}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{write}}}{}{}
Returns an MLWriter instance for this ML instance.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}


\end{fulllineitems}



\section{Evaluation API}
\label{\detokenize{api:module-pyspark.ml.evaluation}}\label{\detokenize{api:evaluation-api}}\index{pyspark.ml.evaluation (module)@\spxentry{pyspark.ml.evaluation}\spxextra{module}}\index{Evaluator (class in pyspark.ml.evaluation)@\spxentry{Evaluator}\spxextra{class in pyspark.ml.evaluation}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.Evaluator}}\pysigline{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.evaluation.}}\sphinxbfcode{\sphinxupquote{Evaluator}}}
Base class for evaluators that compute metrics from predictions.

\DUrole{versionmodified}{New in version 1.4.0.}
\index{evaluate() (pyspark.ml.evaluation.Evaluator method)@\spxentry{evaluate()}\spxextra{pyspark.ml.evaluation.Evaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.Evaluator.evaluate}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{evaluate}}}{\emph{dataset}, \emph{params=None}}{}
Evaluates the output with optional parameters.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode\begin{itemize}
\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{dataset}} \textendash{} a dataset that contains labels/observations and
predictions

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{params}} \textendash{} an optional param map that overrides embedded
params

\end{itemize}

\item[{Returns}] \leavevmode
metric

\end{description}\end{quote}

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{isLargerBetter() (pyspark.ml.evaluation.Evaluator method)@\spxentry{isLargerBetter()}\spxextra{pyspark.ml.evaluation.Evaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.Evaluator.isLargerBetter}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{isLargerBetter}}}{}{}
Indicates whether the metric returned by {\hyperref[\detokenize{api:pyspark.ml.evaluation.Evaluator.evaluate}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{evaluate()}}}}} should be maximized
(True, default) or minimized (False).
A given evaluator may support multiple metrics which may be maximized or minimized.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{BinaryClassificationEvaluator (class in pyspark.ml.evaluation)@\spxentry{BinaryClassificationEvaluator}\spxextra{class in pyspark.ml.evaluation}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.BinaryClassificationEvaluator}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.evaluation.}}\sphinxbfcode{\sphinxupquote{BinaryClassificationEvaluator}}}{\emph{rawPredictionCol='rawPrediction'}, \emph{labelCol='label'}, \emph{metricName='areaUnderROC'}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Evaluator for binary classification, which expects two input columns: rawPrediction and label.
The rawPrediction column can be of type double (binary 0/1 prediction, or probability of label
1) or of type vector (length-2 vector of raw predictions, scores, or label probabilities).

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{scoreAndLabels} \PYG{o}{=} \PYG{n+nb}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{1.0} \PYG{o}{\PYGZhy{}} \PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }   \PYG{p}{[}\PYG{p}{(}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{0.4}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{0.6}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{0.8}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{scoreAndLabels}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{raw}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{BinaryClassificationEvaluator}\PYG{p}{(}\PYG{n}{rawPredictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{raw}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{)}
\PYG{g+go}{0.70...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{metricName}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{areaUnderPR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{g+go}{0.83...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{bce\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/bce}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{bce\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator2} \PYG{o}{=} \PYG{n}{BinaryClassificationEvaluator}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{bce\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{evaluator2}\PYG{o}{.}\PYG{n}{getRawPredictionCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{\PYGZsq{}raw\PYGZsq{}}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.4.0.}
\index{getMetricName() (pyspark.ml.evaluation.BinaryClassificationEvaluator method)@\spxentry{getMetricName()}\spxextra{pyspark.ml.evaluation.BinaryClassificationEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.BinaryClassificationEvaluator.getMetricName}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getMetricName}}}{}{}
Gets the value of metricName or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setMetricName() (pyspark.ml.evaluation.BinaryClassificationEvaluator method)@\spxentry{setMetricName()}\spxextra{pyspark.ml.evaluation.BinaryClassificationEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.BinaryClassificationEvaluator.setMetricName}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setMetricName}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{metricName}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.evaluation.BinaryClassificationEvaluator method)@\spxentry{setParams()}\spxextra{pyspark.ml.evaluation.BinaryClassificationEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.BinaryClassificationEvaluator.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{rawPredictionCol="rawPrediction"}, \emph{labelCol="label"}, \emph{metricName="areaUnderROC"}}{}
Sets params for binary classification evaluator.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{RegressionEvaluator (class in pyspark.ml.evaluation)@\spxentry{RegressionEvaluator}\spxextra{class in pyspark.ml.evaluation}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.RegressionEvaluator}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.evaluation.}}\sphinxbfcode{\sphinxupquote{RegressionEvaluator}}}{\emph{predictionCol='prediction'}, \emph{labelCol='label'}, \emph{metricName='rmse'}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Evaluator for Regression, which expects two input
columns: prediction and label.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{scoreAndLabels} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{28.98343821}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{27.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{20.21491975}\PYG{p}{,} \PYG{l+m+mf}{21.5}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }  \PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{25.98418959}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{22.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{30.69731842}\PYG{p}{,} \PYG{l+m+mf}{33.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{74.69283752}\PYG{p}{,} \PYG{l+m+mf}{71.0}\PYG{p}{)}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{scoreAndLabels}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{raw}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{RegressionEvaluator}\PYG{p}{(}\PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{raw}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{)}
\PYG{g+go}{2.842...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{metricName}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{r2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{g+go}{0.993...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{metricName}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{mae}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{g+go}{2.649...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{re\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/re}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{re\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator2} \PYG{o}{=} \PYG{n}{RegressionEvaluator}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{re\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{evaluator2}\PYG{o}{.}\PYG{n}{getPredictionCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{\PYGZsq{}raw\PYGZsq{}}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.4.0.}
\index{getMetricName() (pyspark.ml.evaluation.RegressionEvaluator method)@\spxentry{getMetricName()}\spxextra{pyspark.ml.evaluation.RegressionEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.RegressionEvaluator.getMetricName}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getMetricName}}}{}{}
Gets the value of metricName or its default value.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setMetricName() (pyspark.ml.evaluation.RegressionEvaluator method)@\spxentry{setMetricName()}\spxextra{pyspark.ml.evaluation.RegressionEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.RegressionEvaluator.setMetricName}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setMetricName}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{metricName}}.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.evaluation.RegressionEvaluator method)@\spxentry{setParams()}\spxextra{pyspark.ml.evaluation.RegressionEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.RegressionEvaluator.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{predictionCol="prediction"}, \emph{labelCol="label"}, \emph{metricName="rmse"}}{}
Sets params for regression evaluator.

\DUrole{versionmodified}{New in version 1.4.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{MulticlassClassificationEvaluator (class in pyspark.ml.evaluation)@\spxentry{MulticlassClassificationEvaluator}\spxextra{class in pyspark.ml.evaluation}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.MulticlassClassificationEvaluator}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.evaluation.}}\sphinxbfcode{\sphinxupquote{MulticlassClassificationEvaluator}}}{\emph{predictionCol='prediction'}, \emph{labelCol='label'}, \emph{metricName='f1'}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Evaluator for Multiclass Classification, which expects two input
columns: prediction and label.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{scoreAndLabels} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{l+m+mf}{2.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+m+mf}{2.0}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{]}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{scoreAndLabels}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{label}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{MulticlassClassificationEvaluator}\PYG{p}{(}\PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{)}
\PYG{g+go}{0.66...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{metricName}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{accuracy}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{g+go}{0.66...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{mce\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/mce}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{mce\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator2} \PYG{o}{=} \PYG{n}{MulticlassClassificationEvaluator}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{mce\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{evaluator2}\PYG{o}{.}\PYG{n}{getPredictionCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{\PYGZsq{}prediction\PYGZsq{}}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 1.5.0.}
\index{getMetricName() (pyspark.ml.evaluation.MulticlassClassificationEvaluator method)@\spxentry{getMetricName()}\spxextra{pyspark.ml.evaluation.MulticlassClassificationEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.MulticlassClassificationEvaluator.getMetricName}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getMetricName}}}{}{}
Gets the value of metricName or its default value.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{setMetricName() (pyspark.ml.evaluation.MulticlassClassificationEvaluator method)@\spxentry{setMetricName()}\spxextra{pyspark.ml.evaluation.MulticlassClassificationEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.MulticlassClassificationEvaluator.setMetricName}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setMetricName}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{metricName}}.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.evaluation.MulticlassClassificationEvaluator method)@\spxentry{setParams()}\spxextra{pyspark.ml.evaluation.MulticlassClassificationEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.MulticlassClassificationEvaluator.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{predictionCol="prediction"}, \emph{labelCol="label"}, \emph{metricName="f1"}}{}
Sets params for multiclass classification evaluator.

\DUrole{versionmodified}{New in version 1.5.0.}

\end{fulllineitems}


\end{fulllineitems}

\index{ClusteringEvaluator (class in pyspark.ml.evaluation)@\spxentry{ClusteringEvaluator}\spxextra{class in pyspark.ml.evaluation}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.ClusteringEvaluator}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{pyspark.ml.evaluation.}}\sphinxbfcode{\sphinxupquote{ClusteringEvaluator}}}{\emph{predictionCol='prediction'}, \emph{featuresCol='features'}, \emph{metricName='silhouette'}, \emph{distanceMeasure='squaredEuclidean'}}{}~
\begin{sphinxadmonition}{note}{Note:}
Experimental
\end{sphinxadmonition}

Evaluator for Clustering results, which expects two input
columns: prediction and features. The metric computes the Silhouette
measure using the squared Euclidean distance.

The Silhouette is a measure for the validation of the consistency
within clusters. It ranges between 1 and -1, where a value close to
1 means that the points in a cluster are close to the other points
in the same cluster and far from the points of the other clusters.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{k+kn}{from} \PYG{n+nn}{pyspark}\PYG{n+nn}{.}\PYG{n+nn}{ml}\PYG{n+nn}{.}\PYG{n+nn}{linalg} \PYG{k}{import} \PYG{n}{Vectors}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{featureAndPredictions} \PYG{o}{=} \PYG{n+nb}{map}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{p}{(}\PYG{n}{Vectors}\PYG{o}{.}\PYG{n}{dense}\PYG{p}{(}\PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{x}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{[}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.0}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{10.0}\PYG{p}{,} \PYG{l+m+mf}{11.0}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,}
\PYG{g+gp}{... }    \PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{10.5}\PYG{p}{,} \PYG{l+m+mf}{11.5}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{1.0}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{8.0}\PYG{p}{,} \PYG{l+m+mf}{6.0}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{dataset} \PYG{o}{=} \PYG{n}{spark}\PYG{o}{.}\PYG{n}{createDataFrame}\PYG{p}{(}\PYG{n}{featureAndPredictions}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{features}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{g+gp}{...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator} \PYG{o}{=} \PYG{n}{ClusteringEvaluator}\PYG{p}{(}\PYG{n}{predictionCol}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{prediction}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{evaluate}\PYG{p}{(}\PYG{n}{dataset}\PYG{p}{)}
\PYG{g+go}{0.9079...}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{ce\PYGZus{}path} \PYG{o}{=} \PYG{n}{temp\PYGZus{}path} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/ce}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{n}{ce\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n}{evaluator2} \PYG{o}{=} \PYG{n}{ClusteringEvaluator}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{n}{ce\PYGZus{}path}\PYG{p}{)}
\PYG{g+gp}{\PYGZgt{}\PYGZgt{}\PYGZgt{} }\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{evaluator2}\PYG{o}{.}\PYG{n}{getPredictionCol}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{g+go}{\PYGZsq{}prediction\PYGZsq{}}
\end{sphinxVerbatim}

\DUrole{versionmodified}{New in version 2.3.0.}
\index{getDistanceMeasure() (pyspark.ml.evaluation.ClusteringEvaluator method)@\spxentry{getDistanceMeasure()}\spxextra{pyspark.ml.evaluation.ClusteringEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.ClusteringEvaluator.getDistanceMeasure}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getDistanceMeasure}}}{}{}
Gets the value of \(distanceMeasure\)

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{getMetricName() (pyspark.ml.evaluation.ClusteringEvaluator method)@\spxentry{getMetricName()}\spxextra{pyspark.ml.evaluation.ClusteringEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.ClusteringEvaluator.getMetricName}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{getMetricName}}}{}{}
Gets the value of metricName or its default value.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{setDistanceMeasure() (pyspark.ml.evaluation.ClusteringEvaluator method)@\spxentry{setDistanceMeasure()}\spxextra{pyspark.ml.evaluation.ClusteringEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.ClusteringEvaluator.setDistanceMeasure}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setDistanceMeasure}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{distanceMeasure}}.

\DUrole{versionmodified}{New in version 2.4.0.}

\end{fulllineitems}

\index{setMetricName() (pyspark.ml.evaluation.ClusteringEvaluator method)@\spxentry{setMetricName()}\spxextra{pyspark.ml.evaluation.ClusteringEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.ClusteringEvaluator.setMetricName}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setMetricName}}}{\emph{value}}{}
Sets the value of \sphinxcode{\sphinxupquote{metricName}}.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}

\index{setParams() (pyspark.ml.evaluation.ClusteringEvaluator method)@\spxentry{setParams()}\spxextra{pyspark.ml.evaluation.ClusteringEvaluator method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:pyspark.ml.evaluation.ClusteringEvaluator.setParams}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{setParams}}}{\emph{self}, \emph{predictionCol="prediction"}, \emph{featuresCol="features"}, \emph{metricName="silhouette"}, \emph{distanceMeasure="squaredEuclidean"}}{}
Sets params for clustering evaluator.

\DUrole{versionmodified}{New in version 2.3.0.}

\end{fulllineitems}


\end{fulllineitems}



\chapter{Main Reference}
\label{\detokenize{reference:main-reference}}\label{\detokenize{reference:reference}}\label{\detokenize{reference::doc}}
\begin{sphinxthebibliography}{Kirillov}
\bibitem[Feng2017]{reference:feng2017}\begin{enumerate}
\def\theenumi{\Alph{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{22}
\item {} 
Feng and M. Chen. \sphinxhref{https://mingchen0919.github.io/learning-apache-spark/index.html}{Learning Apache Spark}, Github 2017.

\end{enumerate}
\bibitem[Karau2015]{reference:karau2015}\begin{enumerate}
\def\theenumi{\Alph{enumi}}
\def\labelenumi{\theenumi .}
\makeatletter\def\p@enumii{\p@enumi \theenumi .}\makeatother
\setcounter{enumi}{7}
\item {} 
Karau, A. Konwinski, P. Wendell and M. Zaharia. Learning Spark: Lightning-Fast Big Data Analysis. O’Reilly Media, Inc., 2015

\end{enumerate}
\bibitem[Kirillov2016]{reference:kirillov2016}
Anton Kirillov. Apache Spark: core concepts, architecture and internals. \sphinxurl{http://datastrophic.io/core-concepts-architecture-and-internals-of-apache-spark/}
\end{sphinxthebibliography}


\renewcommand{\indexname}{Python Module Index}
\begin{sphinxtheindex}
\let\bigletter\sphinxstyleindexlettergroup
\bigletter{p}
\item\relax\sphinxstyleindexentry{pyspark.ml.classification}\sphinxstyleindexpageref{api:\detokenize{module-pyspark.ml.classification}}
\item\relax\sphinxstyleindexentry{pyspark.ml.clustering}\sphinxstyleindexpageref{api:\detokenize{module-pyspark.ml.clustering}}
\item\relax\sphinxstyleindexentry{pyspark.ml.evaluation}\sphinxstyleindexpageref{api:\detokenize{module-pyspark.ml.evaluation}}
\item\relax\sphinxstyleindexentry{pyspark.ml.pipeline}\sphinxstyleindexpageref{api:\detokenize{module-pyspark.ml.pipeline}}
\item\relax\sphinxstyleindexentry{pyspark.ml.recommendation}\sphinxstyleindexpageref{api:\detokenize{module-pyspark.ml.recommendation}}
\item\relax\sphinxstyleindexentry{pyspark.ml.regression}\sphinxstyleindexpageref{api:\detokenize{module-pyspark.ml.regression}}
\item\relax\sphinxstyleindexentry{pyspark.ml.stat}\sphinxstyleindexpageref{api:\detokenize{module-pyspark.ml.stat}}
\item\relax\sphinxstyleindexentry{pyspark.ml.tuning}\sphinxstyleindexpageref{api:\detokenize{module-pyspark.ml.tuning}}
\end{sphinxtheindex}

\renewcommand{\indexname}{Index}
\printindex
\end{document}